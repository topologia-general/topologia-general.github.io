!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("THREE")):"function"==typeof define&&define.amd?define("MathBox",["THREE"],e):"object"==typeof exports?exports.MathBox=e(require("THREE")):t.MathBox=e(t.THREE)}(self,(function(t){return(()=>{var e={3036:(t,e,i)=>{var n=i(2016);t.exports=function(t){for(var e=n(),i=0;i<t.length;i++)e(t[i]);return e(null)}},3837:t=>{let e,i,n,r;const s={nud:function(){return this.children&&this.children.length?this:g("unexpected")()},led:g("missing operator")},o={};function a(){return this}function l(t,e){let i=o[t];return e=e||0,i?e>i.lbp&&(i.lbp=e):(i=Object.create(s),i.id=t,i.lbp=e,o[t]=i),i}function h(t){let e,n=i;for(m(),e=n.nud();t<i.lbp;)n=i,m(),e=n.led(e);return e}function u(t,e,i){l(t,e).led=i||function(t){return this.children=[t,h(e)],this.type="binary",this}}function c(t,e,i){const n=l(t,e);return n.led=i||function(t){return this.children=[t,h(e-1)],this.type="binary",this},n}function p(t,e){const i=l(t);return i.nud=e||function(){return this.children=[h(70)],this.type="unary",this},i}function d(t){l(t,150).led=function(t){return this.children=[t],this.type="suffix",this}}function f(t){return c(t,10,(function(t){return this.children=[t,h(9)],this.assignment=!0,this.type="assign",this}))}function m(t){let s,l,h,u;if(t&&i.data!==t)return e.unexpected("expected `"+t+"`, got `"+i.data+"`");if(!(r>=n.length)){if(s=n[r++],l=s.data,h=s.type,"ident"===h)u=e.scope.find(l)||e.create_node(),h=u.type;else if("builtin"===h)u=o["(builtin)"];else if("keyword"===h)u=o["(keyword)"];else if("operator"===h){if(u=o[l],!u)return e.unexpected("unknown operator `"+l+"`")}else{if("float"!==h&&"integer"!==h)return e.unexpected("unexpected token.");h="literal",u=o["(literal)"]}return u&&(u.nud||(u.nud=a),u.children||(u.children=[])),u=Object.create(u),u.token=s,u.type=h,u.data||(u.data=l),i=u}i=o["(end)"]}function g(t){return function(){return e.unexpected(t)}}l("(ident)").nud=a,l("(keyword)").nud=a,l("(builtin)").nud=a,l("(literal)").nud=a,l("(end)"),l(":"),l(";"),l(","),l(")"),l("]"),l("}"),c("&&",30),c("||",30),u("|",43),u("^",44),u("&",45),u("==",46),u("!=",46),u("<",47),u("<=",47),u(">",47),u(">=",47),u(">>",48),u("<<",48),u("+",50),u("-",50),u("*",60),u("/",60),u("%",60),u("?",20,(function(t){return this.children=[t,h(0),(m(":"),h(0))],this.type="ternary",this})),u(".",80,(function(t){return i.type="literal",e.fake(i),this.children=[t,i],m(),this})),u("[",80,(function(t){return this.children=[t,h(0)],this.type="binary",m("]"),this})),u("(",80,(function(t){if(this.children=[t],this.type="call",")"!==i.data)for(;this.children.push(h(0)),","===i.data;)m(",");return m(")"),this})),p("-"),p("+"),p("!"),p("~"),p("defined"),p("(",(function(){return this.type="group",this.children=[h(0)],m(")"),this})),p("++"),p("--"),d("++"),d("--"),f("="),f("+="),f("-="),f("*="),f("/="),f("%="),f("&="),f("|="),f("^="),f(">>="),f("<<="),t.exports=function(t,i){let s;if(e=t,n=i,r=0,n.length){if(m(),s=h(0),s.parent=e[0],function t(i){e.unshift(i,!1);for(let e=0,n=i.children.length;e<n;++e)t(i.children[e]);e.shift()}(s),r<n.length)throw new Error("did not use all tokens");s.parent.children=[s]}}},2016:(t,e,i)=>{t.exports=function(){const t=At(h),e=At(l),i=At(f),o=At(b),x=At(a),w=(At(k),At(c)),D=At(p),L=At(m),N=At(v),R=At(g),U=At(z),V=At(C),B=At(O);let $,H,W,X,G,Y,Z,Q,J,K,tt,et,it,nt=arguments.length?[].slice.call(arguments):[],rt=!1,st=!1,ot=[],at=[],lt=[],ht=[],ut=!1;return ot.shift=vt,ot.unshift=gt,ot.fake=mt,ot.unexpected=Dt,ot.scope=new r(ot),ot.create_node=function(){const t=j(a,et);return t.parent=ct.program,t},Bt(),it=t(),it.expecting="(eof)",it.mode=h,it.token={type:"(program)",data:"(program)"},tt=it,ct.program=tt,ct.scope=function(t){return 1===arguments.length&&(ot.scope=t),ot.scope},ot.unshift(it),ct;function ct(t){return null===t?(dt(),tt):(at=[],pt(t),at)}function pt(t){if("whitespace"!==t.type&&"line-comment"!==t.type&&"block-comment"!==t.type)for(lt.push(t),et=et||lt[0],et&&ht.length&&(et.preceding=et.preceding||[],et.preceding=et.preceding.concat(ht),ht=[]);ft();)switch(ot[0].mode){case l:bt();break;case h:yt();break;case d:wt();break;case f:_t();break;case y:Mt();break;case u:$(!0,!0);break;case b:H();break;case a:St();break;case _:zt();break;case k:kt();break;case c:J();break;case p:K();break;case m:X();break;case g:Z();break;case C:Q();break;case z:Y();break;case v:G();break;case O:W()}else ht.push(t)}function dt(t){arguments.length&&pt(t),ot.length>1?Dt("unexpected EOF"):rt=!0}function ft(){return!(ut||!ot.length)&&(et=lt[0])}function mt(t){ot.unshift(t),ot.shift()}function gt(t,e){t.parent=ot[0];const i=[].unshift.call(this,t);return(e=void 0===e||e)&&it!==t&&it.children.push(t),it=t,i}function vt(){let t=[].shift.call(this),e=nt[this.length],i=!1;return nt.length?"function"==typeof nt[0]?i=nt[0](t):void 0!==e&&(i=e.test?e.test(t.type):e===t.type):i=!0,i&&!ut&&at.push(t),it=t.parent,t}function yt(){return Ft((function(){return ot.scope.enter(),s}),(function(){if(et.data===ot[0].expecting)return ot.scope.exit(),ot.shift();if("preprocessor"===et.type)return ot.fake(Ct()),void lt.shift();return void ot.unshift(e())}))()}function bt(){if(ot[0].brace)return"}"!==et.data?Dt("expected `}`, got "+et.data):(ot[0].brace=!1,lt.shift(),ot.shift());switch(et.type){case"eof":return xt();case"keyword":switch(et.data){case"for":return ot.unshift(L());case"if":return ot.unshift(N());case"while":return ot.unshift(R());case"do":return ot.unshift(V());case"break":return ot.fake(j(S,et)),lt.shift();case"continue":return ot.fake(j(M,et)),lt.shift();case"discard":return ot.fake(j(A,et)),lt.shift();case"return":return ot.unshift(U());case"precision":return ot.unshift(o())}return ot.unshift(Tt(E));case"ident":var e;if(e=ot.scope.find(et.data))return"struct"===e.parent.type?ot.unshift(Tt(E)):ot.unshift(Et(";"));case"operator":if("{"===et.data){ot[0].brace=!0;const e=t();return e.expecting="}",lt.shift(),ot.unshift(e)}if(";"===et.data)return lt.shift(),ot.shift();default:return ot.unshift(Et(";"))}}function xt(){return st&&(ut=!0),st=!0,ot.shift()}function wt(){const t=ot[0];return Ft((function(){return"invariant"===et.data?8&t.flags?(ot.unshift(Pt()),s):Dt("`invariant` is not allowed here"):(ot.fake(j(T,{data:"",position:et.position})),s)}),(function(){return q(et)?16&t.flags?(ot.unshift(Pt()),s):Dt("storage is not allowed here"):(ot.fake(j(T,{data:"",position:et.position})),s)}),(function(){return F(et)?32&t.flags?Dt("parameter is not allowed here"):(ot.unshift(Pt()),s):(ot.fake(j(T,{data:"",position:et.position})),s)}),(function(){return I(et)?(ot.unshift(Pt()),s):(ot.fake(j(T,{data:"",position:et.position})),s)}),(function(){if("struct"===et.data)return 64&t.flags?(ot.unshift(Ot()),s):Dt("cannot nest structs");if("keyword"===et.type)return ot.unshift(Pt()),s;const e=ot.scope.find(et.data);if(e)return ot.fake(Object.create(e)),lt.shift(),s;return Dt("expected user defined type, struct or keyword, got "+et.data)}),(function(){if(","===et.data&&!(2&t.flags))return ot.shift();if("["===et.data)return void ot.unshift(B());if(")"===et.data)return ot.shift();if(";"===et.data)return t.stage+3;if("ident"!==et.type&&"builtin"!==et.type)return Dt("expected identifier, got "+et.data);return t.collected_name=lt.shift(),s}),(function(){if("("===et.data)return lt.unshift(t.collected_name),delete t.collected_name,ot.unshift(w()),t.stage+2;return s}),(function(){return lt.unshift(t.collected_name),delete t.collected_name,ot.unshift(i()),s}),(function(){return ot.shift()}))()}function _t(){if("ident"===et.type||"builtin"===et.type){const t=et.data;return ot.unshift(x()),void ot.scope.define(t)}if("operator"===et.type){if(","===et.data)return 2&ot[1].flags?lt.shift():ot.shift();if("="===et.data)return 1&ot[1].flags?(lt.shift(),void ot.unshift(Et(",",";"))):Dt("`=` is not allowed here.");if("["===et.data)return void ot.unshift(B())}return ot.shift()}function kt(){return"keyword"===et.type?(ot[0].type="keyword",void(ot[0].mode=_)):"ident"===et.type?(ot[0].type="ident",void(ot[0].mode=a)):Dt("expected keyword or user-defined name, got "+et.data)}function zt(){return"keyword"!==et.type?Dt("expected keyword, got "+et.data):(ot.shift(),lt.shift())}function St(){return"ident"!==et.type&&"builtin"!==et.type?Dt("expected user-defined name, got "+et.data):(ot[0].data=et.data,ot.shift(),lt.shift())}function Mt(){const t=ot[0].expecting;if(ot[0].tokens=ot[0].tokens||[],void 0===ot[0].parenlevel&&(ot[0].parenlevel=0,ot[0].bracelevel=0),ot[0].parenlevel<1&&t.indexOf(et.data)>-1)return function(t){try{n(ot,t)}catch(t){throw ut=!0,t}return ot.shift()}(ot[0].tokens);switch("("===et.data?++ot[0].parenlevel:")"===et.data&&--ot[0].parenlevel,et.data){case"{":++ot[0].bracelevel;break;case"}":--ot[0].bracelevel;break;case"(":++ot[0].parenlevel;break;case")":--ot[0].parenlevel}return ot[0].parenlevel<0?Dt("unexpected `)`"):ot[0].bracelevel<0?Dt("unexpected `}`"):void ot[0].tokens.push(lt.shift())}function At(t){return function(){return j(t,et)}}function Ct(){return j(P[et.type],et)}function Tt(t){const e=j(d,et);return e.flags=t,e}function Ot(t,e){const i=j(u,et);return i.allow_assign=void 0===t||t,i.allow_comma=void 0===e||e,i}function Et(){const t=j(y,et);return t.expecting=[].slice.call(arguments),t}function Pt(t){let e=et;return t&&(e={type:"(implied)",data:"(default)",position:e.position}),j(_,e)}function Dt(t){throw ut=!0,new Error((t||"unexpected "+ot)+" at line "+ot[0].token.line)}function jt(t,e){return qt(t,et.type)&&qt(e,et.data)}function qt(t,e){switch(typeof t){case"string":return e!==t&&Dt("expected `"+t+"`, got "+e+"\n"+et.data),!ut;case"object":return t&&-1===t.indexOf(e)&&Dt("expected one of `"+t.join("`, `")+"`, got "+e),!ut}return!0}function Ft(){let t,e,i=[].slice.call(arguments);return function(){const n=ot[0];return n.stage||(n.stage=0),t=i[n.stage],t?(e=t(),e===s?++n.stage:void(void 0!==e&&(n.stage=e))):Dt("parser in undefined state!")}}function It(t,e){return e=e||"operator",function(){if(!jt(e,t))return;const i=lt.shift(),n=ot[0].children,r=n[n.length-1];return r&&r.token&&i.preceding&&(r.token.succeeding=r.token.succeeding||[],r.token.succeeding=r.token.succeeding.concat(i.preceding)),s}}function Lt(t){return function(){return ot.unshift(Et(t)),s}}function Nt(t){return t?function(){const t=et.data;return jt("ident")&&(ot.unshift(x()),ot.scope.define(t),s)}:function(){if(!jt("ident"))return;return Object.create(ot.scope.find(et.data)).token=et,lt.shift(),s}}function Rt(){return function(){const e=t();return e.expecting="}",ot.unshift(e),s}}function Ut(t){return function(){const i=ot[0].stage;return"{"!==et.data?(ot.unshift(e()),i+t):(lt.shift(),s)}}function Vt(){return function(){return ot.shift(),ot.shift()}}function Bt(){$=Ft(It("struct","keyword"),(function(){return"{"===et.data?(ot.fake(j(a,{data:"",position:et.position,type:"ident"})),s):Nt(!0)()}),(function(){return ot.scope.enter(),s}),It("{"),(function(){return"preprocessor"===et.type?(ot.fake(Ct()),void lt.shift()):"}"===et.data?(ot.scope.exit(),lt.shift(),ot.shift()):void(";"!==et.data?ot.unshift(Tt(166)):lt.shift())})),H=Ft((function(){return lt.shift(),s}),(function(){return jt("keyword",["lowp","mediump","highp"])&&(ot.unshift(Pt()),s)}),(function(){return ot.unshift(Pt()),s}),(function(){return ot.shift()})),W=Ft(It("["),Lt("]"),It("]"),(function(){return ot.shift()})),X=Ft(It("for","keyword"),It("("),(function(){let t;if("ident"===et.type){if((t=ot.scope.find(et.data))||(t=ot.create_node()),"struct"===t.parent.type)return ot.unshift(Tt(E)),s}else if("builtin"===et.type||"keyword"===et.type)return ot.unshift(Tt(E)),s;return Lt(";")()}),It(";"),Lt(";"),It(";"),Lt(")"),It(")"),Ut(3),Rt(),It("}"),Vt()),G=Ft(It("if","keyword"),It("("),Lt(")"),It(")"),Ut(3),Rt(),It("}"),(function(){return"else"===et.data?(lt.shift(),ot.unshift(e()),s):Vt()()}),Vt()),Y=Ft(It("return","keyword"),(function(){return";"===et.data||ot.unshift(Et(";")),s}),(function(){lt.shift(),Vt()()})),Z=Ft(It("while","keyword"),It("("),Lt(")"),It(")"),Ut(3),Rt(),It("}"),Vt()),Q=Ft(It("do","keyword"),Ut(3),Rt(),It("}"),It("while","keyword"),It("("),Lt(")"),It(")"),Vt()),J=Ft((function(){for(let t=1,e=ot.length;t<e;++t)if(ot[t].mode===c)return Dt("function definition is not allowed within another function");return s}),(function(){if(!jt("ident"))return;const t=et.data,e=ot.scope.find(t);return ot.unshift(x()),ot.scope.define(t),ot.scope.enter(e?e.scope:null),s}),It("("),(function(){return ot.unshift(D()),s}),It(")"),(function(){return";"===et.data?(ot.scope.exit(),ot.shift(),ot.shift()):s}),It("{"),Rt(),It("}"),(function(){return ot.scope.exit(),s}),(function(){return ot.shift(),ot.shift(),ot.shift()})),K=Ft((function(){return"void"===et.data?(ot.fake(Pt()),lt.shift(),s):")"!==et.data?"struct"===et.data?(ot.unshift(Ot(false,false)),s):(ot.unshift(Tt(208)),s):void ot.shift()}),(function(){if(","===et.data)return lt.shift(),0;")"!==et.data?Dt("expected one of `,` or `)`, got "+et.data):ot.shift()}))}};const n=i(3837),r=i(8816),s=new Object;let o=0,a=o++,l=o++,h=o++,u=o++,c=o++,p=o++,d=o++,f=o++,m=o++,g=o++,v=o++,y=o++,b=o++,x=o++,w=o++,_=o++,k=o++,z=o++,S=o++,M=o++,A=o++,C=o++,T=o++,O=o++;const E=255,P={"block-comment":x,"line-comment":x,preprocessor:w},D=o=["ident","stmt","stmtlist","struct","function","functionargs","decl","decllist","forloop","whileloop","if","expr","precision","comment","preprocessor","keyword","keyword_or_ident","return","break","continue","discard","do-while","placeholder","quantifier"];function j(t,e){return{mode:t,token:e,children:[],type:D[t],id:(4294967295*Math.random()).toString(16)}}function q(t){return"const"===t.data||"attribute"===t.data||"uniform"===t.data||"varying"===t.data}function F(t){return"in"===t.data||"inout"===t.data||"out"===t.data}function I(t){return"highp"===t.data||"mediump"===t.data||"lowp"===t.data}},8816:t=>{function e(t){if(this.constructor!==e)return new e(t);this.state=t,this.scopes=[],this.current=null}t.exports=e;const i=e.prototype;i.enter=function(t){this.scopes.push(this.current=this.state[0].scope=t||{})},i.exit=function(){this.scopes.pop(),this.current=this.scopes[this.scopes.length-1]},i.define=function(t){this.current[t]=this.state[0]},i.find=function(t,e){for(let e=this.scopes.length-1;e>-1;--e)if(this.scopes[e].hasOwnProperty(t))return this.scopes[e][t];return null}},1073:t=>{t.exports={trueFunc:function(){return!0},falseFunc:function(){return!1}}},996:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.attributeRules=void 0;var n=i(1073),r=/[-[\]{}()*+?.,\\^$|#\s]/g;function s(t){return t.replace(r,"\\$&")}e.attributeRules={equals:function(t,e,i){var n=i.adapter,r=e.name,s=e.value;return e.ignoreCase?(s=s.toLowerCase(),function(e){var i=n.getAttributeValue(e,r);return null!=i&&i.length===s.length&&i.toLowerCase()===s&&t(e)}):function(e){return n.getAttributeValue(e,r)===s&&t(e)}},hyphen:function(t,e,i){var n=i.adapter,r=e.name,s=e.value,o=s.length;return e.ignoreCase?(s=s.toLowerCase(),function(e){var i=n.getAttributeValue(e,r);return null!=i&&(i.length===o||"-"===i.charAt(o))&&i.substr(0,o).toLowerCase()===s&&t(e)}):function(e){var i=n.getAttributeValue(e,r);return null!=i&&(i.length===o||"-"===i.charAt(o))&&i.substr(0,o)===s&&t(e)}},element:function(t,e,i){var r=e.name,o=e.value,a=e.ignoreCase,l=i.adapter;if(/\s/.test(o))return n.falseFunc;var h=new RegExp("(?:^|\\s)".concat(s(o),"(?:$|\\s)"),a?"i":"");return function(e){var i=l.getAttributeValue(e,r);return null!=i&&i.length>=o.length&&h.test(i)&&t(e)}},exists:function(t,e,i){var n=e.name,r=i.adapter;return function(e){return r.hasAttrib(e,n)&&t(e)}},start:function(t,e,i){var r=i.adapter,s=e.name,o=e.value,a=o.length;return 0===a?n.falseFunc:e.ignoreCase?(o=o.toLowerCase(),function(e){var i=r.getAttributeValue(e,s);return null!=i&&i.length>=a&&i.substr(0,a).toLowerCase()===o&&t(e)}):function(e){var i;return!!(null===(i=r.getAttributeValue(e,s))||void 0===i?void 0:i.startsWith(o))&&t(e)}},end:function(t,e,i){var r=i.adapter,s=e.name,o=e.value,a=-o.length;return 0===a?n.falseFunc:e.ignoreCase?(o=o.toLowerCase(),function(e){var i;return(null===(i=r.getAttributeValue(e,s))||void 0===i?void 0:i.substr(a).toLowerCase())===o&&t(e)}):function(e){var i;return!!(null===(i=r.getAttributeValue(e,s))||void 0===i?void 0:i.endsWith(o))&&t(e)}},any:function(t,e,i){var r=i.adapter,o=e.name,a=e.value;if(""===a)return n.falseFunc;if(e.ignoreCase){var l=new RegExp(s(a),"i");return function(e){var i=r.getAttributeValue(e,o);return null!=i&&i.length>=a.length&&l.test(i)&&t(e)}}return function(e){var i;return!!(null===(i=r.getAttributeValue(e,o))||void 0===i?void 0:i.includes(a))&&t(e)}},not:function(t,e,i){var n=i.adapter,r=e.name,s=e.value;return""===s?function(e){return!!n.getAttributeValue(e,r)&&t(e)}:e.ignoreCase?(s=s.toLowerCase(),function(e){var i=n.getAttributeValue(e,r);return(null==i||i.length!==s.length||i.toLowerCase()!==s)&&t(e)}):function(e){return n.getAttributeValue(e,r)!==s&&t(e)}}}},8866:function(t,e,i){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.compileToken=e.compileUnsafe=e.compile=void 0;var r=i(9751),s=i(1073),o=n(i(7353)),a=i(7177),l=i(3621),h=i(1768);function u(t,e,i){return m("string"==typeof t?(0,r.parse)(t,e):t,e,i)}function c(t){return"pseudo"===t.type&&("scope"===t.name||Array.isArray(t.data)&&t.data.some((function(t){return t.some(c)})))}e.compile=function(t,e,i){var n=u(t,e,i);return(0,h.ensureIsTag)(n,e.adapter)},e.compileUnsafe=u;var p={type:"descendant"},d={type:"_flexibleDescendant"},f={type:"pseudo",name:"scope",data:null};function m(t,e,i){var n;(t=t.filter((function(t){return t.length>0}))).forEach(o.default),i=null!==(n=e.context)&&void 0!==n?n:i;var r=Array.isArray(i),u=i&&(Array.isArray(i)?i:[i]);!function(t,e,i){for(var n=e.adapter,r=!!(null==i?void 0:i.every((function(t){var e=n.isTag(t)&&n.getParent(t);return t===h.PLACEHOLDER_ELEMENT||e&&n.isTag(e)}))),s=0,o=t;s<o.length;s++){var l=o[s];if(l.length>0&&(0,a.isTraversal)(l[0])&&"descendant"!==l[0].type);else{if(!r||l.some(c))continue;l.unshift(p)}l.unshift(f)}}(t,e,u);var v=!1,y=t.map((function(t){if(t.length>=2){var i=t[0],n=t[1];"pseudo"!==i.type||"scope"!==i.name||(r&&"descendant"===n.type?t[1]=d:"adjacent"!==n.type&&"sibling"!==n.type||(v=!0))}return function(t,e,i){var n;return t.reduce((function(t,n){return t===s.falseFunc?s.falseFunc:(0,l.compileGeneralSelector)(t,n,e,i,m)}),null!==(n=e.rootFunc)&&void 0!==n?n:s.trueFunc)}(t,e,u)})).reduce(g,s.falseFunc);return y.shouldTestNextSiblings=v,y}function g(t,e){return e===s.falseFunc||t===s.trueFunc?t:t===s.falseFunc||e===s.trueFunc?e:function(i){return t(i)||e(i)}}e.compileToken=m},3621:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.compileGeneralSelector=void 0;var n=i(996),r=i(8677);e.compileGeneralSelector=function(t,e,i,s,o){var a=i.adapter,l=i.equals;switch(e.type){case"pseudo-element":throw new Error("Pseudo-elements are not supported by css-select");case"attribute":return n.attributeRules[e.action](t,e,i);case"pseudo":return(0,r.compilePseudoSelector)(t,e,i,s,o);case"tag":return function(i){return a.getName(i)===e.name&&t(i)};case"descendant":if(!1===i.cacheResults||"undefined"==typeof WeakSet)return function(e){for(var i=e;i=a.getParent(i);)if(a.isTag(i)&&t(i))return!0;return!1};var h=new WeakSet;return function(e){for(var i=e;i=a.getParent(i);)if(!h.has(i)){if(a.isTag(i)&&t(i))return!0;h.add(i)}return!1};case"_flexibleDescendant":return function(e){var i=e;do{if(a.isTag(i)&&t(i))return!0}while(i=a.getParent(i));return!1};case"parent":return function(e){return a.getChildren(e).some((function(e){return a.isTag(e)&&t(e)}))};case"child":return function(e){var i=a.getParent(e);return null!=i&&a.isTag(i)&&t(i)};case"sibling":return function(e){for(var i=a.getSiblings(e),n=0;n<i.length;n++){var r=i[n];if(l(e,r))break;if(a.isTag(r)&&t(r))return!0}return!1};case"adjacent":return function(e){for(var i,n=a.getSiblings(e),r=0;r<n.length;r++){var s=n[r];if(l(e,s))break;a.isTag(s)&&(i=s)}return!!i&&t(i)};case"universal":return t}}},5366:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return r(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.aliases=e.pseudos=e.filters=e.is=e.selectOne=e.selectAll=e.prepareContext=e._compileToken=e._compileUnsafe=e.compile=void 0;var o=s(i(9432)),a=i(1073),l=i(8866),h=i(1768),u=function(t,e){return t===e},c={adapter:o,equals:u};function p(t){var e,i,n,r,s=null!=t?t:c;return null!==(e=s.adapter)&&void 0!==e||(s.adapter=o),null!==(i=s.equals)&&void 0!==i||(s.equals=null!==(r=null===(n=s.adapter)||void 0===n?void 0:n.equals)&&void 0!==r?r:u),s}function d(t){return function(e,i,n){var r=p(i);return t(e,r,n)}}function f(t){return function(e,i,n){var r=p(n);"function"!=typeof e&&(e=(0,l.compileUnsafe)(e,r,i));var s=m(i,r.adapter,e.shouldTestNextSiblings);return t(e,s,r)}}function m(t,e,i){return void 0===i&&(i=!1),i&&(t=function(t,e){for(var i=Array.isArray(t)?t.slice(0):[t],n=i.length,r=0;r<n;r++){var s=(0,h.getNextSiblings)(i[r],e);i.push.apply(i,s)}return i}(t,e)),Array.isArray(t)?e.removeSubsets(t):e.getChildren(t)}e.compile=d(l.compile),e._compileUnsafe=d(l.compileUnsafe),e._compileToken=d(l.compileToken),e.prepareContext=m,e.selectAll=f((function(t,e,i){return t!==a.falseFunc&&e&&0!==e.length?i.adapter.findAll(t,e):[]})),e.selectOne=f((function(t,e,i){return t!==a.falseFunc&&e&&0!==e.length?i.adapter.findOne(t,e):null})),e.is=function(t,e,i){var n=p(i);return("function"==typeof e?e:(0,l.compile)(e,n))(t)},e.default=e.selectAll;var g=i(8677);Object.defineProperty(e,"filters",{enumerable:!0,get:function(){return g.filters}}),Object.defineProperty(e,"pseudos",{enumerable:!0,get:function(){return g.pseudos}}),Object.defineProperty(e,"aliases",{enumerable:!0,get:function(){return g.aliases}})},7177:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isTraversal=e.procedure=void 0,e.procedure={universal:50,tag:30,attribute:1,pseudo:0,"pseudo-element":0,descendant:-1,child:-1,parent:-1,sibling:-1,adjacent:-1,_flexibleDescendant:-1},e.isTraversal=function(t){return e.procedure[t.type]<0}},2968:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.aliases=void 0,e.aliases={"any-link":":is(a, area, link)[href]",link:":any-link:not(:visited)",disabled:":is(\n        :is(button, input, select, textarea, optgroup, option)[disabled],\n        optgroup[disabled] > option,\n        fieldset[disabled]:not(fieldset[disabled] legend:first-of-type *)\n    )",enabled:":not(:disabled)",checked:":is(:is(input[type=radio], input[type=checkbox])[checked], option:selected)",required:":is(input, select, textarea)[required]",optional:":is(input, select, textarea):not([required])",selected:"option:is([selected], select:not([multiple]):not(:has(> option[selected])) > :first-of-type)",checkbox:"[type=checkbox]",file:"[type=file]",password:"[type=password]",radio:"[type=radio]",reset:"[type=reset]",image:"[type=image]",submit:"[type=submit]",parent:":not(:empty)",header:":is(h1, h2, h3, h4, h5, h6)",button:":is(button, input[type=button])",input:":is(input, textarea, select, button)",text:"input:is(:not([type!='']), [type=text])"}},7689:function(t,e,i){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.filters=void 0;var r=n(i(7540)),s=i(1073);function o(t,e){return function(i){var n=e.getParent(i);return null!=n&&e.isTag(n)&&t(i)}}function a(t){return function(e,i,n){var r=n.adapter[t];return"function"!=typeof r?s.falseFunc:function(t){return r(t)&&e(t)}}}e.filters={contains:function(t,e,i){var n=i.adapter;return function(i){return t(i)&&n.getText(i).includes(e)}},icontains:function(t,e,i){var n=i.adapter,r=e.toLowerCase();return function(e){return t(e)&&n.getText(e).toLowerCase().includes(r)}},"nth-child":function(t,e,i){var n=i.adapter,a=i.equals,l=(0,r.default)(e);return l===s.falseFunc?s.falseFunc:l===s.trueFunc?o(t,n):function(e){for(var i=n.getSiblings(e),r=0,s=0;s<i.length&&!a(e,i[s]);s++)n.isTag(i[s])&&r++;return l(r)&&t(e)}},"nth-last-child":function(t,e,i){var n=i.adapter,a=i.equals,l=(0,r.default)(e);return l===s.falseFunc?s.falseFunc:l===s.trueFunc?o(t,n):function(e){for(var i=n.getSiblings(e),r=0,s=i.length-1;s>=0&&!a(e,i[s]);s--)n.isTag(i[s])&&r++;return l(r)&&t(e)}},"nth-of-type":function(t,e,i){var n=i.adapter,a=i.equals,l=(0,r.default)(e);return l===s.falseFunc?s.falseFunc:l===s.trueFunc?o(t,n):function(e){for(var i=n.getSiblings(e),r=0,s=0;s<i.length;s++){var o=i[s];if(a(e,o))break;n.isTag(o)&&n.getName(o)===n.getName(e)&&r++}return l(r)&&t(e)}},"nth-last-of-type":function(t,e,i){var n=i.adapter,a=i.equals,l=(0,r.default)(e);return l===s.falseFunc?s.falseFunc:l===s.trueFunc?o(t,n):function(e){for(var i=n.getSiblings(e),r=0,s=i.length-1;s>=0;s--){var o=i[s];if(a(e,o))break;n.isTag(o)&&n.getName(o)===n.getName(e)&&r++}return l(r)&&t(e)}},root:function(t,e,i){var n=i.adapter;return function(e){var i=n.getParent(e);return(null==i||!n.isTag(i))&&t(e)}},scope:function(t,i,n,r){var s=n.equals;return r&&0!==r.length?1===r.length?function(e){return s(r[0],e)&&t(e)}:function(e){return r.includes(e)&&t(e)}:e.filters.root(t,i,n)},hover:a("isHovered"),visited:a("isVisited"),active:a("isActive")}},8677:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.compilePseudoSelector=e.aliases=e.pseudos=e.filters=void 0;var n=i(1073),r=i(9751),s=i(7689);Object.defineProperty(e,"filters",{enumerable:!0,get:function(){return s.filters}});var o=i(7221);Object.defineProperty(e,"pseudos",{enumerable:!0,get:function(){return o.pseudos}});var a=i(2968);Object.defineProperty(e,"aliases",{enumerable:!0,get:function(){return a.aliases}});var l=i(1768);e.compilePseudoSelector=function(t,e,i,h,u){var c=e.name,p=e.data;if(Array.isArray(p))return l.subselects[c](t,p,i,h,u);if(c in a.aliases){if(null!=p)throw new Error("Pseudo ".concat(c," doesn't have any arguments"));var d=(0,r.parse)(a.aliases[c],i);return l.subselects.is(t,d,i,h,u)}if(c in s.filters)return s.filters[c](t,p,i,h);if(c in o.pseudos){var f=o.pseudos[c];return(0,o.verifyPseudoArgs)(f,c,p),f===n.falseFunc?n.falseFunc:t===n.trueFunc?function(t){return f(t,i,p)}:function(e){return f(e,i,p)&&t(e)}}throw new Error("unmatched pseudo-class :".concat(c))}},7221:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.verifyPseudoArgs=e.pseudos=void 0,e.pseudos={empty:function(t,e){var i=e.adapter;return!i.getChildren(t).some((function(t){return i.isTag(t)||""!==i.getText(t)}))},"first-child":function(t,e){var i=e.adapter,n=e.equals,r=i.getSiblings(t).find((function(t){return i.isTag(t)}));return null!=r&&n(t,r)},"last-child":function(t,e){for(var i=e.adapter,n=e.equals,r=i.getSiblings(t),s=r.length-1;s>=0;s--){if(n(t,r[s]))return!0;if(i.isTag(r[s]))break}return!1},"first-of-type":function(t,e){for(var i=e.adapter,n=e.equals,r=i.getSiblings(t),s=i.getName(t),o=0;o<r.length;o++){var a=r[o];if(n(t,a))return!0;if(i.isTag(a)&&i.getName(a)===s)break}return!1},"last-of-type":function(t,e){for(var i=e.adapter,n=e.equals,r=i.getSiblings(t),s=i.getName(t),o=r.length-1;o>=0;o--){var a=r[o];if(n(t,a))return!0;if(i.isTag(a)&&i.getName(a)===s)break}return!1},"only-of-type":function(t,e){var i=e.adapter,n=e.equals,r=i.getName(t);return i.getSiblings(t).every((function(e){return n(t,e)||!i.isTag(e)||i.getName(e)!==r}))},"only-child":function(t,e){var i=e.adapter,n=e.equals;return i.getSiblings(t).every((function(e){return n(t,e)||!i.isTag(e)}))}},e.verifyPseudoArgs=function(t,e,i){if(null===i){if(t.length>2)throw new Error("pseudo-selector :".concat(e," requires an argument"))}else if(2===t.length)throw new Error("pseudo-selector :".concat(e," doesn't have any arguments"))}},1768:function(t,e,i){"use strict";var n=this&&this.__spreadArray||function(t,e,i){if(i||2===arguments.length)for(var n,r=0,s=e.length;r<s;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.subselects=e.getNextSiblings=e.ensureIsTag=e.PLACEHOLDER_ELEMENT=void 0;var r=i(1073),s=i(7177);function o(t,e){return t===r.falseFunc?r.falseFunc:function(i){return e.isTag(i)&&t(i)}}function a(t,e){var i=e.getSiblings(t);if(i.length<=1)return[];var n=i.indexOf(t);return n<0||n===i.length-1?[]:i.slice(n+1).filter(e.isTag)}e.PLACEHOLDER_ELEMENT={},e.ensureIsTag=o,e.getNextSiblings=a;var l=function(t,e,i,n,r){var s=r(e,{xmlMode:!!i.xmlMode,adapter:i.adapter,equals:i.equals},n);return function(e){return s(e)&&t(e)}};e.subselects={is:l,matches:l,where:l,not:function(t,e,i,n,s){var o=s(e,{xmlMode:!!i.xmlMode,adapter:i.adapter,equals:i.equals},n);return o===r.falseFunc?t:o===r.trueFunc?r.falseFunc:function(e){return!o(e)&&t(e)}},has:function(t,i,l,h,u){var c=l.adapter,p={xmlMode:!!l.xmlMode,adapter:c,equals:l.equals},d=i.some((function(t){return t.some(s.isTraversal)}))?[e.PLACEHOLDER_ELEMENT]:void 0,f=u(i,p,d);if(f===r.falseFunc)return r.falseFunc;if(f===r.trueFunc)return function(e){return c.getChildren(e).some(c.isTag)&&t(e)};var m=o(f,c),g=f.shouldTestNextSiblings,v=void 0!==g&&g;return d?function(e){d[0]=e;var i=c.getChildren(e),r=v?n(n([],i,!0),a(e,c),!0):i;return t(e)&&c.existsOne(m,r)}:function(e){return t(e)&&c.existsOne(m,c.getChildren(e))}}}},7353:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(7177),r={exists:10,equals:8,not:7,start:6,end:6,any:5,hyphen:4,element:4};function s(t){var e=n.procedure[t.type];if("attribute"===t.type)(e=r[t.action])===r.equals&&"id"===t.name&&(e=9),t.ignoreCase&&(e>>=1);else if("pseudo"===t.type)if(t.data)if("has"===t.name||"contains"===t.name)e=0;else if(Array.isArray(t.data)){e=0;for(var i=0;i<t.data.length;i++)if(1===t.data[i].length){var o=s(t.data[i][0]);if(0===o){e=0;break}o>e&&(e=o)}t.data.length>1&&e>0&&(e-=1)}else e=1;else e=3;return e}e.default=function(t){for(var e=t.map(s),i=1;i<t.length;i++){var n=e[i];if(!(n<0))for(var r=i-1;r>=0&&n<e[r];r--){var o=t[r+1];t[r+1]=t[r],t[r]=o,e[r+1]=e[r],e[r]=n}}}},9751:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||n(e,t,i)},s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.stringify=e.parse=void 0,r(i(675),e);var o=i(675);Object.defineProperty(e,"parse",{enumerable:!0,get:function(){return s(o).default}});var a=i(6868);Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return s(a).default}})},675:function(t,e){"use strict";var i=this&&this.__spreadArray||function(t,e,i){if(i||2===arguments.length)for(var n,r=0,s=e.length;r<s;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.isTraversal=void 0;var n=/^[^\\#]?(?:\\(?:[\da-f]{1,6}\s?|.)|[\w\-\u00b0-\uFFFF])+/,r=/\\([\da-f]{1,6}\s?|(\s)|.)/gi,s=new Map([["~","element"],["^","start"],["$","end"],["*","any"],["!","not"],["|","hyphen"]]),o={">":"child","<":"parent","~":"sibling","+":"adjacent"},a={"#":["id","equals"],".":["class","element"]},l=new Set(["has","not","matches","is","where","host","host-context"]),h=new Set(i(["descendant"],Object.keys(o).map((function(t){return o[t]})),!0)),u=new Set(["accept","accept-charset","align","alink","axis","bgcolor","charset","checked","clear","codetype","color","compact","declare","defer","dir","direction","disabled","enctype","face","frame","hreflang","http-equiv","lang","language","link","media","method","multiple","nohref","noresize","noshade","nowrap","readonly","rel","rev","rules","scope","scrolling","selected","shape","target","text","type","valign","valuetype","vlink"]);function c(t){return h.has(t.type)}e.isTraversal=c;var p=new Set(["contains","icontains"]),d=new Set(['"',"'"]);function f(t,e,i){var n=parseInt(e,16)-65536;return n!=n||i?e:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320)}function m(t){return t.replace(r,f)}function g(t){return" "===t||"\n"===t||"\t"===t||"\f"===t||"\r"===t}function v(t,e,i,r){var h,f;void 0===i&&(i={});var b=[],x=!1;function w(t){var i=e.slice(r+t).match(n);if(!i)throw new Error("Expected name, found "+e.slice(r));var s=i[0];return r+=t+s.length,m(s)}function _(t){for(;g(e.charAt(r+t));)t++;r+=t}function k(t){for(var i=0;"\\"===e.charAt(--t);)i++;return 1==(1&i)}function z(){if(b.length>0&&c(b[b.length-1]))throw new Error("Did not expect successive traversals.")}for(_(0);""!==e;){var S=e.charAt(r);if(g(S))x=!0,_(1);else if(S in o)z(),b.push({type:o[S]}),x=!1,_(1);else if(","===S){if(0===b.length)throw new Error("Empty sub-selector");t.push(b),b=[],x=!1,_(1)}else if(e.startsWith("/*",r)){var M=e.indexOf("*/",r+2);if(M<0)throw new Error("Comment was not terminated");r=M+2}else if(x&&(z(),b.push({type:"descendant"}),x=!1),S in a){var A=a[S],C=A[0],T=A[1];b.push({type:"attribute",name:C,action:T,value:w(1),namespace:null,ignoreCase:!!i.xmlMode&&null})}else if("["===S){_(1);var O=null;"|"===e.charAt(r)&&(O="",r+=1),e.startsWith("*|",r)&&(O="*",r+=2);var E=w(0);null===O&&"|"===e.charAt(r)&&"="!==e.charAt(r+1)&&(O=E,E=w(1)),(null!==(h=i.lowerCaseAttributeNames)&&void 0!==h?h:!i.xmlMode)&&(E=E.toLowerCase()),_(0);T="exists";var P=s.get(e.charAt(r));if(P){if(T=P,"="!==e.charAt(r+1))throw new Error("Expected `=`");_(2)}else"="===e.charAt(r)&&(T="equals",_(1));var D="",j=null;if("exists"!==T){if(d.has(e.charAt(r))){for(var q=e.charAt(r),F=r+1;F<e.length&&(e.charAt(F)!==q||k(F));)F+=1;if(e.charAt(F)!==q)throw new Error("Attribute value didn't end");D=m(e.slice(r+1,F)),r=F+1}else{for(var I=r;r<e.length&&(!g(e.charAt(r))&&"]"!==e.charAt(r)||k(r));)r+=1;D=m(e.slice(I,r))}_(0);var L=e.charAt(r);"s"===L||"S"===L?(j=!1,_(1)):"i"!==L&&"I"!==L||(j=!0,_(1))}if(i.xmlMode||null!=j||(j=u.has(E)),"]"!==e.charAt(r))throw new Error("Attribute selector didn't terminate");r+=1;var N={type:"attribute",name:E,action:T,value:D,namespace:O,ignoreCase:j};b.push(N)}else if(":"===S){if(":"===e.charAt(r+1)){b.push({type:"pseudo-element",name:w(2).toLowerCase()});continue}var R=w(1).toLowerCase(),U=null;if("("===e.charAt(r))if(l.has(R)){if(d.has(e.charAt(r+1)))throw new Error("Pseudo-selector "+R+" cannot be quoted");if(r=v(U=[],e,i,r+1),")"!==e.charAt(r))throw new Error("Missing closing parenthesis in :"+R+" ("+e+")");r+=1}else{for(var V=r+=1,B=1;B>0&&r<e.length;r++)"("!==e.charAt(r)||k(r)?")"!==e.charAt(r)||k(r)||B--:B++;if(B)throw new Error("Parenthesis not matched");if(U=e.slice(V,r-1),p.has(R)){var $=U.charAt(0);$===U.slice(-1)&&d.has($)&&(U=U.slice(1,-1)),U=m(U)}}b.push({type:"pseudo",name:R,data:U})}else{O=null;var H=void 0;if("*"===S)r+=1,H="*";else{if(!n.test(e.slice(r)))return b.length&&"descendant"===b[b.length-1].type&&b.pop(),y(t,b),r;"|"===e.charAt(r)&&(O="",r+=1),H=w(0)}"|"===e.charAt(r)&&(O=H,"*"===e.charAt(r+1)?(H="*",r+=2):H=w(1)),"*"===H?b.push({type:"universal",namespace:O}):((null!==(f=i.lowerCaseTags)&&void 0!==f?f:!i.xmlMode)&&(H=H.toLowerCase()),b.push({type:"tag",name:H,namespace:O}))}}return y(t,b),r}function y(t,e){if(t.length>0&&0===e.length)throw new Error("Empty sub-selector");t.push(e)}e.default=function(t,e){var i=[],n=v(i,""+t,e,0);if(n<t.length)throw new Error("Unmatched selector: "+t.slice(n));return i}},6868:function(t,e){"use strict";var i=this&&this.__spreadArray||function(t,e,i){if(i||2===arguments.length)for(var n,r=0,s=e.length;r<s;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0});var n={equals:"",element:"~",start:"^",end:"$",any:"*",not:"!",hyphen:"|"},r=new Set(i(i([],Object.keys(n).map((function(t){return n[t]})).filter(Boolean),!0),[":","[","]"," ","\\","(",")","'"],!1));function s(t){return t.map(o).join(", ")}function o(t){return t.map(a).join("")}function a(t){switch(t.type){case"child":return" > ";case"parent":return" < ";case"sibling":return" ~ ";case"adjacent":return" + ";case"descendant":return" ";case"universal":return h(t.namespace)+"*";case"tag":return l(t);case"pseudo-element":return"::"+u(t.name);case"pseudo":return null===t.data?":"+u(t.name):"string"==typeof t.data?":"+u(t.name)+"("+u(t.data)+")":":"+u(t.name)+"("+s(t.data)+")";case"attribute":if("id"===t.name&&"equals"===t.action&&!t.ignoreCase&&!t.namespace)return"#"+u(t.value);if("class"===t.name&&"element"===t.action&&!t.ignoreCase&&!t.namespace)return"."+u(t.value);var e=l(t);return"exists"===t.action?"["+e+"]":"["+e+n[t.action]+"='"+u(t.value)+"'"+(t.ignoreCase?"i":!1===t.ignoreCase?"s":"")+"]"}}function l(t){return""+h(t.namespace)+u(t.name)}function h(t){return null!==t?("*"===t?"*":u(t))+"|":""}function u(t){return t.split("").map((function(t){return r.has(t)?"\\"+t:t})).join("")}e.default=s},7837:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.attributeNames=e.elementNames=void 0,e.elementNames=new Map([["altglyph","altGlyph"],["altglyphdef","altGlyphDef"],["altglyphitem","altGlyphItem"],["animatecolor","animateColor"],["animatemotion","animateMotion"],["animatetransform","animateTransform"],["clippath","clipPath"],["feblend","feBlend"],["fecolormatrix","feColorMatrix"],["fecomponenttransfer","feComponentTransfer"],["fecomposite","feComposite"],["feconvolvematrix","feConvolveMatrix"],["fediffuselighting","feDiffuseLighting"],["fedisplacementmap","feDisplacementMap"],["fedistantlight","feDistantLight"],["fedropshadow","feDropShadow"],["feflood","feFlood"],["fefunca","feFuncA"],["fefuncb","feFuncB"],["fefuncg","feFuncG"],["fefuncr","feFuncR"],["fegaussianblur","feGaussianBlur"],["feimage","feImage"],["femerge","feMerge"],["femergenode","feMergeNode"],["femorphology","feMorphology"],["feoffset","feOffset"],["fepointlight","fePointLight"],["fespecularlighting","feSpecularLighting"],["fespotlight","feSpotLight"],["fetile","feTile"],["feturbulence","feTurbulence"],["foreignobject","foreignObject"],["glyphref","glyphRef"],["lineargradient","linearGradient"],["radialgradient","radialGradient"],["textpath","textPath"]]),e.attributeNames=new Map([["definitionurl","definitionURL"],["attributename","attributeName"],["attributetype","attributeType"],["basefrequency","baseFrequency"],["baseprofile","baseProfile"],["calcmode","calcMode"],["clippathunits","clipPathUnits"],["diffuseconstant","diffuseConstant"],["edgemode","edgeMode"],["filterunits","filterUnits"],["glyphref","glyphRef"],["gradienttransform","gradientTransform"],["gradientunits","gradientUnits"],["kernelmatrix","kernelMatrix"],["kernelunitlength","kernelUnitLength"],["keypoints","keyPoints"],["keysplines","keySplines"],["keytimes","keyTimes"],["lengthadjust","lengthAdjust"],["limitingconeangle","limitingConeAngle"],["markerheight","markerHeight"],["markerunits","markerUnits"],["markerwidth","markerWidth"],["maskcontentunits","maskContentUnits"],["maskunits","maskUnits"],["numoctaves","numOctaves"],["pathlength","pathLength"],["patterncontentunits","patternContentUnits"],["patterntransform","patternTransform"],["patternunits","patternUnits"],["pointsatx","pointsAtX"],["pointsaty","pointsAtY"],["pointsatz","pointsAtZ"],["preservealpha","preserveAlpha"],["preserveaspectratio","preserveAspectRatio"],["primitiveunits","primitiveUnits"],["refx","refX"],["refy","refY"],["repeatcount","repeatCount"],["repeatdur","repeatDur"],["requiredextensions","requiredExtensions"],["requiredfeatures","requiredFeatures"],["specularconstant","specularConstant"],["specularexponent","specularExponent"],["spreadmethod","spreadMethod"],["startoffset","startOffset"],["stddeviation","stdDeviation"],["stitchtiles","stitchTiles"],["surfacescale","surfaceScale"],["systemlanguage","systemLanguage"],["tablevalues","tableValues"],["targetx","targetX"],["targety","targetY"],["textlength","textLength"],["viewbox","viewBox"],["viewtarget","viewTarget"],["xchannelselector","xChannelSelector"],["ychannelselector","yChannelSelector"],["zoomandpan","zoomAndPan"]])},7220:function(t,e,i){"use strict";var n=this&&this.__assign||function(){return n=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},n.apply(this,arguments)},r=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),s=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),o=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&r(e,t,i);return s(e,t),e};Object.defineProperty(e,"__esModule",{value:!0});var a=o(i(9960)),l=i(5863),h=i(7837),u=new Set(["style","script","xmp","iframe","noembed","noframes","plaintext","noscript"]);var c=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]);function p(t,e){void 0===e&&(e={});for(var i=("length"in t?t:[t]),n="",r=0;r<i.length;r++)n+=d(i[r],e);return n}function d(t,e){switch(t.type){case a.Root:return p(t.children,e);case a.Directive:case a.Doctype:return"<"+t.data+">";case a.Comment:return function(t){return"\x3c!--"+t.data+"--\x3e"}(t);case a.CDATA:return function(t){return"<![CDATA["+t.children[0].data+"]]>"}(t);case a.Script:case a.Style:case a.Tag:return function(t,e){var i;"foreign"===e.xmlMode&&(t.name=null!==(i=h.elementNames.get(t.name))&&void 0!==i?i:t.name,t.parent&&f.has(t.parent.name)&&(e=n(n({},e),{xmlMode:!1})));!e.xmlMode&&m.has(t.name)&&(e=n(n({},e),{xmlMode:"foreign"}));var r="<"+t.name,s=function(t,e){if(t)return Object.keys(t).map((function(i){var n,r,s=null!==(n=t[i])&&void 0!==n?n:"";return"foreign"===e.xmlMode&&(i=null!==(r=h.attributeNames.get(i))&&void 0!==r?r:i),e.emptyAttrs||e.xmlMode||""!==s?i+'="'+(!1!==e.decodeEntities?l.encodeXML(s):s.replace(/"/g,"&quot;"))+'"':i})).join(" ")}(t.attribs,e);s&&(r+=" "+s);0===t.children.length&&(e.xmlMode?!1!==e.selfClosingTags:e.selfClosingTags&&c.has(t.name))?(e.xmlMode||(r+=" "),r+="/>"):(r+=">",t.children.length>0&&(r+=p(t.children,e)),!e.xmlMode&&c.has(t.name)||(r+="</"+t.name+">"));return r}(t,e);case a.Text:return function(t,e){var i=t.data||"";!1===e.decodeEntities||!e.xmlMode&&t.parent&&u.has(t.parent.name)||(i=l.encodeXML(i));return i}(t,e)}}e.default=p;var f=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]),m=new Set(["svg","math"])},9960:(t,e)=>{"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.Doctype=e.CDATA=e.Tag=e.Style=e.Script=e.Comment=e.Directive=e.Text=e.Root=e.isTag=e.ElementType=void 0,function(t){t.Root="root",t.Text="text",t.Directive="directive",t.Comment="comment",t.Script="script",t.Style="style",t.Tag="tag",t.CDATA="cdata",t.Doctype="doctype"}(i=e.ElementType||(e.ElementType={})),e.isTag=function(t){return t.type===i.Tag||t.type===i.Script||t.type===i.Style},e.Root=i.Root,e.Text=i.Text,e.Directive=i.Directive,e.Comment=i.Comment,e.Script=i.Script,e.Style=i.Style,e.Tag=i.Tag,e.CDATA=i.CDATA,e.Doctype=i.Doctype},7915:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||n(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),e.DomHandler=void 0;var s=i(9960),o=i(7790);r(i(7790),e);var a=/\s+/g,l={normalizeWhitespace:!1,withStartIndices:!1,withEndIndices:!1,xmlMode:!1},h=function(){function t(t,e,i){this.dom=[],this.root=new o.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null,"function"==typeof e&&(i=e,e=l),"object"==typeof t&&(e=t,t=void 0),this.callback=null!=t?t:null,this.options=null!=e?e:l,this.elementCB=null!=i?i:null}return t.prototype.onparserinit=function(t){this.parser=t},t.prototype.onreset=function(){this.dom=[],this.root=new o.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null},t.prototype.onend=function(){this.done||(this.done=!0,this.parser=null,this.handleCallback(null))},t.prototype.onerror=function(t){this.handleCallback(t)},t.prototype.onclosetag=function(){this.lastNode=null;var t=this.tagStack.pop();this.options.withEndIndices&&(t.endIndex=this.parser.endIndex),this.elementCB&&this.elementCB(t)},t.prototype.onopentag=function(t,e){var i=this.options.xmlMode?s.ElementType.Tag:void 0,n=new o.Element(t,e,void 0,i);this.addNode(n),this.tagStack.push(n)},t.prototype.ontext=function(t){var e=this.options.normalizeWhitespace,i=this.lastNode;if(i&&i.type===s.ElementType.Text)e?i.data=(i.data+t).replace(a," "):i.data+=t,this.options.withEndIndices&&(i.endIndex=this.parser.endIndex);else{e&&(t=t.replace(a," "));var n=new o.Text(t);this.addNode(n),this.lastNode=n}},t.prototype.oncomment=function(t){if(this.lastNode&&this.lastNode.type===s.ElementType.Comment)this.lastNode.data+=t;else{var e=new o.Comment(t);this.addNode(e),this.lastNode=e}},t.prototype.oncommentend=function(){this.lastNode=null},t.prototype.oncdatastart=function(){var t=new o.Text(""),e=new o.NodeWithChildren(s.ElementType.CDATA,[t]);this.addNode(e),t.parent=e,this.lastNode=t},t.prototype.oncdataend=function(){this.lastNode=null},t.prototype.onprocessinginstruction=function(t,e){var i=new o.ProcessingInstruction(t,e);this.addNode(i)},t.prototype.handleCallback=function(t){if("function"==typeof this.callback)this.callback(t,this.dom);else if(t)throw t},t.prototype.addNode=function(t){var e=this.tagStack[this.tagStack.length-1],i=e.children[e.children.length-1];this.options.withStartIndices&&(t.startIndex=this.parser.startIndex),this.options.withEndIndices&&(t.endIndex=this.parser.endIndex),e.children.push(t),i&&(t.prev=i,i.next=t),t.parent=e,this.lastNode=null},t}();e.DomHandler=h,e.default=h},7790:function(t,e,i){"use strict";var n,r=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=this&&this.__assign||function(){return s=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},s.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.cloneNode=e.hasChildren=e.isDocument=e.isDirective=e.isComment=e.isText=e.isCDATA=e.isTag=e.Element=e.Document=e.NodeWithChildren=e.ProcessingInstruction=e.Comment=e.Text=e.DataNode=e.Node=void 0;var o=i(9960),a=new Map([[o.ElementType.Tag,1],[o.ElementType.Script,1],[o.ElementType.Style,1],[o.ElementType.Directive,1],[o.ElementType.Text,3],[o.ElementType.CDATA,4],[o.ElementType.Comment,8],[o.ElementType.Root,9]]),l=function(){function t(t){this.type=t,this.parent=null,this.prev=null,this.next=null,this.startIndex=null,this.endIndex=null}return Object.defineProperty(t.prototype,"nodeType",{get:function(){var t;return null!==(t=a.get(this.type))&&void 0!==t?t:1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parentNode",{get:function(){return this.parent},set:function(t){this.parent=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"previousSibling",{get:function(){return this.prev},set:function(t){this.prev=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nextSibling",{get:function(){return this.next},set:function(t){this.next=t},enumerable:!1,configurable:!0}),t.prototype.cloneNode=function(t){return void 0===t&&(t=!1),_(this,t)},t}();e.Node=l;var h=function(t){function e(e,i){var n=t.call(this,e)||this;return n.data=i,n}return r(e,t),Object.defineProperty(e.prototype,"nodeValue",{get:function(){return this.data},set:function(t){this.data=t},enumerable:!1,configurable:!0}),e}(l);e.DataNode=h;var u=function(t){function e(e){return t.call(this,o.ElementType.Text,e)||this}return r(e,t),e}(h);e.Text=u;var c=function(t){function e(e){return t.call(this,o.ElementType.Comment,e)||this}return r(e,t),e}(h);e.Comment=c;var p=function(t){function e(e,i){var n=t.call(this,o.ElementType.Directive,i)||this;return n.name=e,n}return r(e,t),e}(h);e.ProcessingInstruction=p;var d=function(t){function e(e,i){var n=t.call(this,e)||this;return n.children=i,n}return r(e,t),Object.defineProperty(e.prototype,"firstChild",{get:function(){var t;return null!==(t=this.children[0])&&void 0!==t?t:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastChild",{get:function(){return this.children.length>0?this.children[this.children.length-1]:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"childNodes",{get:function(){return this.children},set:function(t){this.children=t},enumerable:!1,configurable:!0}),e}(l);e.NodeWithChildren=d;var f=function(t){function e(e){return t.call(this,o.ElementType.Root,e)||this}return r(e,t),e}(d);e.Document=f;var m=function(t){function e(e,i,n,r){void 0===n&&(n=[]),void 0===r&&(r="script"===e?o.ElementType.Script:"style"===e?o.ElementType.Style:o.ElementType.Tag);var s=t.call(this,r,n)||this;return s.name=e,s.attribs=i,s}return r(e,t),Object.defineProperty(e.prototype,"tagName",{get:function(){return this.name},set:function(t){this.name=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attributes",{get:function(){var t=this;return Object.keys(this.attribs).map((function(e){var i,n;return{name:e,value:t.attribs[e],namespace:null===(i=t["x-attribsNamespace"])||void 0===i?void 0:i[e],prefix:null===(n=t["x-attribsPrefix"])||void 0===n?void 0:n[e]}}))},enumerable:!1,configurable:!0}),e}(d);function g(t){return(0,o.isTag)(t)}function v(t){return t.type===o.ElementType.CDATA}function y(t){return t.type===o.ElementType.Text}function b(t){return t.type===o.ElementType.Comment}function x(t){return t.type===o.ElementType.Directive}function w(t){return t.type===o.ElementType.Root}function _(t,e){var i;if(void 0===e&&(e=!1),y(t))i=new u(t.data);else if(b(t))i=new c(t.data);else if(g(t)){var n=e?k(t.children):[],r=new m(t.name,s({},t.attribs),n);n.forEach((function(t){return t.parent=r})),null!=t.namespace&&(r.namespace=t.namespace),t["x-attribsNamespace"]&&(r["x-attribsNamespace"]=s({},t["x-attribsNamespace"])),t["x-attribsPrefix"]&&(r["x-attribsPrefix"]=s({},t["x-attribsPrefix"])),i=r}else if(v(t)){n=e?k(t.children):[];var a=new d(o.ElementType.CDATA,n);n.forEach((function(t){return t.parent=a})),i=a}else if(w(t)){n=e?k(t.children):[];var l=new f(n);n.forEach((function(t){return t.parent=l})),t["x-mode"]&&(l["x-mode"]=t["x-mode"]),i=l}else{if(!x(t))throw new Error("Not implemented yet: ".concat(t.type));var h=new p(t.name,t.data);null!=t["x-name"]&&(h["x-name"]=t["x-name"],h["x-publicId"]=t["x-publicId"],h["x-systemId"]=t["x-systemId"]),i=h}return i.startIndex=t.startIndex,i.endIndex=t.endIndex,null!=t.sourceCodeLocation&&(i.sourceCodeLocation=t.sourceCodeLocation),i}function k(t){for(var e=t.map((function(t){return _(t,!0)})),i=1;i<e.length;i++)e[i].prev=e[i-1],e[i-1].next=e[i];return e}e.Element=m,e.isTag=g,e.isCDATA=v,e.isText=y,e.isComment=b,e.isDirective=x,e.isDocument=w,e.hasChildren=function(t){return Object.prototype.hasOwnProperty.call(t,"children")},e.cloneNode=_},6996:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getFeed=void 0;var n=i(3346),r=i(3905);e.getFeed=function(t){var e=l(c,t);return e?"feed"===e.name?function(t){var e,i=t.children,n={type:"atom",items:(0,r.getElementsByTagName)("entry",i).map((function(t){var e,i=t.children,n={media:a(i)};u(n,"id","id",i),u(n,"title","title",i);var r=null===(e=l("link",i))||void 0===e?void 0:e.attribs.href;r&&(n.link=r);var s=h("summary",i)||h("content",i);s&&(n.description=s);var o=h("updated",i);return o&&(n.pubDate=new Date(o)),n}))};u(n,"id","id",i),u(n,"title","title",i);var s=null===(e=l("link",i))||void 0===e?void 0:e.attribs.href;s&&(n.link=s);u(n,"description","subtitle",i);var o=h("updated",i);o&&(n.updated=new Date(o));return u(n,"author","email",i,!0),n}(e):function(t){var e,i,n=null!==(i=null===(e=l("channel",t.children))||void 0===e?void 0:e.children)&&void 0!==i?i:[],s={type:t.name.substr(0,3),id:"",items:(0,r.getElementsByTagName)("item",t.children).map((function(t){var e=t.children,i={media:a(e)};u(i,"id","guid",e),u(i,"title","title",e),u(i,"link","link",e),u(i,"description","description",e);var n=h("pubDate",e);return n&&(i.pubDate=new Date(n)),i}))};u(s,"title","title",n),u(s,"link","link",n),u(s,"description","description",n);var o=h("lastBuildDate",n);o&&(s.updated=new Date(o));return u(s,"author","managingEditor",n,!0),s}(e):null};var s=["url","type","lang"],o=["fileSize","bitrate","framerate","samplingrate","channels","duration","height","width"];function a(t){return(0,r.getElementsByTagName)("media:content",t).map((function(t){for(var e=t.attribs,i={medium:e.medium,isDefault:!!e.isDefault},n=0,r=s;n<r.length;n++){e[h=r[n]]&&(i[h]=e[h])}for(var a=0,l=o;a<l.length;a++){var h;e[h=l[a]]&&(i[h]=parseInt(e[h],10))}return e.expression&&(i.expression=e.expression),i}))}function l(t,e){return(0,r.getElementsByTagName)(t,e,!0,1)[0]}function h(t,e,i){return void 0===i&&(i=!1),(0,n.textContent)((0,r.getElementsByTagName)(t,e,i,1)).trim()}function u(t,e,i,n,r){void 0===r&&(r=!1);var s=h(i,n,r);s&&(t[e]=s)}function c(t){return"rss"===t||"feed"===t||"rdf:RDF"===t}},4975:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.uniqueSort=e.compareDocumentPosition=e.removeSubsets=void 0;var n=i(7915);function r(t,e){var i=[],r=[];if(t===e)return 0;for(var s=(0,n.hasChildren)(t)?t:t.parent;s;)i.unshift(s),s=s.parent;for(s=(0,n.hasChildren)(e)?e:e.parent;s;)r.unshift(s),s=s.parent;for(var o=Math.min(i.length,r.length),a=0;a<o&&i[a]===r[a];)a++;if(0===a)return 1;var l=i[a-1],h=l.children,u=i[a],c=r[a];return h.indexOf(u)>h.indexOf(c)?l===e?20:4:l===t?10:2}e.removeSubsets=function(t){for(var e=t.length;--e>=0;){var i=t[e];if(e>0&&t.lastIndexOf(i,e-1)>=0)t.splice(e,1);else for(var n=i.parent;n;n=n.parent)if(t.includes(n)){t.splice(e,1);break}}return t},e.compareDocumentPosition=r,e.uniqueSort=function(t){return(t=t.filter((function(t,e,i){return!i.includes(t,e+1)}))).sort((function(t,e){var i=r(t,e);return 2&i?-1:4&i?1:0})),t}},9432:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),r=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||n(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),e.hasChildren=e.isDocument=e.isComment=e.isText=e.isCDATA=e.isTag=void 0,r(i(3346),e),r(i(5010),e),r(i(6765),e),r(i(8043),e),r(i(3905),e),r(i(4975),e),r(i(6996),e);var s=i(7915);Object.defineProperty(e,"isTag",{enumerable:!0,get:function(){return s.isTag}}),Object.defineProperty(e,"isCDATA",{enumerable:!0,get:function(){return s.isCDATA}}),Object.defineProperty(e,"isText",{enumerable:!0,get:function(){return s.isText}}),Object.defineProperty(e,"isComment",{enumerable:!0,get:function(){return s.isComment}}),Object.defineProperty(e,"isDocument",{enumerable:!0,get:function(){return s.isDocument}}),Object.defineProperty(e,"hasChildren",{enumerable:!0,get:function(){return s.hasChildren}})},3905:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getElementsByTagType=e.getElementsByTagName=e.getElementById=e.getElements=e.testElement=void 0;var n=i(7915),r=i(8043),s={tag_name:function(t){return"function"==typeof t?function(e){return(0,n.isTag)(e)&&t(e.name)}:"*"===t?n.isTag:function(e){return(0,n.isTag)(e)&&e.name===t}},tag_type:function(t){return"function"==typeof t?function(e){return t(e.type)}:function(e){return e.type===t}},tag_contains:function(t){return"function"==typeof t?function(e){return(0,n.isText)(e)&&t(e.data)}:function(e){return(0,n.isText)(e)&&e.data===t}}};function o(t,e){return"function"==typeof e?function(i){return(0,n.isTag)(i)&&e(i.attribs[t])}:function(i){return(0,n.isTag)(i)&&i.attribs[t]===e}}function a(t,e){return function(i){return t(i)||e(i)}}function l(t){var e=Object.keys(t).map((function(e){var i=t[e];return Object.prototype.hasOwnProperty.call(s,e)?s[e](i):o(e,i)}));return 0===e.length?null:e.reduce(a)}e.testElement=function(t,e){var i=l(t);return!i||i(e)},e.getElements=function(t,e,i,n){void 0===n&&(n=1/0);var s=l(t);return s?(0,r.filter)(s,e,i,n):[]},e.getElementById=function(t,e,i){return void 0===i&&(i=!0),Array.isArray(e)||(e=[e]),(0,r.findOne)(o("id",t),e,i)},e.getElementsByTagName=function(t,e,i,n){return void 0===i&&(i=!0),void 0===n&&(n=1/0),(0,r.filter)(s.tag_name(t),e,i,n)},e.getElementsByTagType=function(t,e,i,n){return void 0===i&&(i=!0),void 0===n&&(n=1/0),(0,r.filter)(s.tag_type(t),e,i,n)}},6765:(t,e)=>{"use strict";function i(t){if(t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t.parent){var e=t.parent.children;e.splice(e.lastIndexOf(t),1)}}Object.defineProperty(e,"__esModule",{value:!0}),e.prepend=e.prependChild=e.append=e.appendChild=e.replaceElement=e.removeElement=void 0,e.removeElement=i,e.replaceElement=function(t,e){var i=e.prev=t.prev;i&&(i.next=e);var n=e.next=t.next;n&&(n.prev=e);var r=e.parent=t.parent;if(r){var s=r.children;s[s.lastIndexOf(t)]=e}},e.appendChild=function(t,e){if(i(e),e.next=null,e.parent=t,t.children.push(e)>1){var n=t.children[t.children.length-2];n.next=e,e.prev=n}else e.prev=null},e.append=function(t,e){i(e);var n=t.parent,r=t.next;if(e.next=r,e.prev=t,t.next=e,e.parent=n,r){if(r.prev=e,n){var s=n.children;s.splice(s.lastIndexOf(r),0,e)}}else n&&n.children.push(e)},e.prependChild=function(t,e){if(i(e),e.parent=t,e.prev=null,1!==t.children.unshift(e)){var n=t.children[1];n.prev=e,e.next=n}else e.next=null},e.prepend=function(t,e){i(e);var n=t.parent;if(n){var r=n.children;r.splice(r.indexOf(t),0,e)}t.prev&&(t.prev.next=e),e.parent=n,e.prev=t.prev,e.next=t,t.prev=e}},8043:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.findAll=e.existsOne=e.findOne=e.findOneChild=e.find=e.filter=void 0;var n=i(7915);function r(t,e,i,s){for(var o=[],a=0,l=e;a<l.length;a++){var h=l[a];if(t(h)&&(o.push(h),--s<=0))break;if(i&&(0,n.hasChildren)(h)&&h.children.length>0){var u=r(t,h.children,i,s);if(o.push.apply(o,u),(s-=u.length)<=0)break}}return o}e.filter=function(t,e,i,n){return void 0===i&&(i=!0),void 0===n&&(n=1/0),Array.isArray(e)||(e=[e]),r(t,e,i,n)},e.find=r,e.findOneChild=function(t,e){return e.find(t)},e.findOne=function t(e,i,r){void 0===r&&(r=!0);for(var s=null,o=0;o<i.length&&!s;o++){var a=i[o];(0,n.isTag)(a)&&(e(a)?s=a:r&&a.children.length>0&&(s=t(e,a.children)))}return s},e.existsOne=function t(e,i){return i.some((function(i){return(0,n.isTag)(i)&&(e(i)||i.children.length>0&&t(e,i.children))}))},e.findAll=function(t,e){for(var i,r,s=[],o=e.filter(n.isTag);r=o.shift();){var a=null===(i=r.children)||void 0===i?void 0:i.filter(n.isTag);a&&a.length>0&&o.unshift.apply(o,a),t(r)&&s.push(r)}return s}},3346:function(t,e,i){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.innerText=e.textContent=e.getText=e.getInnerHTML=e.getOuterHTML=void 0;var r=i(7915),s=n(i(7220)),o=i(9960);function a(t,e){return(0,s.default)(t,e)}e.getOuterHTML=a,e.getInnerHTML=function(t,e){return(0,r.hasChildren)(t)?t.children.map((function(t){return a(t,e)})).join(""):""},e.getText=function t(e){return Array.isArray(e)?e.map(t).join(""):(0,r.isTag)(e)?"br"===e.name?"\n":t(e.children):(0,r.isCDATA)(e)?t(e.children):(0,r.isText)(e)?e.data:""},e.textContent=function t(e){return Array.isArray(e)?e.map(t).join(""):(0,r.hasChildren)(e)&&!(0,r.isComment)(e)?t(e.children):(0,r.isText)(e)?e.data:""},e.innerText=function t(e){return Array.isArray(e)?e.map(t).join(""):(0,r.hasChildren)(e)&&(e.type===o.ElementType.Tag||(0,r.isCDATA)(e))?t(e.children):(0,r.isText)(e)?e.data:""}},5010:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.prevElementSibling=e.nextElementSibling=e.getName=e.hasAttrib=e.getAttributeValue=e.getSiblings=e.getParent=e.getChildren=void 0;var n=i(7915),r=[];function s(t){var e;return null!==(e=t.children)&&void 0!==e?e:r}function o(t){return t.parent||null}e.getChildren=s,e.getParent=o,e.getSiblings=function(t){var e=o(t);if(null!=e)return s(e);for(var i=[t],n=t.prev,r=t.next;null!=n;)i.unshift(n),n=n.prev;for(;null!=r;)i.push(r),r=r.next;return i},e.getAttributeValue=function(t,e){var i;return null===(i=t.attribs)||void 0===i?void 0:i[e]},e.hasAttrib=function(t,e){return null!=t.attribs&&Object.prototype.hasOwnProperty.call(t.attribs,e)&&null!=t.attribs[e]},e.getName=function(t){return t.name},e.nextElementSibling=function(t){for(var e=t.next;null!==e&&!(0,n.isTag)(e);)e=e.next;return e},e.prevElementSibling=function(t){for(var e=t.prev;null!==e&&!(0,n.isTag)(e);)e=e.prev;return e}},4076:function(t,e,i){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.decodeHTML=e.decodeHTMLStrict=e.decodeXML=void 0;var r=n(i(9323)),s=n(i(9591)),o=n(i(2586)),a=n(i(26)),l=/&(?:[a-zA-Z0-9]+|#[xX][\da-fA-F]+|#\d+);/g;function h(t){var e=c(t);return function(t){return String(t).replace(l,e)}}e.decodeXML=h(o.default),e.decodeHTMLStrict=h(r.default);var u=function(t,e){return t<e?1:-1};function c(t){return function(e){if("#"===e.charAt(1)){var i=e.charAt(2);return"X"===i||"x"===i?a.default(parseInt(e.substr(3),16)):a.default(parseInt(e.substr(2),10))}return t[e.slice(1,-1)]||e}}e.decodeHTML=function(){for(var t=Object.keys(s.default).sort(u),e=Object.keys(r.default).sort(u),i=0,n=0;i<e.length;i++)t[n]===e[i]?(e[i]+=";?",n++):e[i]+=";";var o=new RegExp("&(?:"+e.join("|")+"|#[xX][\\da-fA-F]+;?|#\\d+;?)","g"),a=c(r.default);function l(t){return";"!==t.substr(-1)&&(t+=";"),a(t)}return function(t){return String(t).replace(o,l)}}()},26:function(t,e,i){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var r=n(i(3600)),s=String.fromCodePoint||function(t){var e="";return t>65535&&(t-=65536,e+=String.fromCharCode(t>>>10&1023|55296),t=56320|1023&t),e+=String.fromCharCode(t)};e.default=function(t){return t>=55296&&t<=57343||t>1114111?"�":(t in r.default&&(t=r.default[t]),s(t))}},7322:function(t,e,i){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.escapeUTF8=e.escape=e.encodeNonAsciiHTML=e.encodeHTML=e.encodeXML=void 0;var r=u(n(i(2586)).default),s=c(r);e.encodeXML=g(r);var o,a,l=u(n(i(9323)).default),h=c(l);function u(t){return Object.keys(t).sort().reduce((function(e,i){return e[t[i]]="&"+i+";",e}),{})}function c(t){for(var e=[],i=[],n=0,r=Object.keys(t);n<r.length;n++){var s=r[n];1===s.length?e.push("\\"+s):i.push(s)}e.sort();for(var o=0;o<e.length-1;o++){for(var a=o;a<e.length-1&&e[a].charCodeAt(1)+1===e[a+1].charCodeAt(1);)a+=1;var l=1+a-o;l<3||e.splice(o,l,e[o]+"-"+e[a])}return i.unshift("["+e.join("")+"]"),new RegExp(i.join("|"),"g")}e.encodeHTML=(o=l,a=h,function(t){return t.replace(a,(function(t){return o[t]})).replace(p,f)}),e.encodeNonAsciiHTML=g(l);var p=/(?:[\x80-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/g,d=null!=String.prototype.codePointAt?function(t){return t.codePointAt(0)}:function(t){return 1024*(t.charCodeAt(0)-55296)+t.charCodeAt(1)-56320+65536};function f(t){return"&#x"+(t.length>1?d(t):t.charCodeAt(0)).toString(16).toUpperCase()+";"}var m=new RegExp(s.source+"|"+p.source,"g");function g(t){return function(e){return e.replace(m,(function(e){return t[e]||f(e)}))}}e.escape=function(t){return t.replace(m,f)},e.escapeUTF8=function(t){return t.replace(s,f)}},5863:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.decodeXMLStrict=e.decodeHTML5Strict=e.decodeHTML4Strict=e.decodeHTML5=e.decodeHTML4=e.decodeHTMLStrict=e.decodeHTML=e.decodeXML=e.encodeHTML5=e.encodeHTML4=e.escapeUTF8=e.escape=e.encodeNonAsciiHTML=e.encodeHTML=e.encodeXML=e.encode=e.decodeStrict=e.decode=void 0;var n=i(4076),r=i(7322);e.decode=function(t,e){return(!e||e<=0?n.decodeXML:n.decodeHTML)(t)},e.decodeStrict=function(t,e){return(!e||e<=0?n.decodeXML:n.decodeHTMLStrict)(t)},e.encode=function(t,e){return(!e||e<=0?r.encodeXML:r.encodeHTML)(t)};var s=i(7322);Object.defineProperty(e,"encodeXML",{enumerable:!0,get:function(){return s.encodeXML}}),Object.defineProperty(e,"encodeHTML",{enumerable:!0,get:function(){return s.encodeHTML}}),Object.defineProperty(e,"encodeNonAsciiHTML",{enumerable:!0,get:function(){return s.encodeNonAsciiHTML}}),Object.defineProperty(e,"escape",{enumerable:!0,get:function(){return s.escape}}),Object.defineProperty(e,"escapeUTF8",{enumerable:!0,get:function(){return s.escapeUTF8}}),Object.defineProperty(e,"encodeHTML4",{enumerable:!0,get:function(){return s.encodeHTML}}),Object.defineProperty(e,"encodeHTML5",{enumerable:!0,get:function(){return s.encodeHTML}});var o=i(4076);Object.defineProperty(e,"decodeXML",{enumerable:!0,get:function(){return o.decodeXML}}),Object.defineProperty(e,"decodeHTML",{enumerable:!0,get:function(){return o.decodeHTML}}),Object.defineProperty(e,"decodeHTMLStrict",{enumerable:!0,get:function(){return o.decodeHTMLStrict}}),Object.defineProperty(e,"decodeHTML4",{enumerable:!0,get:function(){return o.decodeHTML}}),Object.defineProperty(e,"decodeHTML5",{enumerable:!0,get:function(){return o.decodeHTML}}),Object.defineProperty(e,"decodeHTML4Strict",{enumerable:!0,get:function(){return o.decodeHTMLStrict}}),Object.defineProperty(e,"decodeHTML5Strict",{enumerable:!0,get:function(){return o.decodeHTMLStrict}}),Object.defineProperty(e,"decodeXMLStrict",{enumerable:!0,get:function(){return o.decodeXML}})},8460:(t,e,i)=>{t.exports=function(t){var e,i,c,p=0,d=0,f=l,m=[],g=[],v=1,y=0,b=0,x=!1,w=!1,_="",k=s,z=n;"300 es"===(t=t||{}).version&&(k=a,z=o);var S={},M={};for(p=0;p<k.length;p++)S[k[p]]=!0;for(p=0;p<z.length;p++)M[z[p]]=!0;return function(t){return g=[],null!==t?function(t){p=0,t.toString&&(t=t.toString());var i;_+=t.replace(/\r\n/g,"\n"),c=_.length;for(;e=_[p],p<c;){switch(i=p,f){case 0:p=P();break;case 1:p=E();break;case 2:p=O();break;case 3:p=D();break;case 4:p=F();break;case 11:p=q();break;case 5:p=I();break;case h:p=L();break;case 9:p=T();break;case l:p=C()}if(i!==p)if("\n"===_[i])y=0,++v;else++y}return d+=p,_=_.slice(p),g}(t):function(t){m.length&&A(m.join(""));return f=10,A("(eof)"),g}()};function A(t){t.length&&g.push({type:u[f],data:t,position:b,line:v,column:y})}function C(){return m=m.length?[]:m,"/"===i&&"*"===e?(b=d+p-1,f=0,i=e,p+1):"/"===i&&"/"===e?(b=d+p-1,f=1,i=e,p+1):"#"===e?(f=2,b=d+p,p):/\s/.test(e)?(f=9,b=d+p,p):(x=/\d/.test(e),w=/[^\w_]/.test(e),b=d+p,f=x?4:w?3:h,p)}function T(){return/[^\s]/g.test(e)?(A(m.join("")),f=l,p):(m.push(e),i=e,p+1)}function O(){return"\r"!==e&&"\n"!==e||"\\"===i?(m.push(e),i=e,p+1):(A(m.join("")),f=l,p)}function E(){return O()}function P(){return"/"===e&&"*"===i?(m.push(e),A(m.join("")),f=l,p+1):(m.push(e),i=e,p+1)}function D(){if("."===i&&/\d/.test(e))return f=5,p;if("/"===i&&"*"===e)return f=0,p;if("/"===i&&"/"===e)return f=1,p;if("."===e&&m.length){for(;j(m););return f=5,p}if(";"===e||")"===e||"("===e){if(m.length)for(;j(m););return A(e),f=l,p+1}var t=2===m.length&&"="!==e;if(/[\w_\d\s]/.test(e)||t){for(;j(m););return f=l,p}return m.push(e),i=e,p+1}function j(t){for(var e,i,n=0;;){if(e=r.indexOf(t.slice(0,t.length+n).join("")),i=r[e],-1===e){if(n--+t.length>0)continue;i=t.slice(0,1).join("")}return A(i),b+=i.length,(m=m.slice(i.length)).length}}function q(){return/[^a-fA-F0-9]/.test(e)?(A(m.join("")),f=l,p):(m.push(e),i=e,p+1)}function F(){return"."===e||/[eE]/.test(e)?(m.push(e),f=5,i=e,p+1):"x"===e&&1===m.length&&"0"===m[0]?(f=11,m.push(e),i=e,p+1):/[^\d]/.test(e)?(A(m.join("")),f=l,p):(m.push(e),i=e,p+1)}function I(){return"f"===e&&(m.push(e),i=e,p+=1),/[eE]/.test(e)?(m.push(e),i=e,p+1):("-"!==e&&"+"!==e||!/[eE]/.test(i))&&/[^\d]/.test(e)?(A(m.join("")),f=l,p):(m.push(e),i=e,p+1)}function L(){if(/[^\d\w_]/.test(e)){var t=m.join("");return f=M[t]?8:S[t]?7:6,A(m.join("")),f=l,p}return m.push(e),i=e,p+1}};var n=i(7529),r=i(7679),s=i(2222),o=i(2914),a=i(9537),l=999,h=9999,u=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"]},9537:(t,e,i)=>{var n=i(2222);n=n.slice().filter((function(t){return!/^(gl\_|texture)/.test(t)})),t.exports=n.concat(["gl_VertexID","gl_InstanceID","gl_Position","gl_PointSize","gl_FragCoord","gl_FrontFacing","gl_FragDepth","gl_PointCoord","gl_MaxVertexAttribs","gl_MaxVertexUniformVectors","gl_MaxVertexOutputVectors","gl_MaxFragmentInputVectors","gl_MaxVertexTextureImageUnits","gl_MaxCombinedTextureImageUnits","gl_MaxTextureImageUnits","gl_MaxFragmentUniformVectors","gl_MaxDrawBuffers","gl_MinProgramTexelOffset","gl_MaxProgramTexelOffset","gl_DepthRangeParameters","gl_DepthRange","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"])},2222:t=>{t.exports=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"]},2914:(t,e,i)=>{var n=i(7529);t.exports=n.slice().concat(["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray"])},7529:t=>{t.exports=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","uint","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"]},7679:t=>{t.exports=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"]},9932:(t,e,i)=>{var n=i(8460);t.exports=function(t,e){var i=n(e),r=[];return r=(r=r.concat(i(t))).concat(i(null))}},8552:(t,e,i)=>{var n=i(852)(i(5639),"DataView");t.exports=n},1989:(t,e,i)=>{var n=i(1789),r=i(401),s=i(7667),o=i(1327),a=i(1866);function l(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}l.prototype.clear=n,l.prototype.delete=r,l.prototype.get=s,l.prototype.has=o,l.prototype.set=a,t.exports=l},8407:(t,e,i)=>{var n=i(7040),r=i(4125),s=i(2117),o=i(7518),a=i(4705);function l(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}l.prototype.clear=n,l.prototype.delete=r,l.prototype.get=s,l.prototype.has=o,l.prototype.set=a,t.exports=l},7071:(t,e,i)=>{var n=i(852)(i(5639),"Map");t.exports=n},3369:(t,e,i)=>{var n=i(4785),r=i(1285),s=i(6e3),o=i(9916),a=i(5265);function l(t){var e=-1,i=null==t?0:t.length;for(this.clear();++e<i;){var n=t[e];this.set(n[0],n[1])}}l.prototype.clear=n,l.prototype.delete=r,l.prototype.get=s,l.prototype.has=o,l.prototype.set=a,t.exports=l},3818:(t,e,i)=>{var n=i(852)(i(5639),"Promise");t.exports=n},8525:(t,e,i)=>{var n=i(852)(i(5639),"Set");t.exports=n},8668:(t,e,i)=>{var n=i(3369),r=i(619),s=i(2385);function o(t){var e=-1,i=null==t?0:t.length;for(this.__data__=new n;++e<i;)this.add(t[e])}o.prototype.add=o.prototype.push=r,o.prototype.has=s,t.exports=o},6384:(t,e,i)=>{var n=i(8407),r=i(7465),s=i(3779),o=i(7599),a=i(4758),l=i(4309);function h(t){var e=this.__data__=new n(t);this.size=e.size}h.prototype.clear=r,h.prototype.delete=s,h.prototype.get=o,h.prototype.has=a,h.prototype.set=l,t.exports=h},2705:(t,e,i)=>{var n=i(5639).Symbol;t.exports=n},1149:(t,e,i)=>{var n=i(5639).Uint8Array;t.exports=n},577:(t,e,i)=>{var n=i(852)(i(5639),"WeakMap");t.exports=n},7412:t=>{t.exports=function(t,e){for(var i=-1,n=null==t?0:t.length;++i<n&&!1!==e(t[i],i,t););return t}},4963:t=>{t.exports=function(t,e){for(var i=-1,n=null==t?0:t.length,r=0,s=[];++i<n;){var o=t[i];e(o,i,t)&&(s[r++]=o)}return s}},4636:(t,e,i)=>{var n=i(2545),r=i(5694),s=i(1469),o=i(4144),a=i(5776),l=i(6719),h=Object.prototype.hasOwnProperty;t.exports=function(t,e){var i=s(t),u=!i&&r(t),c=!i&&!u&&o(t),p=!i&&!u&&!c&&l(t),d=i||u||c||p,f=d?n(t.length,String):[],m=f.length;for(var g in t)!e&&!h.call(t,g)||d&&("length"==g||c&&("offset"==g||"parent"==g)||p&&("buffer"==g||"byteLength"==g||"byteOffset"==g)||a(g,m))||f.push(g);return f}},2488:t=>{t.exports=function(t,e){for(var i=-1,n=e.length,r=t.length;++i<n;)t[r+i]=e[i];return t}},2908:t=>{t.exports=function(t,e){for(var i=-1,n=null==t?0:t.length;++i<n;)if(e(t[i],i,t))return!0;return!1}},4865:(t,e,i)=>{var n=i(9465),r=i(7813),s=Object.prototype.hasOwnProperty;t.exports=function(t,e,i){var o=t[e];s.call(t,e)&&r(o,i)&&(void 0!==i||e in t)||n(t,e,i)}},8470:(t,e,i)=>{var n=i(7813);t.exports=function(t,e){for(var i=t.length;i--;)if(n(t[i][0],e))return i;return-1}},4037:(t,e,i)=>{var n=i(8363),r=i(3674);t.exports=function(t,e){return t&&n(e,r(e),t)}},3886:(t,e,i)=>{var n=i(8363),r=i(1704);t.exports=function(t,e){return t&&n(e,r(e),t)}},9465:(t,e,i)=>{var n=i(8777);t.exports=function(t,e,i){"__proto__"==e&&n?n(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}},5990:(t,e,i)=>{var n=i(6384),r=i(7412),s=i(4865),o=i(4037),a=i(3886),l=i(4626),h=i(278),u=i(8805),c=i(1911),p=i(8234),d=i(6904),f=i(4160),m=i(3824),g=i(9148),v=i(8517),y=i(1469),b=i(4144),x=i(6688),w=i(3218),_=i(2928),k=i(3674),z=i(1704),S="[object Arguments]",M="[object Function]",A="[object Object]",C={};C[S]=C["[object Array]"]=C["[object ArrayBuffer]"]=C["[object DataView]"]=C["[object Boolean]"]=C["[object Date]"]=C["[object Float32Array]"]=C["[object Float64Array]"]=C["[object Int8Array]"]=C["[object Int16Array]"]=C["[object Int32Array]"]=C["[object Map]"]=C["[object Number]"]=C[A]=C["[object RegExp]"]=C["[object Set]"]=C["[object String]"]=C["[object Symbol]"]=C["[object Uint8Array]"]=C["[object Uint8ClampedArray]"]=C["[object Uint16Array]"]=C["[object Uint32Array]"]=!0,C["[object Error]"]=C[M]=C["[object WeakMap]"]=!1,t.exports=function t(e,i,T,O,E,P){var D,j=1&i,q=2&i,F=4&i;if(T&&(D=E?T(e,O,E,P):T(e)),void 0!==D)return D;if(!w(e))return e;var I=y(e);if(I){if(D=m(e),!j)return h(e,D)}else{var L=f(e),N=L==M||"[object GeneratorFunction]"==L;if(b(e))return l(e,j);if(L==A||L==S||N&&!E){if(D=q||N?{}:v(e),!j)return q?c(e,a(D,e)):u(e,o(D,e))}else{if(!C[L])return E?e:{};D=g(e,L,j)}}P||(P=new n);var R=P.get(e);if(R)return R;P.set(e,D),_(e)?e.forEach((function(n){D.add(t(n,i,T,n,e,P))})):x(e)&&e.forEach((function(n,r){D.set(r,t(n,i,T,r,e,P))}));var U=I?void 0:(F?q?d:p:q?z:k)(e);return r(U||e,(function(n,r){U&&(n=e[r=n]),s(D,r,t(n,i,T,r,e,P))})),D}},3118:(t,e,i)=>{var n=i(3218),r=Object.create,s=function(){function t(){}return function(e){if(!n(e))return{};if(r)return r(e);t.prototype=e;var i=new t;return t.prototype=void 0,i}}();t.exports=s},4055:(t,e,i)=>{var n=i(2488),r=i(1469);t.exports=function(t,e,i){var s=e(t);return r(t)?s:n(s,i(t))}},4239:(t,e,i)=>{var n=i(2705),r=i(9607),s=i(2333),o=n?n.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":o&&o in Object(t)?r(t):s(t)}},9454:(t,e,i)=>{var n=i(4239),r=i(7005);t.exports=function(t){return r(t)&&"[object Arguments]"==n(t)}},939:(t,e,i)=>{var n=i(2492),r=i(7005);t.exports=function t(e,i,s,o,a){return e===i||(null==e||null==i||!r(e)&&!r(i)?e!=e&&i!=i:n(e,i,s,o,t,a))}},2492:(t,e,i)=>{var n=i(6384),r=i(7114),s=i(8351),o=i(6096),a=i(4160),l=i(1469),h=i(4144),u=i(6719),c="[object Arguments]",p="[object Array]",d="[object Object]",f=Object.prototype.hasOwnProperty;t.exports=function(t,e,i,m,g,v){var y=l(t),b=l(e),x=y?p:a(t),w=b?p:a(e),_=(x=x==c?d:x)==d,k=(w=w==c?d:w)==d,z=x==w;if(z&&h(t)){if(!h(e))return!1;y=!0,_=!1}if(z&&!_)return v||(v=new n),y||u(t)?r(t,e,i,m,g,v):s(t,e,x,i,m,g,v);if(!(1&i)){var S=_&&f.call(t,"__wrapped__"),M=k&&f.call(e,"__wrapped__");if(S||M){var A=S?t.value():t,C=M?e.value():e;return v||(v=new n),g(A,C,i,m,v)}}return!!z&&(v||(v=new n),o(t,e,i,m,g,v))}},5588:(t,e,i)=>{var n=i(4160),r=i(7005);t.exports=function(t){return r(t)&&"[object Map]"==n(t)}},8458:(t,e,i)=>{var n=i(3560),r=i(5346),s=i(3218),o=i(346),a=/^\[object .+?Constructor\]$/,l=Function.prototype,h=Object.prototype,u=l.toString,c=h.hasOwnProperty,p=RegExp("^"+u.call(c).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=function(t){return!(!s(t)||r(t))&&(n(t)?p:a).test(o(t))}},9221:(t,e,i)=>{var n=i(4160),r=i(7005);t.exports=function(t){return r(t)&&"[object Set]"==n(t)}},8749:(t,e,i)=>{var n=i(4239),r=i(1780),s=i(7005),o={};o["[object Float32Array]"]=o["[object Float64Array]"]=o["[object Int8Array]"]=o["[object Int16Array]"]=o["[object Int32Array]"]=o["[object Uint8Array]"]=o["[object Uint8ClampedArray]"]=o["[object Uint16Array]"]=o["[object Uint32Array]"]=!0,o["[object Arguments]"]=o["[object Array]"]=o["[object ArrayBuffer]"]=o["[object Boolean]"]=o["[object DataView]"]=o["[object Date]"]=o["[object Error]"]=o["[object Function]"]=o["[object Map]"]=o["[object Number]"]=o["[object Object]"]=o["[object RegExp]"]=o["[object Set]"]=o["[object String]"]=o["[object WeakMap]"]=!1,t.exports=function(t){return s(t)&&r(t.length)&&!!o[n(t)]}},280:(t,e,i)=>{var n=i(5726),r=i(6916),s=Object.prototype.hasOwnProperty;t.exports=function(t){if(!n(t))return r(t);var e=[];for(var i in Object(t))s.call(t,i)&&"constructor"!=i&&e.push(i);return e}},313:(t,e,i)=>{var n=i(3218),r=i(5726),s=i(3498),o=Object.prototype.hasOwnProperty;t.exports=function(t){if(!n(t))return s(t);var e=r(t),i=[];for(var a in t)("constructor"!=a||!e&&o.call(t,a))&&i.push(a);return i}},2545:t=>{t.exports=function(t,e){for(var i=-1,n=Array(t);++i<t;)n[i]=e(i);return n}},1717:t=>{t.exports=function(t){return function(e){return t(e)}}},4757:t=>{t.exports=function(t,e){return t.has(e)}},4318:(t,e,i)=>{var n=i(1149);t.exports=function(t){var e=new t.constructor(t.byteLength);return new n(e).set(new n(t)),e}},4626:(t,e,i)=>{t=i.nmd(t);var n=i(5639),r=e&&!e.nodeType&&e,s=r&&t&&!t.nodeType&&t,o=s&&s.exports===r?n.Buffer:void 0,a=o?o.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var i=t.length,n=a?a(i):new t.constructor(i);return t.copy(n),n}},7157:(t,e,i)=>{var n=i(4318);t.exports=function(t,e){var i=e?n(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)}},3147:t=>{var e=/\w*$/;t.exports=function(t){var i=new t.constructor(t.source,e.exec(t));return i.lastIndex=t.lastIndex,i}},419:(t,e,i)=>{var n=i(2705),r=n?n.prototype:void 0,s=r?r.valueOf:void 0;t.exports=function(t){return s?Object(s.call(t)):{}}},7133:(t,e,i)=>{var n=i(4318);t.exports=function(t,e){var i=e?n(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}},278:t=>{t.exports=function(t,e){var i=-1,n=t.length;for(e||(e=Array(n));++i<n;)e[i]=t[i];return e}},8363:(t,e,i)=>{var n=i(4865),r=i(9465);t.exports=function(t,e,i,s){var o=!i;i||(i={});for(var a=-1,l=e.length;++a<l;){var h=e[a],u=s?s(i[h],t[h],h,i,t):void 0;void 0===u&&(u=t[h]),o?r(i,h,u):n(i,h,u)}return i}},8805:(t,e,i)=>{var n=i(8363),r=i(9551);t.exports=function(t,e){return n(t,r(t),e)}},1911:(t,e,i)=>{var n=i(8363),r=i(1442);t.exports=function(t,e){return n(t,r(t),e)}},4429:(t,e,i)=>{var n=i(5639)["__core-js_shared__"];t.exports=n},8777:(t,e,i)=>{var n=i(852),r=function(){try{var t=n(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();t.exports=r},7114:(t,e,i)=>{var n=i(8668),r=i(2908),s=i(4757);t.exports=function(t,e,i,o,a,l){var h=1&i,u=t.length,c=e.length;if(u!=c&&!(h&&c>u))return!1;var p=l.get(t),d=l.get(e);if(p&&d)return p==e&&d==t;var f=-1,m=!0,g=2&i?new n:void 0;for(l.set(t,e),l.set(e,t);++f<u;){var v=t[f],y=e[f];if(o)var b=h?o(y,v,f,e,t,l):o(v,y,f,t,e,l);if(void 0!==b){if(b)continue;m=!1;break}if(g){if(!r(e,(function(t,e){if(!s(g,e)&&(v===t||a(v,t,i,o,l)))return g.push(e)}))){m=!1;break}}else if(v!==y&&!a(v,y,i,o,l)){m=!1;break}}return l.delete(t),l.delete(e),m}},8351:(t,e,i)=>{var n=i(2705),r=i(1149),s=i(7813),o=i(7114),a=i(8776),l=i(1814),h=n?n.prototype:void 0,u=h?h.valueOf:void 0;t.exports=function(t,e,i,n,h,c,p){switch(i){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!c(new r(t),new r(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return s(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var d=a;case"[object Set]":var f=1&n;if(d||(d=l),t.size!=e.size&&!f)return!1;var m=p.get(t);if(m)return m==e;n|=2,p.set(t,e);var g=o(d(t),d(e),n,h,c,p);return p.delete(t),g;case"[object Symbol]":if(u)return u.call(t)==u.call(e)}return!1}},6096:(t,e,i)=>{var n=i(8234),r=Object.prototype.hasOwnProperty;t.exports=function(t,e,i,s,o,a){var l=1&i,h=n(t),u=h.length;if(u!=n(e).length&&!l)return!1;for(var c=u;c--;){var p=h[c];if(!(l?p in e:r.call(e,p)))return!1}var d=a.get(t),f=a.get(e);if(d&&f)return d==e&&f==t;var m=!0;a.set(t,e),a.set(e,t);for(var g=l;++c<u;){var v=t[p=h[c]],y=e[p];if(s)var b=l?s(y,v,p,e,t,a):s(v,y,p,t,e,a);if(!(void 0===b?v===y||o(v,y,i,s,a):b)){m=!1;break}g||(g="constructor"==p)}if(m&&!g){var x=t.constructor,w=e.constructor;x==w||!("constructor"in t)||!("constructor"in e)||"function"==typeof x&&x instanceof x&&"function"==typeof w&&w instanceof w||(m=!1)}return a.delete(t),a.delete(e),m}},1957:(t,e,i)=>{var n="object"==typeof i.g&&i.g&&i.g.Object===Object&&i.g;t.exports=n},8234:(t,e,i)=>{var n=i(4055),r=i(9551),s=i(3674);t.exports=function(t){return n(t,s,r)}},6904:(t,e,i)=>{var n=i(4055),r=i(1442),s=i(1704);t.exports=function(t){return n(t,s,r)}},5050:(t,e,i)=>{var n=i(7019);t.exports=function(t,e){var i=t.__data__;return n(e)?i["string"==typeof e?"string":"hash"]:i.map}},852:(t,e,i)=>{var n=i(8458),r=i(7801);t.exports=function(t,e){var i=r(t,e);return n(i)?i:void 0}},5924:(t,e,i)=>{var n=i(5569)(Object.getPrototypeOf,Object);t.exports=n},9607:(t,e,i)=>{var n=i(2705),r=Object.prototype,s=r.hasOwnProperty,o=r.toString,a=n?n.toStringTag:void 0;t.exports=function(t){var e=s.call(t,a),i=t[a];try{t[a]=void 0;var n=!0}catch(t){}var r=o.call(t);return n&&(e?t[a]=i:delete t[a]),r}},9551:(t,e,i)=>{var n=i(4963),r=i(479),s=Object.prototype.propertyIsEnumerable,o=Object.getOwnPropertySymbols,a=o?function(t){return null==t?[]:(t=Object(t),n(o(t),(function(e){return s.call(t,e)})))}:r;t.exports=a},1442:(t,e,i)=>{var n=i(2488),r=i(5924),s=i(9551),o=i(479),a=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)n(e,s(t)),t=r(t);return e}:o;t.exports=a},4160:(t,e,i)=>{var n=i(8552),r=i(7071),s=i(3818),o=i(8525),a=i(577),l=i(4239),h=i(346),u="[object Map]",c="[object Promise]",p="[object Set]",d="[object WeakMap]",f="[object DataView]",m=h(n),g=h(r),v=h(s),y=h(o),b=h(a),x=l;(n&&x(new n(new ArrayBuffer(1)))!=f||r&&x(new r)!=u||s&&x(s.resolve())!=c||o&&x(new o)!=p||a&&x(new a)!=d)&&(x=function(t){var e=l(t),i="[object Object]"==e?t.constructor:void 0,n=i?h(i):"";if(n)switch(n){case m:return f;case g:return u;case v:return c;case y:return p;case b:return d}return e}),t.exports=x},7801:t=>{t.exports=function(t,e){return null==t?void 0:t[e]}},1789:(t,e,i)=>{var n=i(4536);t.exports=function(){this.__data__=n?n(null):{},this.size=0}},401:t=>{t.exports=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}},7667:(t,e,i)=>{var n=i(4536),r=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;if(n){var i=e[t];return"__lodash_hash_undefined__"===i?void 0:i}return r.call(e,t)?e[t]:void 0}},1327:(t,e,i)=>{var n=i(4536),r=Object.prototype.hasOwnProperty;t.exports=function(t){var e=this.__data__;return n?void 0!==e[t]:r.call(e,t)}},1866:(t,e,i)=>{var n=i(4536);t.exports=function(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=n&&void 0===e?"__lodash_hash_undefined__":e,this}},3824:t=>{var e=Object.prototype.hasOwnProperty;t.exports=function(t){var i=t.length,n=new t.constructor(i);return i&&"string"==typeof t[0]&&e.call(t,"index")&&(n.index=t.index,n.input=t.input),n}},9148:(t,e,i)=>{var n=i(4318),r=i(7157),s=i(3147),o=i(419),a=i(7133);t.exports=function(t,e,i){var l=t.constructor;switch(e){case"[object ArrayBuffer]":return n(t);case"[object Boolean]":case"[object Date]":return new l(+t);case"[object DataView]":return r(t,i);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return a(t,i);case"[object Map]":case"[object Set]":return new l;case"[object Number]":case"[object String]":return new l(t);case"[object RegExp]":return s(t);case"[object Symbol]":return o(t)}}},8517:(t,e,i)=>{var n=i(3118),r=i(5924),s=i(5726);t.exports=function(t){return"function"!=typeof t.constructor||s(t)?{}:n(r(t))}},5776:t=>{var e=/^(?:0|[1-9]\d*)$/;t.exports=function(t,i){var n=typeof t;return!!(i=null==i?9007199254740991:i)&&("number"==n||"symbol"!=n&&e.test(t))&&t>-1&&t%1==0&&t<i}},7019:t=>{t.exports=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}},5346:(t,e,i)=>{var n,r=i(4429),s=(n=/[^.]+$/.exec(r&&r.keys&&r.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"";t.exports=function(t){return!!s&&s in t}},5726:t=>{var e=Object.prototype;t.exports=function(t){var i=t&&t.constructor;return t===("function"==typeof i&&i.prototype||e)}},7040:t=>{t.exports=function(){this.__data__=[],this.size=0}},4125:(t,e,i)=>{var n=i(8470),r=Array.prototype.splice;t.exports=function(t){var e=this.__data__,i=n(e,t);return!(i<0)&&(i==e.length-1?e.pop():r.call(e,i,1),--this.size,!0)}},2117:(t,e,i)=>{var n=i(8470);t.exports=function(t){var e=this.__data__,i=n(e,t);return i<0?void 0:e[i][1]}},7518:(t,e,i)=>{var n=i(8470);t.exports=function(t){return n(this.__data__,t)>-1}},4705:(t,e,i)=>{var n=i(8470);t.exports=function(t,e){var i=this.__data__,r=n(i,t);return r<0?(++this.size,i.push([t,e])):i[r][1]=e,this}},4785:(t,e,i)=>{var n=i(1989),r=i(8407),s=i(7071);t.exports=function(){this.size=0,this.__data__={hash:new n,map:new(s||r),string:new n}}},1285:(t,e,i)=>{var n=i(5050);t.exports=function(t){var e=n(this,t).delete(t);return this.size-=e?1:0,e}},6e3:(t,e,i)=>{var n=i(5050);t.exports=function(t){return n(this,t).get(t)}},9916:(t,e,i)=>{var n=i(5050);t.exports=function(t){return n(this,t).has(t)}},5265:(t,e,i)=>{var n=i(5050);t.exports=function(t,e){var i=n(this,t),r=i.size;return i.set(t,e),this.size+=i.size==r?0:1,this}},8776:t=>{t.exports=function(t){var e=-1,i=Array(t.size);return t.forEach((function(t,n){i[++e]=[n,t]})),i}},4536:(t,e,i)=>{var n=i(852)(Object,"create");t.exports=n},6916:(t,e,i)=>{var n=i(5569)(Object.keys,Object);t.exports=n},3498:t=>{t.exports=function(t){var e=[];if(null!=t)for(var i in Object(t))e.push(i);return e}},1167:(t,e,i)=>{t=i.nmd(t);var n=i(1957),r=e&&!e.nodeType&&e,s=r&&t&&!t.nodeType&&t,o=s&&s.exports===r&&n.process,a=function(){try{var t=s&&s.require&&s.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=a},2333:t=>{var e=Object.prototype.toString;t.exports=function(t){return e.call(t)}},5569:t=>{t.exports=function(t,e){return function(i){return t(e(i))}}},5639:(t,e,i)=>{var n=i(1957),r="object"==typeof self&&self&&self.Object===Object&&self,s=n||r||Function("return this")();t.exports=s},619:t=>{t.exports=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this}},2385:t=>{t.exports=function(t){return this.__data__.has(t)}},1814:t=>{t.exports=function(t){var e=-1,i=Array(t.size);return t.forEach((function(t){i[++e]=t})),i}},7465:(t,e,i)=>{var n=i(8407);t.exports=function(){this.__data__=new n,this.size=0}},3779:t=>{t.exports=function(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i}},7599:t=>{t.exports=function(t){return this.__data__.get(t)}},4758:t=>{t.exports=function(t){return this.__data__.has(t)}},4309:(t,e,i)=>{var n=i(8407),r=i(7071),s=i(3369);t.exports=function(t,e){var i=this.__data__;if(i instanceof n){var o=i.__data__;if(!r||o.length<199)return o.push([t,e]),this.size=++i.size,this;i=this.__data__=new s(o)}return i.set(t,e),this.size=i.size,this}},346:t=>{var e=Function.prototype.toString;t.exports=function(t){if(null!=t){try{return e.call(t)}catch(t){}try{return t+""}catch(t){}}return""}},361:(t,e,i)=>{var n=i(5990);t.exports=function(t){return n(t,5)}},7813:t=>{t.exports=function(t,e){return t===e||t!=t&&e!=e}},5694:(t,e,i)=>{var n=i(9454),r=i(7005),s=Object.prototype,o=s.hasOwnProperty,a=s.propertyIsEnumerable,l=n(function(){return arguments}())?n:function(t){return r(t)&&o.call(t,"callee")&&!a.call(t,"callee")};t.exports=l},1469:t=>{var e=Array.isArray;t.exports=e},8612:(t,e,i)=>{var n=i(3560),r=i(1780);t.exports=function(t){return null!=t&&r(t.length)&&!n(t)}},4144:(t,e,i)=>{t=i.nmd(t);var n=i(5639),r=i(5062),s=e&&!e.nodeType&&e,o=s&&t&&!t.nodeType&&t,a=o&&o.exports===s?n.Buffer:void 0,l=(a?a.isBuffer:void 0)||r;t.exports=l},8446:(t,e,i)=>{var n=i(939);t.exports=function(t,e){return n(t,e)}},3560:(t,e,i)=>{var n=i(4239),r=i(3218);t.exports=function(t){if(!r(t))return!1;var e=n(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}},1780:t=>{t.exports=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}},6688:(t,e,i)=>{var n=i(5588),r=i(1717),s=i(1167),o=s&&s.isMap,a=o?r(o):n;t.exports=a},3218:t=>{t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},7005:t=>{t.exports=function(t){return null!=t&&"object"==typeof t}},2928:(t,e,i)=>{var n=i(9221),r=i(1717),s=i(1167),o=s&&s.isSet,a=o?r(o):n;t.exports=a},6719:(t,e,i)=>{var n=i(8749),r=i(1717),s=i(1167),o=s&&s.isTypedArray,a=o?r(o):n;t.exports=a},3674:(t,e,i)=>{var n=i(4636),r=i(280),s=i(8612);t.exports=function(t){return s(t)?n(t):r(t)}},1704:(t,e,i)=>{var n=i(4636),r=i(313),s=i(8612);t.exports=function(t){return s(t)?n(t,!0):r(t)}},479:t=>{t.exports=function(){return[]}},5062:t=>{t.exports=function(){return!1}},9769:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.compile=void 0;var n=i(1073);e.compile=function(t){var e=t[0],i=t[1]-1;if(i<0&&e<=0)return n.falseFunc;if(-1===e)return function(t){return t<=i};if(0===e)return function(t){return t===i};if(1===e)return i<0?n.trueFunc:function(t){return t>=i};var r=Math.abs(e),s=(i%r+r)%r;return e>1?function(t){return t>=i&&t%r===s}:function(t){return t<=i&&t%r===s}}},7540:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.compile=e.parse=void 0;var n=i(7766);Object.defineProperty(e,"parse",{enumerable:!0,get:function(){return n.parse}});var r=i(9769);Object.defineProperty(e,"compile",{enumerable:!0,get:function(){return r.compile}}),e.default=function(t){return(0,r.compile)((0,n.parse)(t))}},7766:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parse=void 0;var i=new Set([9,10,12,13,32]),n="0".charCodeAt(0),r="9".charCodeAt(0);e.parse=function(t){if("even"===(t=t.trim().toLowerCase()))return[2,0];if("odd"===t)return[2,1];var e=0,s=0,o=l(),a=h();if(e<t.length&&"n"===t.charAt(e)&&(e++,s=o*(null!=a?a:1),u(),e<t.length?(o=l(),u(),a=h()):o=a=0),null===a||e<t.length)throw new Error("n-th rule couldn't be parsed ('"+t+"')");return[s,o*a];function l(){return"-"===t.charAt(e)?(e++,-1):("+"===t.charAt(e)&&e++,1)}function h(){for(var i=e,s=0;e<t.length&&t.charCodeAt(e)>=n&&t.charCodeAt(e)<=r;)s=10*s+(t.charCodeAt(e)-n),e++;return e===i?null:s}function u(){for(;e<t.length&&i.has(t.charCodeAt(e));)e++}}},3981:(t,e)=>{e.make=function(t){return null==t&&(t=[]),t instanceof Array||(t=[null!=+t?+t:0]),t},e.nest=(t,e)=>t.concat(e),e.compare=function(t,e){for(let i=0,n=Math.min(t.length,e.length),r=0<=n;r?i<n:i>n;r?i++:i--){const n=t[i],r=e[i];if(n>r)return-1;if(n<r)return 1}return(t=t.length)>(e=e.length)?-1:t<e?1:0},e.max=function(t,i){return e.compare(t,i)>0?i:t}},3466:function(t){var e;t.exports=(e=function(){function t(t){return r.appendChild(t.dom),t}function i(t){for(var e=0;e<r.children.length;e++)r.children[e].style.display=e===t?"block":"none";n=t}var n=0,r=document.createElement("div");r.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",r.addEventListener("click",(function(t){t.preventDefault(),i(++n%r.children.length)}),!1);var s=(performance||Date).now(),o=s,a=0,l=t(new e.Panel("FPS","#0ff","#002")),h=t(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=t(new e.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:r,addPanel:t,showPanel:i,begin:function(){s=(performance||Date).now()},end:function(){a++;var t=(performance||Date).now();if(h.update(t-s,200),t>o+1e3&&(l.update(1e3*a/(t-o),100),o=t,a=0,u)){var e=performance.memory;u.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){s=this.end()},domElement:r,setMode:i}},e.Panel=function(t,e,i){var n=1/0,r=0,s=Math.round,o=s(window.devicePixelRatio||1),a=80*o,l=48*o,h=3*o,u=2*o,c=3*o,p=15*o,d=74*o,f=30*o,m=document.createElement("canvas");m.width=a,m.height=l,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*o+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=i,g.fillRect(0,0,a,l),g.fillStyle=e,g.fillText(t,h,u),g.fillRect(c,p,d,f),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(c,p,d,f),{dom:m,update:function(l,v){n=Math.min(n,l),r=Math.max(r,l),g.fillStyle=i,g.globalAlpha=1,g.fillRect(0,0,a,p),g.fillStyle=e,g.fillText(s(l)+" "+t+" ("+s(n)+"-"+s(r)+")",h,u),g.drawImage(m,c+o,p,d-o,f,c,p,d-o,f),g.fillRect(c+d-o,p,o,f),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(c+d-o,p,o,s((1-l/v)*f))}}},e)},824:e=>{"use strict";e.exports=t},3600:t=>{"use strict";t.exports=JSON.parse('{"0":65533,"128":8364,"130":8218,"131":402,"132":8222,"133":8230,"134":8224,"135":8225,"136":710,"137":8240,"138":352,"139":8249,"140":338,"142":381,"145":8216,"146":8217,"147":8220,"148":8221,"149":8226,"150":8211,"151":8212,"152":732,"153":8482,"154":353,"155":8250,"156":339,"158":382,"159":376}')},9323:t=>{"use strict";t.exports=JSON.parse('{"Aacute":"Á","aacute":"á","Abreve":"Ă","abreve":"ă","ac":"∾","acd":"∿","acE":"∾̳","Acirc":"Â","acirc":"â","acute":"´","Acy":"А","acy":"а","AElig":"Æ","aelig":"æ","af":"⁡","Afr":"𝔄","afr":"𝔞","Agrave":"À","agrave":"à","alefsym":"ℵ","aleph":"ℵ","Alpha":"Α","alpha":"α","Amacr":"Ā","amacr":"ā","amalg":"⨿","amp":"&","AMP":"&","andand":"⩕","And":"⩓","and":"∧","andd":"⩜","andslope":"⩘","andv":"⩚","ang":"∠","ange":"⦤","angle":"∠","angmsdaa":"⦨","angmsdab":"⦩","angmsdac":"⦪","angmsdad":"⦫","angmsdae":"⦬","angmsdaf":"⦭","angmsdag":"⦮","angmsdah":"⦯","angmsd":"∡","angrt":"∟","angrtvb":"⊾","angrtvbd":"⦝","angsph":"∢","angst":"Å","angzarr":"⍼","Aogon":"Ą","aogon":"ą","Aopf":"𝔸","aopf":"𝕒","apacir":"⩯","ap":"≈","apE":"⩰","ape":"≊","apid":"≋","apos":"\'","ApplyFunction":"⁡","approx":"≈","approxeq":"≊","Aring":"Å","aring":"å","Ascr":"𝒜","ascr":"𝒶","Assign":"≔","ast":"*","asymp":"≈","asympeq":"≍","Atilde":"Ã","atilde":"ã","Auml":"Ä","auml":"ä","awconint":"∳","awint":"⨑","backcong":"≌","backepsilon":"϶","backprime":"‵","backsim":"∽","backsimeq":"⋍","Backslash":"∖","Barv":"⫧","barvee":"⊽","barwed":"⌅","Barwed":"⌆","barwedge":"⌅","bbrk":"⎵","bbrktbrk":"⎶","bcong":"≌","Bcy":"Б","bcy":"б","bdquo":"„","becaus":"∵","because":"∵","Because":"∵","bemptyv":"⦰","bepsi":"϶","bernou":"ℬ","Bernoullis":"ℬ","Beta":"Β","beta":"β","beth":"ℶ","between":"≬","Bfr":"𝔅","bfr":"𝔟","bigcap":"⋂","bigcirc":"◯","bigcup":"⋃","bigodot":"⨀","bigoplus":"⨁","bigotimes":"⨂","bigsqcup":"⨆","bigstar":"★","bigtriangledown":"▽","bigtriangleup":"△","biguplus":"⨄","bigvee":"⋁","bigwedge":"⋀","bkarow":"⤍","blacklozenge":"⧫","blacksquare":"▪","blacktriangle":"▴","blacktriangledown":"▾","blacktriangleleft":"◂","blacktriangleright":"▸","blank":"␣","blk12":"▒","blk14":"░","blk34":"▓","block":"█","bne":"=⃥","bnequiv":"≡⃥","bNot":"⫭","bnot":"⌐","Bopf":"𝔹","bopf":"𝕓","bot":"⊥","bottom":"⊥","bowtie":"⋈","boxbox":"⧉","boxdl":"┐","boxdL":"╕","boxDl":"╖","boxDL":"╗","boxdr":"┌","boxdR":"╒","boxDr":"╓","boxDR":"╔","boxh":"─","boxH":"═","boxhd":"┬","boxHd":"╤","boxhD":"╥","boxHD":"╦","boxhu":"┴","boxHu":"╧","boxhU":"╨","boxHU":"╩","boxminus":"⊟","boxplus":"⊞","boxtimes":"⊠","boxul":"┘","boxuL":"╛","boxUl":"╜","boxUL":"╝","boxur":"└","boxuR":"╘","boxUr":"╙","boxUR":"╚","boxv":"│","boxV":"║","boxvh":"┼","boxvH":"╪","boxVh":"╫","boxVH":"╬","boxvl":"┤","boxvL":"╡","boxVl":"╢","boxVL":"╣","boxvr":"├","boxvR":"╞","boxVr":"╟","boxVR":"╠","bprime":"‵","breve":"˘","Breve":"˘","brvbar":"¦","bscr":"𝒷","Bscr":"ℬ","bsemi":"⁏","bsim":"∽","bsime":"⋍","bsolb":"⧅","bsol":"\\\\","bsolhsub":"⟈","bull":"•","bullet":"•","bump":"≎","bumpE":"⪮","bumpe":"≏","Bumpeq":"≎","bumpeq":"≏","Cacute":"Ć","cacute":"ć","capand":"⩄","capbrcup":"⩉","capcap":"⩋","cap":"∩","Cap":"⋒","capcup":"⩇","capdot":"⩀","CapitalDifferentialD":"ⅅ","caps":"∩︀","caret":"⁁","caron":"ˇ","Cayleys":"ℭ","ccaps":"⩍","Ccaron":"Č","ccaron":"č","Ccedil":"Ç","ccedil":"ç","Ccirc":"Ĉ","ccirc":"ĉ","Cconint":"∰","ccups":"⩌","ccupssm":"⩐","Cdot":"Ċ","cdot":"ċ","cedil":"¸","Cedilla":"¸","cemptyv":"⦲","cent":"¢","centerdot":"·","CenterDot":"·","cfr":"𝔠","Cfr":"ℭ","CHcy":"Ч","chcy":"ч","check":"✓","checkmark":"✓","Chi":"Χ","chi":"χ","circ":"ˆ","circeq":"≗","circlearrowleft":"↺","circlearrowright":"↻","circledast":"⊛","circledcirc":"⊚","circleddash":"⊝","CircleDot":"⊙","circledR":"®","circledS":"Ⓢ","CircleMinus":"⊖","CirclePlus":"⊕","CircleTimes":"⊗","cir":"○","cirE":"⧃","cire":"≗","cirfnint":"⨐","cirmid":"⫯","cirscir":"⧂","ClockwiseContourIntegral":"∲","CloseCurlyDoubleQuote":"”","CloseCurlyQuote":"’","clubs":"♣","clubsuit":"♣","colon":":","Colon":"∷","Colone":"⩴","colone":"≔","coloneq":"≔","comma":",","commat":"@","comp":"∁","compfn":"∘","complement":"∁","complexes":"ℂ","cong":"≅","congdot":"⩭","Congruent":"≡","conint":"∮","Conint":"∯","ContourIntegral":"∮","copf":"𝕔","Copf":"ℂ","coprod":"∐","Coproduct":"∐","copy":"©","COPY":"©","copysr":"℗","CounterClockwiseContourIntegral":"∳","crarr":"↵","cross":"✗","Cross":"⨯","Cscr":"𝒞","cscr":"𝒸","csub":"⫏","csube":"⫑","csup":"⫐","csupe":"⫒","ctdot":"⋯","cudarrl":"⤸","cudarrr":"⤵","cuepr":"⋞","cuesc":"⋟","cularr":"↶","cularrp":"⤽","cupbrcap":"⩈","cupcap":"⩆","CupCap":"≍","cup":"∪","Cup":"⋓","cupcup":"⩊","cupdot":"⊍","cupor":"⩅","cups":"∪︀","curarr":"↷","curarrm":"⤼","curlyeqprec":"⋞","curlyeqsucc":"⋟","curlyvee":"⋎","curlywedge":"⋏","curren":"¤","curvearrowleft":"↶","curvearrowright":"↷","cuvee":"⋎","cuwed":"⋏","cwconint":"∲","cwint":"∱","cylcty":"⌭","dagger":"†","Dagger":"‡","daleth":"ℸ","darr":"↓","Darr":"↡","dArr":"⇓","dash":"‐","Dashv":"⫤","dashv":"⊣","dbkarow":"⤏","dblac":"˝","Dcaron":"Ď","dcaron":"ď","Dcy":"Д","dcy":"д","ddagger":"‡","ddarr":"⇊","DD":"ⅅ","dd":"ⅆ","DDotrahd":"⤑","ddotseq":"⩷","deg":"°","Del":"∇","Delta":"Δ","delta":"δ","demptyv":"⦱","dfisht":"⥿","Dfr":"𝔇","dfr":"𝔡","dHar":"⥥","dharl":"⇃","dharr":"⇂","DiacriticalAcute":"´","DiacriticalDot":"˙","DiacriticalDoubleAcute":"˝","DiacriticalGrave":"`","DiacriticalTilde":"˜","diam":"⋄","diamond":"⋄","Diamond":"⋄","diamondsuit":"♦","diams":"♦","die":"¨","DifferentialD":"ⅆ","digamma":"ϝ","disin":"⋲","div":"÷","divide":"÷","divideontimes":"⋇","divonx":"⋇","DJcy":"Ђ","djcy":"ђ","dlcorn":"⌞","dlcrop":"⌍","dollar":"$","Dopf":"𝔻","dopf":"𝕕","Dot":"¨","dot":"˙","DotDot":"⃜","doteq":"≐","doteqdot":"≑","DotEqual":"≐","dotminus":"∸","dotplus":"∔","dotsquare":"⊡","doublebarwedge":"⌆","DoubleContourIntegral":"∯","DoubleDot":"¨","DoubleDownArrow":"⇓","DoubleLeftArrow":"⇐","DoubleLeftRightArrow":"⇔","DoubleLeftTee":"⫤","DoubleLongLeftArrow":"⟸","DoubleLongLeftRightArrow":"⟺","DoubleLongRightArrow":"⟹","DoubleRightArrow":"⇒","DoubleRightTee":"⊨","DoubleUpArrow":"⇑","DoubleUpDownArrow":"⇕","DoubleVerticalBar":"∥","DownArrowBar":"⤓","downarrow":"↓","DownArrow":"↓","Downarrow":"⇓","DownArrowUpArrow":"⇵","DownBreve":"̑","downdownarrows":"⇊","downharpoonleft":"⇃","downharpoonright":"⇂","DownLeftRightVector":"⥐","DownLeftTeeVector":"⥞","DownLeftVectorBar":"⥖","DownLeftVector":"↽","DownRightTeeVector":"⥟","DownRightVectorBar":"⥗","DownRightVector":"⇁","DownTeeArrow":"↧","DownTee":"⊤","drbkarow":"⤐","drcorn":"⌟","drcrop":"⌌","Dscr":"𝒟","dscr":"𝒹","DScy":"Ѕ","dscy":"ѕ","dsol":"⧶","Dstrok":"Đ","dstrok":"đ","dtdot":"⋱","dtri":"▿","dtrif":"▾","duarr":"⇵","duhar":"⥯","dwangle":"⦦","DZcy":"Џ","dzcy":"џ","dzigrarr":"⟿","Eacute":"É","eacute":"é","easter":"⩮","Ecaron":"Ě","ecaron":"ě","Ecirc":"Ê","ecirc":"ê","ecir":"≖","ecolon":"≕","Ecy":"Э","ecy":"э","eDDot":"⩷","Edot":"Ė","edot":"ė","eDot":"≑","ee":"ⅇ","efDot":"≒","Efr":"𝔈","efr":"𝔢","eg":"⪚","Egrave":"È","egrave":"è","egs":"⪖","egsdot":"⪘","el":"⪙","Element":"∈","elinters":"⏧","ell":"ℓ","els":"⪕","elsdot":"⪗","Emacr":"Ē","emacr":"ē","empty":"∅","emptyset":"∅","EmptySmallSquare":"◻","emptyv":"∅","EmptyVerySmallSquare":"▫","emsp13":" ","emsp14":" ","emsp":" ","ENG":"Ŋ","eng":"ŋ","ensp":" ","Eogon":"Ę","eogon":"ę","Eopf":"𝔼","eopf":"𝕖","epar":"⋕","eparsl":"⧣","eplus":"⩱","epsi":"ε","Epsilon":"Ε","epsilon":"ε","epsiv":"ϵ","eqcirc":"≖","eqcolon":"≕","eqsim":"≂","eqslantgtr":"⪖","eqslantless":"⪕","Equal":"⩵","equals":"=","EqualTilde":"≂","equest":"≟","Equilibrium":"⇌","equiv":"≡","equivDD":"⩸","eqvparsl":"⧥","erarr":"⥱","erDot":"≓","escr":"ℯ","Escr":"ℰ","esdot":"≐","Esim":"⩳","esim":"≂","Eta":"Η","eta":"η","ETH":"Ð","eth":"ð","Euml":"Ë","euml":"ë","euro":"€","excl":"!","exist":"∃","Exists":"∃","expectation":"ℰ","exponentiale":"ⅇ","ExponentialE":"ⅇ","fallingdotseq":"≒","Fcy":"Ф","fcy":"ф","female":"♀","ffilig":"ﬃ","fflig":"ﬀ","ffllig":"ﬄ","Ffr":"𝔉","ffr":"𝔣","filig":"ﬁ","FilledSmallSquare":"◼","FilledVerySmallSquare":"▪","fjlig":"fj","flat":"♭","fllig":"ﬂ","fltns":"▱","fnof":"ƒ","Fopf":"𝔽","fopf":"𝕗","forall":"∀","ForAll":"∀","fork":"⋔","forkv":"⫙","Fouriertrf":"ℱ","fpartint":"⨍","frac12":"½","frac13":"⅓","frac14":"¼","frac15":"⅕","frac16":"⅙","frac18":"⅛","frac23":"⅔","frac25":"⅖","frac34":"¾","frac35":"⅗","frac38":"⅜","frac45":"⅘","frac56":"⅚","frac58":"⅝","frac78":"⅞","frasl":"⁄","frown":"⌢","fscr":"𝒻","Fscr":"ℱ","gacute":"ǵ","Gamma":"Γ","gamma":"γ","Gammad":"Ϝ","gammad":"ϝ","gap":"⪆","Gbreve":"Ğ","gbreve":"ğ","Gcedil":"Ģ","Gcirc":"Ĝ","gcirc":"ĝ","Gcy":"Г","gcy":"г","Gdot":"Ġ","gdot":"ġ","ge":"≥","gE":"≧","gEl":"⪌","gel":"⋛","geq":"≥","geqq":"≧","geqslant":"⩾","gescc":"⪩","ges":"⩾","gesdot":"⪀","gesdoto":"⪂","gesdotol":"⪄","gesl":"⋛︀","gesles":"⪔","Gfr":"𝔊","gfr":"𝔤","gg":"≫","Gg":"⋙","ggg":"⋙","gimel":"ℷ","GJcy":"Ѓ","gjcy":"ѓ","gla":"⪥","gl":"≷","glE":"⪒","glj":"⪤","gnap":"⪊","gnapprox":"⪊","gne":"⪈","gnE":"≩","gneq":"⪈","gneqq":"≩","gnsim":"⋧","Gopf":"𝔾","gopf":"𝕘","grave":"`","GreaterEqual":"≥","GreaterEqualLess":"⋛","GreaterFullEqual":"≧","GreaterGreater":"⪢","GreaterLess":"≷","GreaterSlantEqual":"⩾","GreaterTilde":"≳","Gscr":"𝒢","gscr":"ℊ","gsim":"≳","gsime":"⪎","gsiml":"⪐","gtcc":"⪧","gtcir":"⩺","gt":">","GT":">","Gt":"≫","gtdot":"⋗","gtlPar":"⦕","gtquest":"⩼","gtrapprox":"⪆","gtrarr":"⥸","gtrdot":"⋗","gtreqless":"⋛","gtreqqless":"⪌","gtrless":"≷","gtrsim":"≳","gvertneqq":"≩︀","gvnE":"≩︀","Hacek":"ˇ","hairsp":" ","half":"½","hamilt":"ℋ","HARDcy":"Ъ","hardcy":"ъ","harrcir":"⥈","harr":"↔","hArr":"⇔","harrw":"↭","Hat":"^","hbar":"ℏ","Hcirc":"Ĥ","hcirc":"ĥ","hearts":"♥","heartsuit":"♥","hellip":"…","hercon":"⊹","hfr":"𝔥","Hfr":"ℌ","HilbertSpace":"ℋ","hksearow":"⤥","hkswarow":"⤦","hoarr":"⇿","homtht":"∻","hookleftarrow":"↩","hookrightarrow":"↪","hopf":"𝕙","Hopf":"ℍ","horbar":"―","HorizontalLine":"─","hscr":"𝒽","Hscr":"ℋ","hslash":"ℏ","Hstrok":"Ħ","hstrok":"ħ","HumpDownHump":"≎","HumpEqual":"≏","hybull":"⁃","hyphen":"‐","Iacute":"Í","iacute":"í","ic":"⁣","Icirc":"Î","icirc":"î","Icy":"И","icy":"и","Idot":"İ","IEcy":"Е","iecy":"е","iexcl":"¡","iff":"⇔","ifr":"𝔦","Ifr":"ℑ","Igrave":"Ì","igrave":"ì","ii":"ⅈ","iiiint":"⨌","iiint":"∭","iinfin":"⧜","iiota":"℩","IJlig":"Ĳ","ijlig":"ĳ","Imacr":"Ī","imacr":"ī","image":"ℑ","ImaginaryI":"ⅈ","imagline":"ℐ","imagpart":"ℑ","imath":"ı","Im":"ℑ","imof":"⊷","imped":"Ƶ","Implies":"⇒","incare":"℅","in":"∈","infin":"∞","infintie":"⧝","inodot":"ı","intcal":"⊺","int":"∫","Int":"∬","integers":"ℤ","Integral":"∫","intercal":"⊺","Intersection":"⋂","intlarhk":"⨗","intprod":"⨼","InvisibleComma":"⁣","InvisibleTimes":"⁢","IOcy":"Ё","iocy":"ё","Iogon":"Į","iogon":"į","Iopf":"𝕀","iopf":"𝕚","Iota":"Ι","iota":"ι","iprod":"⨼","iquest":"¿","iscr":"𝒾","Iscr":"ℐ","isin":"∈","isindot":"⋵","isinE":"⋹","isins":"⋴","isinsv":"⋳","isinv":"∈","it":"⁢","Itilde":"Ĩ","itilde":"ĩ","Iukcy":"І","iukcy":"і","Iuml":"Ï","iuml":"ï","Jcirc":"Ĵ","jcirc":"ĵ","Jcy":"Й","jcy":"й","Jfr":"𝔍","jfr":"𝔧","jmath":"ȷ","Jopf":"𝕁","jopf":"𝕛","Jscr":"𝒥","jscr":"𝒿","Jsercy":"Ј","jsercy":"ј","Jukcy":"Є","jukcy":"є","Kappa":"Κ","kappa":"κ","kappav":"ϰ","Kcedil":"Ķ","kcedil":"ķ","Kcy":"К","kcy":"к","Kfr":"𝔎","kfr":"𝔨","kgreen":"ĸ","KHcy":"Х","khcy":"х","KJcy":"Ќ","kjcy":"ќ","Kopf":"𝕂","kopf":"𝕜","Kscr":"𝒦","kscr":"𝓀","lAarr":"⇚","Lacute":"Ĺ","lacute":"ĺ","laemptyv":"⦴","lagran":"ℒ","Lambda":"Λ","lambda":"λ","lang":"⟨","Lang":"⟪","langd":"⦑","langle":"⟨","lap":"⪅","Laplacetrf":"ℒ","laquo":"«","larrb":"⇤","larrbfs":"⤟","larr":"←","Larr":"↞","lArr":"⇐","larrfs":"⤝","larrhk":"↩","larrlp":"↫","larrpl":"⤹","larrsim":"⥳","larrtl":"↢","latail":"⤙","lAtail":"⤛","lat":"⪫","late":"⪭","lates":"⪭︀","lbarr":"⤌","lBarr":"⤎","lbbrk":"❲","lbrace":"{","lbrack":"[","lbrke":"⦋","lbrksld":"⦏","lbrkslu":"⦍","Lcaron":"Ľ","lcaron":"ľ","Lcedil":"Ļ","lcedil":"ļ","lceil":"⌈","lcub":"{","Lcy":"Л","lcy":"л","ldca":"⤶","ldquo":"“","ldquor":"„","ldrdhar":"⥧","ldrushar":"⥋","ldsh":"↲","le":"≤","lE":"≦","LeftAngleBracket":"⟨","LeftArrowBar":"⇤","leftarrow":"←","LeftArrow":"←","Leftarrow":"⇐","LeftArrowRightArrow":"⇆","leftarrowtail":"↢","LeftCeiling":"⌈","LeftDoubleBracket":"⟦","LeftDownTeeVector":"⥡","LeftDownVectorBar":"⥙","LeftDownVector":"⇃","LeftFloor":"⌊","leftharpoondown":"↽","leftharpoonup":"↼","leftleftarrows":"⇇","leftrightarrow":"↔","LeftRightArrow":"↔","Leftrightarrow":"⇔","leftrightarrows":"⇆","leftrightharpoons":"⇋","leftrightsquigarrow":"↭","LeftRightVector":"⥎","LeftTeeArrow":"↤","LeftTee":"⊣","LeftTeeVector":"⥚","leftthreetimes":"⋋","LeftTriangleBar":"⧏","LeftTriangle":"⊲","LeftTriangleEqual":"⊴","LeftUpDownVector":"⥑","LeftUpTeeVector":"⥠","LeftUpVectorBar":"⥘","LeftUpVector":"↿","LeftVectorBar":"⥒","LeftVector":"↼","lEg":"⪋","leg":"⋚","leq":"≤","leqq":"≦","leqslant":"⩽","lescc":"⪨","les":"⩽","lesdot":"⩿","lesdoto":"⪁","lesdotor":"⪃","lesg":"⋚︀","lesges":"⪓","lessapprox":"⪅","lessdot":"⋖","lesseqgtr":"⋚","lesseqqgtr":"⪋","LessEqualGreater":"⋚","LessFullEqual":"≦","LessGreater":"≶","lessgtr":"≶","LessLess":"⪡","lesssim":"≲","LessSlantEqual":"⩽","LessTilde":"≲","lfisht":"⥼","lfloor":"⌊","Lfr":"𝔏","lfr":"𝔩","lg":"≶","lgE":"⪑","lHar":"⥢","lhard":"↽","lharu":"↼","lharul":"⥪","lhblk":"▄","LJcy":"Љ","ljcy":"љ","llarr":"⇇","ll":"≪","Ll":"⋘","llcorner":"⌞","Lleftarrow":"⇚","llhard":"⥫","lltri":"◺","Lmidot":"Ŀ","lmidot":"ŀ","lmoustache":"⎰","lmoust":"⎰","lnap":"⪉","lnapprox":"⪉","lne":"⪇","lnE":"≨","lneq":"⪇","lneqq":"≨","lnsim":"⋦","loang":"⟬","loarr":"⇽","lobrk":"⟦","longleftarrow":"⟵","LongLeftArrow":"⟵","Longleftarrow":"⟸","longleftrightarrow":"⟷","LongLeftRightArrow":"⟷","Longleftrightarrow":"⟺","longmapsto":"⟼","longrightarrow":"⟶","LongRightArrow":"⟶","Longrightarrow":"⟹","looparrowleft":"↫","looparrowright":"↬","lopar":"⦅","Lopf":"𝕃","lopf":"𝕝","loplus":"⨭","lotimes":"⨴","lowast":"∗","lowbar":"_","LowerLeftArrow":"↙","LowerRightArrow":"↘","loz":"◊","lozenge":"◊","lozf":"⧫","lpar":"(","lparlt":"⦓","lrarr":"⇆","lrcorner":"⌟","lrhar":"⇋","lrhard":"⥭","lrm":"‎","lrtri":"⊿","lsaquo":"‹","lscr":"𝓁","Lscr":"ℒ","lsh":"↰","Lsh":"↰","lsim":"≲","lsime":"⪍","lsimg":"⪏","lsqb":"[","lsquo":"‘","lsquor":"‚","Lstrok":"Ł","lstrok":"ł","ltcc":"⪦","ltcir":"⩹","lt":"<","LT":"<","Lt":"≪","ltdot":"⋖","lthree":"⋋","ltimes":"⋉","ltlarr":"⥶","ltquest":"⩻","ltri":"◃","ltrie":"⊴","ltrif":"◂","ltrPar":"⦖","lurdshar":"⥊","luruhar":"⥦","lvertneqq":"≨︀","lvnE":"≨︀","macr":"¯","male":"♂","malt":"✠","maltese":"✠","Map":"⤅","map":"↦","mapsto":"↦","mapstodown":"↧","mapstoleft":"↤","mapstoup":"↥","marker":"▮","mcomma":"⨩","Mcy":"М","mcy":"м","mdash":"—","mDDot":"∺","measuredangle":"∡","MediumSpace":" ","Mellintrf":"ℳ","Mfr":"𝔐","mfr":"𝔪","mho":"℧","micro":"µ","midast":"*","midcir":"⫰","mid":"∣","middot":"·","minusb":"⊟","minus":"−","minusd":"∸","minusdu":"⨪","MinusPlus":"∓","mlcp":"⫛","mldr":"…","mnplus":"∓","models":"⊧","Mopf":"𝕄","mopf":"𝕞","mp":"∓","mscr":"𝓂","Mscr":"ℳ","mstpos":"∾","Mu":"Μ","mu":"μ","multimap":"⊸","mumap":"⊸","nabla":"∇","Nacute":"Ń","nacute":"ń","nang":"∠⃒","nap":"≉","napE":"⩰̸","napid":"≋̸","napos":"ŉ","napprox":"≉","natural":"♮","naturals":"ℕ","natur":"♮","nbsp":" ","nbump":"≎̸","nbumpe":"≏̸","ncap":"⩃","Ncaron":"Ň","ncaron":"ň","Ncedil":"Ņ","ncedil":"ņ","ncong":"≇","ncongdot":"⩭̸","ncup":"⩂","Ncy":"Н","ncy":"н","ndash":"–","nearhk":"⤤","nearr":"↗","neArr":"⇗","nearrow":"↗","ne":"≠","nedot":"≐̸","NegativeMediumSpace":"​","NegativeThickSpace":"​","NegativeThinSpace":"​","NegativeVeryThinSpace":"​","nequiv":"≢","nesear":"⤨","nesim":"≂̸","NestedGreaterGreater":"≫","NestedLessLess":"≪","NewLine":"\\n","nexist":"∄","nexists":"∄","Nfr":"𝔑","nfr":"𝔫","ngE":"≧̸","nge":"≱","ngeq":"≱","ngeqq":"≧̸","ngeqslant":"⩾̸","nges":"⩾̸","nGg":"⋙̸","ngsim":"≵","nGt":"≫⃒","ngt":"≯","ngtr":"≯","nGtv":"≫̸","nharr":"↮","nhArr":"⇎","nhpar":"⫲","ni":"∋","nis":"⋼","nisd":"⋺","niv":"∋","NJcy":"Њ","njcy":"њ","nlarr":"↚","nlArr":"⇍","nldr":"‥","nlE":"≦̸","nle":"≰","nleftarrow":"↚","nLeftarrow":"⇍","nleftrightarrow":"↮","nLeftrightarrow":"⇎","nleq":"≰","nleqq":"≦̸","nleqslant":"⩽̸","nles":"⩽̸","nless":"≮","nLl":"⋘̸","nlsim":"≴","nLt":"≪⃒","nlt":"≮","nltri":"⋪","nltrie":"⋬","nLtv":"≪̸","nmid":"∤","NoBreak":"⁠","NonBreakingSpace":" ","nopf":"𝕟","Nopf":"ℕ","Not":"⫬","not":"¬","NotCongruent":"≢","NotCupCap":"≭","NotDoubleVerticalBar":"∦","NotElement":"∉","NotEqual":"≠","NotEqualTilde":"≂̸","NotExists":"∄","NotGreater":"≯","NotGreaterEqual":"≱","NotGreaterFullEqual":"≧̸","NotGreaterGreater":"≫̸","NotGreaterLess":"≹","NotGreaterSlantEqual":"⩾̸","NotGreaterTilde":"≵","NotHumpDownHump":"≎̸","NotHumpEqual":"≏̸","notin":"∉","notindot":"⋵̸","notinE":"⋹̸","notinva":"∉","notinvb":"⋷","notinvc":"⋶","NotLeftTriangleBar":"⧏̸","NotLeftTriangle":"⋪","NotLeftTriangleEqual":"⋬","NotLess":"≮","NotLessEqual":"≰","NotLessGreater":"≸","NotLessLess":"≪̸","NotLessSlantEqual":"⩽̸","NotLessTilde":"≴","NotNestedGreaterGreater":"⪢̸","NotNestedLessLess":"⪡̸","notni":"∌","notniva":"∌","notnivb":"⋾","notnivc":"⋽","NotPrecedes":"⊀","NotPrecedesEqual":"⪯̸","NotPrecedesSlantEqual":"⋠","NotReverseElement":"∌","NotRightTriangleBar":"⧐̸","NotRightTriangle":"⋫","NotRightTriangleEqual":"⋭","NotSquareSubset":"⊏̸","NotSquareSubsetEqual":"⋢","NotSquareSuperset":"⊐̸","NotSquareSupersetEqual":"⋣","NotSubset":"⊂⃒","NotSubsetEqual":"⊈","NotSucceeds":"⊁","NotSucceedsEqual":"⪰̸","NotSucceedsSlantEqual":"⋡","NotSucceedsTilde":"≿̸","NotSuperset":"⊃⃒","NotSupersetEqual":"⊉","NotTilde":"≁","NotTildeEqual":"≄","NotTildeFullEqual":"≇","NotTildeTilde":"≉","NotVerticalBar":"∤","nparallel":"∦","npar":"∦","nparsl":"⫽⃥","npart":"∂̸","npolint":"⨔","npr":"⊀","nprcue":"⋠","nprec":"⊀","npreceq":"⪯̸","npre":"⪯̸","nrarrc":"⤳̸","nrarr":"↛","nrArr":"⇏","nrarrw":"↝̸","nrightarrow":"↛","nRightarrow":"⇏","nrtri":"⋫","nrtrie":"⋭","nsc":"⊁","nsccue":"⋡","nsce":"⪰̸","Nscr":"𝒩","nscr":"𝓃","nshortmid":"∤","nshortparallel":"∦","nsim":"≁","nsime":"≄","nsimeq":"≄","nsmid":"∤","nspar":"∦","nsqsube":"⋢","nsqsupe":"⋣","nsub":"⊄","nsubE":"⫅̸","nsube":"⊈","nsubset":"⊂⃒","nsubseteq":"⊈","nsubseteqq":"⫅̸","nsucc":"⊁","nsucceq":"⪰̸","nsup":"⊅","nsupE":"⫆̸","nsupe":"⊉","nsupset":"⊃⃒","nsupseteq":"⊉","nsupseteqq":"⫆̸","ntgl":"≹","Ntilde":"Ñ","ntilde":"ñ","ntlg":"≸","ntriangleleft":"⋪","ntrianglelefteq":"⋬","ntriangleright":"⋫","ntrianglerighteq":"⋭","Nu":"Ν","nu":"ν","num":"#","numero":"№","numsp":" ","nvap":"≍⃒","nvdash":"⊬","nvDash":"⊭","nVdash":"⊮","nVDash":"⊯","nvge":"≥⃒","nvgt":">⃒","nvHarr":"⤄","nvinfin":"⧞","nvlArr":"⤂","nvle":"≤⃒","nvlt":"<⃒","nvltrie":"⊴⃒","nvrArr":"⤃","nvrtrie":"⊵⃒","nvsim":"∼⃒","nwarhk":"⤣","nwarr":"↖","nwArr":"⇖","nwarrow":"↖","nwnear":"⤧","Oacute":"Ó","oacute":"ó","oast":"⊛","Ocirc":"Ô","ocirc":"ô","ocir":"⊚","Ocy":"О","ocy":"о","odash":"⊝","Odblac":"Ő","odblac":"ő","odiv":"⨸","odot":"⊙","odsold":"⦼","OElig":"Œ","oelig":"œ","ofcir":"⦿","Ofr":"𝔒","ofr":"𝔬","ogon":"˛","Ograve":"Ò","ograve":"ò","ogt":"⧁","ohbar":"⦵","ohm":"Ω","oint":"∮","olarr":"↺","olcir":"⦾","olcross":"⦻","oline":"‾","olt":"⧀","Omacr":"Ō","omacr":"ō","Omega":"Ω","omega":"ω","Omicron":"Ο","omicron":"ο","omid":"⦶","ominus":"⊖","Oopf":"𝕆","oopf":"𝕠","opar":"⦷","OpenCurlyDoubleQuote":"“","OpenCurlyQuote":"‘","operp":"⦹","oplus":"⊕","orarr":"↻","Or":"⩔","or":"∨","ord":"⩝","order":"ℴ","orderof":"ℴ","ordf":"ª","ordm":"º","origof":"⊶","oror":"⩖","orslope":"⩗","orv":"⩛","oS":"Ⓢ","Oscr":"𝒪","oscr":"ℴ","Oslash":"Ø","oslash":"ø","osol":"⊘","Otilde":"Õ","otilde":"õ","otimesas":"⨶","Otimes":"⨷","otimes":"⊗","Ouml":"Ö","ouml":"ö","ovbar":"⌽","OverBar":"‾","OverBrace":"⏞","OverBracket":"⎴","OverParenthesis":"⏜","para":"¶","parallel":"∥","par":"∥","parsim":"⫳","parsl":"⫽","part":"∂","PartialD":"∂","Pcy":"П","pcy":"п","percnt":"%","period":".","permil":"‰","perp":"⊥","pertenk":"‱","Pfr":"𝔓","pfr":"𝔭","Phi":"Φ","phi":"φ","phiv":"ϕ","phmmat":"ℳ","phone":"☎","Pi":"Π","pi":"π","pitchfork":"⋔","piv":"ϖ","planck":"ℏ","planckh":"ℎ","plankv":"ℏ","plusacir":"⨣","plusb":"⊞","pluscir":"⨢","plus":"+","plusdo":"∔","plusdu":"⨥","pluse":"⩲","PlusMinus":"±","plusmn":"±","plussim":"⨦","plustwo":"⨧","pm":"±","Poincareplane":"ℌ","pointint":"⨕","popf":"𝕡","Popf":"ℙ","pound":"£","prap":"⪷","Pr":"⪻","pr":"≺","prcue":"≼","precapprox":"⪷","prec":"≺","preccurlyeq":"≼","Precedes":"≺","PrecedesEqual":"⪯","PrecedesSlantEqual":"≼","PrecedesTilde":"≾","preceq":"⪯","precnapprox":"⪹","precneqq":"⪵","precnsim":"⋨","pre":"⪯","prE":"⪳","precsim":"≾","prime":"′","Prime":"″","primes":"ℙ","prnap":"⪹","prnE":"⪵","prnsim":"⋨","prod":"∏","Product":"∏","profalar":"⌮","profline":"⌒","profsurf":"⌓","prop":"∝","Proportional":"∝","Proportion":"∷","propto":"∝","prsim":"≾","prurel":"⊰","Pscr":"𝒫","pscr":"𝓅","Psi":"Ψ","psi":"ψ","puncsp":" ","Qfr":"𝔔","qfr":"𝔮","qint":"⨌","qopf":"𝕢","Qopf":"ℚ","qprime":"⁗","Qscr":"𝒬","qscr":"𝓆","quaternions":"ℍ","quatint":"⨖","quest":"?","questeq":"≟","quot":"\\"","QUOT":"\\"","rAarr":"⇛","race":"∽̱","Racute":"Ŕ","racute":"ŕ","radic":"√","raemptyv":"⦳","rang":"⟩","Rang":"⟫","rangd":"⦒","range":"⦥","rangle":"⟩","raquo":"»","rarrap":"⥵","rarrb":"⇥","rarrbfs":"⤠","rarrc":"⤳","rarr":"→","Rarr":"↠","rArr":"⇒","rarrfs":"⤞","rarrhk":"↪","rarrlp":"↬","rarrpl":"⥅","rarrsim":"⥴","Rarrtl":"⤖","rarrtl":"↣","rarrw":"↝","ratail":"⤚","rAtail":"⤜","ratio":"∶","rationals":"ℚ","rbarr":"⤍","rBarr":"⤏","RBarr":"⤐","rbbrk":"❳","rbrace":"}","rbrack":"]","rbrke":"⦌","rbrksld":"⦎","rbrkslu":"⦐","Rcaron":"Ř","rcaron":"ř","Rcedil":"Ŗ","rcedil":"ŗ","rceil":"⌉","rcub":"}","Rcy":"Р","rcy":"р","rdca":"⤷","rdldhar":"⥩","rdquo":"”","rdquor":"”","rdsh":"↳","real":"ℜ","realine":"ℛ","realpart":"ℜ","reals":"ℝ","Re":"ℜ","rect":"▭","reg":"®","REG":"®","ReverseElement":"∋","ReverseEquilibrium":"⇋","ReverseUpEquilibrium":"⥯","rfisht":"⥽","rfloor":"⌋","rfr":"𝔯","Rfr":"ℜ","rHar":"⥤","rhard":"⇁","rharu":"⇀","rharul":"⥬","Rho":"Ρ","rho":"ρ","rhov":"ϱ","RightAngleBracket":"⟩","RightArrowBar":"⇥","rightarrow":"→","RightArrow":"→","Rightarrow":"⇒","RightArrowLeftArrow":"⇄","rightarrowtail":"↣","RightCeiling":"⌉","RightDoubleBracket":"⟧","RightDownTeeVector":"⥝","RightDownVectorBar":"⥕","RightDownVector":"⇂","RightFloor":"⌋","rightharpoondown":"⇁","rightharpoonup":"⇀","rightleftarrows":"⇄","rightleftharpoons":"⇌","rightrightarrows":"⇉","rightsquigarrow":"↝","RightTeeArrow":"↦","RightTee":"⊢","RightTeeVector":"⥛","rightthreetimes":"⋌","RightTriangleBar":"⧐","RightTriangle":"⊳","RightTriangleEqual":"⊵","RightUpDownVector":"⥏","RightUpTeeVector":"⥜","RightUpVectorBar":"⥔","RightUpVector":"↾","RightVectorBar":"⥓","RightVector":"⇀","ring":"˚","risingdotseq":"≓","rlarr":"⇄","rlhar":"⇌","rlm":"‏","rmoustache":"⎱","rmoust":"⎱","rnmid":"⫮","roang":"⟭","roarr":"⇾","robrk":"⟧","ropar":"⦆","ropf":"𝕣","Ropf":"ℝ","roplus":"⨮","rotimes":"⨵","RoundImplies":"⥰","rpar":")","rpargt":"⦔","rppolint":"⨒","rrarr":"⇉","Rrightarrow":"⇛","rsaquo":"›","rscr":"𝓇","Rscr":"ℛ","rsh":"↱","Rsh":"↱","rsqb":"]","rsquo":"’","rsquor":"’","rthree":"⋌","rtimes":"⋊","rtri":"▹","rtrie":"⊵","rtrif":"▸","rtriltri":"⧎","RuleDelayed":"⧴","ruluhar":"⥨","rx":"℞","Sacute":"Ś","sacute":"ś","sbquo":"‚","scap":"⪸","Scaron":"Š","scaron":"š","Sc":"⪼","sc":"≻","sccue":"≽","sce":"⪰","scE":"⪴","Scedil":"Ş","scedil":"ş","Scirc":"Ŝ","scirc":"ŝ","scnap":"⪺","scnE":"⪶","scnsim":"⋩","scpolint":"⨓","scsim":"≿","Scy":"С","scy":"с","sdotb":"⊡","sdot":"⋅","sdote":"⩦","searhk":"⤥","searr":"↘","seArr":"⇘","searrow":"↘","sect":"§","semi":";","seswar":"⤩","setminus":"∖","setmn":"∖","sext":"✶","Sfr":"𝔖","sfr":"𝔰","sfrown":"⌢","sharp":"♯","SHCHcy":"Щ","shchcy":"щ","SHcy":"Ш","shcy":"ш","ShortDownArrow":"↓","ShortLeftArrow":"←","shortmid":"∣","shortparallel":"∥","ShortRightArrow":"→","ShortUpArrow":"↑","shy":"­","Sigma":"Σ","sigma":"σ","sigmaf":"ς","sigmav":"ς","sim":"∼","simdot":"⩪","sime":"≃","simeq":"≃","simg":"⪞","simgE":"⪠","siml":"⪝","simlE":"⪟","simne":"≆","simplus":"⨤","simrarr":"⥲","slarr":"←","SmallCircle":"∘","smallsetminus":"∖","smashp":"⨳","smeparsl":"⧤","smid":"∣","smile":"⌣","smt":"⪪","smte":"⪬","smtes":"⪬︀","SOFTcy":"Ь","softcy":"ь","solbar":"⌿","solb":"⧄","sol":"/","Sopf":"𝕊","sopf":"𝕤","spades":"♠","spadesuit":"♠","spar":"∥","sqcap":"⊓","sqcaps":"⊓︀","sqcup":"⊔","sqcups":"⊔︀","Sqrt":"√","sqsub":"⊏","sqsube":"⊑","sqsubset":"⊏","sqsubseteq":"⊑","sqsup":"⊐","sqsupe":"⊒","sqsupset":"⊐","sqsupseteq":"⊒","square":"□","Square":"□","SquareIntersection":"⊓","SquareSubset":"⊏","SquareSubsetEqual":"⊑","SquareSuperset":"⊐","SquareSupersetEqual":"⊒","SquareUnion":"⊔","squarf":"▪","squ":"□","squf":"▪","srarr":"→","Sscr":"𝒮","sscr":"𝓈","ssetmn":"∖","ssmile":"⌣","sstarf":"⋆","Star":"⋆","star":"☆","starf":"★","straightepsilon":"ϵ","straightphi":"ϕ","strns":"¯","sub":"⊂","Sub":"⋐","subdot":"⪽","subE":"⫅","sube":"⊆","subedot":"⫃","submult":"⫁","subnE":"⫋","subne":"⊊","subplus":"⪿","subrarr":"⥹","subset":"⊂","Subset":"⋐","subseteq":"⊆","subseteqq":"⫅","SubsetEqual":"⊆","subsetneq":"⊊","subsetneqq":"⫋","subsim":"⫇","subsub":"⫕","subsup":"⫓","succapprox":"⪸","succ":"≻","succcurlyeq":"≽","Succeeds":"≻","SucceedsEqual":"⪰","SucceedsSlantEqual":"≽","SucceedsTilde":"≿","succeq":"⪰","succnapprox":"⪺","succneqq":"⪶","succnsim":"⋩","succsim":"≿","SuchThat":"∋","sum":"∑","Sum":"∑","sung":"♪","sup1":"¹","sup2":"²","sup3":"³","sup":"⊃","Sup":"⋑","supdot":"⪾","supdsub":"⫘","supE":"⫆","supe":"⊇","supedot":"⫄","Superset":"⊃","SupersetEqual":"⊇","suphsol":"⟉","suphsub":"⫗","suplarr":"⥻","supmult":"⫂","supnE":"⫌","supne":"⊋","supplus":"⫀","supset":"⊃","Supset":"⋑","supseteq":"⊇","supseteqq":"⫆","supsetneq":"⊋","supsetneqq":"⫌","supsim":"⫈","supsub":"⫔","supsup":"⫖","swarhk":"⤦","swarr":"↙","swArr":"⇙","swarrow":"↙","swnwar":"⤪","szlig":"ß","Tab":"\\t","target":"⌖","Tau":"Τ","tau":"τ","tbrk":"⎴","Tcaron":"Ť","tcaron":"ť","Tcedil":"Ţ","tcedil":"ţ","Tcy":"Т","tcy":"т","tdot":"⃛","telrec":"⌕","Tfr":"𝔗","tfr":"𝔱","there4":"∴","therefore":"∴","Therefore":"∴","Theta":"Θ","theta":"θ","thetasym":"ϑ","thetav":"ϑ","thickapprox":"≈","thicksim":"∼","ThickSpace":"  ","ThinSpace":" ","thinsp":" ","thkap":"≈","thksim":"∼","THORN":"Þ","thorn":"þ","tilde":"˜","Tilde":"∼","TildeEqual":"≃","TildeFullEqual":"≅","TildeTilde":"≈","timesbar":"⨱","timesb":"⊠","times":"×","timesd":"⨰","tint":"∭","toea":"⤨","topbot":"⌶","topcir":"⫱","top":"⊤","Topf":"𝕋","topf":"𝕥","topfork":"⫚","tosa":"⤩","tprime":"‴","trade":"™","TRADE":"™","triangle":"▵","triangledown":"▿","triangleleft":"◃","trianglelefteq":"⊴","triangleq":"≜","triangleright":"▹","trianglerighteq":"⊵","tridot":"◬","trie":"≜","triminus":"⨺","TripleDot":"⃛","triplus":"⨹","trisb":"⧍","tritime":"⨻","trpezium":"⏢","Tscr":"𝒯","tscr":"𝓉","TScy":"Ц","tscy":"ц","TSHcy":"Ћ","tshcy":"ћ","Tstrok":"Ŧ","tstrok":"ŧ","twixt":"≬","twoheadleftarrow":"↞","twoheadrightarrow":"↠","Uacute":"Ú","uacute":"ú","uarr":"↑","Uarr":"↟","uArr":"⇑","Uarrocir":"⥉","Ubrcy":"Ў","ubrcy":"ў","Ubreve":"Ŭ","ubreve":"ŭ","Ucirc":"Û","ucirc":"û","Ucy":"У","ucy":"у","udarr":"⇅","Udblac":"Ű","udblac":"ű","udhar":"⥮","ufisht":"⥾","Ufr":"𝔘","ufr":"𝔲","Ugrave":"Ù","ugrave":"ù","uHar":"⥣","uharl":"↿","uharr":"↾","uhblk":"▀","ulcorn":"⌜","ulcorner":"⌜","ulcrop":"⌏","ultri":"◸","Umacr":"Ū","umacr":"ū","uml":"¨","UnderBar":"_","UnderBrace":"⏟","UnderBracket":"⎵","UnderParenthesis":"⏝","Union":"⋃","UnionPlus":"⊎","Uogon":"Ų","uogon":"ų","Uopf":"𝕌","uopf":"𝕦","UpArrowBar":"⤒","uparrow":"↑","UpArrow":"↑","Uparrow":"⇑","UpArrowDownArrow":"⇅","updownarrow":"↕","UpDownArrow":"↕","Updownarrow":"⇕","UpEquilibrium":"⥮","upharpoonleft":"↿","upharpoonright":"↾","uplus":"⊎","UpperLeftArrow":"↖","UpperRightArrow":"↗","upsi":"υ","Upsi":"ϒ","upsih":"ϒ","Upsilon":"Υ","upsilon":"υ","UpTeeArrow":"↥","UpTee":"⊥","upuparrows":"⇈","urcorn":"⌝","urcorner":"⌝","urcrop":"⌎","Uring":"Ů","uring":"ů","urtri":"◹","Uscr":"𝒰","uscr":"𝓊","utdot":"⋰","Utilde":"Ũ","utilde":"ũ","utri":"▵","utrif":"▴","uuarr":"⇈","Uuml":"Ü","uuml":"ü","uwangle":"⦧","vangrt":"⦜","varepsilon":"ϵ","varkappa":"ϰ","varnothing":"∅","varphi":"ϕ","varpi":"ϖ","varpropto":"∝","varr":"↕","vArr":"⇕","varrho":"ϱ","varsigma":"ς","varsubsetneq":"⊊︀","varsubsetneqq":"⫋︀","varsupsetneq":"⊋︀","varsupsetneqq":"⫌︀","vartheta":"ϑ","vartriangleleft":"⊲","vartriangleright":"⊳","vBar":"⫨","Vbar":"⫫","vBarv":"⫩","Vcy":"В","vcy":"в","vdash":"⊢","vDash":"⊨","Vdash":"⊩","VDash":"⊫","Vdashl":"⫦","veebar":"⊻","vee":"∨","Vee":"⋁","veeeq":"≚","vellip":"⋮","verbar":"|","Verbar":"‖","vert":"|","Vert":"‖","VerticalBar":"∣","VerticalLine":"|","VerticalSeparator":"❘","VerticalTilde":"≀","VeryThinSpace":" ","Vfr":"𝔙","vfr":"𝔳","vltri":"⊲","vnsub":"⊂⃒","vnsup":"⊃⃒","Vopf":"𝕍","vopf":"𝕧","vprop":"∝","vrtri":"⊳","Vscr":"𝒱","vscr":"𝓋","vsubnE":"⫋︀","vsubne":"⊊︀","vsupnE":"⫌︀","vsupne":"⊋︀","Vvdash":"⊪","vzigzag":"⦚","Wcirc":"Ŵ","wcirc":"ŵ","wedbar":"⩟","wedge":"∧","Wedge":"⋀","wedgeq":"≙","weierp":"℘","Wfr":"𝔚","wfr":"𝔴","Wopf":"𝕎","wopf":"𝕨","wp":"℘","wr":"≀","wreath":"≀","Wscr":"𝒲","wscr":"𝓌","xcap":"⋂","xcirc":"◯","xcup":"⋃","xdtri":"▽","Xfr":"𝔛","xfr":"𝔵","xharr":"⟷","xhArr":"⟺","Xi":"Ξ","xi":"ξ","xlarr":"⟵","xlArr":"⟸","xmap":"⟼","xnis":"⋻","xodot":"⨀","Xopf":"𝕏","xopf":"𝕩","xoplus":"⨁","xotime":"⨂","xrarr":"⟶","xrArr":"⟹","Xscr":"𝒳","xscr":"𝓍","xsqcup":"⨆","xuplus":"⨄","xutri":"△","xvee":"⋁","xwedge":"⋀","Yacute":"Ý","yacute":"ý","YAcy":"Я","yacy":"я","Ycirc":"Ŷ","ycirc":"ŷ","Ycy":"Ы","ycy":"ы","yen":"¥","Yfr":"𝔜","yfr":"𝔶","YIcy":"Ї","yicy":"ї","Yopf":"𝕐","yopf":"𝕪","Yscr":"𝒴","yscr":"𝓎","YUcy":"Ю","yucy":"ю","yuml":"ÿ","Yuml":"Ÿ","Zacute":"Ź","zacute":"ź","Zcaron":"Ž","zcaron":"ž","Zcy":"З","zcy":"з","Zdot":"Ż","zdot":"ż","zeetrf":"ℨ","ZeroWidthSpace":"​","Zeta":"Ζ","zeta":"ζ","zfr":"𝔷","Zfr":"ℨ","ZHcy":"Ж","zhcy":"ж","zigrarr":"⇝","zopf":"𝕫","Zopf":"ℤ","Zscr":"𝒵","zscr":"𝓏","zwj":"‍","zwnj":"‌"}')},9591:t=>{"use strict";t.exports=JSON.parse('{"Aacute":"Á","aacute":"á","Acirc":"Â","acirc":"â","acute":"´","AElig":"Æ","aelig":"æ","Agrave":"À","agrave":"à","amp":"&","AMP":"&","Aring":"Å","aring":"å","Atilde":"Ã","atilde":"ã","Auml":"Ä","auml":"ä","brvbar":"¦","Ccedil":"Ç","ccedil":"ç","cedil":"¸","cent":"¢","copy":"©","COPY":"©","curren":"¤","deg":"°","divide":"÷","Eacute":"É","eacute":"é","Ecirc":"Ê","ecirc":"ê","Egrave":"È","egrave":"è","ETH":"Ð","eth":"ð","Euml":"Ë","euml":"ë","frac12":"½","frac14":"¼","frac34":"¾","gt":">","GT":">","Iacute":"Í","iacute":"í","Icirc":"Î","icirc":"î","iexcl":"¡","Igrave":"Ì","igrave":"ì","iquest":"¿","Iuml":"Ï","iuml":"ï","laquo":"«","lt":"<","LT":"<","macr":"¯","micro":"µ","middot":"·","nbsp":" ","not":"¬","Ntilde":"Ñ","ntilde":"ñ","Oacute":"Ó","oacute":"ó","Ocirc":"Ô","ocirc":"ô","Ograve":"Ò","ograve":"ò","ordf":"ª","ordm":"º","Oslash":"Ø","oslash":"ø","Otilde":"Õ","otilde":"õ","Ouml":"Ö","ouml":"ö","para":"¶","plusmn":"±","pound":"£","quot":"\\"","QUOT":"\\"","raquo":"»","reg":"®","REG":"®","sect":"§","shy":"­","sup1":"¹","sup2":"²","sup3":"³","szlig":"ß","THORN":"Þ","thorn":"þ","times":"×","Uacute":"Ú","uacute":"ú","Ucirc":"Û","ucirc":"û","Ugrave":"Ù","ugrave":"ù","uml":"¨","Uuml":"Ü","uuml":"ü","Yacute":"Ý","yacute":"ý","yen":"¥","yuml":"ÿ"}')},2586:t=>{"use strict";t.exports=JSON.parse('{"amp":"&","apos":"\'","gt":">","lt":"<","quot":"\\""}')}},i={};function n(t){var r=i[t];if(void 0!==r)return r.exports;var s=i[t]={id:t,loaded:!1,exports:{}};return e[t].call(s.exports,s,s.exports,n),s.loaded=!0,s.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.nmd=t=>(t.paths=[],t.children||(t.children=[]),t);var r={};return(()=>{"use strict";n.r(r),n.d(r,{Context:()=>Js,DOM:()=>ao,Model:()=>to,Overlay:()=>eo,Primitives:()=>io,Render:()=>no,Shaders:()=>ro,Stage:()=>so,Util:()=>oo,e:()=>Qs,mathBox:()=>lo,version:()=>Ks,π:()=>Ys,τ:()=>Zs});var t={};n.r(t),n.d(t,{JSX:()=>W,format:()=>H,markup:()=>V,number:()=>R,print:()=>U});var e={};n.r(e),n.d(e,{Attributes:()=>P,Group:()=>Y,Guard:()=>Z,Model:()=>st,Node:()=>G});var i={};n.r(i),n.d(i,{Types:()=>ht,apply:()=>ft,createClass:()=>wt,element:()=>pt,hint:()=>ct,recycle:()=>dt});var s={};n.r(s),n.d(s,{Classes:()=>zt,Factory:()=>ot,Overlay:()=>_t});var o={};n.r(o),n.d(o,{paramToArrayStorage:()=>Pt,paramToGL:()=>Et,swizzleToEulerOrder:()=>Dt,transformComposer:()=>jt});var a={};n.r(a),n.d(a,{getDimensions:()=>It,getLerpEmitter:()=>Vt,getLerpThunk:()=>Bt,getSizes:()=>Ft,getStreamer:()=>Ut,getThunk:()=>Rt,makeEmitter:()=>Nt,repeatCall:()=>Lt});var l={};n.r(l),n.d(l,{binaryOperator:()=>Jt,constant:()=>se,extendVec:()=>Kt,identity:()=>re,injectVec4:()=>ee,invertSwizzleVec4:()=>ne,mapByte2FloatOffset:()=>Zt,sample2DArray:()=>Qt,swizzleVec4:()=>ie,toType:()=>Gt,truncateVec:()=>te});var h={};n.r(h),n.d(h,{addOrigin:()=>we,recenterAxis:()=>ze,setDimension:()=>_e,setDimensionNormal:()=>ke,setOrigin:()=>xe});var u={};n.r(u),n.d(u,{clone:()=>Ae,merge:()=>Me,parseQuoted:()=>Ce});var c={};n.r(c),n.d(c,{binary:()=>_i,clamp:()=>xi,cosine:()=>wi,hold:()=>ki});var p={};n.r(p),n.d(p,{linear:()=>Xi,log:()=>Gi,make:()=>Yi});var d={};n.r(d),n.d(d,{Classes:()=>Ui,Helpers:()=>Qi,Traits:()=>Wi,Types:()=>Hi});var f={};n.r(f),n.d(f,{Factory:()=>Ki,Primitive:()=>St,Types:()=>tn});var m={};n.r(m),n.d(m,{Classes:()=>An,Factory:()=>sn,Scene:()=>rn});var g={};n.r(g),n.d(g,{Graph:()=>Cn,IN:()=>En,Node:()=>On,OUT:()=>Pn,Outlet:()=>Tn});var v={};n.r(v),n.d(v,{Layout:()=>Ln,Program:()=>Fn,Snippet:()=>Dn,assemble:()=>qn,compare:()=>jn.compare,link:()=>In,load:()=>Nn,make:()=>jn.make,max:()=>jn.max,nest:()=>jn.nest});var y={};n.r(y),n.d(y,{merge:()=>lr,overlay:()=>or,process:()=>Kn});var b={};n.r(b),n.d(b,{inspect:()=>mr,markup:()=>ur,serialize:()=>hr,visualize:()=>fr});var x={};n.r(x),n.d(x,{Factory:()=>gr,Material:()=>yr,cache:()=>wr,hash:()=>Yn,library:()=>br,queue:()=>xr});var w={};n.r(w),n.d(w,{RETURN_ARG:()=>Kr,SHADOW_ARG:()=>Jr,body:()=>fs,build:()=>xs,call:()=>bs,compile:()=>_r,dedupe:()=>zs,define:()=>ms,defuse:()=>ks,fn:()=>gs,hoist:()=>Ss,invoke:()=>vs,lines:()=>cs,link:()=>_s,links:()=>ws,list:()=>ps,parse:()=>es,same:()=>ys,statements:()=>ds,unshadow:()=>us,walk:()=>ls});var _={};n.r(_),n.d(_,{Factory:()=>Ds,Snippets:()=>js});var k={};n.r(k),n.d(k,{API:()=>Is,Animator:()=>qs,Controller:()=>Ls});var z={};n.r(z),n.d(z,{Axis:()=>Ns,Data:()=>Rs,Ease:()=>Us,GLSL:()=>Vs,JS:()=>Bs,Pretty:()=>$s,Three:()=>Hs,Ticks:()=>Ws,VDOM:()=>Xs});var S=n(824);class M{static bind(t,e){return function(i,n){n.__binds||(n.__binds=[]);let r=t;Array.isArray(i)&&(r=i[0],i=i[1]);const s=/^([^.:]*(?:\.[^.:]+)*)?(?::(.*))?$/.exec(i),o=s[1].split(/\./g),a=o.pop(),l=s[2]||a,h=o.shift();let u={this:n}[h]||e[h]||t[h]||r;for(;u&&(i=o.shift());)u=u[i];if(u&&(u.on||u.addEventListener)){const e=function(e){n[l]&&n[l](e,t)};M._polyfill(u,["addEventListener","on"],(function(t){u[t](a,e)}));const i={target:u,name:a,callback:e};return n.__binds.push(i),e}throw"Cannot bind '"+i+"' in "+this.__name}}static unbind(){return function(t){t.__binds&&(t.__binds.forEach(function(t){M._polyfill(t.target,["removeEventListener","off"],(function(e){t.target[e](t.name,t.callback)}))}.bind(this)),t.__binds=[])}}static apply(t){t.trigger=M._trigger,t.triggerOnce=M._triggerOnce,t.hasEventListener=S.EventDispatcher.prototype.hasEventListener,t.addEventListener=S.EventDispatcher.prototype.addEventListener,t.removeEventListener=S.EventDispatcher.prototype.removeEventListener,t.on=t.addEventListener,t.off=t.removeEventListener,t.dispatchEvent=t.trigger}static _triggerOnce(t){this.trigger(t),this._listeners&&delete this._listeners[t.type]}static _trigger(t){if(void 0===this._listeners)return;const e=t.type;let i=this._listeners[e];if(void 0!==i){i=i.slice();const e=i.length;t.target=this;for(let n=0;n<e;n++)i[n].call(this,t,this)}}static _polyfill(t,e,i){e.map((function(e){return t.method})),e.length&&i(e[0])}}function A(t){return t&&"string"==typeof t.valueOf()}class C{static initClass(){this.Plugins={},this.Aliases={}}static registerPlugin(t,e){const i=function(e){C.Plugin.call(this,e),this.__name=t};i.prototype=Object.assign(new C.Plugin,e),this.Plugins[t]=i}static unregisterPlugin(t){delete this.Plugins[t]}static registerAlias(t,e){this.Aliases[t]=e}static unregisterAlias(t){delete this.Aliases[t]}constructor(t){if(t){let e=[].slice.apply(arguments);if(t={},e[0]instanceof Node){const i=e[0];e=e.slice(1),t.element=i}A(e[0])?t.plugins=e:Array.isArray(e[0])?t.plugins=e[0]:e[0]&&(t=Object.assign({},e[0],t))}const e={init:!0,element:document.body,plugins:["core"],aliases:{},plugindb:C.Plugins||{},aliasdb:C.Aliases||{}};this.__options=Object.assign({},e,t||{}),this.__inited=!1,this.__destroyed=!1,this.__installed=[];let i=this.__options.element;i===""+i&&(i=document.querySelector(i)),this.plugins={},this.element=i,this.trigger=this.trigger.bind(this),this.frame=this.frame.bind(this),this.events=["pre","update","render","post"].map((function(t){return{type:t}})),this.__options.init&&this.init()}init(){this.__inited||(this.__inited=!0,this.install(this.__options.plugins))}destroy(){this.__inited&&(this.__destroyed||(this.__destroyed=!0,this.trigger({type:"destroy"}),this.uninstall()))}frame(){this.events.map(this.trigger)}resolve(t){t=Array.isArray(t)?t:[t];const e=this.__options,i=Object.assign({},e.aliasdb,e.aliases),n=function(t){const e=t.split(":");return!e[1]||(i[e[0]]=[e[1]],!1)};return t=t.filter(n),Object.entries(i).forEach((function([t,e]){i[t]=Array.isArray(e)?e:[e]})),function t(e,r,s){if(s>=256)throw"Plug-in alias recursion detected.";return(e=e.filter(n)).forEach((function(e){const n=i[e];n?r=r.concat(t(n,[],s+1)):r.push(e)})),r}(t,[],0)}install(t){t=Array.isArray(t)?t:[t],((t,e)=>{let i=0;for(const n of t){if(!1===e(n,i,t))break;i++}})(t=this.resolve(t),(t=>this.__install(t))),this.__ready()}uninstall(t){t&&(t=Array.isArray(t)?t:[t],t=this.resolve(t)),(t||this.__installed).reverse().forEach((t=>this.__uninstall(t)))}__install(t){const e=this.__options.plugindb[t];if(!e)throw"[three.install] Cannot install. '"+t+"' is not registered.";if(this.plugins[t])return console.warn("[three.install] "+t+" is already installed.");const i=new e(this.__options[t]||{},t);this.plugins[t]=i;const n=i.install(this);return this.__installed.push(i),this.trigger({type:"install",plugin:i}),n}__uninstall(t){const e=A(t)?this.plugins[t]:t;e?(t=e.__name,e.uninstall(this),this.__installed=this.__installed.filter((t=>t!==e)),delete this.plugins[t],this.trigger({type:"uninstall",plugin:e})):console.warn("[three.uninstall] "+t+"' is not installed.")}__ready(){this.triggerOnce({type:"ready"})}}C.initClass(),C.Plugin=function(t){this.options=Object.assign({},this.defaults,t||{})},C.Plugin.prototype={listen:[],defaults:{},install:function(t){},uninstall:function(t){}},M.apply(C.prototype),M.apply(C.Plugin.prototype),class{static apply(t){t.set=function(t){const e=this.options||{},i=Object.entries(t).reduce((function(t,[i,n]){return e[i]!==n&&(t[i]=n),t}),{});this.options=Object.assign(e,i),this.trigger({type:"change",options:t,changes:i})},t.get=function(){return this.options},t.api=function(t,e){return t||(t={}),e&&Object.entries(t).forEach((function([i,n]){"function"==typeof n&&(t[i]=(...t)=>n(...t,e))})),t.set=this.set.bind(this),t.get=this.get.bind(this),t}}}.apply(C.Plugin.prototype),C.registerPlugin("splash",{defaults:{color:"mono",fancy:!0},listen:["ready","mathbox/init:init","mathbox/progress:progress","mathbox/destroy:destroy"],uninstall(){return this.destroy()},ready(t,e){if(e.MathBox&&!this.div)return this.init(t,e)},init(t,e){let i;this.destroy();const{color:n}=this.options,r=`<div class="mathbox-loader mathbox-splash-${n}">\n  <div class="mathbox-logo">\n    <div> <div></div><div></div><div></div> </div>\n    <div> <div></div><div></div><div></div> </div>\n  </div>\n  <div class="mathbox-progress"><div></div></div>\n</div>`;this.div=i=document.createElement("div"),i.innerHTML=r,e.element.appendChild(i);const s=2*Math.random()-1,o=2*Math.random()-1,a=2*Math.random()-1,l=1/Math.sqrt(s*s+o*o+a*a);return this.loader=i.querySelector(".mathbox-loader"),this.bar=i.querySelector(".mathbox-progress > div"),this.gyro=i.querySelectorAll(".mathbox-logo > div"),this.transforms=["rotateZ(22deg) rotateX(24deg) rotateY(30deg)","rotateZ(11deg) rotateX(12deg) rotateY(15deg) scale3d(.6, .6, .6)"],this.random=[s*l,o*l,a*l],this.start=e.Time.now,this.timer=null},progress(t,e){if(!this.div)return;const{current:i,total:n}=t,r=i<n;clearTimeout(this.timer),r?(this.loader.classList.remove("mathbox-exit"),this.loader.style.display="block"):(this.loader.classList.add("mathbox-exit"),this.timer=setTimeout((()=>this.loader.style.display="none"),150));const s=i<n?.1*Math.round(1e3*i/n)+"%":"100%";if(this.bar.style.width=s,this.options.fancy){const t=this.random,i=Math.max(0,Math.min(1,e.Time.now-this.start)),n=function(n,r){return null==r&&(r=0),n.replace(/(-?[0-9.e]+)deg/g,((n,s)=>+s+t[r++]*i*e.Time.step*60+"deg"))};return(()=>{const t=[];for(let e=0;e<this.gyro.length;e++){let i;const r=this.gyro[e];this.transforms[e]=i=n(this.transforms[e]),t.push(r.style.transform=r.style.WebkitTransform=i)}return t})()}},destroy(){return null!=this.div&&this.div.remove(),this.div=null}}),C.registerAlias("empty",["fallback","bind","renderer","size","fill","loop","time"]),C.registerAlias("core",["empty","scene","camera","render","warmup"]),C.registerAlias("VR",["core","cursor","fullscreen","render:vr"]),C.registerPlugin("bind",{install:function(t){const e={three:t,window};t.bind=M.bind(t,e),t.unbind=M.unbind(t),t.bind("install:bind",this),t.bind("uninstall:unbind",this)},uninstall:function(t){t.unbind(this),delete t.bind,delete t.unbind},bind:function(t,e){const i=t.plugin,n=i.listen;n&&n.forEach((function(t){e.bind(t,i)}))},unbind:function(t,e){e.unbind(t.plugin)}}),C.registerPlugin("camera",{defaults:{near:.01,far:1e4,type:"perspective",fov:60,aspect:null,left:-1,right:1,bottom:-1,top:1,klass:null,parameters:null},listen:["resize","this.change"],install:function(t){t.Camera=this.api(),t.camera=null,this.aspect=1,this.change({},t)},uninstall:function(t){delete t.Camera,delete t.camera},change:function(t,e){const i=this.options,n=e.camera;if(!e.camera||t.changes.type||t.changes.klass){const t=i.klass||{perspective:S.PerspectiveCamera,orthographic:S.OrthographicCamera}[i.type]||S.Camera;e.camera=i.parameters?new t(i.parameters):new t}Object.entries(i).forEach(function([t]){Object.prototype.hasOwnProperty.call(e.camera,t)&&(e.camera[t]=i[t])}.bind(this)),this.update(e),n===e.camera||e.trigger({type:"camera",camera:e.camera})},resize:function(t,e){this.aspect=t.viewWidth/Math.max(1,t.viewHeight),this.update(e)},update:function(t){t.camera.aspect=this.options.aspect||this.aspect,t.camera.updateProjectionMatrix()}}),C.registerPlugin("fallback",{defaults:{force:!1,fill:!0,begin:'<div class="threestrap-fallback" style="display: table; width: 100%; height: 100%;box-sizing: border-box; border: 1px dashed rgba(0, 0, 0, .25);"><div style="display: table-cell; padding: 10px; vertical-align: middle; text-align: center;">',end:"</div></div>",message:'<big><strong>This example requires WebGL</strong></big><br>Visit <a target="_blank" href="http://get.webgl.org/">get.webgl.org</a> for more info</a>'},install:function(t){let e,i;try{if(e=document.createElement("canvas"),i=e.getContext("webgl")||e.getContext("experimental-webgl"),!i||this.options.force)throw"WebGL unavailable.";t.fallback=!1}catch(e){const i=this.options.message,n=this.options.begin,r=this.options.end,s=this.options.fill,o=document.createElement("div");for(o.innerHTML=n+i+r,this.children=[];o.childNodes.length>0;)this.children.push(o.firstChild),t.element.appendChild(o.firstChild);return s&&t.install("fill"),this.div=o,t.fallback=!0,!1}},uninstall:function(t){this.children&&(this.children.forEach((function(t){t.parentNode.removeChild(t)})),this.children=null),delete t.fallback}}),C.registerPlugin("fill",{defaults:{block:!0,body:!0,layout:!0},install:function(t){if(this.options.body&&t.element==document.body&&(this.applied=[t.element,document.documentElement].filter((function(t){const e=t.style.height;return"auto"==e||""==e})).map((function(t){return t.style.height="100%",t.style.margin=0,t.style.padding=0,t}))),this.options.block&&t.canvas&&(t.canvas.style.display="block",this.block=!0),this.options.layout&&t.element){"static"==window.getComputedStyle(t.element).position&&(t.element.style.position="relative",this.layout=!0)}},uninstall:function(t){if(this.applied){const t=function(t){return t.style.height="",t.style.margin="",t.style.padding="",t};this.applied.map(t),delete this.applied}this.block&&t.canvas&&(t.canvas.style.display="",delete this.block),this.layout&&t.element&&(t.element.style.position="",delete this.layout)},change:function(t){this.uninstall(t),this.install(t)}}),C.registerPlugin("loop",{defaults:{start:!0,each:1},listen:["ready"],install:function(t){this.running=!1,this.lastRequestId=null,t.Loop=this.api({start:this.start.bind(this),stop:this.stop.bind(this),running:!1,window},t),this.events=["pre","update","render","post"].map((function(t){return{type:t}}))},uninstall:function(t){this.stop(t)},ready:function(t,e){this.options.start&&this.start(e)},start:function(t){if(this.running)return;t.Loop.running=this.running=!0;const e=t.trigger.bind(t),i=function(){this.running&&(this.lastRequestId=t.Loop.window.requestAnimationFrame(i),this.events.map(e))}.bind(this);this.lastRequestId=t.Loop.window.requestAnimationFrame(i),t.trigger({type:"start"})},stop:function(t){this.running&&(t.Loop.running=this.running=!1,t.Loop.window.cancelAnimationFrame(this.lastRequestId),this.lastRequestId=null,t.trigger({type:"stop"}))}}),C.registerPlugin("render",{listen:["render"],render:function(t,e){e.scene&&e.camera&&e.renderer.render(e.scene,e.camera)}}),C.registerPlugin("renderer",{defaults:{klass:S.WebGL1Renderer,parameters:{depth:!0,stencil:!0,preserveDrawingBuffer:!0,antialias:!0}},listen:["resize"],install:function(t){const e=t.renderer=new this.options.klass(this.options.parameters);t.canvas=e.domElement,t.element.appendChild(e.domElement)},uninstall:function(t){t.element.removeChild(t.renderer.domElement),delete t.renderer,delete t.canvas},resize:function(t,e){const i=e.renderer,n=i.domElement;n&&"CANVAS"==n.tagName?i.setSize(t.renderWidth,t.renderHeight,!1):(i.setRenderSize&&i.setRenderSize(t.renderWidth,t.renderHeight),i.setSize(t.viewWidth,t.viewHeight,!1))}}),C.registerPlugin("scene",{install:function(t){t.scene=new S.Scene},uninstall:function(t){delete t.scene}}),C.registerPlugin("size",{defaults:{width:null,height:null,aspect:null,scale:1,maxRenderWidth:1/0,maxRenderHeight:1/0,devicePixelRatio:!0},listen:["window.resize:queue","element.resize:queue","this.change:queue","ready:resize","pre:pre"],install:function(t){t.Size=this.api({renderWidth:0,renderHeight:0,viewWidth:0,viewHeight:0}),this.resized=!1},uninstall:function(t){delete t.Size},queue:function(t,e){this.resized=!0},pre:function(t,e){this.resized&&(this.resized=!1,this.resize(t,e))},resize:function(t,e){const i=this.options,n=e.element,r=e.renderer;let s,o,a,l,h,u,c,p,d=0,f=0;s=a=void 0===i.width||null==i.width?n.offsetWidth||n.innerWidth||0:i.width,o=l=void 0===i.height||null==i.height?n.offsetHeight||n.innerHeight||0:i.height,c=s/o,i.aspect&&(i.aspect>c?(o=Math.round(s/i.aspect),f=Math.floor((l-o)/2)):(s=Math.round(o*i.aspect),d=Math.floor((a-s)/2)),c=s/o),p=1,i.devicePixelRatio&&"undefined"!=typeof window&&(p=window.devicePixelRatio||1),h=Math.round(Math.min(s*p*i.scale,i.maxRenderWidth)),u=Math.round(Math.min(o*p*i.scale,i.maxRenderHeight));h/u>c?h=Math.round(u*c):u=Math.round(h/c),p=u/o;const m=r.domElement.style;m.width=s+"px",m.height=o+"px",m.marginLeft=d+"px",m.marginTop=f+"px",Object.assign(e.Size,{renderWidth:h,renderHeight:u,viewWidth:s,viewHeight:o,aspect:c,pixelRatio:p}),e.trigger({type:"resize",renderWidth:h,renderHeight:u,viewWidth:s,viewHeight:o,aspect:c,pixelRatio:p})}}),C.registerPlugin("time",{defaults:{speed:1,warmup:0,timeout:1},listen:["pre:tick","this.change"],now:function(){return+new Date/1e3},install:function(t){t.Time=this.api({now:this.now(),clock:0,step:1/60,frames:0,time:0,delta:1/60,average:0,fps:0}),this.last=0,this.time=0,this.clock=0,this.wait=this.options.warmup,this.clockStart=0,this.timeStart=0},tick:function(t,e){const i=this.options.speed,n=this.options.timeout,r=e.Time,s=r.now=this.now(),o=this.last;let a=this.time,l=this.clock;if(o){let t=r.delta=s-o;const e=r.average||t;t>n&&(t=0);const h=t*i;a+=t,l+=h,r.frames>0&&(r.average=e+.1*(t-e),r.fps=1/e),r.step=h,r.clock=l-this.clockStart,r.time=a-this.timeStart,r.frames++,this.wait-- >0&&(this.clockStart=l,this.timeStart=a,r.clock=0,r.step=1e-100)}this.last=s,this.clock=l,this.time=a},uninstall:function(t){delete t.Time}}),C.registerPlugin("warmup",{defaults:{delay:2},listen:["ready","post"],ready:function(t,e){e.renderer.domElement.style.visibility="hidden",this.frame=0,this.hidden=!0},post:function(t,e){this.hidden&&this.frame>=this.options.delay&&(e.renderer.domElement.style.visibility="visible",this.hidden=!1),this.frame++}}),C.registerPlugin("controls",{listen:["update","resize","camera","this.change"],defaults:{klass:null,parameters:{}},install:function(t){if(!this.options.klass)throw"Must provide class for `controls.klass`";t.controls=null,this._camera=t.camera||new S.PerspectiveCamera,this.change(null,t)},uninstall:function(t){delete t.controls},change:function(t,e){this.options.klass?(t&&!t.changes.klass||(e.controls=new this.options.klass(this._camera,e.renderer.domElement)),Object.assign(e.controls,this.options.parameters)):e.controls=null},update:function(t,e){const i=e.Time&&e.Time.delta||1/60,n=e.VR&&e.VR.state;e.controls.vr&&e.controls.vr(n),e.controls.update(i)},camera:function(t,e){e.controls.object=this._camera=t.camera},resize:function(t,e){e.controls.handleResize&&e.controls.handleResize()}}),C.registerPlugin("cursor",{listen:["update","this.change","install:change","uninstall:change","element.mousemove","vr"],defaults:{cursor:null,hide:!1,timeout:3},install:function(t){this.timeout=this.options.timeout,this.element=t.element,this.change(null,t)},uninstall:function(t){delete t.controls},change:function(t,e){this.applyCursor(e)},mousemove:function(t,e){this.options.hide&&(this.applyCursor(e),this.timeout=+this.options.timeout||0)},update:function(t,e){const i=e.Time&&e.Time.delta||1/60;this.options.hide&&(this.timeout-=i,this.timeout<0&&this.applyCursor(e,"none"))},vr:function(t,e){this.hide=t.active&&!t.hmd.fake,this.applyCursor(e)},applyCursor:function(t,e){const i=t.controls?"move":"";e=e||this.options.cursor||i,this.hide&&(e="none"),this.cursor!=e&&(this.element.style.cursor=e)}}),C.registerPlugin("fullscreen",{defaults:{key:"f"},listen:["ready","update"],install:function(t){t.Fullscreen=this.api({active:!1,toggle:this.toggle.bind(this)},t)},uninstall:function(t){delete t.Fullscreen},ready:function(t,e){document.body.addEventListener("keypress",function(t){this.options.key&&t.charCode==this.options.key.charCodeAt(0)&&this.toggle(e)}.bind(this));const i=function(){const t=!!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement);e.Fullscreen.active=this.active=t,e.trigger({type:"fullscreen",active:t})}.bind(this);document.addEventListener("fullscreenchange",i,!1),document.addEventListener("webkitfullscreenchange",i,!1),document.addEventListener("mozfullscreenchange",i,!1)},toggle:function(t){const e=t.canvas,i=t.VR&&t.VR.active?{vrDisplay:t.VR.hmd}:{};this.active?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen():e.requestFullScreen?e.requestFullScreen(i):e.msRequestFullScreen?e.msRequestFullscreen(i):e.webkitRequestFullscreen?e.webkitRequestFullscreen(i):e.mozRequestFullScreen&&e.mozRequestFullScreen(i)}});var T=n(3466),O=n.n(T);C.registerPlugin("stats",{listen:["pre","post"],install:function(t){const e=this.stats=new(O()),i=e.domElement.style;i.position="absolute",i.top=i.left=0,t.element.appendChild(e.domElement),t.stats=e},uninstall:function(t){this.stats.domElement.remove(),delete t.stats},pre:function(t,e){this.stats.begin()},post:function(t,e){this.stats.end()}}),C.registerPlugin("ui",{defaults:{theme:"white",style:".threestrap-ui { position: absolute; bottom: 5px; right: 5px; float: left; }.threestrap-ui button { border: 0; background: none;  vertical-align: middle; font-weight: bold; } .threestrap-ui .glyphicon { top: 2px; font-weight: bold; } @media (max-width: 640px) { .threestrap-ui button { font-size: 120% } }.threestrap-white button { color: #fff; text-shadow: 0 1px 1px rgba(0, 0, 0, 1), 0 1px 3px rgba(0, 0, 0, 1); }.threestrap-black button { color: #000; text-shadow: 0 0px 1px rgba(255, 255, 255, 1), 0 0px 2px rgba(255, 255, 255, 1), 0 0px 2px rgba(255, 255, 255, 1) }"},listen:["fullscreen"],markup:function(t,e,i){let n="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css";location.href.match(/^file:\/\//)&&(n="http://"+n);const r=[];return t.Fullscreen&&r.push('<button class="fullscreen" title="Full Screen"><span class="glyphicon glyphicon-fullscreen"></span></button>'),t.VR&&r.push('<button class="vr" title="VR Headset">VR</button>'),'<style type="text/css">@import url("'+n+'"); '+i+'</style><div class="threestrap-ui threestrap-'+e+'">'+r.join("\n")+"</div>"},install:function(t){const e=this.ui=document.createElement("div");e.innerHTML=this.markup(t,this.options.theme,this.options.style),document.body.appendChild(e);const i=this.ui.fullscreen=e.querySelector("button.fullscreen");i&&t.bind([i,"click:goFullscreen"],this);const n=this.ui.vr=e.querySelector("button.vr");n&&t.VR&&(t.VR.set({mode:"2d"}),t.bind([n,"click:goVR"],this))},fullscreen:function(t,e){this.ui.style.display=t.active?"none":"block",t.active||e.VR&&e.VR.set({mode:"2d"})},goFullscreen:function(t,e){e.Fullscreen&&e.Fullscreen.toggle()},goVR:function(t,e){e.VR&&(e.VR.set({mode:"auto"}),e.Fullscreen.toggle())},uninstall:function(t){document.body.removeChild(this.ui)}});class E{constructor(t,e){this.renderer=t,this.right=new S.Vector3,this.cameraLeft=new S.PerspectiveCamera,this.cameraRight=new S.PerspectiveCamera;const i=e.getEyeTranslation("left");this.halfIPD=new S.Vector3(i.x,i.y,i.z).length(),this.fovLeft=e.getRecommendedEyeFieldOfView("left"),this.fovRight=e.getRecommendedEyeFieldOfView("right")}FovToNDCScaleOffset(t){const e=2/(t.leftTan+t.rightTan),i=(t.leftTan-t.rightTan)*e*.5,n=2/(t.upTan+t.downTan);return{scale:[e,n],offset:[i,(t.upTan-t.downTan)*n*.5]}}FovPortToProjection(t,e,i,n,r){n=void 0===n?.01:n,r=void 0===r?1e4:r;const s=(i=void 0===i||i)?-1:1,o=t.elements,a=this.FovToNDCScaleOffset(e);o[0]=a.scale[0],o[1]=0,o[2]=a.offset[0]*s,o[3]=0,o[4]=0,o[5]=a.scale[1],o[6]=-a.offset[1]*s,o[7]=0,o[8]=0,o[9]=0,o[10]=r/(n-r)*-s,o[11]=r*n/(n-r),o[12]=0,o[13]=0,o[14]=s,o[15]=0,t.transpose()}FovToProjection(t,e,i,n,r){const s={upTan:Math.tan(e.upDegrees*Math.PI/180),downTan:Math.tan(e.downDegrees*Math.PI/180),leftTan:Math.tan(e.leftDegrees*Math.PI/180),rightTan:Math.tan(e.rightDegrees*Math.PI/180)};return this.FovPortToProjection(t,s,i,n,r)}render(t,e){this.FovToProjection(this.cameraLeft.projectionMatrix,this.fovLeft,!0,e.near,e.far),this.FovToProjection(this.cameraRight.projectionMatrix,this.fovRight,!0,e.near,e.far),this.right.set(this.halfIPD,0,0),this.right.applyQuaternion(e.quaternion),this.cameraLeft.position.copy(e.position).sub(this.right),this.cameraRight.position.copy(e.position).add(this.right),this.cameraLeft.quaternion.copy(e.quaternion),this.cameraRight.quaternion.copy(e.quaternion);const i=this.renderer.devicePixelRatio||1,n=this.renderer.domElement.width/2/i,r=this.renderer.domElement.height/i;this.renderer.enableScissorTest(!0),this.renderer.setViewport(0,0,n,r),this.renderer.setScissor(0,0,n,r),this.renderer.render(t,this.cameraLeft),this.renderer.setViewport(n,0,n,r),this.renderer.setScissor(n,0,n,r),this.renderer.render(t,this.cameraRight)}}C.registerPlugin("vr",{defaults:{mode:"auto",device:null,fov:80},listen:["window.load","pre","render","resize","this.change"],install:function(t){t.VR=this.api({active:!1,devices:[],hmd:null,sensor:null,renderer:null,state:null},t)},uninstall:function(t){delete t.VR},mocks:function(t,e,i){return[{fake:!0,force:1,deviceId:"emu",deviceName:"Emulated",getEyeTranslation:function(t){return{left:{x:-.03,y:0,z:0},right:{x:.03,y:0,z:0}}[t]},getRecommendedEyeFieldOfView:function(n){const r=t.camera,s=r&&r.aspect||16/9,o=(e||r&&r.fov||i)/2,a=180*Math.atan(Math.tan(o*Math.PI/180)*s/2)/Math.PI;return{left:{rightDegrees:a,leftDegrees:a,downDegrees:o,upDegrees:o},right:{rightDegrees:a,leftDegrees:a,downDegrees:o,upDegrees:o}}[n]}},{force:2,getState:function(){return{}}}]},load:function(t,e){const i=function(t){this.callback(t,e)}.bind(this);navigator.getVRDevices?navigator.getVRDevices().then(i):navigator.mozGetVRDevices?navigator.mozGetVRDevices(i):(console.warn("No native VR support detected."),i(this.mocks(e,this.options.fov,this.defaults.fov),e))},callback:function(t,e){let i,n;const r=window.HMDVRDevice||function(){},s=window.PositionSensorVRDevice||function(){};t=e.VR.devices=t||e.VR.devices;const o=this.options.device;let a;for(let e=0;e<t.length;++e)if(a=t[e],1==a.force||a instanceof r){if(o&&o!=a.deviceId)continue;i=a;break}if(i){let r;for(let e=0;e<t.length;++e)if(r=t[e],2==r.force||r instanceof s&&r.hardwareUnitId==i.hardwareUnitId){n=r;break}this.hookup(i,n,e)}},hookup:function(t,e,i){E||console.log("VRRenderer not found");const n=E||function(){};this.renderer=new n(i.renderer,t),this.hmd=t,this.sensor=e,i.VR.renderer=this.renderer,i.VR.hmd=t,i.VR.sensor=e,console.log("VRRenderer",t.deviceName)},change:function(t,e){t.changes.device&&this.callback(null,e),this.pre(t,e)},pre:function(t,e){const i=this.active,n=this.active=this.renderer&&"2d"!=this.options.mode;if(e.VR.active=n,n&&this.sensor){const t=this.sensor.getState();e.VR.state=t}else e.VR.state=null;i!=this.active&&e.trigger({type:"vr",active:n,hmd:this.hmd,sensor:this.sensor})},resize:function(t,e){this.active&&this.renderer.initialize()},render:function(t,e){if(e.scene&&e.camera){const t=this.active?this.renderer:e.renderer;if(this.last!=t&&t==e.renderer){const e=t.getPixelRatio(),i=t.domElement.width/e,n=t.domElement.height/e;t.setScissorTest(!1),t.setViewport(0,0,i,n)}this.last=t,t.render(e.scene,e.camera)}}});class P{constructor(t,e){this.context=e,this.traits=t.Traits,this.types=t.Types,this.pending=[],this.bound=[],this.last=null}make(t){return{enum:"function"==typeof t.enum?t.enum():void 0,type:"function"==typeof t.uniform?t.uniform():void 0,value:t.make()}}apply(t,e){return new j(t,e,this)}bind(t){return this.bound.push(t)}unbind(t){return this.bound=Array.from(this.bound).filter((e=>e!==t))}queue(t,e,i,n){return this.lastObject=e,this.lastKey=i,this.lastValue=n,this.pending.push(t)}invoke(t){return t(this.context.time.clock,this.context.time.step)}compute(){if(this.bound.length)for(const t of Array.from(this.bound))this.invoke(t)}digest(){let t;if(!this.pending.length)return!1;[t,this.pending]=Array.from([this.pending,[]]);for(const e of Array.from(t))e();return!0}getTrait(t){return this.traits[t]}getLastTrigger(){return`${this.lastObject.toString()} - ${this.lastKey}=\`${this.lastValue}\``}}const D=function(t){const e={};for(const i in t){const n=t[i];e[i]=n}return e};class j{constructor(t,e,i){let n,r,s,o,a,l,h,{props:u}=e;const{traits:c,finals:p,freeform:d}=e,f=this;null!=t.props&&null!=t.expr&&null!=t.orig&&null!=t.computed&&null!=t.attributes&&(l=D(t.props),o=D(t.expr),a=t.orig(),s=t.computed(),null!=t.attributes&&t.attributes.dispose());const m={},g={},v={},y=t=>null!=v[t]?v[t]:t,b=function(e,i){if(v[i])throw new Error(`${t.toString()} - Duplicate property \`${i}\``);return v[i]=e},x=t=>{return null!=(null!=f[t]?f[t].value:void 0)?null!=f[t]?f[t].value:void 0:(e=f[y(t)],i=t=>t.value,null!=e?i(e):void 0);var e,i},w=function(e,i,n,r){let s;if(e=y(e),null==(s=f[e])){if(!d)throw new Error(`${t.toString()} - Setting unknown property \`${e}={${i}}\``);s=f[e]={short:e,type:null,last:null,value:null},j[e]=t=>t}if(!n){if(M[e])throw new Error(`${t.toString()} - Can't set bound property \`${e}={${i}}\``);if(A[e])throw new Error(`${t.toString()} - Can't set computed property \`${e}={${i}}\``);if(C[e])throw new Error(`${t.toString()} - Can't set final property \`${e}={${i}}\``)}let o=!0;const a=I(e,i,s.last,(function(){return o=!1,null}));if(o){[s.value,s.last]=Array.from([a,s.value]);const{short:t}=s;m[t]=a,n||(g[t]=i),r||F(e,s.value,s.last)||B(e,i)}return o},_=function(t,e,i){return t=y(t),w(t,e,!0,i),C[t]=!0},k={},z={},S={},M={},A={},C={},T=function(e,n,r){if(null==r&&(r=!1),e=y(e),"function"!=typeof n)throw new Error(`${t.toString()} - Expression \`${e}=>{${k}}\` is not a function`);if(M[e])throw new Error(`${t.toString()} - Property \`${e}=>{${k}}\` is already bound`);if(A[e])throw new Error(`${t.toString()} - Property \`${e}\` is computed`);if(C[e])throw new Error(`${t.toString()} - Property \`${e}\` is final`);(r?A:M)[e]=n;const s=null!=f[e]?f[e].short:e;return r||(k[s]=n),S[e]=n,n=n.bind(t),z[e]=function(i,r){let s;return(s=null!=t.clock?t.clock.getTime():void 0)&&(i=s.clock,r=s.step),t.set(e,n(i,r),!0)},i.bind(z[e])},O=function(t,e){null==e&&(e=!1),t=y(t);const n=e?A:M;if(n[t])return i.unbind(z[t]),delete z[t],delete n[t],null!=f[t]&&(t=f[t].short),delete k[t]},E=function(t,e){let i;return t=y(t),null!=(i="function"==typeof S[t]?S[t](e,0):void 0)?i:f[t].value};t.expr=k,t.props=m,t.evaluate=function(t,e){if(null!=t)return E(t,e);{const i={};for(t in u)i[t]=E(t,e);return i}},t.get=function(t){return null!=t?x(t):m},t.set=function(t,e,i,n){if("string"==typeof t)w(t,e,i,n);else{n=i,i=e;const r=t;for(t in r)e=r[t],w(t,e,i,n)}},t.bind=function(t,e,i){if("string"==typeof t)T(t,e,i);else{i=e;const n=t;for(t in n)e=n[t],T(t,e,i)}},t.unbind=function(t,e){if("string"==typeof t)O(t,e);else{e=k;const i=t;for(t in i)O(t,e)}},t.attribute=function(t){return null!=t?f[y(t)]:f},t.orig=function(t){return null!=t?g[y(t)]:D(g)},t.computed=function(t){return null!=t?A[y(t)]:D(A)};const P={},j={},q={},F=(t,e,i)=>q[t](e,i),I=(t,e,i,n)=>j[t](e,i,n);t.validate=function(e,i){let n;e=y(e);const r=P[e];return null!=r&&(n=r()),I(e,i,n,(function(){throw new Error(`${t.toString()} - Invalid value \`${e}={${i}}\``)}))};let L=!1,N={},R={},U={},V={};const B=function(e,n){L||(L=!0,i.queue(H,t,e,n));const r=(t=>t.split(".")[0])(e);return N[e]=!0,R[r]=!0},$={type:"change",changed:null,touched:null},H=function(){let e;for(e in $.changed=N,$.touched=R,N=U,R=V,({changed:U}=$),({touched:V}=$),L=!1,N)N[e]=!1;for(e in R)R[e]=!1;return $.type="change",t.trigger($),(()=>{const e=[];for(const i in $.touched)$.type=`change:${i}`,e.push(t.trigger($));return e})()},W=function(t){const e=t.split(/\./g),i=e.pop();return e.pop(),e.unshift(i),e.reduce(((t,e)=>t+e.charAt(0).toUpperCase()+e.substring(1)))},X=(t,e)=>(()=>{const i=[];for(let n in e){let r;const s=e[n];n=[t,n].join(".");const o=W(n);f[n]={T:s,ns:t,short:o,enum:"function"==typeof s.enum?s.enum():void 0,type:"function"==typeof s.uniform?s.uniform():void 0,last:s.make(),value:r=s.make()},b(n,o),m[o]=r,P[n]=s.make,j[n]=null!=s.validate?s.validate:t=>t,i.push(q[n]=null!=s.equals?s.equals:(t,e)=>t===e)}return i})(),G=[];for(let t of Array.from(c)){[t,r]=Array.from(t.split(":"));const e=r?[r,t].join("."):t;h=i.getTrait(t),G.push(t),null!=h&&X(e,h)}if(null!=u)for(r in u)h=u[r],X(r,h);const Y=G.filter(((t,e)=>G.indexOf(t)===e));if(t.traits=Y,null!=l&&t.set(l,!0,!0),null!=p)for(n in p){const t=p[n];_(n,t,!0)}null!=a&&t.set(a,!1,!0),null!=s&&t.bind(s,!0),null!=o&&t.bind(o,!1),this.dispose=function(){for(n in A)O(n,!0);for(n in M)O(n,!1);return u={},delete t.attributes,delete t.get,delete t.set}}}const q=t=>((t,e)=>Math.abs(t/e-Math.round(t/e))<1e-4)(t,1),F=function(t,e,i,n){const r=Math.round(t/e);return 1===r?`${i}`:-1===r?`-${i}`:"1"===i?`${r}`:n?`${r}${i}`:`${r}*${i}`},I=function(t,e,i,n){let r=Math.round(t*e);return 1===Math.abs(r)?(r=r<0?"-":"",r+=i):"1"!==i&&(r+=n?`${i}`:`*${i}`),`${r}/${e}`},L=[{1:1},{1:1,τ:2*Math.PI},{1:1,π:Math.PI},{1:1,τ:2*Math.PI,π:Math.PI},{1:1,e:Math.E},{1:1,τ:2*Math.PI,e:Math.E},{1:1,π:Math.PI,e:Math.E},{1:1,τ:2*Math.PI,π:Math.PI,e:Math.E}],N=[[420,[2,3,5,7]],[88200,[2,3,5,7]],[60060,[2,3,5,7,11,13]],[861764,[2,17,19,23,29]],[65536,[2]],[1e6,[2,5]]],R=function(t){let e,i,n,r,s;t&&({cache:e,compact:i,tau:s,pi:r,e:n}=t),i=+!(null!=i&&!i),s=+!(null!=s&&!s),r=+!(null!=r&&!r),n=+!(null!=n&&!n),e=+!(null!=e&&!e);const o=s+2*r+4*n,a=e?{}:null;return function(t){if(null!=a){let e;if(null!=(e=a[t]))return e;if(t===Math.round(t))return a[t]=`${t}`}let e=`${t}`,n=e.length+e.indexOf(".")+2;const r=function(t){const i=t.length;if(i<=n)return e=`${t}`,n=i};for(const e in L[o]){const n=L[o][e];if(q(t/n))r(`${F(t/n,1,e,i)}`);else for(let[s,o]of Array.from(N)){let a=t/n*s;if(q(a)){for(const t of Array.from(o)){let e,i;for(;q(i=a/t)&&q(e=s/t);)a=i,s=e}r(`${I(t/n,s,e,i)}`);break}}}return`${t}`.length>5&&r(`${t.toPrecision(5)}`),null!=a&&(a[t]=e),e}},U=function(t,e){return null==e&&(e="info"),t=V(t),console[e].apply(console,t)},V=function(t){const e="color:rgb(128,0,128)",i="color:rgb(144,64,0)",n="color:rgb(0,70,156)";let r=!1,s=0;const o=[];return[t=t.replace(/(\\[<={}> "'])|(=>|[<={}> "'])/g,(function(t,a,l){return(null!=a?a.length:void 0)?a:r&&!['"',"'"].includes(l)||s&&!['"',"'","{","}"].includes(l)?l:(()=>{switch(l){case"<":return o.push(e),"%c<";case">":return o.push(e),o.push("color:inherit"),"%c>%c";case" ":return o.push(i)," %c";case"=":case"=>":return o.push(e),`%c${l}`;case'"':case"'":return r=!r,r?(o.push(s?i:"color:rgb(0,0,192)"),`${l}%c`):(o.push(s?n:e),`%c${l}`);case"{":return 0==s++?(o.push(n),`%c${l}`):l;case"}":return 0==--s?(o.push(e),`${l}%c`):l;default:return l}})()}))].concat(o)},B=function(){const t=R({compact:!1});return function(e,i,n){const r=function(t){return t===""+ +t||t.match(/^[A-Za-z_][A-Za-z0-9]*$/)?t:JSON.stringify(t)},s=function(e){if(e instanceof Array)return`[${e.map(s).join(", ")}]`;switch(typeof e){case"string":return e.match("\n")?`"\n${e}"\n`:`"${e}"`;case"function":return(e=`${e}`).match("\n"),(e=e.replace(/^function (\([^)]*\))/,"$1 =>")).replace(/^(\([^)]*\)) =>\s*{\s*return\s*([^}]+)\s*;\s*}/,"$1 => $2");case"number":return t(e);default:return null!=e&&e!==!!e?null!=e._up?s(e.map((t=>t))):e.toMarkup?e.toString():"{"+(()=>{const t=[];for(const i in e){const n=e[i];Object.prototype.hasOwnProperty.call(e,i)&&t.push(`${r(i)}: ${s(n)}`)}return t})().join(", ")+"}":`${JSON.stringify(e)}`}};return[e,n,function(t){return t.match('\n*"')?t:`{${t}}`}(s(i))].join("")}}(),$=function(t){return(t=(t=t.replace(/&/g,"&amp;")).replace(/</g,"&lt;")).replace(/"/g,"&quot;")},H=function(t){const e=[].slice.call(arguments);e.shift();let i="<span>";t=$(t);for(const i of Array.from(e))t=t.replace(/%([a-z])/,(function(t,i){const n=e.shift();return"c"===i?`</span><span style="${$(n)}">`:$(n)}));return i+=t,i+"</span>"},W={prop:(t,e)=>B(t,e,"="),bind:(t,e)=>B(t,e,"=>")};let X=0;class G{constructor(t,e,i,n,r,s){this.type=t,this._id=(++X).toString(),this.configure(r,s),this.parent=this.root=this.path=this.index=null,this.set(e,!0,!0),this.set(i,!1,!0),this.bind(n,!1)}configure(t,e){let{traits:i,props:n,finals:r,freeform:s}=t;return null==i&&(i=null!=(null!=this._config?this._config.traits:void 0)?null!=this._config?this._config.traits:void 0:[]),null==n&&(n=null!=(null!=this._config?this._config.props:void 0)?null!=this._config?this._config.props:void 0:{}),null==r&&(r=null!=(null!=this._config?this._config.finals:void 0)?null!=this._config?this._config.finals:void 0:{}),null==s&&(s=null!=(null!=this._config?this._config.freeform:void 0)&&(null!=this._config?this._config.freeform:void 0)),this._config={traits:i,props:n,finals:r,freeform:s},this.attributes=e.apply(this,this._config)}dispose(){return this.attributes.dispose(),this.attributes=null}_added(t){this.parent=t,this.root=t.root;const e={type:"add",node:this,parent:this.parent};return this.root&&this.root.trigger(e),e.type="added",this.trigger(e)}_removed(){const t={type:"remove",node:this};return this.root&&this.root.trigger(t),t.type="removed",this.trigger(t),this.root=this.parent=null}_index(t,e){let i;if(null==e&&({parent:e}=this),this.index=t,this.path=i=null!=t?(null!=(null!=e?e.path:void 0)?null!=e?e.path:void 0:[]).concat([t]):null,this.order=null!=i?this._encode(i):1/0,null!=this.root)return this.trigger({type:"reindex"})}_encode(t){const e=t=>3/(t+3),i=t=>r+(n-r)*t;let n=1+1/3,r=0;for(const s of Array.from(t)){const t=e(s+1),o=e(s+2);[n,r]=Array.from([i(t),i(o)])}return n}toString(){const t=null!=this.id?this.id:this._id,e=null!=this.type?this.type:"node";let i=e;if(i+=`#${t}`,(null!=this.classes?this.classes.length:void 0)&&(i+=`.${this.classes.join(".")}`),null!=this.children){let t;return(t=this.children.length)?`<${i}>…(${t})…</${e}>`:`<${i}></${e}>`}return`<${i} />`}toMarkup(t=null,e){let i,n;if(null==e&&(e=""),t&&"function"!=typeof t){let e;t=null!=(e=null!=this.root?this.root.model._matcher(t):void 0)?e:()=>!0}const r=null!=this.type?this.type:"node";let{expr:s}=this;const o={id:this._id},a="function"==typeof this.orig?this.orig():void 0;for(i in a)n=a[i],o[i]=n;const l=(()=>{const t=[];for(i in o)n=o[i],this.expr[i]||t.push(W.prop(i,n));return t})();s=(()=>{const t=[];for(i in s)n=s[i],t.push(W.bind(i,n));return t})();let h=[""];l.length&&(h=h.concat(l)),s.length&&(h=h.concat(s)),h=h.join(" ");let u=e;const c=()=>(null!=this.children?this.children.length:void 0)?this.children.map((e=>e.toMarkup(t,u))).filter((t=>null!=t&&t.length)).join("\n"):"";if(t&&!t(this))return c();if(null!=this.children){const t=`<${r}${h}>`,i=`</${r}>`;u=e+"  ";let n=c();return n.length&&(n="\n"+n+"\n"+e),null==n&&(n=""),e+t+n+i}return`${e}<${r}${h} />`}print(t,e){return U(this.toMarkup(t),e)}}M.apply(G.prototype);class Y extends G{constructor(t,e,i,n,r,s){super(t,e,i,n,r,s),this.children=[],this.on("reindex",(t=>Array.from(this.children).map((e=>e.trigger(t)))))}add(t){return null!=t.parent&&t.parent.remove(t),t._index(this.children.length,this),this.children.push(t),t._added(this)}remove(t){(null!=t.children?t.children.length:void 0)&&t.empty();const e=this.children.indexOf(t);if(-1!==e){this.children.splice(e,1),t._index(null),t._removed(this);for(let i=0;i<this.children.length;i++)t=this.children[i],i>=e&&t._index(i)}}empty(){const t=this.children.slice().reverse();for(const e of Array.from(t))this.remove(e)}}class Z{constructor(t){null==t&&(t=10),this.limit=t}iterate(t){const{step:e,last:i}=t;let{limit:n}=this;for(;e();)if(!--n)throw console.warn("Last iteration","function"==typeof i?i():void 0),new Error("Exceeded iteration limit.");return null}}var Q=n(5366);function J(t){return!0}function K(t){return t.children||[]}function tt(t){return t.parent}const et={isTag:J,existsOne:(t,e)=>e.some((e=>t(e)||et.existsOne(t,K(e)))),getSiblings(t){const e=tt(t);return e?K(e):[t]},getChildren:K,getParent:tt,getAttributeValue:(t,e)=>"class"===e?t.props.classes.join(" "):"id"===e?t.id:"",hasAttrib:(t,e)=>"id"===e?!!t.id:"class"===e?t.props.classes.length>0:!!t.traits.hash&&Object.prototype.hasOwnProperty.call(t.traits.hash,e),removeSubsets:function(t){const e=new Set(t);return e.forEach((t=>{let i=t.parent;for(;i;){if(e.has(i))return void e.delete(t);i=i.parent}})),Array.from(e)},getName:t=>t.type??"",findOne:function t(e,i){for(const n of i){if(e(n))return n;{const i=t(e,K(n));if(i)return i}}return null},findAll:function t(e,i){const n=[];for(const r of i)e(r)&&n.push(r),n.push(...t(e,K(r)));return n},getText:function(t){return""}},it=et,nt=(t,e)=>{try{Q.compile(t)}catch(t){return[]}const i=Array.isArray(e);if(i&&0===e.length)return[];const n=(t=>{let e=t;for(;null!==it.getParent(e);)e=it.getParent(e);return e})(i?e[0]:e),r=Q.selectAll(t,n,{adapter:it});return e?((t,e)=>{const i=[],n=Array.isArray(e)?e:[e],r=new Set(n);for(const e of Array.from(t)){let t=e;for(;null!=t;){if(r.has(t)){i.push(e);break}t=it.getParent(t)}}return i})(r,e):r},rt=/^<([0-9]+|<*)$/;class st{constructor(t){this.root=t,this.root.model=this,this.root.root=this.root,this.ids={},this.classes={},this.traits={},this.types={},this.nodes=[],this.watchers=[],this.fire=!1,this.lastNode=null,this.event={type:"update"};this.root.on("add",(t=>e(t.node))),this.root.on("remove",(t=>i(t.node)));const e=t=>(m(t),v(t),b(t),t.on("change:node",o),o(null,t,!0),s(t)),i=t=>(g(t),y(t),x(t),p(t.id,t),f(t.classes,t),t.off("change:node",o),s(t)),n=t=>{for(const e of Array.from(this.watchers))e.match=e.matcher(t);return null},r=t=>{for(const e of Array.from(this.watchers)){const i=e.fire||(e.fire=e.match!==e.matcher(t));i&&(this.lastNode=t),this.fire||(this.fire=i)}return null},s=t=>{for(const e of Array.from(this.watchers)){const i=e.fire||(e.fire=e.matcher(t));i&&(this.lastNode=t),this.fire||(this.fire=i)}return null};this.digest=()=>{if(!this.fire)return!1;for(const t of Array.from(this.watchers.slice()))t.fire&&(t.fire=!1,t.handler());return this.fire=!1,!0};const o=(t,e,i)=>{const s=i||t.changed["node.id"],o=i||t.changed["node.classes"];let a=!1;if(s){const t=e.get("node.id");t!==e.id&&(i||n(e),a=!0,null!=e.id&&p(e.id,e),c(t,e))}if(o){let t,r=null!=(t=e.get("node.classes"))?t:[];const s=r.join(",");s!==(null!=e.classes?e.classes.klass:void 0)&&(r=r.slice(),i||a||n(e),a=!0,null!=e.classes&&f(e.classes,e),d(r,e),e.classes=r,e.classes.klass=s)}return!i&&a&&r(e),null},a=function(t,e,i){if(null!=e){for(const n of Array.from(e)){const e=null!=t[n]?t[n]:[];e.push(i),t[n]=e}return null}},l=function(t,e,i){if(null!=e){for(const n of Array.from(e)){const e=t[n],r=e.indexOf(i);r>=0&&e.splice(r,1),0===e.length&&delete t[n]}return null}},h=function(t){if(!(t.length>0))return;const e=t.hash={};return Array.from(t).map((t=>e[t]=!0))},u=t=>delete t.hash,c=(t,e)=>{if(this.ids[t])throw new Error(`Duplicate node id \`${t}\``);return null!=t&&(this.ids[t]=[e]),e.id=null!=t?t:e._id},p=(t,e)=>(null!=t&&delete this.ids[t],e.id=e._id),d=(t,e)=>{if(a(this.classes,t,e),null!=t)return h(t)},f=(t,e)=>{if(l(this.classes,t,e),null!=t)return u(t)},m=t=>this.nodes.push(t),g=t=>this.nodes.splice(this.nodes.indexOf(t),1),v=t=>a(this.types,[t.type],t),y=t=>l(this.types,[t.type],t),b=t=>(a(this.traits,t.traits,t),h(t.traits)),x=t=>(l(this.traits,t.traits,t),u(t.traits));e(this.root),this.root.trigger({type:"added"})}select(t,e){return nt(t,e||this.getRoot())}watch(t,e){let i;return e.unwatch=()=>this.unwatch(e),e.watcher=i={selector:t,handler:e,matcher:this._matcher(t),match:!1,fire:!1},this.watchers.push(i),this.select(t)}unwatch(t){const{watcher:e}=t;if(null!=e)return this.watchers.splice(this.watchers.indexOf(e),1),delete t.unwatch,delete t.watcher}_matcher(t){if(rt.test(t))throw new Error("Auto-link matcher unsupported");return(t=>{try{return Q.compile(t,{adapter:it})}catch(t){return()=>!1}})(t)}getRoot(){return this.root}getLastTrigger(){return this.lastNode.toString()}}class ot{constructor(t,e){this.classes=t,this.canvas=e;const i=document.createElement("div");i.classList.add("mathbox-overlays"),this.div=i}inject(){const t=this.canvas.parentNode;if(!t)throw new Error("Canvas not inserted into document.");return t.insertBefore(this.div,this.canvas)}unject(){return this.div.parentNode.removeChild(this.div)}getTypes(){return Object.keys(this.classes)}make(t,e){return new this.classes[t](this.div,e)}}const at=[];let lt=0;const ht={},ut=()=>({id:lt++,type:null,props:null,children:null,rendered:null,instance:null}),ct=function(t){return t*=2,function(t,e,i){const n=[],r=t<e,s=i?r?e+1:e-1:e;for(let e=t;r?e<s:e>s;r?e++:e--)n.push(e);return n}(0,t=Math.max(0,at.length-t),!1).map((t=>at.push(ut())))},pt=function(t,e,i){const n=at.length?at.pop():ut();return n.type=null!=t?t:"div",n.props=null!=e?e:null,n.children=null!=i?i:null,n},dt=function(t){if(!t.type)return;const{children:e}=t;if(t.type=t.props=t.children=t.instance=null,at.push(t),null!=e)for(const t of Array.from(e))dt(t)},ft=function(t,e,i,n,r){if(null!=t){if(null==e)return mt(t,n,r);{let s;if(t instanceof Node){if(s=t===e,s)return}else s=typeof t==typeof e&&null!==e&&null!==t&&t.type===e.type;if(s){let s,o,a;t.instance=e.instance;const l=(null!=t.type?t.type.isComponentClass:void 0)?t.type:ht[t.type],h=null!=e?e.props:void 0,u=t.props,c=null!=(null!=e?e.children:void 0)?null!=e?e.children:void 0:null,p=t.children;if(null!=u&&(u.children=p),null!=l){let l=i._COMPONENT_DIRTY;if(null!=h!=(null!=u)&&(l=!0),c!==p&&(l=!0),null!=h&&null!=u){if(!l)for(s in h)Object.prototype.hasOwnProperty.call(u,s)||(l=!0);if(!l)for(s in u)a=u[s],(o=h[s])!==a&&(l=!0)}if(l){let s;const o=e.instance;null==t.props&&(t.props={});for(const e in o.defaultProps){const i=o.defaultProps[e];null==t.props[e]&&(t.props[e]=i)}t.props.children=t.children,"function"==typeof o.willReceiveProps&&o.willReceiveProps(t.props);const a=i._COMPONENT_FORCE||null==(s="function"==typeof o.shouldUpdate?o.shouldUpdate(t.props):void 0)||s;if(a){const e=o.getNextState();"function"==typeof o.willUpdate&&o.willUpdate(t.props,e)}const l=o.props,h=o.applyNextState();o.props=t.props,o.children=t.children,a&&(t=t.rendered="function"==typeof o.render?o.render(pt,t.props,t.children):void 0,ft(t,e.rendered,i,n,r),"function"==typeof o.didUpdate&&o.didUpdate(l,h))}return}if(null!=h)for(s in h)Object.prototype.hasOwnProperty.call(u,s)||xt(i,s,h[s]);if(null!=u)for(s in u)a=u[s],(o=h[s])!==a&&"children"!==s&&bt(i,s,a,o);if(null!=p)if(["string","number"].includes(typeof p))p!==c&&(i.textContent=p);else if(null!=p.type)ft(p,c,i.childNodes[0],i,0);else{let t,e;const{childNodes:n}=i;if(null!=c)for(e=0;e<p.length;e++)t=p[e],ft(t,c[e],n[e],i,e);else for(e=0;e<p.length;e++)t=p[e],ft(t,null,n[e],i,e)}else null!=c&&(gt(null,i),i.innerHTML="");return}return gt(e.instance,i),i.remove(),mt(t,n,r)}}if(null!=e)return gt(e.instance,i),e.node.remove()},mt=function(t,e,i){let n;null==i&&(i=0);const r=(null!=t.type?t.type.isComponentClass:void 0)?t.type:ht[t.type];if(t instanceof Node)n=t;else{if(null!=r){let r;const s=(null!=t.type?t.type.isComponentClass:void 0)?t.type:ht[t.type];if(!s)return t=t.rendered=pt("noscript"),n=mt(t,e,i),n;t.instance=r=new s(e),null==t.props&&(t.props={});for(const e in r.defaultProps){const i=r.defaultProps[e];null==t.props[e]&&(t.props[e]=i)}return t.props.children=t.children,r.props=t.props,r.children=t.children,r.setState("function"==typeof r.getInitialState?r.getInitialState():void 0),"function"==typeof r.willMount&&r.willMount(),t=t.rendered="function"==typeof r.render?r.render(pt,t.props,t.children):void 0,n=mt(t,e,i),"function"==typeof r.didMount&&r.didMount(t),n._COMPONENT=r,n}if(["string","number"].includes(typeof t))n=document.createTextNode(t);else{n=document.createElement(t.type);for(const e in t.props){const i=t.props[e];bt(n,e,i)}}const{children:s}=t;if(null!=s)if(["string","number"].includes(typeof s))n.textContent=s;else if(null!=s.type)mt(s,n,0);else for(let t=0;t<s.length;t++){const e=s[t];mt(e,n,t)}}return e.insertBefore(n,e.childNodes[i]),n},gt=function(t,e){if(t){"function"==typeof t.willUnmount&&t.willUnmount();for(const e in t)delete t[e]}return(()=>{const t=[];for(const i of Array.from(e.childNodes))gt(i._COMPONENT,i),t.push(delete i._COMPONENT);return t})()},vt=function(t){if("undefined"==typeof document)return!0;if(null!=document.documentElement.style[t])return t;t=t[0].toUpperCase()+t.slice(1);const e=["webkit","moz","ms","o"];for(const i of Array.from(e))if(null!=document.documentElement.style[i+t])return i+t},yt={};for(const t of["transform"])yt[t]=vt(t);const bt=function(t,e,i,n){if("style"!==e)if(null==t[e])t instanceof Node&&t.setAttribute(e,i);else try{t[e]=i}catch(t){console.log("failed setting "+e)}else for(const e in i){const r=i[e];(null!=n?n[e]:void 0)!==r&&(t.style[null!=yt[e]?yt[e]:e]=r)}},xt=function(t,e,i){if("style"!==e)null!=t[e]&&(t[e]=void 0),t instanceof Node&&t.removeAttribute(e);else for(const e in i)t.style[null!=yt[e]?yt[e]:e]=""},wt=function(t){let e;const i={willMount:"componentWillMount",didMount:"componentDidMount",willReceiveProps:"componentWillReceiveProps",shouldUpdate:"shouldComponentUpdate",willUpdate:"componentWillUpdate",didUpdate:"componentDidUpdate",willUnmount:"componentWillUnmount"};for(const e in i){const n=i[e];null==t[e]&&(t[e]=t[n])}class n{constructor(e,i,n=null,r=null){let s,o;null==i&&(i={}),this.props=i,this.state=n,this.children=r;const a=function(t,e){return"function"==typeof t?t.bind(e):t};for(s in t)o=t[s],this[s]=a(o,this);let l=null;this.setState=function(t){for(s in null==l&&(l=t?null!=l?l:{}:null),t)o=t[s],l[s]=o;e._COMPONENT_DIRTY=!0},this.forceUpdate=function(){e._COMPONENT_FORCE=e._COMPONENT_DIRTY=!0;let t=e;return(()=>{const e=[];for(;t=t.parentNode;)t._COMPONENT?e.push(t._COMPONENT_FORCE=!0):e.push(void 0);return e})()},this.getNextState=()=>l,this.applyNextState=function(){e._COMPONENT_FORCE=e._COMPONENT_DIRTY=!1;const t=this.state;return[l,this.state]=Array.from([null,l]),t}}}return n.isComponentClass=!0,n.prototype.defaultProps=null!=(e="function"==typeof t.getDefaultProps?t.getDefaultProps():void 0)?e:{},n};class _t{constructor(t,e){this.element=t,"function"==typeof this.init&&this.init(e)}dispose(){}}class kt extends _t{static initClass(){this.prototype.el=pt,this.prototype.hint=ct,this.prototype.apply=ft,this.prototype.recycle=dt}init(t){return this.last=null}dispose(){return this.unmount(),super.dispose()}mount(){const t=document.createElement("div");return t.classList.add("mathbox-overlay"),this.element.appendChild(t),this.overlay=t}unmount(t){return this.overlay&&this.overlay.parentNode&&this.element.removeChild(this.overlay),this.overlay=null}render(t){this.overlay||this.mount(),["string","number"].includes(typeof t)&&(t=this.el("div",null,t)),t instanceof Array&&(t=this.el("div",null,t)),null==t&&(t=this.el("div"));const e="div"===t.type;let{last:i}=this;const{overlay:n}=this,r=e?n:n.childNodes[0],s=e?n.parentNode:n;!i&&r&&(i=this.el("div")),this.apply(t,i,r,s,0),this.last=t,null!=i&&this.recycle(i)}}kt.initClass();const zt={dom:kt};class St{static initClass(){this.Node=G,this.Group=Y,this.model=this.Node,this.defaults=null,this.traits=null,this.props=null,this.finals=null,this.freeform=!1}constructor(t,e,i){this.node=t,this._context=e,this._renderables=this._context.renderables,this._attributes=this._context.attributes,this._shaders=this._context.shaders,this._overlays=this._context.overlays,this._animator=this._context.animator,this._types=this._attributes.types,this.node.controller=this,this.node.on("added",(t=>this._added())),this.node.on("removed",(t=>this._removed())),this.node.on("change",(t=>{if(this._root)return this.change(t.changed,t.touched)})),this.reconfigure(),this._get=this.node.get.bind(this.node),this._helpers=i(this,this.node.traits),this._handlers={inherit:{},listen:[],watch:[],compute:[]},this._root=this._parent=null,this.init()}is(t){return this.traits.hash[t]}init(){}make(){}made(){}unmake(t){}unmade(){}change(t,e,i){}refresh(){return this.change({},{},!0)}rebuild(){if(this._root)return this._removed(!0),this._added()}reconfigure(t){return null!=t&&this.node.configure(t,this._attributes),this.traits=this.node.traits,this.props=this.node.props}_added(){let t,e;this._parent=null!=this.node.parent?this.node.parent.controller:void 0,this._root=null!=this.node.root?this.node.root.controller:void 0,this.node.clock=null!=(e=this._inherit("clock"))?e:this._root;try{try{return this.make(),this.refresh(),this.made()}catch(e){throw t=e,this.node.print("warn"),console.error(t),t}}catch(e){t=e;try{return this._removed()}catch(t){}}}_removed(t){return null==t&&(t=!1),this.unmake(t),this._unlisten(),this._unattach(),this._uncompute(),this._root=null,this._parent=null,this.unmade(t)}_listen(t,e,i,n){if(null==n&&(n=this),t instanceof Array)for(const r of Array.from(t))return this.__listen(r,e,i,n);return this.__listen(t,e,i,n)}__listen(t,e,i,n){if(null==n&&(n=this),"string"==typeof t&&(t=this._inherit(t)),null!=t){const r=i.bind(n);r.node=this.node,t.on(e,r),this._handlers.listen.push([t,e,r])}return t}_unlisten(){if(this._handlers.listen.length){for(const[t,e,i]of Array.from(this._handlers.listen))t.off(e,i);return this._handlers.listen=[]}}_inherit(t){const e=this._handlers.inherit[t];return void 0!==e?e:this._handlers.inherit[t]=null!=this._parent?this._parent._find(null!=t?t:null):void 0}_find(t){return this.is(t)?this:null!=this._parent?this._parent._find(t):void 0}_uninherit(){return this._handlers.inherit={}}_attach(t,e,i,n,r,s,o){null==n&&(n=this),null==r&&(r=this),null==s&&(s=!1),null==o&&(o=!1);const a=function(t){if(null!=t&&Array.from(t.traits).includes(e))return t},l=t=>null!=t?t.controller:void 0,h=function(t){if(null==t)return t;let e=[];for(const i of Array.from(t))i instanceof Array?e=e.concat(i):e.push(i);return e},u=t=>{let l,c;if("object"==typeof t){if(l=t,null!=l?l._up:void 0)return t=o?l._targets:[l[0]];if(l instanceof Array)return t=o?h(l.map(u)):u(l[0]);if(l instanceof G)return[l]}else if("string"==typeof t&&"<"===t[0]){let e,i=0;(e=t.match(/^<([0-9])+$/))&&(i=+e[1]-1),t.match(/^<+$/)&&(i=+t.length-1),c=[];let n=r.node;for(;n;){const{parent:t}=n;if(!t)break;if(n=t.children[n.index-1],n||c.length||(n=t),l=null,a(n)&&(l=n),null!=l&&i--<=0&&c.push(l),!o&&c.length)return c}if(o&&c.length)return c}else if("string"==typeof t){const e=i.bind(n);this._handlers.watch.push(e);const r=this._root.watch(t,e);if(o){if(c=r.filter(a),c.length)return c}else if(a(r[0])&&(l=r[0]),null!=l)return[l]}if(!s)throw console.warn(this.node.toMarkup()),new Error(`${this.node.toString()} - Could not find ${e} \`${t}\``);return o?[]:null},c=h(u(t));return o?null!=c?c.map(l):null:null!=c?l(c[0]):null}_unattach(){if(this._handlers.watch.length){for(const t of Array.from(this._handlers.watch))null!=t&&t.unwatch();return this._handlers.watch=[]}}_compute(t,e){return this._handlers.compute.push(t),this.node.bind(t,e,!0)}_uncompute(){if(this._handlers.compute.length){for(const t of Array.from(this._handlers.compute))this.node.unbind(t,!0);return this._handlers.compute=[]}}}St.initClass(),M.apply(St.prototype);class Mt extends St{static initClass(){this.model=St.Group,this.traits=["node"]}}Mt.initClass();class At extends Mt{static initClass(){this.traits=["node","object","entity","visible","active"]}make(){return this._helpers.visible.make(),this._helpers.active.make()}unmake(){return this._helpers.visible.unmake(),this._helpers.active.unmake()}}At.initClass();class Ct extends Mt{static initClass(){this.traits=["node","bind"]}make(){return this._helpers.bind.make([{to:"inherit.source",trait:"node"}])}unmake(){return this._helpers.bind.unmake()}_find(t){return this.bind.source&&Array.from(this.props.traits).includes(t)?this.bind.source._inherit(t):super._find()}}Ct.initClass();class Tt extends Mt{static initClass(){this.traits=["node","root","clock","scene","vertex","unit"]}init(){return this.size=null,this.cameraEvent={type:"root.camera"},this.preEvent={type:"root.pre"},this.updateEvent={type:"root.update"},this.renderEvent={type:"root.render"},this.postEvent={type:"root.post"},this.clockEvent={type:"clock.tick"},this.camera=null}make(){return this._helpers.unit.make()}unmake(){return this._helpers.unit.unmake()}change(t,e,i){if(t["root.camera"]||i)return this._unattach(),this._attach(this.props.camera,"camera",this.setCamera,this,this,!0),this.setCamera()}adopt(t){return Array.from(t.renders).map((t=>this._context.scene.add(t)))}unadopt(t){return Array.from(t.renders).map((t=>this._context.scene.remove(t)))}select(t){return this.node.model.select(t)}watch(t,e){return this.node.model.watch(t,e)}unwatch(t){return this.node.model.unwatch(t)}resize(t){return this.size=t,this.trigger({type:"root.resize",size:t})}getSize(){return this.size}getSpeed(){return this.props.speed}getUnit(){return this._helpers.unit.get()}getUnitUniforms(){return this._helpers.unit.uniforms()}pre(){return this.getCamera().updateProjectionMatrix(),this.trigger(this.clockEvent),this.trigger(this.preEvent)}update(){return this.trigger(this.updateEvent)}render(){return this.trigger(this.renderEvent)}post(){return this.trigger(this.postEvent)}setCamera(){const t=(e=this.select(this.props.camera)[0],i=t=>t.controller,null!=e?i(e):void 0);var e,i;if(this.camera!==t)return this.camera=t,this.trigger({type:"root.camera"})}getCamera(){let t;return null!=(t=null!=this.camera?this.camera.getCamera():void 0)?t:this._context.defaultCamera}getTime(){return this._context.time}vertex(t,e){return 2===e?t.pipe("view.position"):3===e?t.pipe("root.position"):t}}Tt.initClass();class Ot extends Mt{static initClass(){this.traits=["node","unit"]}make(){return this._helpers.unit.make()}unmake(){return this._helpers.unit.unmake()}getUnit(){return this._helpers.unit.get()}getUnitUniforms(){return this._helpers.unit.uniforms()}}Ot.initClass();const Et=function(t,e){return e===S.RepeatWrapping?t.REPEAT:e===S.ClampToEdgeWrapping?t.CLAMP_TO_EDGE:e===S.MirroredRepeatWrapping?t.MIRRORED_REPEAT:e===S.NearestFilter?t.NEAREST:e===S.NearestMipMapNearestFilter?t.NEAREST_MIPMAP_NEAREST:e===S.NearestMipMapLinearFilter?t.NEAREST_MIPMAP_LINEAR:e===S.LinearFilter?t.LINEAR:e===S.LinearMipMapNearestFilter?t.LINEAR_MIPMAP_NEAREST:e===S.LinearMipMapLinearFilter?t.LINEAR_MIPMAP_LINEAR:e===S.UnsignedByteType?t.UNSIGNED_BYTE:e===S.UnsignedShort4444Type?t.UNSIGNED_SHORT_4_4_4_4:e===S.UnsignedShort5551Type?t.UNSIGNED_SHORT_5_5_5_1:e===S.ByteType?t.BYTE:e===S.ShortType?t.SHORT:e===S.UnsignedShortType?t.UNSIGNED_SHORT:e===S.IntType?t.INT:e===S.UnsignedIntType?t.UNSIGNED_INT:e===S.FloatType?t.FLOAT:e===S.AlphaFormat?t.ALPHA:e===S.RGBAFormat?t.RGBA:e===S.LuminanceFormat?t.LUMINANCE:e===S.LuminanceAlphaFormat?t.LUMINANCE_ALPHA:e===S.AddEquation?t.FUNC_ADD:e===S.SubtractEquation?t.FUNC_SUBTRACT:e===S.ReverseSubtractEquation?t.FUNC_REVERSE_SUBTRACT:e===S.ZeroFactor?t.ZERO:e===S.OneFactor?t.ONE:e===S.SrcColorFactor?t.SRC_COLOR:e===S.OneMinusSrcColorFactor?t.ONE_MINUS_SRC_COLOR:e===S.SrcAlphaFactor?t.SRC_ALPHA:e===S.OneMinusSrcAlphaFactor?t.ONE_MINUS_SRC_ALPHA:e===S.DstAlphaFactor?t.DST_ALPHA:e===S.OneMinusDstAlphaFactor?t.ONE_MINUS_DST_ALPHA:e===S.DstColorFactor?t.DST_COLOR:e===S.OneMinusDstColorFactor?t.ONE_MINUS_DST_COLOR:e===S.SrcAlphaSaturateFactor?t.SRC_ALPHA_SATURATE:0},Pt=function(t){switch(t){case S.UnsignedByteType:return Uint8Array;case S.ByteType:return Int8Array;case S.ShortType:return Int16Array;case S.UnsignedShortType:return Uint16Array;case S.IntType:return Int32Array;case S.UnsignedIntType:return Uint32Array;case S.FloatType:return Float32Array}},Dt=t=>t.map((t=>["","X","Y","Z"][t])).join(""),jt=function(){const t=new S.Euler,e=new S.Quaternion,i=new S.Vector3,n=new S.Vector3,r=new S.Matrix4;return function(s,o,a,l,h,u){return null==u&&(u="XYZ"),null!=o?(u instanceof Array&&(u=Dt(u)),t.setFromVector3(o,u),e.setFromEuler(t)):e.set(0,0,0,1),null!=a&&e.multiply(a),null!=s?i.copy(s):i.set(0,0,0),null!=l?n.copy(l):n.set(1,1,1),r.compose(i,e,n),null!=h&&r.multiplyMatrices(r,h),r}};class qt extends St{static initClass(){this.traits=["node","camera"]}init(){}make(){const t=this._context.defaultCamera;return this.camera=this.props.proxy?t:t.clone(),this.euler=new S.Euler,this.quat=new S.Quaternion}unmake(){}getCamera(){return this.camera}change(t,e,i){if(t["camera.position"]||t["camera.quaternion"]||t["camera.rotation"]||t["camera.lookAt"]||t["camera.up"]||t["camera.fov"]||i){const{position:t,quaternion:e,rotation:i,lookAt:n,up:r,fov:s}=this.props;return null!=t&&this.camera.position.copy(t),null==e&&null==i&&null==n||(null!=n?this.camera.lookAt(n):this.camera.quaternion.set(0,0,0,1),null!=i&&(this.euler.setFromVector3(i,Dt(this.props.eulerOrder)),this.quat.setFromEuler(this.euler),this.camera.quaternion.multiply(this.quat)),null!=e&&this.camera.quaternion.multiply(e)),null!=s&&null!=this.camera.fov&&(this.camera.fov=s),null!=r&&this.camera.up.copy(r),this.camera.updateMatrix()}}}qt.initClass();const Ft=function(t){const e=[];let i=t;for(;"string"!=typeof i&&null!=(null!=i?i.length:void 0);)e.push(i.length),i=i[0];return e},It=function(t,e){let i;null==e&&(e={});const{items:n,channels:r,width:s,height:o,depth:a}=e,l={};if(!t||!t.length)return{items:n,channels:r,width:null!=s?s:0,height:null!=o?o:0,depth:null!=a?a:0};const h=Ft(t),u=h.length;l.channels=1!==r&&h.length>1?h.pop():r,l.items=1!==n&&h.length>1?h.pop():n,l.width=1!==s&&h.length>1?h.pop():s,l.height=1!==o&&h.length>1?h.pop():o,l.depth=1!==a&&h.length>1?h.pop():a;let c=u;1===r&&c++,1===n&&c>1&&c++,1===s&&c>2&&c++,1===o&&c>3&&c++;let p=null!=(i=h.pop())?i:1;return c<=1&&(p/=null!=l.channels?l.channels:1),c<=2&&(p/=null!=l.items?l.items:1),c<=3&&(p/=null!=l.width?l.width:1),c<=4&&(p/=null!=l.height?l.height:1),p=Math.floor(p),null==l.width&&(l.width=p,p=1),null==l.height&&(l.height=p,p=1),null==l.depth&&(l.depth=p,p=1),l},Lt=function(t,e){switch(e){case 0:return()=>!0;case 1:return()=>t();case 2:return function(){return t(),t()};case 3:case 4:return function(){return t(),t(),t(),t()};case 6:case 8:return function(){return t(),t(),t(),t(),t(),t()}}},Nt=function(t,e,i){let n;const r=(()=>{switch(i){case 0:return()=>!0;case 1:return e=>e(t());case 2:return e=>e(t(),t());case 3:return e=>e(t(),t(),t());case 4:return e=>e(t(),t(),t(),t());case 6:return e=>e(t(),t(),t(),t(),t(),t());case 8:return e=>e(t(),t(),t(),t(),t(),t(),t(),t())}})();let s=null;for(;e>0;){const t=Math.min(e,8);n=(()=>{switch(t){case 1:return t=>r(t);case 2:return function(t){return r(t),r(t)};case 3:return function(t){return r(t),r(t),r(t)};case 4:return function(t){return r(t),r(t),r(t),r(t)};case 5:return function(t){return r(t),r(t),r(t),r(t),r(t)};case 6:return function(t){return r(t),r(t),r(t),r(t),r(t),r(t)};case 7:return function(t){return r(t),r(t),r(t),r(t),r(t),r(t),r(t)};case 8:return function(t){return r(t),r(t),r(t),r(t),r(t),r(t),r(t),r(t)}}})(),s=null!=s?((t,e)=>function(i){return t(i),e(i)})(n,s):n,e-=t}return n=null!=s?s:()=>!0,n.reset=t.reset,n.rebind=t.rebind,n},Rt=function(t){let e,i,n,r,s,o=Ft(t);const a=o.length;let l=o.pop(),h=o.pop(),u=o.pop();const c=o.pop();let p,d,f,m,g;switch(a){case 0:e=()=>0,e.reset=function(){};break;case 1:p=0,e=()=>t[p++],e.reset=()=>p=0;break;case 2:p=i=0,d=null!=t[i]?t[i]:[],e=function(){const e=d[p++];return p===l&&(p=0,i++,d=null!=t[i]?t[i]:[]),e},e.reset=function(){p=i=0,d=null!=t[i]?t[i]:[]};break;case 3:p=i=n=0,f=null!=t[n]?t[n]:[],d=null!=f[i]?f[i]:[],e=function(){const e=d[p++];return p===l&&(p=0,i++,i===h&&(i=0,n++,f=null!=t[n]?t[n]:[]),d=null!=f[i]?f[i]:[]),e},e.reset=function(){p=i=n=0,f=null!=t[n]?t[n]:[],d=null!=f[i]?f[i]:[]};break;case 4:p=i=n=r=0,m=null!=t[r]?t[r]:[],f=null!=m[n]?m[n]:[],d=null!=f[i]?f[i]:[],e=function(){const e=d[p++];return p===l&&(p=0,i++,i===h&&(i=0,n++,n===u&&(n=0,r++,m=null!=t[r]?t[r]:[]),f=null!=m[n]?m[n]:[]),d=null!=f[i]?f[i]:[]),e},e.reset=function(){p=i=n=r=0,m=null!=t[r]?t[r]:[],f=null!=m[n]?m[n]:[],d=null!=f[i]?f[i]:[]};break;case 5:p=i=n=r=s=0,g=null!=t[s]?t[s]:[],m=null!=g[r]?g[r]:[],f=null!=m[n]?m[n]:[],d=null!=f[i]?f[i]:[],e=function(){const e=d[p++];return p===l&&(p=0,i++,i===h&&(i=0,n++,n===u&&(n=0,r++,r===c&&(r=0,s++,g=null!=t[s]?t[s]:[]),m=null!=g[r]?g[r]:[]),f=null!=m[n]?m[n]:[]),d=null!=f[i]?f[i]:[]),e},e.reset=function(){p=i=n=r=s=0,g=null!=t[s]?t[s]:[],m=null!=g[r]?g[r]:[],f=null!=m[n]?m[n]:[],d=null!=f[i]?f[i]:[]}}return e.rebind=function(e){if(o=Ft(t=e),o.length&&(l=o.pop()),o.length&&(h=o.pop()),o.length&&(u=o.pop()),o.length)return o.pop()},e},Ut=function(t,e,i,n){let r,s,o=r=s=0;const a=function(){return o=e*i*n,r=s=0},l=(()=>{switch(i){case 1:return function(t){r+=t,s+=t};case 2:return function(t){r+=2*t,s+=t};case 3:return function(t){r+=3*t,s+=t};case 4:return function(t){r+=4*t,s+=t}}})(),h=(()=>{switch(i){case 1:return function(e){e(t[r++]),++s};case 2:return function(e){e(t[r++],t[r++]),++s};case 3:return function(e){e(t[r++],t[r++],t[r++]),++s};case 4:return function(e){e(t[r++],t[r++],t[r++],t[r++]),++s}}})(),u=(()=>{switch(i){case 1:return function(e){t[r++]=e,++s};case 2:return function(e,i){t[r++]=e,t[r++]=i,++s};case 3:return function(e,i,n){t[r++]=e,t[r++]=i,t[r++]=n,++s};case 4:return function(e,i,n,o){t[r++]=e,t[r++]=i,t[r++]=n,t[r++]=o,++s}}})();return h.reset=a,u.reset=a,a(),{emit:u,consume:h,skip:l,count:()=>s,done:()=>o-r<=0,reset:a}},Vt=function(t,e){let i,n,r,s,o;const a=new Float32Array(4096);let l=n=.5,h=r=s=o=0;const u=function(t,e,i,n){return s++,a[h++]=t*l,a[h++]=e*l,a[h++]=i*l,a[h++]=n*l},c=function(t,e,i,s){return o++,a[r++]+=t*n,a[r++]+=e*n,a[r++]+=i*n,a[r++]+=s*n},p=Math.max(t.length,e.length);return i=p<=3?function(i,n,l){h=r=s=o=0,t(u,n,l),e(c,n,l);const p=Math.min(s,o);let d=0;return $t(0,p,!1).map((t=>i(a[d++],a[d++],a[d++],a[d++])))}:p<=5?function(i,n,l,p,d){h=r=s=o=0,t(u,n,l,p,d),e(c,n,l,p,d);const f=Math.min(s,o);let m=0;return $t(0,f,!1).map((t=>i(a[m++],a[m++],a[m++],a[m++])))}:p<=7?function(i,n,l,p,d,f,m){h=r=s=o=0,t(u,n,l,p,d,f,m),e(c,n,l,p,d,f,m);const g=Math.min(s,o);let v=0;return(()=>{let t,e;const n=[];for(m=0,e=g,t=0<=e;t?m<e:m>e;t?m++:m--)n.push(i(a[v++],a[v++],a[v++],a[v++]));return n})()}:p<=9?function(i,n,l,p,d,f,m,g,v){h=r=s=o=0,t(u,n,l,p,d,f,m,g,v),e(c,n,l,p,d,f,m,g,v);const y=Math.min(s,o);return v=0,(()=>{let t,e;const n=[];for(g=0,e=y,t=0<=e;t?g<e:g>e;t?g++:g--)n.push(i(a[v++],a[v++],a[v++],a[v++]));return n})()}:function(i,n,l,p,d,f,m,g,v,y,b){h=r=0,t(u,n,l,p,d,f,m,g,v,y,b),e(c,n,l,p,d,f,m,g,v,y,b);const x=Math.min(s,o);return v=0,(()=>{let t,e;const n=[];for(g=0,e=x,t=0<=e;t?g<e:g>e;t?g++:g--)n.push(i(a[v++],a[v++],a[v++],a[v++]));return n})()},i.lerp=function(t){let e;return[l,n]=Array.from(e=[1-t,t]),e},i},Bt=function(t,e){const i=Ft(t).reduce(((t,e)=>t*e)),n=Ft(e).reduce(((t,e)=>t*e)),r=Math.min(i,n),s=Rt(t),o=Rt(e),a=new Float32Array(r);return a.lerp=function(t){s.reset(),o.reset();let e=0;return(()=>{const i=[];for(;e<r;){const n=s(),r=o();i.push(a[e++]=n+(r-n)*t)}return i})()},a};function $t(t,e,i){const n=[],r=t<e,s=i?r?e+1:e-1:e;for(let e=t;r?e<s:e>s;r?e++:e--)n.push(e);return n}const Ht="xyzw".split(""),Wt={0:-1,x:0,y:1,z:2,w:3},Xt=function(t){return t===""+t&&(t=t.split("")),t===+t&&(t=[t]),t},Gt=function(t){return t===+t&&(t="vec"+t),"vec1"===t&&(t="float"),t},Yt=function(t){if((t=""+t).indexOf(".")<0)return t+".0"},Zt=function(t){null==t&&(t=4);const e=Yt(t);return`vec4 float2ByteIndex(vec4 xyzw, out float channelIndex) {\n  float relative = xyzw.w / ${e};\n  float w = floor(relative);\n  channelIndex = (relative - w) * ${e};\n  return vec4(xyzw.xyz, w);\n}`},Qt=function(t){const e=function(t,i){let n;if(t===i)n=`return texture2D(dataTextures[${t}], uv);`;else{const r=Math.ceil(t+(i-t)/2);n=`if (z < ${r-.5}) {\n  ${e(t,r-1)}\n}\nelse {\n  ${e(r,i)}\n}`}return n.replace(/\n/g,"\n  ")};return`uniform sampler2D dataTextures[${t}];\n\nvec4 sample2DArray(vec2 uv, float z) {\n  ${e(0,t-1)}\n}`},Jt=function(t,e,i){return t=Gt(t),null!=i?`${t} binaryOperator(${t} a) {\n  return a ${e} ${i};\n}`:`${t} binaryOperator(${t} a, ${t} b) {\n  return a ${e} b;\n}`},Kt=function(t,e,i){if(null==i&&(i=0),t>e)return te(t,e);const n=e-t;t=Gt(t),e=Gt(e),i=Yt(i);return`${e} extendVec(${t} v) { return ${e}(${function(t,e,i){const n=[],r=t<e,s=i?r?e+1:e-1:e;for(let e=t;r?e<s:e>s;r?e++:e--)n.push(e);return n}(0,n,!0).map((function(t){return t?i:"v"})).join(",")}); }`},te=function(t,e){if(t<e)return Kt(t,e);const i="."+"xyzw".substr(0,e);return t=Gt(t),`${e=Gt(e)} truncateVec(${t} v) { return v${i}; }`},ee=function(t){const e=["0.0","0.0","0.0","0.0"];t=(t=Xt(t)).map((function(t){return t===""+t?Wt[t]:t}));for(let i=0;i<t.length;i++){e[t[i]]=["a","b","c","d"][i]}const i=e.slice(0,4).join(", ");return`vec4 inject(${["float a","float b","float c","float d"].slice(0,t.length)}) {\n  return vec4(${i});\n}`},ie=function(t,e=null){const i=["0.0","xyzw.x","xyzw.y","xyzw.z","xyzw.w"];for(null==e&&(e=t.length),t=(t=Xt(t)).map((function(t){return Array.from([0,1,2,3,4]).includes(+t)&&(t=+t),t===""+t&&(t=Wt[t]+1),i[t]}));t.length<e;)t.push("0.0");return`vec${e} swizzle(vec4 xyzw) {\n  return vec${e}(${t.join(", ")});\n}`.replace(/vec1/g,"float")},ne=function(t){const e=["0.0","0.0","0.0","0.0"];t=(t=Xt(t)).map((function(t){return t===+t?Ht[t-1]:t}));for(let i=0;i<t.length;i++){const n=t[i],r=Ht[i];e[Wt[n]]=`xyzw.${r}`}return`vec4 invertSwizzle(vec4 xyzw) {\n  return vec4(${e.join(", ")});\n}`},re=function(t){let e=[].slice.call(arguments);return e.length>1?(e=e.map(((t,e)=>["inout",t,String.fromCharCode(97+e)].join(" "))),e=e.join(", "),`void identity(${e}) { }`):`${t} identity(${t} x) {\n  return x;\n}`},se=(t,e)=>`${t} constant() {\nreturn ${e};\n}`;class oe extends St{static initClass(){this.traits=["node","source","index"]}made(){return this.trigger({type:"source.rebuild"})}indexShader(t){return t.pipe(re("vec4"))}sourceShader(t){return t.pipe(re("vec4"))}getDimensions(){return{items:1,width:1,height:1,depth:1}}getActiveDimensions(){return this.getDimensions()}getIndexDimensions(){return this.getActiveDimensions()}getFutureDimensions(){return this.getActiveDimensions()}}oe.initClass();class ae extends oe{static initClass(){this.traits=["node","data","source","index","entity","active"]}init(){return this.dataEmitter=null,this.dataSizes=null}emitter(t,e){let i,n;const{data:r,bind:s,expr:o}=this.props;if(null!=r){const n=this.dataSizes,s=Ft(r);if(!n||n.length!==s.length){const i=Rt(r);this.dataEmitter=this.callback(Nt(i,e,t)),this.dataSizes=s}i=this.dataEmitter}else null!=n?(n=this._inherit("resolve"),i=this.callback(n.callback(s))):i=null!=o?this.callback(o):this.callback(this.passthrough);return i}callback(t){return null!=t?t:function(){}}update(){}make(){return this._helpers.active.make(),this.first=!0,this._listen("root","root.update",(()=>((this.isActive||this.first)&&this.update(),this.first=!1)))}unmake(){return this._helpers.active.unmake(),this.dataEmitter=null,this.dataSizes=null}}ae.initClass();class le extends ae{static initClass(){this.traits=["node","buffer","active","data","source","index","texture"]}init(){this.bufferSlack=0,this.bufferFrames=0,this.bufferTime=0,this.bufferDelta=0,this.bufferClock=0,this.bufferStep=0,super.init()}make(){super.make(),this.clockParent=this._inherit("clock"),this.latchParent=this._inherit("latch")}unmake(){return super.unmake()}rawBuffer(){return this.buffer}emitter(){const{channels:t,items:e}=this.props;return super.emitter(t,e)}change(t,e,i){if(t["buffer.fps"]||i){const{fps:t}=this.props;return this.bufferSlack=t?.5/t:0}}syncBuffer(t){let e,i;if(!this.buffer)return;const{live:n,fps:r,hurry:s,limit:o,realtime:a,observe:l}=this.props,h=this.buffer.getFilled();if(h&&!n)return;if(this.latchParent&&!this.latchParent.isDirty)return;const u=this.clockParent.getTime();if(null!=r){const n=this.bufferSlack,c=u.step/u.delta;e=a?u.delta:u.step;const p=1/r;i=a&&l?c*p:p,Math.abs(u.time-this.bufferTime)>u.step*o&&(this.bufferTime=u.time,this.bufferClock=u.clock),this.bufferSlack=Math.min(o/r,n+e),this.bufferDelta=e,this.bufferStep=i;let d=Math.min(s,Math.floor(n*r));h||(d=Math.max(1,d));let f=!1;const m=()=>f=!0;return(()=>{const n=[];for(let r=0,s=d,o=0<=s;(o?r<s:r>s)&&(this.bufferTime+=e,this.bufferClock+=i,!f);o?r++:r--)t(m,this.bufferFrames++,r,d),n.push(this.bufferSlack-=p);return n})()}return this.bufferTime=u.time,this.bufferDelta=u.delta,this.bufferClock=u.clock,this.bufferStep=u.step,t((function(){}),this.bufferFrames++,0,1)}alignShader(t,e){const{minFilter:i,magFilter:n,aligned:r}=this.props,s=t.items>1&&t.width>1||t.height>1&&t.depth>1;if(r||!s)return;return i===this.node.attributes["texture.minFilter"].enum.nearest&&n===this.node.attributes["texture.magFilter"].enum.nearest||console.warn(`${this.node.toString()} - Cannot use linear min/magFilter with 3D/4D sampling`),e.pipe("map.xyzw.align")}}le.initClass();class he extends le{static initClass(){this.traits=["node","buffer","active","data","source","index","array","texture","raw"]}init(){return this.buffer=this.spec=null,this.space={width:0,history:0},this.used={width:0},this.storage="arrayBuffer",this.passthrough=(t,e)=>t(e,0,0,0),super.init()}sourceShader(t){const e=this.getDimensions();return this.alignShader(e,t),this.buffer.shader(t)}getDimensions(){return{items:this.items,width:this.space.width,height:this.space.history,depth:1}}getActiveDimensions(){return{items:this.items,width:this.used.width,height:this.buffer.getFilled(),depth:1}}getFutureDimensions(){return{items:this.items,width:this.used.width,height:this.space.history,depth:1}}getRawDimensions(){return{items:this.items,width:this.space.width,height:1,depth:1}}make(){super.make();const t=null!=this.minFilter?this.minFilter:this.props.minFilter,e=null!=this.magFilter?this.magFilter:this.props.magFilter,i=null!=this.type?this.type:this.props.type,{width:n}=this.props,{history:r}=this.props,s=this.props.bufferWidth,{channels:o}=this.props,{items:a}=this.props;let l=this.spec={channels:o,items:a,width:n};this.items=l.items,this.channels=l.channels;const{data:h}=this.props;l=It(h,l);const{space:u}=this;return u.width=Math.max(s,l.width||1),u.history=r,this.buffer=this._renderables.make(this.storage,{width:u.width,history:u.history,channels:o,items:a,minFilter:t,magFilter:e,type:i})}unmake(){if(super.unmake(),this.buffer)return this.buffer.dispose(),this.buffer=this.spec=null}change(t,e,i){if(e.texture||t["history.history"]||t["buffer.channels"]||t["buffer.items"]||t["array.bufferWidth"])return this.rebuild();if(this.buffer){if(t["array.width"]){const{width:t,bufferWidth:e}=this.props;if(this.spec.width=t,t>e)return this.rebuild()}return t["data.map"]||t["data.data"]||t["data.resolve"]||t["data.expr"]||i?this.buffer.setCallback(this.emitter()):void 0}}callback(t){return t.length<=2?t:(e,i)=>t(e,i,this.bufferClock,this.bufferStep)}update(){if(!this.buffer)return;const{data:t}=this.props;let{width:e}=this.props;const{space:i,used:n}=this,r=n.width,s=this.buffer.getFilled();return this.syncBuffer((r=>{if(null!=t){const e=It(t,this.spec);return e.width>i.width?(r(),this.rebuild()):(n.width=e.width,this.buffer.setActive(n.width),"function"==typeof this.buffer.callback.rebind&&this.buffer.callback.rebind(t),this.buffer.update())}return e=this.spec.width||1,this.buffer.setActive(e),e=this.buffer.update(),n.width=e})),n.width!==r||s!==this.buffer.getFilled()?this.trigger({type:"source.resize"}):void 0}}he.initClass();class ue extends he{static initClass(){this.traits=["node","buffer","active","data","source","index","texture","array","span","interval","sampler","raw"]}updateSpan(){let t;const e=this.props.axis;let{width:i}=this.props;const{centered:n}=this.props,r=this.props.padding,s=this._helpers.span.get("",e);i+=2*r,this.a=s.x;const o=s.y-s.x;return n?(t=1/Math.max(1,i),this.a+=o*t/2):t=1/Math.max(1,i-1),this.b=o*t,this.a+=r*this.b}callback(t){return this.updateSpan(),this.last===t?this._callback:(this.last=t,t.length<=3?this._callback=(e,i)=>{const n=this.a+this.b*i;return t(e,n,i)}:this._callback=(e,i)=>{const n=this.a+this.b*i;return t(e,n,i,this.bufferClock,this.bufferStep)})}make(){return super.make(),this._helpers.span.make(),this._listen(this,"span.range",this.updateSpan)}unmake(){return super.unmake(),this._helpers.span.unmake()}change(t,e,i){super.change(t,e,i),e.span&&this.updateSpan()}}ue.initClass();var ce=n(361),pe=n.n(ce),de=n(8446),fe=n.n(de);class me extends Mt{static initClass(){this.traits=["node","entity","active","latch"]}init(){this.data=void 0,this.isDirty=!0}make(){this._helpers.active.make(),this._listen("root","root.update",(function(){this.isActive&&this.update()}))}unmake(){this._helpers.active.unmake(),this.data=void 0}swap(){const{deep:t,data:e}=this.props;(t?!fe()(e,this.data):e!=this.data)&&(this.data=t?pe()(e):e)}update(){this.isDirty=this.swap()}}me.initClass();class ge extends le{static initClass(){this.traits=["node","buffer","active","data","source","index","texture","matrix","raw"]}init(){return this.buffer=this.spec=null,this.space={width:0,height:0,history:0},this.used={width:0,height:0},this.storage="matrixBuffer",this.passthrough=(t,e,i)=>t(e,i,0,0),super.init()}sourceShader(t){const e=this.getDimensions();return this.alignShader(e,t),this.buffer.shader(t)}getDimensions(){return{items:this.items,width:this.space.width,height:this.space.height,depth:this.space.history}}getActiveDimensions(){return{items:this.items,width:this.used.width,height:this.used.height,depth:this.buffer.getFilled()}}getFutureDimensions(){return{items:this.items,width:this.used.width,height:this.used.height,depth:this.space.history}}getRawDimensions(){return{items:this.items,width:this.space.width,height:this.space.height,depth:1}}make(){super.make();const t=null!=this.minFilter?this.minFilter:this.props.minFilter,e=null!=this.magFilter?this.magFilter:this.props.magFilter,i=null!=this.type?this.type:this.props.type,{width:n}=this.props,{height:r}=this.props,{history:s}=this.props,o=this.props.bufferWidth,a=this.props.bufferHeight,{channels:l}=this.props,{items:h}=this.props;let u=this.spec={channels:l,items:h,width:n,height:r};this.items=u.items,this.channels=u.channels;const{data:c}=this.props;u=It(c,u);const{space:p}=this;return p.width=Math.max(o,u.width||1),p.height=Math.max(a,u.height||1),p.history=s,this.buffer=this._renderables.make(this.storage,{width:p.width,height:p.height,history:p.history,channels:l,items:h,minFilter:t,magFilter:e,type:i})}unmake(){if(super.unmake(),this.buffer)return this.buffer.dispose(),this.buffer=this.spec=null}change(t,e,i){if(e.texture||t["matrix.history"]||t["buffer.channels"]||t["buffer.items"]||t["matrix.bufferWidth"]||t["matrix.bufferHeight"])return this.rebuild();if(this.buffer){if(t["matrix.width"]){const{width:t,bufferWidth:e}=this.props;if(this.spec.width=t,t>e)return this.rebuild()}if(t["matrix.height"]){const{height:t,bufferHeight:e}=this.props;if(this.spec.height=t,t>e)return this.rebuild()}return t["data.map"]||t["data.data"]||t["data.resolve"]||t["data.expr"]||i?this.buffer.setCallback(this.emitter()):void 0}}callback(t){return t.length<=3?t:(e,i,n)=>t(e,i,n,this.bufferClock,this.bufferStep)}update(){if(!this.buffer)return;const{data:t}=this.props,{space:e,used:i}=this,n=i.width,r=i.height,s=this.buffer.getFilled();return this.syncBuffer((n=>{if(null!=t){const r=It(t,this.spec);return r.width>e.width||r.height>e.height?(n(),this.rebuild()):(i.width=r.width,i.height=r.height,this.buffer.setActive(i.width,i.height),"function"==typeof this.buffer.callback.rebind&&this.buffer.callback.rebind(t),this.buffer.update())}{let t;const e=this.spec.width||1,n=this.spec.height||1;this.buffer.setActive(e,n);const r=this.buffer.update();i.width=t=e,i.height=Math.min(n,Math.ceil(r/t)),1===i.height&&(i.width=Math.min(e,r))}})),i.width!==n||i.height!==r||s!==this.buffer.getFilled()?this.trigger({type:"source.resize"}):void 0}}ge.initClass();class ve extends ge{static initClass(){this.traits=["node","buffer","active","data","source","index","matrix","texture","raw","span:x","span:y","area","sampler:x","sampler:y"]}updateSpan(){let t,e;const i=this.props.axes;let{width:n}=this.props,{height:r}=this.props;const{centeredX:s}=this.props,{centeredY:o}=this.props,a=this.props.paddingX,l=this.props.paddingY,h=this._helpers.span.get("x.",i[0]),u=this._helpers.span.get("y.",i[1]);this.aX=h.x,this.aY=u.x;const c=h.y-h.x,p=u.y-u.x;return n+=2*a,r+=2*l,s?(t=1/Math.max(1,n),this.aX+=c*t/2):t=1/Math.max(1,n-1),o?(e=1/Math.max(1,r),this.aY+=p*e/2):e=1/Math.max(1,r-1),this.bX=c*t,this.bY=p*e,this.aX+=a*this.bX,this.aY+=l*this.bY}callback(t){return this.updateSpan(),this.last===t?this._callback:(this.last=t,t.length<=5?this._callback=(e,i,n)=>{const r=this.aX+this.bX*i,s=this.aY+this.bY*n;return t(e,r,s,i,n)}:this._callback=(e,i,n)=>{const r=this.aX+this.bX*i,s=this.aY+this.bY*n;return t(e,r,s,i,n,this.bufferClock,this.bufferStep)})}make(){return super.make(),this._helpers.span.make(),this._listen(this,"span.range",this.updateSpan)}unmake(){return super.unmake(),this._helpers.span.unmake()}change(t,e,i){super.change(t,e,i),(e.x||e.y)&&this.updateSpan()}}ve.initClass();class ye extends le{constructor(...t){super(...t),this.update=this.update.bind(this)}static initClass(){this.traits=["node","buffer","active","data","source","index","texture","voxel","raw"]}init(){this.buffer=this.spec=null,this.space={width:0,height:0,depth:0},this.used={width:0,height:0,depth:0},this.storage="voxelBuffer",this.passthrough=(t,e,i,n)=>t(e,i,n,0),super.init()}sourceShader(t){const e=this.getDimensions();return this.alignShader(e,t),this.buffer.shader(t)}getDimensions(){return{items:this.items,width:this.space.width,height:this.space.height,depth:this.space.depth}}getActiveDimensions(){return{items:this.items,width:this.used.width,height:this.used.height,depth:this.used.depth*this.buffer.getFilled()}}getRawDimensions(){return this.getDimensions()}make(){super.make();const t=null!=this.minFilter?this.minFilter:this.props.minFilter,e=null!=this.magFilter?this.magFilter:this.props.magFilter,i=null!=this.type?this.type:this.props.type,{width:n}=this.props,{height:r}=this.props,{depth:s}=this.props,o=this.props.bufferWidth,a=this.props.bufferHeight,l=this.props.bufferDepth,{channels:h}=this.props,{items:u}=this.props;let c=this.spec={channels:h,items:u,width:n,height:r,depth:s};this.items=c.items,this.channels=c.channels;const{data:p}=this.props;c=It(p,c);const{space:d}=this;return d.width=Math.max(o,c.width||1),d.height=Math.max(a,c.height||1),d.depth=Math.max(l,c.depth||1),this.buffer=this._renderables.make(this.storage,{width:d.width,height:d.height,depth:d.depth,channels:h,items:u,minFilter:t,magFilter:e,type:i})}unmake(){if(super.unmake(),this.buffer)return this.buffer.dispose(),this.buffer=this.spec=null}change(t,e,i){if(e.texture||t["buffer.channels"]||t["buffer.items"]||t["voxel.bufferWidth"]||t["voxel.bufferHeight"]||t["voxel.bufferDepth"])return this.rebuild();if(this.buffer){if(t["voxel.width"]){const{width:t,bufferWidth:e}=this.props;if(this.spec.width=t,t>e)return this.rebuild()}if(t["voxel.height"]){const{height:t,bufferHeight:e}=this.props;if(this.spec.height=t,t>e)return this.rebuild()}if(t["voxel.depth"]){const{depth:t,bufferDepth:e}=this.props;if(this.spec.depth=t,t>e)return this.rebuild()}return t["data.map"]||t["data.data"]||t["data.resolve"]||t["data.expr"]||i?this.buffer.setCallback(this.emitter()):void 0}}callback(t){return t.length<=4?t:(e,i,n,r)=>t(e,i,n,r,this.bufferClock,this.bufferStep)}update(){if(!this.buffer)return;const{data:t}=this.props,{space:e,used:i}=this,n=i.width,r=i.height,s=i.depth,o=this.buffer.getFilled();return this.syncBuffer((n=>{if(null!=t){const r=It(t,this.spec);return r.width>e.width||r.height>e.height||r.depth>e.depth?(n(),this.rebuild()):(i.width=r.width,i.height=r.height,i.depth=r.depth,this.buffer.setActive(i.width,i.height,i.depth),"function"==typeof this.buffer.callback.rebind&&this.buffer.callback.rebind(t),this.buffer.update())}{let t,e;const n=this.spec.width||1,r=this.spec.height||1,s=this.spec.depth||1;this.buffer.setActive(n,r,s);const o=this.buffer.update();i.width=e=n,i.height=t=r,i.depth=Math.min(s,Math.ceil(o/e/t)),1===i.depth&&(i.height=Math.min(r,Math.ceil(o/e)),1===i.height&&(i.width=Math.min(n,o)))}})),i.width!==n||i.height!==r||i.depth!==s||o!==this.buffer.getFilled()?this.trigger({type:"source.resize"}):void 0}}ye.initClass();class be extends ye{static initClass(){this.traits=["node","buffer","active","data","source","index","texture","voxel","span:x","span:y","span:z","volume","sampler:x","sampler:y","sampler:z","raw"]}updateSpan(){let t,e,i;const n=this.props.axes;let{width:r}=this.props,{height:s}=this.props,{depth:o}=this.props;const{centeredX:a}=this.props,{centeredY:l}=this.props,{centeredZ:h}=this.props,u=this.props.paddingX,c=this.props.paddingY,p=this.props.paddingZ,d=this._helpers.span.get("x.",n[0]),f=this._helpers.span.get("y.",n[1]),m=this._helpers.span.get("z.",n[2]);this.aX=d.x,this.aY=f.x,this.aZ=m.x;const g=d.y-d.x,v=f.y-f.x,y=m.y-m.x;return r+=2*u,s+=2*c,o+=2*p,a?(t=1/Math.max(1,r),this.aX+=g*t/2):t=1/Math.max(1,r-1),l?(e=1/Math.max(1,s),this.aY+=v*e/2):e=1/Math.max(1,s-1),h?(i=1/Math.max(1,o),this.aZ+=y*i/2):i=1/Math.max(1,o-1),this.bX=g*t,this.bY=v*e,this.bZ=y*i,this.aX+=this.bX*u,this.aY+=this.bY*c,this.aZ+=this.bZ*c}callback(t){return this.updateSpan(),this.last===t?this._callback:(this.last=t,t.length<=7?this._callback=(e,i,n,r)=>{const s=this.aX+this.bX*i,o=this.aY+this.bY*n,a=this.aZ+this.bZ*r;return t(e,s,o,a,i,n,r)}:this._callback=(e,i,n,r)=>{const s=this.aX+this.bX*i,o=this.aY+this.bY*n,a=this.aZ+this.bZ*r;return t(e,s,o,a,i,n,r,this.bufferClock,this.bufferStep)})}make(){return super.make(),this._helpers.span.make(),this._listen(this,"span.range",this.updateSpan)}unmake(){return super.unmake(),this._helpers.span.unmake()}change(t,e,i){super.change(t,e,i),(e.x||e.y||e.z)&&this.updateSpan()}}be.initClass();const xe=function(t,e,i){+e===e&&(e=[e]);const n=Array.from(e).includes(1)?0:i.x,r=Array.from(e).includes(2)?0:i.y,s=Array.from(e).includes(3)?0:i.z,o=Array.from(e).includes(4)?0:i.w;return t.set(n,r,s,o)},we=function(){const t=new S.Vector4;return function(e,i,n){return xe(t,i,n),e.add(t)}}(),_e=function(t,e){const i=1===e?1:0,n=2===e?1:0,r=3===e?1:0,s=4===e?1:0;return t.set(i,n,r,s)},ke=function(t,e){const i=1===e?1:0,n=2===e?1:0,r=3===e?1:0,s=4===e?1:0;return t.set(n,r+i,s,0)},ze=function(){const t=[0,0];return function(e,i,n,r){if(null==r&&(r=0),n>0){const t=e,s=e+i,o=Math.max(Math.abs(t),Math.abs(s)),a=o*r,l=Math.min(t,s),h=Math.max(t,s);i=h+(o+a-h)*n-(e=l+(-o+a-l)*n)}return t[0]=e,t[1]=i,t}}();class Se extends oe{static initClass(){this.traits=["node","source","index","interval","span","scale","raw","origin"]}init(){return this.used=this.space=this.scaleAxis=this.sampler=null}rawBuffer(){return this.buffer}sourceShader(t){return t.pipe(this.sampler)}getDimensions(){return{items:1,width:this.space,height:1,depth:1}}getActiveDimensions(){return{items:1,width:this.used,height:this.buffer.getFilled(),depth:1}}getRawDimensions(){return this.getDimensions()}make(){let t;this.space=t=this._helpers.scale.divide(""),this.buffer=this._renderables.make("dataBuffer",{width:t,channels:1,items:1});const e={scaleAxis:this._attributes.make(this._types.vec4()),scaleOffset:this._attributes.make(this._types.vec4())};this.scaleAxis=e.scaleAxis.value,this.scaleOffset=e.scaleOffset.value;const i=this.sampler=this._shaders.shader();return i.require(this.buffer.shader(this._shaders.shader(),1)),i.pipe("scale.position",e),this._helpers.span.make(),this._listen(this,"span.range",this.updateRanges)}unmake(){return this.scaleAxis=null,this._helpers.span.unmake()}change(t,e,i){return t["scale.divide"]?this.rebuild():e.view||e.interval||e.span||e.scale||e.origin||i?this.updateRanges():void 0}updateRanges(){const{used:t}=this,{axis:e,origin:i}=this.props,n=this._helpers.span.get("",e),r=n.x,s=n.y,o=this._helpers.scale.generate("",this.buffer,r,s);if(_e(this.scaleAxis,e),xe(this.scaleOffset,e,i),this.used=o.length,this.used!==t)return this.trigger({type:"source.resize"})}}Se.initClass();const Me=function(){const t={};for(const e of Array.from(arguments))for(const i in e){const n=e[i];t[i]=n}return t},Ae=t=>JSON.parse(JSON.serialize(t)),Ce=function(t){let e="";const i=function(t){return e.length&&r.push((t=>t.replace(/\\/g,""))(e)),e=null!=t?t:""};t=t.split(/(?=(?:\\.|["' ,]))/g);let n=!1;const r=[];for(const r of Array.from(t)){const s=r[0],o=r.slice(1);switch(s){case'"':case"'":if(n)n===s?(n=!1,i(o)):e+=r;else{if(""!==e)throw new Error(`ParseError: String \`${t}\` does not contain comma-separated quoted tokens.`);n=s,e+=o}break;case" ":case",":n?e+=r:i(o);break;default:e+=r}}return i(),r};class Te extends St{static initClass(){this.traits=["node","object","visible","style","line","axis","span","interval","arrow","position","origin","shade"],this.defaults={end:!0,zBias:-1}}constructor(t,e,i){super(t,e,i),this.axisPosition=this.axisStep=this.resolution=this.line=this.arrows=null}make(){const t={axisPosition:this._attributes.make(this._types.vec4()),axisStep:this._attributes.make(this._types.vec4())};this.axisPosition=t.axisPosition.value,this.axisStep=t.axisStep.value;let e=this._shaders.shader();e.pipe("axis.position",t),e=this._helpers.position.pipeline(e);const i=this._helpers.style.uniforms(),n=this._helpers.line.uniforms(),r=this._helpers.arrow.uniforms(),s=this._inherit("unit").getUnitUniforms(),{detail:o}=this.props,a=o+1;this.resolution=1/o;const{start:l,end:h}=this.props,{stroke:u,join:c}=this.props;let p=this._helpers.object.mask();const d=this._helpers.shade.pipeline()||!1,{crossed:f,axis:m}=this.props;if(!f&&null!=p&&m>1){const t=["x000","y000","z000","w000"][m];p=this._helpers.position.swizzle(p,t)}const g=Me(r,n,i,s);return this.line=this._renderables.make("line",{uniforms:g,samples:a,position:e,clip:l||h,stroke:u,join:c,mask:p,material:d}),this.arrows=[],l&&this.arrows.push(this._renderables.make("arrow",{uniforms:g,flip:!0,samples:a,position:e,mask:p,material:d})),h&&this.arrows.push(this._renderables.make("arrow",{uniforms:g,samples:a,position:e,mask:p,material:d})),this._helpers.visible.make(),this._helpers.object.make(this.arrows.concat([this.line])),this._helpers.span.make(),this._listen(this,"span.range",this.updateRanges)}unmake(){return this._helpers.visible.unmake(),this._helpers.object.unmake(),this._helpers.span.unmake()}change(t,e,i){return t["axis.detail"]||t["line.stroke"]||t["line.join"]||t["axis.crossed"]||t["interval.axis"]&&this.props.crossed?this.rebuild():e.interval||e.span||e.view||e.origin||i?this.updateRanges():void 0}updateRanges(){const{axis:t,origin:e}=this.props,i=this._helpers.span.get("",t),n=i.x,r=i.y;return _e(this.axisPosition,t).multiplyScalar(n),_e(this.axisStep,t).multiplyScalar((r-n)*this.resolution),we(this.axisPosition,t,e)}}Te.initClass();class Oe extends St{static initClass(){this.traits=["node","object","visible","style","line","mesh","face","geometry","position","bind","shade"]}constructor(t,e,i){super(t,e,i),this.face=null}resize(){if(null==this.bind.points)return;const t=this.bind.points.getActiveDimensions(),{items:e,width:i,height:n,depth:r}=t;if(this.face&&this.face.geometry.clip(i,n,r,e),this.line&&this.line.geometry.clip(e,i,n,r),null!=this.bind.map){const t=this.bind.map.getActiveDimensions();if(this.face)return this.face.geometry.map(t.width,t.height,t.depth,t.items)}}make(){let t,e;if(this._helpers.bind.make([{to:"geometry.points",trait:"source"},{to:"geometry.colors",trait:"source"},{to:"mesh.map",trait:"source"}]),null==this.bind.points)return;let i=this.bind.points.sourceShader(this._shaders.shader());i=this._helpers.position.pipeline(i);const n=this._helpers.style.uniforms(),r=this._helpers.line.uniforms(),s=this._inherit("unit").getUnitUniforms(),o={};o.styleZBias=this._attributes.make(this._types.number()),this.wireZBias=o.styleZBias;const a=this.bind.points.getDimensions(),{items:l,width:h,height:u,depth:c}=a,{line:p,shaded:d,fill:f,stroke:m,join:g}=this.props;this.bind.colors&&(t=this._shaders.shader(),this.bind.colors.sourceShader(t));const v=this._helpers.object.mask(),y=this._helpers.shade.map(null!=this.bind.map?this.bind.map.sourceShader(this._shaders.shader()):void 0),b=this._helpers.shade.pipeline(),x=b||d,w=b||!1,_=[];if(p){const a=this._shaders.shader();a.pipe(ie("yzwx")),a.pipe(i),e=Me(s,r,n,o),this.line=this._renderables.make("line",{uniforms:e,samples:l,strips:h,ribbons:u,layers:c,position:a,color:t,stroke:m,join:g,material:w,mask:v,closed:!0}),_.push(this.line)}return f&&(e=Me(s,n,{}),this.face=this._renderables.make("face",{uniforms:e,width:h,height:u,depth:c,items:l,position:i,color:t,material:x,mask:v,map:y}),_.push(this.face)),this._helpers.visible.make(),this._helpers.object.make(_)}made(){return this.resize()}unmake(){return this._helpers.bind.unmake(),this._helpers.visible.unmake(),this._helpers.object.unmake(),this.face=this.line=null}change(t,e,i){if(t["geometry.points"]||e.mesh)return this.rebuild();if(t["style.zBias"]||t["mesh.lineBias"]||i){const{fill:t,zBias:e,lineBias:i}=this.props;return this.wireZBias.value=e+(t?i:0)}}}Oe.initClass();class Ee extends St{static initClass(){this.traits=["node","object","visible","style","line","grid","area","position","origin","shade","axis:x","axis:y","scale:x","scale:y","span:x","span:y"],this.defaults={width:1,zBias:-2}}constructor(t,e,i){super(t,e,i),this.axes=null}make(){let t,e=this._helpers.object.mask();const i=this._helpers.shade.pipeline()||!1;t=(t,n,r)=>{let s;const o=this._get(t+"axis.detail"),a=o+1,u=1/o,c=this._helpers.scale.divide(n),p=this._renderables.make("dataBuffer",{width:c,channels:1}),d={gridPosition:this._attributes.make(this._types.vec4()),gridStep:this._attributes.make(this._types.vec4()),gridAxis:this._attributes.make(this._types.vec4())},f={gridPosition:d.gridPosition.value,gridStep:d.gridStep.value,gridAxis:d.gridAxis.value},m=s=this._shaders.shader();null!=r&&null!=e&&(e=this._helpers.position.swizzle(e,r)),m.require(p.shader(this._shaders.shader(),2)),m.pipe("grid.position",d),s=this._helpers.position.pipeline(m);const g=this._helpers.style.uniforms(),v=this._helpers.line.uniforms(),y=this._inherit("unit").getUnitUniforms(),b=Me(v,g,y);return{first:t,second:n,resolution:u,samples:a,line:this._renderables.make("line",{uniforms:b,samples:a,strips:c,position:s,stroke:l,join:h,mask:e,material:i}),buffer:p,values:f}};const{lineX:n,lineY:r,crossed:s,axes:o}=this.props,a=["0000","x000","y000","z000","w000"][o[1]],{stroke:l,join:h}=this.props;this.axes=[],n&&this.axes.push(t("x.","y.",null)),r&&this.axes.push(t("y.","x.",s?null:a));const u=(()=>{const e=[];for(t of this.axes)e.push(t.line);return e})();return this._helpers.visible.make(),this._helpers.object.make(u),this._helpers.span.make(),this._listen(this,"span.range",this.updateRanges)}unmake(){this._helpers.visible.unmake(),this._helpers.object.unmake(),this._helpers.span.unmake();for(const t of this.axes)t.buffer.dispose();this.axes=null}change(t,e,i){return t["x.axis.detail"]||t["y.axis.detail"]||t["x.axis.factor"]||t["y.axis.factor"]||t["grid.lineX"]||t["grid.lineY"]||t["line.stroke"]||t["line.join"]||t["grid.crossed"]||t["grid.axes"]&&this.props.crossed?this.rebuild():e.x||e.y||e.area||e.grid||e.view||e.origin||i?this.updateRanges():void 0}updateRanges(){const t=(t,n,r,s,o)=>{const{second:a,resolution:l,samples:h,line:u,buffer:c,values:p}=o;let d=r.x,f=r.y;_e(p.gridPosition,t).multiplyScalar(d),_e(p.gridStep,t).multiplyScalar((f-d)*l),we(p.gridPosition,e,i),d=s.x,f=s.y;const m=this._helpers.scale.generate(a,c,d,f);_e(p.gridAxis,n);const g=m.length;return u.geometry.clip(h,g,1,1)},{axes:e,origin:i}=this.props,n=this._helpers.span.get("x.",e[0]),r=this._helpers.span.get("y.",e[1]),{lineX:s,lineY:o}=this.props;s&&t(e[0],e[1],n,r,this.axes[0]),o&&t(e[1],e[0],r,n,this.axes[+s]),window.cake1=this.axes[0].buffer,window.cake2=this.axes[1].buffer,window.cake3=this.axes[0]}}Ee.initClass();class Pe extends St{static initClass(){this.traits=["node","object","visible","style","line","arrow","geometry","position","bind","shade"]}constructor(t,e,i){super(t,e,i),this.line=this.arrows=null}resize(){if(null==this.bind.points)return;const t=this.bind.points.getActiveDimensions(),e=t.width,i=t.height,n=t.depth,r=t.items;return this.line.geometry.clip(e,i,n,r),Array.from(this.arrows).map((t=>t.geometry.clip(e,i,n,r)))}make(){let t;if(this._helpers.bind.make([{to:"geometry.points",trait:"source"},{to:"geometry.colors",trait:"source"}]),null==this.bind.points)return;let e=this._shaders.shader();e=this.bind.points.sourceShader(e),e=this._helpers.position.pipeline(e);const i=this._helpers.style.uniforms(),n=this._helpers.line.uniforms(),r=this._helpers.arrow.uniforms(),s=this._inherit("unit").getUnitUniforms(),{start:o,end:a}=this.props,{stroke:l,join:h,proximity:u,closed:c}=this.props;this.proximity=u;const p=this.bind.points.getDimensions(),d=p.width,f=p.height,m=p.depth,g=p.items;this.bind.colors&&(t=this._shaders.shader(),this.bind.colors.sourceShader(t));const v=this._helpers.object.mask(),y=this._helpers.shade.pipeline()||!1,b=Me(r,n,i,s);return this.line=this._renderables.make("line",{uniforms:b,samples:d,strips:f,ribbons:m,layers:g,position:e,color:t,clip:o||a,stroke:l,join:h,proximity:u,closed:c,mask:v,material:y}),this.arrows=[],o&&this.arrows.push(this._renderables.make("arrow",{uniforms:b,flip:!0,samples:d,strips:f,ribbons:m,layers:g,position:e,color:t,closed:c,mask:v,material:y})),a&&this.arrows.push(this._renderables.make("arrow",{uniforms:b,samples:d,strips:f,ribbons:m,layers:g,position:e,color:t,closed:c,mask:v,material:y})),this._helpers.visible.make(),this._helpers.object.make(this.arrows.concat([this.line]))}made(){return this.resize()}unmake(){return this._helpers.bind.unmake(),this._helpers.visible.unmake(),this._helpers.object.unmake(),this.line=this.arrows=null}change(t,e,i){return t["geometry.points"]||t["line.stroke"]||t["line.join"]||t["arrow.start"]||t["arrow.end"]||t["line.proximity"]&&null!=this.proximity!=(null!=this.props.proximity)?this.rebuild():void 0}}Pe.initClass();class De extends St{static initClass(){this.traits=["node","object","visible","style","point","geometry","position","bind","shade"]}constructor(t,e,i){super(t,e,i),this.point=null}resize(){if(null==this.bind.points)return;const t=this.bind.points.getActiveDimensions(),{items:e,width:i,height:n,depth:r}=t;return this.point.geometry.clip(i,n,r,e)}make(){let t,e;if(this._helpers.bind.make([{to:"geometry.points",trait:"source"},{to:"geometry.colors",trait:"source"},{to:"point.sizes",trait:"source"}]),null==this.bind.points)return;let i=this._shaders.shader();i=this.bind.points.sourceShader(i),i=this._helpers.position.pipeline(i);const n=this.bind.points.getDimensions(),{items:r,width:s,height:o,depth:a}=n,l=this._helpers.style.uniforms(),h=this._helpers.point.uniforms(),u=this._inherit("unit").getUnitUniforms();this.bind.colors&&(t=this._shaders.shader(),this.bind.colors.sourceShader(t)),this.bind.sizes&&(e=this._shaders.shader(),this.bind.sizes.sourceShader(e));const c=this._helpers.object.mask(),p=this._helpers.shade.pipeline()||!1,{shape:d}=this.props,{fill:f}=this.props,{optical:m}=this.props,g=Me(u,h,l);this.point=this._renderables.make("point",{uniforms:g,width:s,height:o,depth:a,items:r,position:i,color:t,size:e,shape:d,optical:m,fill:f,mask:c,material:p}),this._helpers.visible.make(),this._helpers.object.make([this.point])}made(){return this.resize()}unmake(){this._helpers.bind.unmake(),this._helpers.visible.unmake(),this._helpers.object.unmake(),this.point=null}change(t,e,i){if(t["geometry.points"]||t["point.shape"]||t["point.fill"])return this.rebuild()}}De.initClass();class je extends St{static initClass(){this.traits=["node","object","visible","style","line","mesh","strip","geometry","position","bind","shade"]}constructor(t,e,i){super(t,e,i),this.strip=null}resize(){if(null==this.bind.points)return;const t=this.bind.points.getActiveDimensions(),{items:e,width:i,height:n,depth:r}=t;if(this.strip&&this.strip.geometry.clip(i,n,r,e),this.line&&this.line.geometry.clip(e,i,n,r),null!=this.bind.map){const t=this.bind.map.getActiveDimensions();if(this.strip)return this.strip.geometry.map(t.width,t.height,t.depth,t.items)}}make(){let t,e;if(this._helpers.bind.make([{to:"geometry.points",trait:"source"},{to:"geometry.colors",trait:"source"},{to:"mesh.map",trait:"source"}]),null==this.bind.points)return;let i=this._shaders.shader();i=this.bind.points.sourceShader(i),i=this._helpers.position.pipeline(i);const n=this._helpers.style.uniforms(),r=this._helpers.line.uniforms(),s=this._inherit("unit").getUnitUniforms(),{line:o,shaded:a,fill:l,stroke:h,join:u}=this.props,c={};c.styleZBias=this._attributes.make(this._types.number()),this.wireZBias=c.styleZBias;const p=this.bind.points.getDimensions(),{items:d,width:f,height:m,depth:g}=p;this.bind.colors&&(t=this._shaders.shader(),t=this.bind.colors.sourceShader(t));const v=this._helpers.object.mask();this._helpers.shade.map(null!=this.bind.map?this.bind.map.sourceShader(this._shaders.shader()):void 0);const y=this._helpers.shade.pipeline(),b=y||a,x=y||!1,w=[];if(o){const o=this._shaders.shader();o.pipe(ie("yzwx")),o.pipe(i),e=Me(s,r,n,c),this.line=this._renderables.make("line",{uniforms:e,samples:d,strips:f,ribbons:m,layers:g,position:o,color:t,stroke:h,join:u,mask:v,material:x}),w.push(this.line)}return l&&(e=Me(n,{}),this.strip=this._renderables.make("strip",{uniforms:e,width:f,height:m,depth:g,items:d,position:i,color:t,material:b}),w.push(this.strip)),this._helpers.visible.make(),this._helpers.object.make(w)}made(){return this.resize()}unmake(){return this._helpers.bind.unmake(),this._helpers.visible.unmake(),this._helpers.object.unmake(),this.strip=null}change(t,e,i){if(t["geometry.points"]||e.mesh)return this.rebuild();if(t["style.zBias"]||t["mesh.lineBias"]||i){const{fill:t,zBias:e,lineBias:i}=this.props;return this.wireZBias.value=e+(t?i:0)}}}je.initClass();class qe extends St{static initClass(){this.traits=["node","object","visible","style","line","mesh","geometry","surface","position","grid","bind","shade"],this.defaults={lineX:!1,lineY:!1}}constructor(t,e,i){super(t,e,i),this.lineX=this.lineY=this.surface=null}resize(){if(null==this.bind.points)return;const t=this.bind.points.getActiveDimensions(),{width:e,height:i,depth:n,items:r}=t;if(this.surface&&this.surface.geometry.clip(e,i,n,r),this.lineX&&this.lineX.geometry.clip(e,i,n,r),this.lineY&&this.lineY.geometry.clip(i,e,n,r),null!=this.bind.map){const t=this.bind.map.getActiveDimensions();if(this.surface)return this.surface.geometry.map(t.width,t.height,t.depth,t.items)}}make(){let t,e;if(this._helpers.bind.make([{to:"geometry.points",trait:"source"},{to:"geometry.colors",trait:"source"},{to:"mesh.normals",trait:"source"},{to:"mesh.map",trait:"source"}]),null==this.bind.points)return;let i=this._shaders.shader();i=this.bind.points.sourceShader(i),i=this._helpers.position.pipeline(i);const n=this._helpers.style.uniforms(),r=this._helpers.style.uniforms(),s=this._helpers.line.uniforms(),o=this._helpers.surface.uniforms(),a=this._inherit("unit").getUnitUniforms();r.styleColor=this._attributes.make(this._types.color()),r.styleZBias=this._attributes.make(this._types.number()),this.wireColor=r.styleColor.value,this.wireZBias=r.styleZBias,this.wireScratch=new S.Color;const l=this.bind.points.getDimensions(),{width:h,height:u,depth:c,items:p}=l,{shaded:d,fill:f,lineX:m,lineY:g,closedX:v,closedY:y,stroke:b,join:x,proximity:w,crossed:_}=this.props,k=[];this.proximity=w,null!=this.bind.normals&&(e=this._shaders.shader(),this.bind.normals.sourceShader(e),this._helpers.shade.normal(e)),null!=this.bind.colors&&(t=this._shaders.shader(),this.bind.colors.sourceShader(t));const z=this._helpers.object.mask(),M=this._helpers.shade.map(null!=this.bind.map?this.bind.map.sourceShader(this._shaders.shader()):void 0),A=this._helpers.shade.pipeline(),C=A||d,T=A||!1,{swizzle:O,swizzle2:E}=this._helpers.position;let P=Me(a,s,n,r);const D=m||g?-50:0;return m&&(this.lineX=this._renderables.make("line",{uniforms:P,samples:h,strips:u,ribbons:c,layers:p,position:i,color:t,normal:e,zUnits:-D,stroke:b,join:x,mask:z,material:T,proximity:w,closed:v||closed}),k.push(this.lineX)),g&&(this.lineY=this._renderables.make("line",{uniforms:P,samples:u,strips:h,ribbons:c,layers:p,position:E(i,"yxzw","yxzw"),color:O(t,"yxzw"),zUnits:-D,stroke:b,join:x,mask:O(z,_?"xyzw":"yxzw"),material:T,proximity:w,closed:y||closed}),k.push(this.lineY)),f&&(P=Me(a,o,n),this.surface=this._renderables.make("surface",{uniforms:P,width:h,height:u,surfaces:c,layers:p,position:i,color:t,zUnits:D,stroke:b,material:C,mask:z,map:M,intUV:!0,closedX:v||closed,closedY:y||closed}),k.push(this.surface)),this._helpers.visible.make(),this._helpers.object.make(k)}made(){return this.resize()}unmake(){return this._helpers.bind.unmake(),this._helpers.visible.unmake(),this._helpers.object.unmake(),this.lineX=this.lineY=this.surface=null}_convertGammaToLinear(t,e=2){return t.r=Math.pow(t.r,e),t.g=Math.pow(t.g,e),t.b=Math.pow(t.b,e),t}_convertLinearToGamma(t,e=2){const i=e>0?1/e:1;return t.r=Math.pow(t.r,i),t.g=Math.pow(t.g,i),t.b=Math.pow(t.b,i),t}change(t,e,i){if(t["geometry.points"]||t["mesh.shaded"]||t["mesh.fill"]||t["line.stroke"]||t["line.join"]||e.grid)return this.rebuild();if(t["style.color"]||t["style.zBias"]||t["mesh.fill"]||t["mesh.lineBias"]||i){const{fill:t,color:e,zBias:i,lineBias:n}=this.props;if(this.wireZBias.value=i+(t?n:0),this.wireColor.copy(e),t){const t=this.wireScratch;t.setRGB(e.r,e.g,e.b),this._convertLinearToGamma(this._convertGammaToLinear(t).multiplyScalar(.75)),this.wireColor.r=t.r,this.wireColor.g=t.g,this.wireColor.b=t.b}}return t["line.proximity"]&&null!=this.proximity!=(null!=this.props.proximity)?this.rebuild():void 0}}qe.initClass();class Fe extends St{static initClass(){this.traits=["node","object","visible","style","line","ticks","geometry","position","bind","shade"]}init(){return this.tickStrip=this.line=null}resize(){if(null==this.bind.points)return;const t=this.bind.points.getActiveDimensions(),e=+(t.items>0),i=t.width*e,n=t.height*e,r=t.depth*e;return this.line.geometry.clip(2,i,n,r),this.tickStrip.set(0,i-1)}make(){let t,e;if(this._helpers.bind.make([{to:"geometry.points",trait:"source"},{to:"geometry.colors",trait:"source"}]),null==this.bind.points)return;const i=this._helpers.style.uniforms(),n=this._helpers.line.uniforms(),r=this._inherit("unit").getUnitUniforms(),s=Me(n,i,r),o={tickEpsilon:this.node.attributes["ticks.epsilon"],tickSize:this.node.attributes["ticks.size"],tickNormal:this.node.attributes["ticks.normal"],tickStrip:this._attributes.make(this._types.vec2(0,0)),worldUnit:s.worldUnit,focusDepth:s.focusDepth};this.tickStrip=o.tickStrip.value;const a=e=this._shaders.shader();a.require(this.bind.points.sourceShader(this._shaders.shader())),a.require(this._helpers.position.pipeline(this._shaders.shader())),a.pipe("ticks.position",o);const{stroke:l,join:h}=this.props,u=this.bind.points.getDimensions(),c=u.width,p=u.height,d=u.depth;this.bind.colors&&(t=this._shaders.shader(),this.bind.colors.sourceShader(t));const f=this._helpers.object.mask(),m=this._helpers.shade.pipeline()||!1,{swizzle:g}=this._helpers.position;return this.line=this._renderables.make("line",{uniforms:s,samples:2,strips:c,ribbons:p,layers:d,position:e,color:t,stroke:l,join:h,mask:g(f,"yzwx"),material:m}),this._helpers.visible.make(),this._helpers.object.make([this.line])}made(){return this.resize()}unmake(){return this.line=null,this._helpers.visible.unmake(),this._helpers.object.unmake()}change(t,e,i){if(t["geometry.points"]||t["line.stroke"]||t["line.join"])return this.rebuild()}}Fe.initClass();class Ie extends St{static initClass(){this.traits=["node","object","visible","style","line","arrow","geometry","position","bind","shade"]}constructor(t,e,i){super(t,e,i),this.line=this.arrows=null}resize(){if(null==this.bind.points)return;const t=this.bind.points.getActiveDimensions(),e=t.items,i=t.width,n=t.height,r=t.depth;return this.line.geometry.clip(e,i,n,r),Array.from(this.arrows).map((t=>t.geometry.clip(e,i,n,r)))}make(){let t;if(this._helpers.bind.make([{to:"geometry.points",trait:"source"},{to:"geometry.colors",trait:"source"}]),null==this.bind.points)return;let e=this._shaders.shader();this.bind.points.sourceShader(e),this._helpers.position.pipeline(e);const i=this._helpers.style.uniforms(),n=this._helpers.line.uniforms(),r=this._helpers.arrow.uniforms(),s=this._inherit("unit").getUnitUniforms(),{start:o,end:a}=this.props,{stroke:l,join:h,proximity:u,closed:c}=this.props;this.proximity=u;const p=this.bind.points.getDimensions(),d=p.items,f=p.width,m=p.height,g=p.depth;this.bind.colors&&(t=this._shaders.shader(),this.bind.colors.sourceShader(t));let v=this._helpers.object.mask(),y=this._helpers.shade.pipeline()||!1;const{swizzle:b,swizzle2:x}=this._helpers.position;e=x(e,"yzwx","yzwx"),t=b(t,"yzwx"),v=b(v,"yzwx"),y=b(y,"yzwx");const w=Me(r,n,i,s);return this.line=this._renderables.make("line",{uniforms:w,samples:d,ribbons:m,strips:f,layers:g,position:e,color:t,clip:o||a,stroke:l,join:h,proximity:u,closed:c,mask:v,material:y}),this.arrows=[],o&&this.arrows.push(this._renderables.make("arrow",{uniforms:w,flip:!0,samples:d,ribbons:m,strips:f,layers:g,position:e,color:t,closed:c,mask:v,material:y})),a&&this.arrows.push(this._renderables.make("arrow",{uniforms:w,samples:d,ribbons:m,strips:f,layers:g,position:e,color:t,closed:c,mask:v,material:y})),this._helpers.visible.make(),this._helpers.object.make(this.arrows.concat([this.line]))}made(){return this.resize()}unmake(){return this._helpers.bind.unmake(),this._helpers.visible.unmake(),this._helpers.object.unmake(),this.line=this.arrows=null}change(t,e,i){return t["geometry.points"]||t["line.stroke"]||t["line.join"]||t["arrow.start"]||t["arrow.end"]||t["line.proximity"]&&null!=this.proximity!=(null!=this.props.proximity)?this.rebuild():void 0}}Ie.initClass();class Le extends ye{static initClass(){this.traits=["node","buffer","active","data","voxel","html"],this.finals={channels:1}}init(){super.init(),this.storage="pushBuffer"}make(){super.make();const{items:t,width:e,height:i,depth:n}=this.getDimensions();return this.dom=this._overlays.make("dom"),this.dom.hint(t*e*i*n)}unmake(){if(super.unmake(),null!=this.dom)return this.dom.dispose(),this.dom=null}update(){return super.update()}change(t,e,i){return e.html?this.rebuild():super.change(t,e,i)}nodes(){return this.buffer.read()}callback(t){const{el:e}=this.dom;return t.length<=6?(i,n,r,s,o)=>t(i,e,n,r,s,o):(i,n,r,s,o)=>t(i,e,n,r,s,o,this.bufferClock,this.bufferStep)}}Le.initClass();class Ne extends St{static initClass(){this.traits=["node","bind","object","visible","overlay","dom","attach","position"]}init(){this.emitter=this.root=null,this.active={}}make(){if(super.make(),this._helpers.bind.make([{to:"dom.html",trait:"html"},{to:"dom.points",trait:"source"}]),null==this.bind.points||null==this.bind.html)return;this.root=this._inherit("root"),this._listen("root","root.update",this.update),this._listen("root","root.post",this.post);const t=this.bind.points.getDimensions(),e=this.bind.html.getDimensions(),i=Math.min(t.items,e.items),n=Math.min(t.width,e.width),r=Math.min(t.height,e.height),s=Math.min(t.depth,e.depth);let o=this.bind.points.sourceShader(this._shaders.shader());o=this._helpers.position.pipeline(o);const a=this._shaders.shader({globals:["projectionMatrix"]});a.pipe("project.readback"),o.pipe(a);const l=this._shaders.shader();this.readback=this._renderables.make("readback",{map:o,indexer:l,items:i,width:n,height:r,depth:s,channels:4,stpq:!0}),this.dom=this._overlays.make("dom"),this.dom.hint(i*n*r*s*2),this.emitter=this.callback(this.bind.html.nodes()),this.readback.setCallback(this.emitter),this._helpers.visible.make()}unmake(){null!=this.readback&&(this.readback.dispose(),this.dom.dispose(),this.readback=this.dom=null,this.root=null,this.emitter=null,this.active={}),this._helpers.bind.unmake(),this._helpers.visible.unmake()}update(){null!=this.readback&&this.props.visible&&(this.readback.update(null!=this.root?this.root.getCamera():void 0),this.readback.post(),this.readback.iterate())}post(){null!=this.readback&&this.dom.render(this.isVisible?this.emitter.nodes():null)}callback(t){let e,i;const n=this._inherit("unit").getUnitUniforms(),r=n.viewWidth,s=n.viewHeight,o=this.node.attributes["dom.attributes"],a=this.node.attributes["dom.size"],l=this.node.attributes["dom.zoom"],h=this.node.attributes["dom.color"],u=this.node.attributes["dom.outline"],c=this.node.attributes["dom.pointerEvents"],p=this.node.attributes["overlay.opacity"],d=this.node.attributes["overlay.zIndex"],f=this.node.attributes["attach.offset"],m=this.node.attributes["attach.depth"],g=this.node.attributes["attach.snap"],{el:v}=this.dom;let y=[],b=null,x=null,w=e=i=0,_="";const k=function(n,a,h,u,c,d,_,k){let z;const S=t[k+w*c+e*d+i*_],M=u<0,A=1+(1/u-1)*m.value,C=M?0:A,T=+f.value.x*C,O=+f.value.y*C;let E=(n+1)*r.value*.5+T,P=(a-1)*s.value*.5+O;E/=l.value,P/=l.value,g.value&&(E=Math.round(E),P=Math.round(P));const D=Math.min(.999,M?0:p.value),j={className:x,style:{transform:`translate3d(${E}px, ${-P}px, ${1-u}px) translate(-50%, -50%) scale(${C},${C})`,opacity:D}};for(_ in b)z=b[_],j.style[_]=z;const q=o.value;if(null!=q){const t=q.style;for(_ in q)z=q[_],["style","className"].includes(_)||(j[_]=z);if(null!=t)for(_ in t)z=t[_],j.style[_]=z}return j.className+=" "+(null!=(null!=q?q.className:void 0)?null!=q?q.className:void 0:"mathbox-label"),y.push(v("div",j,S))};return k.reset=()=>{y=[],[w,e,i]=Array.from([this.strideI,this.strideJ,this.strideK]);const t=h.value,n=t=>Math.floor(255*t);if(_=t?`rgb(${[n(t.x),n(t.y),n(t.z)]})`:"",x=`mathbox-outline-${Math.round(u.value)}`,b={},t&&(b.color=_),b.fontSize=`${a.value}px`,1!==l.value&&(b.zoom=l.value),d.value>0&&(b.zIndex=d.value),c.value)return b.pointerEvents="auto"},k.nodes=()=>y,k}resize(){let t,e;if(null==this.readback)return;const i=this.bind.points.getActiveDimensions(),n=this.bind.html.getActiveDimensions(),r=Math.min(i.items,n.items),s=Math.min(i.width,n.width),o=Math.min(i.height,n.height),a=Math.min(i.depth,n.depth);this.readback.setActive(r,s,o,a),this.strideI=t=n.items,this.strideJ=e=t*n.width,this.strideK=e*n.height}change(t,e,i){if(t["dom.html"]||t["dom.points"])return this.rebuild()}}Ne.initClass();class Re extends ye{static initClass(){this.traits=["node","buffer","active","data","texture","voxel","text","font"],this.defaults={minFilter:"linear",magFilter:"linear"},this.finals={channels:1}}init(){return super.init(),this.atlas=null}textShader(t){return this.atlas.shader(t)}textIsSDF(){return this.props.sdf>0}textHeight(){return this.props.detail}make(){let{minFilter:t,magFilter:e,type:i}=this.props;const{font:n,style:r,variant:s,weight:o,detail:a,sdf:l}=this.props;this.atlas=this._renderables.make("textAtlas",{font:n,size:a,style:r,variant:s,weight:o,outline:l,minFilter:t,magFilter:e,type:i}),this.minFilter=S.NearestFilter,this.magFilter=S.NearestFilter,this.type=S.FloatType,le.prototype.make.call(this),t=null!=this.minFilter?this.minFilter:this.props.minFilter,e=null!=this.magFilter?this.magFilter:this.props.magFilter,i=null!=this.type?this.type:this.props.type;const{width:h}=this.props,{height:u}=this.props,{depth:c}=this.props,p=this.props.bufferWidth,d=this.props.bufferHeight,f=this.props.bufferDepth,{channels:m}=this.props,{items:g}=this.props;let v=this.spec={channels:m,items:g,width:h,height:u,depth:c};this.items=v.items,this.channels=v.channels;const{data:y}=this.props;v=It(y,v);const{space:b}=this;b.width=Math.max(p,v.width||1),b.height=Math.max(d,v.height||1),b.depth=Math.max(f,v.depth||1),this.buffer=this._renderables.make(this.storage,{width:b.width,height:b.height,depth:b.depth,channels:4,items:g,minFilter:t,magFilter:e,type:i});const{atlas:x}=this,{emit:w}=this.buffer.streamer;return this.buffer.streamer.emit=t=>x.map(t,w)}unmake(){if(super.unmake(),this.atlas)return this.atlas.dispose(),this.atlas=null}update(){return this.atlas.begin(),super.update(),this.atlas.end()}change(t,e,i){return e.font?this.rebuild():super.change(t,e,i)}}Re.initClass();class Ue extends oe{static initClass(){this.traits=["node","bind","operator","source","index"]}indexShader(t){return Ve(this.bind.source,"indexShader",(e=>e.indexShader(t)))}sourceShader(t){return Ve(this.bind.source,"sourceShader",(e=>e.sourceShader(t)))}getDimensions(){return this.bind.source.getDimensions()}getFutureDimensions(){return this.bind.source.getFutureDimensions()}getActiveDimensions(){return this.bind.source.getActiveDimensions()}getIndexDimensions(){return this.bind.source.getIndexDimensions()}init(){return this.sourceSpec=[{to:"operator.source",trait:"source",optional:!0}]}make(){return super.make(),this._helpers.bind.make(this.sourceSpec)}made(){return this.resize(),super.made()}unmake(){return this._helpers.bind.unmake()}resize(t){return this.trigger({type:"source.resize"})}}function Ve(t,e,i){return null!=t&&"function"==typeof t[e]?i(t,e):void 0}Ue.initClass();class Be extends Ue{static initClass(){this.traits=["node","bind","operator","texture","text","format","font"],this.defaults={minFilter:"linear",magFilter:"linear"}}init(){return super.init(),this.atlas=this.buffer=this.used=this.time=null,this.filled=!1}sourceShader(t){return this.buffer.shader(t)}textShader(t){return this.atlas.shader(t)}textIsSDF(){return this.props.sdf>0}textHeight(){return this.props.detail}make(){this._helpers.bind.make([{to:"operator.source",trait:"raw"}]);let{minFilter:t,magFilter:e,type:i}=this.props;const{font:n,style:r,variant:s,weight:o,detail:a,sdf:l}=this.props;this.atlas=this._renderables.make("textAtlas",{font:n,size:a,style:r,variant:s,weight:o,outline:l,minFilter:t,magFilter:e,type:i}),t=S.NearestFilter,e=S.NearestFilter,i=S.FloatType;const h=this.bind.source.getDimensions(),{items:u,width:c,height:p,depth:d}=h;this.buffer=this._renderables.make("voxelBuffer",{width:c,height:p,depth:d,channels:4,items:u,minFilter:t,magFilter:e,type:i});const{atlas:f}=this,{emit:m}=this.buffer.streamer;return this.buffer.streamer.emit=t=>f.map(t,m),this.clockParent=this._inherit("clock"),this._listen("root","root.update",this.update)}made(){return super.made(),this.resize()}unmake(){if(super.unmake(),this.buffer&&(this.buffer.dispose(),this.buffer=null),this.atlas)return this.atlas.dispose(),this.atlas=null}update(){if(this.filled&&!this.props.live||!this.through)return;this.time=this.clockParent.getTime();const{used:t}=this;return this.atlas.begin(),this.used=this.through(),this.buffer.write(this.used),this.atlas.end(),this.filled=!0,t!==this.used?this.trigger({type:"source.resize"}):void 0}change(t,e,i){if(e.font)return this.rebuild();if(t["format.expr"]||t["format.digits"]||t["format.data"]||i){let t,{expr:e}=this.props;const{digits:i,data:n}=this.props;null==e&&(e=null!=n?(t,e,i,r,s)=>n[s]:t=>t);const{length:r}=e;return null!=i&&(e=(t=>(e,n,r,s,o,a,l,h,u,c)=>+t(e,n,r,s,o,a,l,h,u,c).toPrecision(i))(e)),t=r>8?(t,i,n,r,s,o,a,l,h,u,c)=>t(e(i,n,r,s,o,a,l,h,this.time.clock,this.time.step)):(t,i,n,r,s,o,a,l,h)=>t(e(i,n,r,s,o,a,l,h)),this.through=this.bind.source.rawBuffer().through(t,this.buffer)}}}Be.initClass();class $e extends St{static initClass(){this.traits=["node","bind","object","visible","style","label","attach","geometry","position"]}make(){let t;if(super.make(),this._helpers.bind.make([{to:"label.text",trait:"text"},{to:"geometry.points",trait:"source"},{to:"geometry.colors",trait:"source"}]),null==this.bind.points)return;if(null==this.bind.text)return;const e=this.bind.points.getDimensions(),i=this.bind.text.getDimensions(),n=this.bind.text.textIsSDF(),r=Math.min(e.items,i.items),s=Math.min(e.width,i.width),o=Math.min(e.height,i.height),a=Math.min(e.depth,i.depth);let l=this.bind.points.sourceShader(this._shaders.shader());l=this._helpers.position.pipeline(l);const h=this.bind.text.sourceShader(this._shaders.shader()),u=this._shaders.shader().pipe("label.map");u.pipe(this.bind.text.textShader(this._shaders.shader()));const c={spriteDepth:this.node.attributes["attach.depth"],spriteOffset:this.node.attributes["attach.offset"],spriteSnap:this.node.attributes["attach.snap"],spriteScale:this._attributes.make(this._types.number()),outlineStep:this._attributes.make(this._types.number()),outlineExpand:this._attributes.make(this._types.number()),outlineColor:this.node.attributes["label.background"]};this.spriteScale=c.spriteScale,this.outlineStep=c.outlineStep,this.outlineExpand=c.outlineExpand;const p=n?"label.outline":"label.alpha",d=this._shaders.shader().pipe(p,c);this.bind.colors&&(t=this._shaders.shader(),this.bind.colors.sourceShader(t));const f=this._helpers.object.mask(),m=this._helpers.style.uniforms(),g=this._inherit("unit").getUnitUniforms(),v=Me(g,m,c);return this.sprite=this._renderables.make("sprite",{uniforms:v,width:s,height:o,depth:a,items:r,position:l,sprite:h,map:u,combine:d,color:t,mask:f,linear:!0}),this._helpers.visible.make(),this._helpers.object.make([this.sprite])}unmake(){return this._helpers.bind.unmake(),this._helpers.visible.unmake(),this._helpers.object.unmake(),this.sprite=null}resize(){const t=this.bind.points.getActiveDimensions(),e=this.bind.text.getActiveDimensions(),i=Math.min(t.items,e.items),n=Math.min(t.width,e.width),r=Math.min(t.height,e.height),s=Math.min(t.depth,e.depth);return this.sprite.geometry.clip(n,r,s,i)}change(t,e,i){if(e.geometry||t["label.text"])return this.rebuild();if(null==this.bind.points)return;const{size:n}=this.props,{outline:r}=this.props,{expand:s}=this.props,o=n/this.bind.text.textHeight();return this.outlineExpand.value=s/o*16/255,this.outlineStep.value=r/o*16/255,this.spriteScale.value=o}}$e.initClass();class He extends Ue{static initClass(){this.traits=["node","bind","operator","source","index","resample","sampler:x","sampler:y","sampler:z","sampler:w","include"]}indexShader(t){return t.pipe(this.indexer),super.indexShader(t)}sourceShader(t){return t.pipe(this.operator)}getDimensions(){return this._resample(this.bind.source.getDimensions())}getActiveDimensions(){return this._resample(this.bind.source.getActiveDimensions())}getFutureDimensions(){return this._resample(this.bind.source.getFutureDimensions())}getIndexDimensions(){return this._resample(this.bind.source.getIndexDimensions())}_resample(t){const e=this.resampled,i=this.centered,n=this.padding;return this.relativeSize?(i.items||t.items--,i.width||t.width--,i.height||t.height--,i.depth||t.depth--,null!=e.items&&(t.items*=e.items),null!=e.width&&(t.width*=e.width),null!=e.height&&(t.height*=e.height),null!=e.depth&&(t.depth*=e.depth),i.items||t.items++,i.width||t.width++,i.height||t.height++,i.depth||t.depth++,t.items-=2*n.items,t.width-=2*n.width,t.height-=2*n.height,t.depth-=2*n.depth):(null!=e.items&&(t.items=e.items),null!=e.width&&(t.width=e.width),null!=e.height&&(t.height=e.height),null!=e.depth&&(t.depth=e.depth)),t.items=Math.max(0,Math.floor(t.items)),t.width=Math.max(0,Math.floor(t.width)),t.height=Math.max(0,Math.floor(t.height)),t.depth=Math.max(0,Math.floor(t.depth)),t}make(){if(super.make(),null==this.bind.source)return;this._helpers.bind.make([{to:"include.shader",trait:"shader",optional:!0}]);const{indices:t,channels:e}=this.props,{shader:i}=this.bind,{sample:n,size:r,items:s,width:o,height:a,depth:l}=this.props,h=n===this.node.attributes["resample.sample"].enum.relative,u=r===this.node.attributes["resample.size"].enum.relative;this.resampled={},null!=s&&(this.resampled.items=s),null!=o&&(this.resampled.width=o),null!=a&&(this.resampled.height=a),null!=l&&(this.resampled.depth=l),this.centered={},this.centered.items=this.props.centeredW,this.centered.width=this.props.centeredX,this.centered.height=this.props.centeredY,this.centered.depth=this.props.centeredZ,this.padding={},this.padding.items=this.props.paddingW,this.padding.width=this.props.paddingX,this.padding.height=this.props.paddingY,this.padding.depth=this.props.paddingZ;const c=this._shaders.shader(),p=this._shaders.shader(),d=[null,this._types.number,this._types.vec2,this._types.vec3,this._types.vec4][t],f={dataSize:this._attributes.make(d(0,0,0,0)),dataResolution:this._attributes.make(d(0,0,0,0)),targetSize:this._attributes.make(d(0,0,0,0)),targetResolution:this._attributes.make(d(0,0,0,0)),resampleFactor:this._attributes.make(this._types.vec4(0,0,0,0)),resampleBias:this._attributes.make(this._types.vec4(0,0,0,0))};this.dataResolution=f.dataResolution,this.dataSize=f.dataSize,this.targetResolution=f.targetResolution,this.targetSize=f.targetSize,this.resampleFactor=f.resampleFactor,this.resampleBias=f.resampleBias;const m=null!=s||null!=o||null!=a||null!=l;c.pipe("resample.padding",f);let g=[],v=!1;const y=["width","height","depth","items"];for(let t=0;t<y.length;t++){const e=y[t],i=this.centered[e];v||(v=i),g[t]=i?"0.5":"0.0"}return v&&(g=`vec4(${g})`,c.pipe(Jt(4,"+",g)),m&&p.pipe(Jt(4,"+",g))),h&&(m?(c.pipe("resample.relative",f),p.pipe("resample.relative",f)):p.pipe(re("vec4"))),null!=i?(4!==t&&c.pipe(te(4,t)),c.callback(),4!==t&&c.pipe(Kt(t,4)),v&&c.pipe(Jt(4,"-",g)),c.pipe(this.bind.source.sourceShader(this._shaders.shader())),4!==e&&c.pipe(te(4,e)),c.join(),null!=this.bind.shader&&c.pipe(this.bind.shader.shaderBind(f)),4!==e&&c.pipe(Kt(e,4))):(v&&c.pipe(Jt(4,"-",g)),c.pipe(this.bind.source.sourceShader(this._shaders.shader()))),v&&m&&p.pipe(Jt(4,"-",g)),this.operator=c,this.indexer=p,this.indices=t,this.relativeSample=h,this.relativeSize=u}unmake(){return super.unmake(),this.operator=null}resize(){if(null==this.bind.source)return;const t=this.bind.source.getActiveDimensions(),e=this.getActiveDimensions(),i=i=>{const n=this.centered[i],r=this.padding[i];e[i]+=2*r;return[n?t[i]/Math.max(1,e[i]):Math.max(1,t[i]-1)/Math.max(1,e[i]-1),r]},[n,r]=Array.from(i("width")),[s,o]=Array.from(i("height")),[a,l]=Array.from(i("depth")),[h,u]=Array.from(i("items"));return 1===this.indices?(this.dataResolution.value=1/t.width,this.targetResolution.value=1/e.width,this.dataSize.value=t.width,this.targetSize.value=e.width):(this.dataResolution.value.set(1/t.width,1/t.height,1/t.depth,1/t.items),this.targetResolution.value.set(1/e.width,1/e.height,1/e.depth,1/e.items),this.dataSize.value.set(t.width,t.height,t.depth,t.items),this.targetSize.value.set(e.width,e.height,e.depth,e.items)),this.resampleFactor.value.set(n,s,a,h),this.resampleBias.value.set(r,o,l,u),super.resize()}change(t,e,i){if(e.operator||e.resample||e.sampler||e.include)return this.rebuild()}}He.initClass();class We extends He{static initClass(){this.traits=["node","bind","operator","resample","sampler:x","sampler:y","sampler:z","sampler:w","include","text"]}init(){return this.sourceSpec=[{to:"operator.source",trait:"text"}]}textShader(t){return this.bind.source.textShader(t)}textIsSDF(){return(null!=this.bind.source?this.bind.source.props.sdf:void 0)>0}textHeight(){return null!=this.bind.source?this.bind.source.props.detail:void 0}}We.initClass();class Xe extends Mt{static initClass(){this.traits=["node","clock","seek","play"]}init(){return this.skew=0,this.last=0,this.time={now:+new Date/1e3,time:0,delta:0,clock:0,step:0}}make(){return this._listen("clock","clock.tick",this.tick)}reset(){return this.skew=0}tick(t){const{from:e,to:i,speed:n,seek:r,pace:s,delay:o,realtime:a}=this.props,l=this._inherit("clock").getTime(),h=a?l.time:l.clock,u=a?l.delta:l.step,c=n/s;this.skew+=u*(c-1),this.last>h&&(this.skew=0),this.time.now=l.now+this.skew,this.time.time=l.time,this.time.delta=l.delta;const p=null!=r?r:l.clock+this.skew;return this.time.clock=Math.min(i,e+Math.max(0,p-o*c)),this.time.step=u*c,this.last=h,this.trigger(t)}getTime(){return this.time}}Xe.initClass();class Ge extends Mt{static initClass(){this.traits=["node","clock","now"]}init(){let t;return this.now=t=+new Date/1e3,this.skew=0,this.time={now:t,time:0,delta:0,clock:0,step:0}}make(){return this.clockParent=this._inherit("clock"),this._listen("clock","clock.tick",this.tick)}unmake(){return this.clockParent=null}change(t,e,i){if(t["date.now"])return this.skew=0}tick(t){const{seek:e,pace:i,speed:n}=this.props,r=this.clockParent.getTime();return this.skew+=r.step*i/n,null!=e&&(this.skew=e),this.time.now=this.time.time=this.time.clock=(null!=this.props.now?this.props.now:this.now)+this.skew,this.time.delta=this.time.step=r.delta,this.trigger(t)}getTime(){return this.time}}Ge.initClass();class Ye extends Mt{static initClass(){this.traits=["node","vertex","fragment"]}vertex(t,e){let i;return null!=(i=Ze(this._inherit("vertex"),(i=>i.vertex(t,e))))?i:t}fragment(t,e){let i;return null!=(i=Ze(this._inherit("fragment"),(i=>i.fragment(t,e))))?i:t}}function Ze(t,e){return null!=t?e(t):void 0}Ye.initClass();class Qe extends Ye{static initClass(){this.traits=["node","vertex","transform3"]}make(){return this.uniforms={transformMatrix:this._attributes.make(this._types.mat4())},this.composer=jt()}unmake(){return delete this.uniforms}change(t,e,i){if(t["transform3.pass"])return this.rebuild();if(!e.transform3&&!i)return;const n=this.props.position,r=this.props.quaternion,s=this.props.rotation,o=this.props.scale,a=this.props.matrix,l=this.props.eulerOrder;return this.uniforms.transformMatrix.value=this.composer(n,s,r,o,a,l)}vertex(t,e){return e===this.props.pass&&t.pipe("transform3.position",this.uniforms),super.vertex(t,e)}}Qe.initClass();class Je extends Ye{static initClass(){this.traits=["node","vertex","transform4"]}make(){return this.uniforms={transformMatrix:this._attributes.make(this._types.mat4()),transformOffset:this.node.attributes["transform4.position"]},this.transformMatrix=this.uniforms.transformMatrix.value}unmake(){return delete this.uniforms}change(t,e,i){if(t["transform4.pass"])return this.rebuild();if(!e.transform4&&!i)return;const n=this.props.scale,r=this.props.matrix,s=this.transformMatrix;return s.copy(r),s.scale(n)}vertex(t,e){return e===this.props.pass&&t.pipe("transform4.position",this.uniforms),super.vertex(t,e)}}Je.initClass();class Ke extends Ye{static initClass(){this.traits=["node","include","vertex","bind"]}make(){return this._helpers.bind.make([{to:"include.shader",trait:"shader",optional:!0}])}unmake(){return this._helpers.bind.unmake()}change(t,e,i){if(e.include)return this.rebuild()}vertex(t,e){return null!=this.bind.shader&&e===this.props.pass&&t.pipe(this.bind.shader.shaderBind()),super.vertex(t,e)}}Ke.initClass();class ti extends Ye{static initClass(){this.traits=["node","include","fragment","bind"]}make(){return this._helpers.bind.make([{to:"include.shader",trait:"shader",optional:!0}])}unmake(){return this._helpers.bind.unmake()}change(t,e,i){if(e.include||t["fragment.gamma"])return this.rebuild()}fragment(t,e){return null!=this.bind.shader&&e===this.props.pass&&(this.props.gamma&&t.pipe("mesh.gamma.out"),t.pipe(this.bind.shader.shaderBind()),t.split(),this.props.gamma&&t.pipe("mesh.gamma.in"),t.pass()),super.fragment(t,e)}}ti.initClass();class ei extends Ye{static initClass(){this.traits=["node","vertex","layer"]}make(){return this._listen("root","root.resize",this.update),this.uniforms={layerScale:this._attributes.make(this._types.vec4()),layerBias:this._attributes.make(this._types.vec4())}}update(){const t=this._inherit("root").getCamera(),e=null!=t.aspect?t.aspect:1,i=null!=t.fov?t.fov:1,n=Math.tan(i*Math.PI/360),r=this.node.attributes["layer.fit"].enum;let{fit:s}=this.props;const{depth:o}=this.props;switch(s){case r.contain:s=e>1?r.y:r.x;break;case r.cover:s=e>1?r.x:r.y}switch(s){case r.x:this.uniforms.layerScale.value.set(n*e,n*e,1,1);break;case r.y:this.uniforms.layerScale.value.set(n,n,1,1)}return this.uniforms.layerBias.value.set(0,0,-o,0)}change(t,e,i){if(t["layer.fit"]||t["layer.depth"]||i)return this.update()}vertex(t,e){return 2===e?t.pipe("layer.position",this.uniforms):3===e?t.pipe("root.position"):t}}ei.initClass();class ii extends Mt{static initClass(){this.traits=["node","include","mask","bind"]}make(){return this._helpers.bind.make([{to:"include.shader",trait:"shader",optional:!0}])}unmake(){return this._helpers.bind.unmake()}change(t,e,i){if(e.include)return this.rebuild()}mask(t){let e,i;return null!=this.bind.shader?t?(i=this._shaders.shader(),i.pipe(re("vec4")),i.fan(),i.pipe(t),i.next(),i.pipe(this.bind.shader.shaderBind()),i.end(),i.pipe("float combine(float a, float b) { return min(a, b); }")):(i=this._shaders.shader(),i.pipe(this.bind.shader.shaderBind())):i=t,null!=(n=this._inherit("mask"),r=t=>t.mask(i),e=null!=n?r(n):void 0)?e:i;var n,r}}ii.initClass();class ni extends Ue{static initClass(){this.traits=["node","bind","operator","source","index","clamp"]}indexShader(t){return t.pipe(this.operator),super.indexShader(t)}sourceShader(t){return t.pipe(this.operator),super.sourceShader(t)}make(){if(super.make(),null==this.bind.source)return;const t={clampLimit:this._attributes.make(this._types.vec4())};this.clampLimit=t.clampLimit;const e=this._shaders.shader();return e.pipe("clamp.position",t),this.operator=e}unmake(){return super.unmake()}resize(){if(null!=this.bind.source){const t=this.bind.source.getActiveDimensions();this.clampLimit.value.set(t.width-1,t.height-1,t.depth-1,t.items-1)}return super.resize()}change(t,e,i){if(e.operator||e.clamp)return this.rebuild()}}ni.initClass();class ri extends Ue{static initClass(){this.traits=["node","bind","operator","source","index","grow"]}sourceShader(t){return t.pipe(this.operator)}make(){if(super.make(),null==this.bind.source)return;const t={growScale:this.node.attributes["grow.scale"],growMask:this._attributes.make(this._types.vec4()),growAnchor:this._attributes.make(this._types.vec4())};this.growMask=t.growMask.value,this.growAnchor=t.growAnchor.value;const e=this._shaders.shader();return e.require(this.bind.source.sourceShader(this._shaders.shader())),e.pipe("grow.position",t),this.operator=e}unmake(){return super.unmake()}resize(){return this.update(),super.resize()}update(){const t=this.bind.source.getFutureDimensions(),e=["width","height","depth","items"],i=(t,e)=>((t||1)-1)*(.5-.5*e);return(()=>{const n=[];for(let r=0;r<e.length;r++){const s=e[r],o=this.props[s];this.growMask.setComponent(r,+(null==o)),n.push(this.growAnchor.setComponent(r,null!=o?i(t[s],o):0))}return n})()}change(t,e,i){return e.operator?this.rebuild():e.grow?this.update():void 0}}ri.initClass();class si extends Ue{static initClass(){this.traits=["node","bind","operator","source","index","join"]}indexShader(t){return t.pipe(this.operator),super.indexShader(t)}sourceShader(t){return t.pipe(this.operator),super.sourceShader(t)}getDimensions(){return this._resample(this.bind.source.getDimensions())}getActiveDimensions(){return this._resample(this.bind.source.getActiveDimensions())}getFutureDimensions(){return this._resample(this.bind.source.getFutureDimensions())}getIndexDimensions(){return this._resample(this.bind.source.getIndexDimensions())}_resample(t){let e,i;const{order:n,axis:r,stride:s}=this,o=["width","height","depth","items"],a=n.map((t=>o[t-1])),l=n.indexOf(r);let h=(()=>{const e=[];for(i of Array.from(a))e.push(t[i]);return e})();const u=(null!=(e=h[l+1])?e:1)*s;h.splice(l,2,u),h=h.slice(0,3),h.push(1);const c={};for(let t=0;t<a.length;t++)i=a[t],c[i]=h[t];return c}make(){if(super.make(),null==this.bind.source)return;const{order:t}=this.props;let{axis:e}=this.props,{overlap:i}=this.props;const n=t.join("");null==e&&(e=t[0]);const r=n.indexOf(e),s=n.replace(e,"00").substring(0,4),o=[null,"width","height","depth","items"][e],a=this.bind.source.getDimensions()[o];i=Math.min(a-1,i);const l=a-i,h={joinStride:this._attributes.make(this._types.number(l)),joinStrideInv:this._attributes.make(this._types.number(1/l))},u=this._shaders.shader();return u.require(ie(e,1)),u.require(ie(s,4)),u.require(ee([r,r+1])),u.pipe("join.position",h),u.pipe(ne(t)),this.operator=u,this.order=t,this.axis=e,this.overlap=i,this.length=a,this.stride=l}unmake(){return super.unmake()}change(t,e,i){if(e.join||e.operator)return this.rebuild()}}si.initClass();class oi extends Ue{static initClass(){this.traits=["node","bind","operator","source","index","lerp","sampler:x","sampler:y","sampler:z","sampler:w"]}indexShader(t){return t.pipe(this.indexer),super.indexShader(t)}sourceShader(t){return t.pipe(this.operator)}getDimensions(){return this._resample(this.bind.source.getDimensions())}getActiveDimensions(){return this._resample(this.bind.source.getActiveDimensions())}getFutureDimensions(){return this._resample(this.bind.source.getFutureDimensions())}getIndexDimensions(){return this._resample(this.bind.source.getIndexDimensions())}_resample(t){const e=this.resampled,i=this.centered,n=this.padding;return this.relativeSize?(i.items||t.items--,i.width||t.width--,i.height||t.height--,i.depth||t.depth--,null!=e.items&&(t.items*=e.items),null!=e.width&&(t.width*=e.width),null!=e.height&&(t.height*=e.height),null!=e.depth&&(t.depth*=e.depth),i.items||t.items++,i.width||t.width++,i.height||t.height++,i.depth||t.depth++,t.items-=2*n.items,t.width-=2*n.width,t.height-=2*n.height,t.depth-=2*n.depth):(null!=e.items&&(t.items=e.items),null!=e.width&&(t.width=e.width),null!=e.height&&(t.height=e.height),null!=e.depth&&(t.depth=e.depth)),t.items=Math.max(0,Math.floor(t.items)),t.width=Math.max(0,Math.floor(t.width)),t.height=Math.max(0,Math.floor(t.height)),t.depth=Math.max(0,Math.floor(t.depth)),t}make(){let t,e;if(super.make(),null==this.bind.source)return;const{size:i,items:n,width:r,height:s,depth:o}=this.props,a=i===this.node.attributes["lerp.size"].enum.relative;this.resampled={},null!=n&&(this.resampled.items=n),null!=r&&(this.resampled.width=r),null!=s&&(this.resampled.height=s),null!=o&&(this.resampled.depth=o),this.centered={},this.centered.items=this.props.centeredW,this.centered.width=this.props.centeredX,this.centered.height=this.props.centeredY,this.centered.depth=this.props.centeredZ,this.padding={},this.padding.items=this.props.paddingW,this.padding.width=this.props.paddingX,this.padding.height=this.props.paddingY,this.padding.depth=this.props.paddingZ;const l=this._shaders.shader(),h=this._shaders.shader(),u={resampleFactor:this._attributes.make(this._types.vec4(0,0,0,0)),resampleBias:this._attributes.make(this._types.vec4(0,0,0,0))};this.resampleFactor=u.resampleFactor,this.resampleBias=u.resampleBias;const c=null!=n||null!=r||null!=s||null!=o;l.pipe("resample.padding",u);const p=[];let d=!1;const f=["width","height","depth","items"];for(t=0;t<f.length;t++){e=f[t];const i=this.centered[e];d||(d=i),p[t]=i?"0.5":"0.0"}let m;d&&c&&(m=`vec4(${p})`,l.pipe(Jt(4,"+",m)),h.pipe(Jt(4,"+",m))),c?(l.pipe("resample.relative",u),h.pipe("resample.relative",u)):(l.pipe(re("vec4")),h.pipe(re("vec4"))),d&&c&&(l.pipe(Jt(4,"-",m)),h.pipe(Jt(4,"-",m)));let g=this.bind.source.sourceShader(this._shaders.shader());const v=["width","height","depth","items"];for(t=0;t<v.length;t++){e=v[t];const i=`lerp.${e}`;null!=this.props[e]&&(g=this._shaders.shader().require(g),g.pipe(i,u))}return l.pipe(g),this.operator=l,this.indexer=h,this.relativeSize=a}unmake(){return super.unmake(),this.operator=null}resize(){if(null==this.bind.source)return;const t=this.bind.source.getActiveDimensions(),e=this.getActiveDimensions(),i=i=>{const n=this.centered[i],r=this.padding[i];e[i]+=2*r;return[n?t[i]/Math.max(1,e[i]):Math.max(1,t[i]-1)/Math.max(1,e[i]-1),r]},[n,r]=Array.from(i("width")),[s,o]=Array.from(i("height")),[a,l]=Array.from(i("depth")),[h,u]=Array.from(i("items"));return this.resampleFactor.value.set(n,s,a,h),this.resampleBias.value.set(r,o,l,u),super.resize()}change(t,e,i){if(e.operator||e.lerp||e.sampler)return this.rebuild()}}oi.initClass();class ai extends Ue{static initClass(){this.traits=["node","bind","active","operator","source","index","texture","memo"]}sourceShader(t){return this.memo.shaderAbsolute(t,1)}make(){if(super.make(),null==this.bind.source)return;this._helpers.active.make(),this._listen("root","root.update",(()=>{if(this.isActive)return this.update()}));const{minFilter:t,magFilter:e,type:i}=this.props,n=this.bind.source.getDimensions(),{items:r,width:s,height:o,depth:a}=n;this.memo=this._renderables.make("memo",{items:r,width:s,height:o,depth:a,minFilter:t,magFilter:e,type:i});const l=this._shaders.shader();return this.bind.source.sourceShader(l),this.compose=this._renderables.make("memoScreen",{map:l,items:r,width:s,height:o,depth:a}),this.memo.adopt(this.compose),this.objects=[this.compose],this.renders=this.compose.renders}unmake(){this._helpers.active.unmake(),null!=this.bind.source&&(this.memo.unadopt(this.compose),this.memo.dispose(),this.memo=this.compose=null,super.unmake())}update(){return null!=this.memo?this.memo.render():void 0}resize(){if(null==this.bind.source)return;const t=this.bind.source.getActiveDimensions(),{width:e,height:i,depth:n}=t;return this.compose.cover(e,i,n),super.resize()}change(t,e,i){if(e.texture||e.operator)return this.rebuild()}}ai.initClass();class li extends St{static initClass(){this.traits=["node","bind","operator","readback","entity","active"],this.finals={channels:4}}init(){return this.emitter=this.root=null,this.active={}}make(){if(super.make(),this._compute("readback.data",(()=>null!=this.readback?this.readback.data:void 0)),this._compute("readback.items",(()=>null!=this.readback?this.readback.items:void 0)),this._compute("readback.width",(()=>null!=this.readback?this.readback.width:void 0)),this._compute("readback.height",(()=>null!=this.readback?this.readback.height:void 0)),this._compute("readback.depth",(()=>null!=this.readback?this.readback.depth:void 0)),this._helpers.bind.make([{to:"operator.source",trait:"source"}]),null==this.bind.source)return;const{type:t,channels:e,expr:i}=this.props;this.root=this._inherit("root"),this._listen("root","root.update",this.update);const{items:n,width:r,height:s,depth:o}=this.bind.source.getDimensions(),a=this.bind.source.sourceShader(this._shaders.shader());this.readback=this._renderables.make("readback",{map:a,items:n,width:r,height:s,depth:o,channels:e,type:t}),null!=i&&this.readback.setCallback(i),this._helpers.active.make()}unmake(){return null!=this.readback&&(this.readback.dispose(),this.readback=null,this.root=null,this.emitter=null,this.active={}),this._helpers.active.unmake(),this._helpers.bind.unmake()}update(){null!=this.readback&&this.isActive&&(this.readback.update(null!=this.root?this.root.getCamera():void 0),this.readback.post(),null!=this.props.expr&&this.readback.iterate())}resize(){let t,e;if(null==this.readback)return;const{items:i,width:n,height:r,depth:s}=this.bind.source.getActiveDimensions();return this.readback.setActive(i,n,r,s),this.strideI=t=i,this.strideJ=e=t*n,this.strideK=e*r}change(t,e,i){return t["readback.type"]?this.rebuild():t["readback.expr"]&&this.readback?this.readback.setCallback(this.props.expr):void 0}}li.initClass();class hi extends Ue{static initClass(){this.traits=["node","bind","operator","source","index","repeat"]}indexShader(t){return t.pipe(this.operator),super.indexShader(t)}sourceShader(t){return t.pipe(this.operator),super.sourceShader(t)}getDimensions(){return this._resample(this.bind.source.getDimensions())}getActiveDimensions(){return this._resample(this.bind.source.getActiveDimensions())}getFutureDimensions(){return this._resample(this.bind.source.getFutureDimensions())}getIndexDimensions(){return this._resample(this.bind.source.getIndexDimensions())}_resample(t){const e=this.resample;return{items:e.items*t.items,width:e.width*t.width,height:e.height*t.height,depth:e.depth*t.depth}}make(){if(super.make(),null==this.bind.source)return;this.resample={};const t={repeatModulus:this._attributes.make(this._types.vec4())};this.repeatModulus=t.repeatModulus;const e=this._shaders.shader();return e.pipe("repeat.position",t),this.operator=e}unmake(){return super.unmake()}resize(){if(null!=this.bind.source){const t=this.bind.source.getActiveDimensions();this.repeatModulus.value.set(t.width,t.height,t.depth,t.items)}return super.resize()}change(t,e,i){return e.operator||e.repeat?this.rebuild():i?["items","width","height","depth"].map((t=>this.resample[t]=this.props[t])):void 0}}hi.initClass();class ui extends Ue{static initClass(){this.traits=["node","bind","operator","source","index","reverse"]}getDimensions(){return this.bind.source.getDimensions()}getActiveDimensions(){return this.bind.source.getActiveDimensions()}getFutureDimensions(){return this.bind.source.getFutureDimensions()}getIndexDimensions(){return this.bind.source.getIndexDimensions()}sourceShader(t){return t.pipe("reverse.position",this.uniforms),this.bind.source.sourceShader(t)}_resolveScale(t,e){return this.props[t]?-1:1}_resolveOffset(t,e){const i=this.props[t],n=e[t];return i?n-1:0}make(){if(super.make(),null!=this.bind.source)return this.uniforms={reverseScale:this._attributes.make(this._types.vec4()),reverseOffset:this._attributes.make(this._types.vec4())}}unmake(){return super.unmake()}resize(){if(null==this.bind.source)return;const t=this.bind.source.getActiveDimensions();return this.uniforms.reverseScale.value.set(this._resolveScale("width",t),this._resolveScale("height",t),this._resolveScale("depth",t),this._resolveScale("items",t)),this.uniforms.reverseOffset.value.set(this._resolveOffset("width",t),this._resolveOffset("height",t),this._resolveOffset("depth",t),this._resolveOffset("items",t)),super.resize()}change(t,e,i){return e.operator?this.rebuild():e.reverse?this.resize():void 0}}ui.initClass();class ci extends Ue{static initClass(){this.traits=["node","bind","operator","source","index","swizzle"]}sourceShader(t){return t=super.sourceShader(t),this.swizzler&&t.pipe(this.swizzler),t}make(){if(super.make(),null==this.bind.source)return;const{order:t}=this.props;return"1234"!==t.join()?this.swizzler=ie(t,4):void 0}unmake(){return super.unmake(),this.swizzler=null}change(t,e,i){if(e.swizzle||e.operator)return this.rebuild()}}ci.initClass();class pi extends Ue{static initClass(){this.traits=["node","bind","operator","source","index","spread"]}sourceShader(t){return t.pipe(this.operator)}make(){if(super.make(),null==this.bind.source)return;const t={spreadMatrix:this._attributes.make(this._types.mat4()),spreadOffset:this._attributes.make(this._types.vec4())};this.spreadMatrix=t.spreadMatrix,this.spreadOffset=t.spreadOffset;const e=this._shaders.shader();return e.require(this.bind.source.sourceShader(this._shaders.shader())),e.pipe("spread.position",t),this.operator=e}unmake(){return super.unmake()}resize(){return this.update(),super.resize()}update(){let t,e,i,n;const r=this.bind.source.getFutureDimensions(),s=this.spreadMatrix.value.elements,o=["width","height","depth","items"],a=["alignWidth","alignHeight","alignDepth","alignItems"],{unit:l}=this.props,h=this.node.attributes["spread.unit"].enum,u=(()=>{switch(l){case h.relative:return(t,e,i,n)=>s[4*e+i]=n/Math.max(1,r[t]-1);case h.absolute:return(t,e,i,n)=>s[4*e+i]=n}})();return(()=>{const l=[];for(e=0;e<o.length;e++){let h;t=o[e];const c=this.props[t],p=this.props[a[e]];if(null!=c){h=-((null!=r[t]?r[t]:1)-1)*(.5-.5*p)}else h=0;this.spreadOffset.value.setComponent(e,h),l.push((()=>{const r=[];for(i=0;i<=3;i++){let o;n=null!=(o=null!=c?c.getComponent(i):void 0)?o:0,r.push(s[4*e+i]=u(t,e,i,n))}return r})())}return l})()}change(t,e,i){return e.operator?this.rebuild():e.spread?this.update():void 0}}pi.initClass();class di extends Ue{static initClass(){this.traits=["node","bind","operator","source","index","split"]}indexShader(t){return t.pipe(this.operator),super.indexShader(t)}sourceShader(t){return t.pipe(this.operator),super.sourceShader(t)}getDimensions(){return this._resample(this.bind.source.getDimensions())}getActiveDimensions(){return this._resample(this.bind.source.getActiveDimensions())}getFutureDimensions(){return this._resample(this.bind.source.getFutureDimensions())}getIndexDimensions(){return this._resample(this.bind.source.getIndexDimensions())}_resample(t){let e;const{order:i}=this,{axis:n}=this,{overlap:r}=this,{length:s}=this,{stride:o}=this,a=["width","height","depth","items"],l=i.map((t=>a[t-1])),h=i.indexOf(n);let u=(()=>{const i=[];for(e of Array.from(l))i.push(t[e]);return i})();const c=Math.floor((u[h]-r)/o);u.splice(h,1,s,c),u=u.slice(0,4);const p={};for(let t=0;t<l.length;t++)e=l[t],p[e]=u[t];return p}make(){let t;if(super.make(),null==this.bind.source)return;const{order:e}=this.props;let{axis:i}=this.props,{overlap:n}=this.props;const{length:r}=this.props,s=e.join("");null==i&&(i=e[0]);const o=s.indexOf(i),a=s[o]+(null!=(t=s[o+1])?t:0),l=s.replace(a[1],"").replace(a[0],"0")+"0";n=Math.min(r-1,n);const h=r-n,u={splitStride:this._attributes.make(this._types.number(h))},c=this._shaders.shader();return c.require(ie(a,2)),c.require(ie(l,4)),c.require(ee(o)),c.pipe("split.position",u),c.pipe(ne(e)),this.operator=c,this.order=e,this.axis=i,this.overlap=n,this.length=r,this.stride=h}unmake(){return super.unmake()}change(t,e,i){if(t["split.axis"]||t["split.order"]||e.operator)return this.rebuild()}}di.initClass();class fi extends Ue{static initClass(){this.traits=["node","bind","operator","source","index","slice"]}getDimensions(){return this._resample(this.bind.source.getDimensions())}getActiveDimensions(){return this._resample(this.bind.source.getActiveDimensions())}getFutureDimensions(){return this._resample(this.bind.source.getFutureDimensions())}getIndexDimensions(){return this._resample(this.bind.source.getIndexDimensions())}sourceShader(t){return t.pipe("slice.position",this.uniforms),this.bind.source.sourceShader(t)}_resolve(t,e){const i=this.props[t],n=e[t];if(null==i)return[0,n];const r=function(t,e){return t<0?e+t:t},s=r(Math.round(i.x),n);let o=r(Math.round(i.y),n);return o=Math.max(s,o),[s,o-s]}_resample(t){return t.width=this._resolve("width",t)[1],t.height=this._resolve("height",t)[1],t.depth=this._resolve("depth",t)[1],t.items=this._resolve("items",t)[1],t}make(){if(super.make(),null!=this.bind.source)return this.uniforms={sliceOffset:this._attributes.make(this._types.vec4())}}unmake(){return super.unmake()}resize(){if(null==this.bind.source)return;const t=this.bind.source.getActiveDimensions();return this.uniforms.sliceOffset.value.set(this._resolve("width",t)[0],this._resolve("height",t)[0],this._resolve("depth",t)[0],this._resolve("items",t)[0]),super.resize()}change(t,e,i){return e.operator?this.rebuild():e.slice?this.resize():void 0}}fi.initClass();class mi extends Ue{static initClass(){this.traits=["node","bind","operator","source","index","subdivide"]}indexShader(t){return t.pipe(this.indexer),super.indexShader(t)}sourceShader(t){return t.pipe(this.operator)}getDimensions(){return this._resample(this.bind.source.getDimensions())}getActiveDimensions(){return this._resample(this.bind.source.getActiveDimensions())}getFutureDimensions(){return this._resample(this.bind.source.getFutureDimensions())}getIndexDimensions(){return this._resample(this.bind.source.getIndexDimensions())}_resample(t){const e=this.resampled;return t.items--,t.width--,t.height--,t.depth--,null!=e.items&&(t.items*=e.items),null!=e.width&&(t.width*=e.width),null!=e.height&&(t.height*=e.height),null!=e.depth&&(t.depth*=e.depth),t.items++,t.width++,t.height++,t.depth++,t}make(){if(super.make(),null==this.bind.source)return;let{lerp:t}=this.props;const{items:e,width:i,height:n,depth:r}=this.props;this.resampled={},null!=e&&(this.resampled.items=e),null!=i&&(this.resampled.width=i),null!=n&&(this.resampled.height=n),null!=r&&(this.resampled.depth=r);const s=this._shaders.shader(),o=this._shaders.shader(),a={resampleFactor:this._attributes.make(this._types.vec4(0,0,0,0)),subdivideBevel:this.node.attributes["subdivide.bevel"]};this.resampleFactor=a.resampleFactor,this.resampleBias=a.resampleBias;null!=e||null!=i||null!=n||null!=r?(s.pipe("resample.relative",a),o.pipe("resample.relative",a)):(s.pipe(re("vec4")),o.pipe(re("vec4")));let l=this.bind.source.sourceShader(this._shaders.shader());t=t?".lerp":"";const h=["width","height","depth","items"];for(let e=0;e<h.length;e++){const i=h[e],n=`subdivide.${i}${t}`;null!=this.props[i]&&(l=this._shaders.shader().require(l),l.pipe(n,a))}return s.pipe(l),this.operator=s,this.indexer=o}unmake(){return super.unmake(),this.operator=null}resize(){if(null==this.bind.source)return;const t=this.bind.source.getActiveDimensions(),e=this.getActiveDimensions(),i=i=>Math.max(1,t[i]-1)/Math.max(1,e[i]-1),n=i("width"),r=i("height"),s=i("depth"),o=i("items");return this.resampleFactor.value.set(n,r,s,o),super.resize()}change(t,e,i){if(e.operator||e.subdivide)return this.rebuild()}}mi.initClass();const gi={1:"width",2:"height",3:"depth",4:"items"};class vi extends Ue{static initClass(){this.traits=["node","bind","operator","source","index","transpose"]}indexShader(t){return this.swizzler&&t.pipe(this.swizzler),super.indexShader(t)}sourceShader(t){return this.swizzler&&t.pipe(this.swizzler),super.sourceShader(t)}getDimensions(){return this._remap(this.transpose,this.bind.source.getDimensions())}getActiveDimensions(){return this._remap(this.transpose,this.bind.source.getActiveDimensions())}getFutureDimensions(){return this._remap(this.transpose,this.bind.source.getFutureDimensions())}getIndexDimensions(){return this._remap(this.transpose,this.bind.source.getIndexDimensions())}_remap(t,e){const i={};for(let n=0;n<=3;n++){const r=gi[n+1],s=gi[t[n]];i[r]=null!=e[s]?e[s]:1}return i}make(){if(super.make(),null==this.bind.source)return;const{order:t}=this.props;return"1234"!==t.join()&&(this.swizzler=ne(t)),this.transpose=t,this.trigger({type:"source.rebuild"})}unmake(){return super.unmake(),this.swizzler=null}change(t,e,i){if(e.transpose||e.operator)return this.rebuild()}}vi.initClass();class yi extends Mt{static initClass(){this.traits=["node","transition","transform","mask","visible","active"]}init(){return this.animate=null,this.uniforms=null,this.state={isVisible:!0,isActive:!0,enter:1,exit:1},this.latched=null,this.locked=null}make(){this.uniforms={transitionFrom:this._attributes.make(this._types.vec4()),transitionTo:this._attributes.make(this._types.vec4()),transitionActive:this._attributes.make(this._types.bool()),transitionScale:this._attributes.make(this._types.vec4()),transitionBias:this._attributes.make(this._types.vec4()),transitionEnter:this._attributes.make(this._types.number()),transitionExit:this._attributes.make(this._types.number()),transitionSkew:this._attributes.make(this._types.number())};const t=this._inherit("slide"),e=this._inherit("visible"),i=this._inherit("active");return this._listen(t,"transition.latch",(t=>this.latch(t.step))),this._listen(t,"transition.release",(()=>this.release())),this._listen(e,"visible.change",(()=>this.update(this.state.isVisible=e.isVisible))),this._listen(i,"active.change",(()=>this.update(this.state.isActive=i.isActive))),this.animate=this._animator.make(this._types.vec2(1,1),{step:t=>(this.state.enter=t.x,this.state.exit=t.y,this.update()),complete:t=>this.complete(t)}),this.move=null!=this.props.from||null!=this.props.to}unmake(){return this.animate.dispose()}latch(t){let e;this.locked=null,this.latched=e={isVisible:this.state.isVisible,isActive:this.state.isActive,step:t};if(!this.isVisible){const t=e.step>=0,[i,n]=Array.from(t?[0,1]:[1,0]);return this.animate.set(i,n)}}release(){const{latched:t}=this,{state:e}=this;if(this.latched=null,t.isVisible!==e.isVisible){const i=t.step>=0,n=e.isVisible,[r,s]=Array.from(n?[1,1]:i?[1,0]:[0,1]);let{duration:o,durationEnter:a,durationExit:l}=this.props;null==a&&(a=o),null==l&&(l=o),o=n*a+!n*l;let{delay:h,delayEnter:u,delayExit:c}=this.props;null==u&&(u=h),null==c&&(c=h),h=n*u+!n*c,this.animate.immediate({x:r,y:s},{duration:o,delay:h,ease:"linear"}),this.locked={isVisible:!0,isActive:t.isActive||e.isActive}}return this.update()}complete(t){if(t)return this.locked=null,this.update()}update(){if(null!=this.latched)return;let{enter:t,exit:e}=this.props;null==t&&({enter:t}=this.state),null==e&&({exit:e}=this.state);const i=t*e;let n=i>0;const r=i<1;this.uniforms.transitionEnter.value=t,this.uniforms.transitionExit.value=e,this.uniforms.transitionActive.value=r,n&&(n=!!this.state.isVisible),null!=this.locked&&(n=this.locked.isVisible),this.isVisible!==n&&(this.isVisible=n,this.trigger({type:"visible.change"}));const s=!(!this.state.isActive&&!(null!=this.locked?this.locked.isActive:void 0));return this.isActive!==s?(this.isActive=s,this.trigger({type:"active.change"})):void 0}change(t,e,i){if((t["transition.enter"]||t["transition.exit"]||i)&&this.update(),t["transition.stagger"]||i){const{stagger:t}=this.props,e=t.x<0,i=t.y<0,n=t.z<0,r=t.w<0,s=Math.abs(t.x),o=Math.abs(t.y),a=Math.abs(t.z),l=Math.abs(t.w);return this.uniforms.transitionSkew.value=s+o+a+l,this.uniforms.transitionScale.value.set((1-2*e)*s,(1-2*i)*o,(1-2*n)*a,(1-2*r)*l),this.uniforms.transitionBias.value.set(e*s,i*o,n*a,r*l)}}}yi.initClass();class bi extends yi{static initClass(){this.traits=["node","transition","vertex","move","visible","active"]}make(){super.make();const t={moveFrom:this.node.attributes["move.from"],moveTo:this.node.attributes["move.to"]};for(const e in t){const i=t[e];this.uniforms[e]=i}}vertex(t,e){let i;return e===this.props.pass&&t.pipe("move.position",this.uniforms),null!=(n=this._inherit("vertex"),r=i=>i.vertex(t,e),i=null!=n?r(n):void 0)?i:t;var n,r}}function xi(t,e,i){return Math.max(e,Math.min(i,t))}function wi(t){return.5-.5*Math.cos(xi(t,0,1)*Math.PI)}function _i(t){return+(t>=.5)}function ki(t){return+(t>=1)}bi.initClass();const zi=function(t){const e={};for(const i in t){const n=t[i];e[i]=n instanceof Array?n.slice():null!=n&&"object"==typeof n?zi(n):n}return e};class Si extends St{static initClass(){this.traits=["node","track","seek","bind"]}init(){return this.handlers={},this.script=null,this.values=null,this.playhead=0,this.velocity=null,this.section=null,this.expr=null}make(){let t;this._helpers.bind.make([{to:"track.target",trait:"node",callback:null}]);const{script:e}=this.props,{node:i}=this.bind.target;return this.targetNode=i,[this.script,this.values,this.start,this.end]=Array.from(t=this._process(i,e)),t}unmake(){return this.unbindExpr(),this._helpers.bind.unmake(),this.script=this.values=this.start=this.end=this.section=this.expr=null,this.playhead=0}bindExpr(t){this.unbindExpr(),this.expr=t,this.targetNode.bind(t,!0);const{clock:e}=this.targetNode,i=this;return this._attributes.bind(this.measure=function(){let t=null;return()=>{const{step:n}=e.getTime();return null!=t&&(i.velocity=(i.playhead-t)/n),t=i.playhead}}())}unbindExpr(){return null!=this.expr&&this.targetNode.unbind(this.expr,!0),null!=this.measure&&this._attributes.unbind(this.measure),this.expr=this.measure=null}_process(t,e){let i,n,r,s,o,a,l;if(e instanceof Array){o={};for(let t=0;t<e.length;t++)a=e[t],o[t]=a;e=o}for(n in o=[],e)a=e[n],null==a&&(a=[]),a instanceof Array?a={key:+n,props:null!=a[0]?zi(a[0]):{},bind:null!=a[1]?zi(a[1]):{}}:(a=null!=a.key||a.props||a.bind?zi(a):{props:zi(a)},a.key=null!=a.key?+a.key:+n,null==a.props&&(a.props={}),null==a.bind&&(a.bind={})),o.push(a);if(!(e=o).length)return[[],{},0,0];e.sort(((t,e)=>t.key-e.key));const h=e[0].key,u=e[e.length-1].key;for(n in e)a=e[n],null!=r&&(r.next=a),r=a;r.next=r,e=o;const c={},p={};for(n in e)for(i in a=e[n],a.props)l=a.props[i],c[i]=!0;for(n in e)for(i in a=e[n],a.bind)l=a.bind[i],c[i]=!0;for(i in c)c[i]=t.get(i);try{for(i in c)p[i]=[t.attribute(i).T.make(),t.attribute(i).T.make(),t.attribute(i).T.make()]}catch(e){throw console.warn(this.node.toMarkup()),s=`${this.node.toString()} - Target ${t} has no \`${i}\` property`,new Error(s)}const d=[];for(a of Array.from(e)){for(i in c)if(l=c[i],l=t.validate(i,null!=a.props[i]?a.props[i]:l),c[i]=a.props[i]=l,null!=a.bind[i]&&"function"!=typeof a.bind[i])throw console.warn(this.node.toMarkup()),s=`${this.node.toString()} - Bind expression \`${a.bind[i]}\` on property \`${i}\` is not a function`,new Error(s);d.push(a)}return[d,p,h,u]}update(){let{playhead:t}=this;const{script:e}=this,{ease:i,seek:n}=this.props,r=this.targetNode;if(null!=n&&(t=n),e.length){let n;const s=function(){let i=e[0];for(let n=0;n<e.length;n++){const r=e[n];if(r.key>t)break;i=r}return i};let{section:o}=this;if((!o||t<o.key||t>o.next.key)&&(o=s(e,t)),o===this.section)return;this.section=o;const a=o,l=o.next,h=a.key,u=l.key,c=(()=>{switch(i){case"linear":case 0:return xi;case"cosine":case 1:default:return wi;case"binary":case 2:return _i;case"hold":case 3:return ki}})(),{clock:p}=r,d=t=>{if(null==this.velocity)return this.playhead;const e=p.getTime();return this.playhead+this.velocity*(t-e.time)},f=function(){const t=1/Math.max(1e-4,u-h);return e=>c((d(e)-h)*t,0,1)}(),m=t=>{const e=a.bind[t],i=l.bind[t],n=a.props[t],s=l.props[t],o=function(){throw console.warn(r.toMarkup()),new Error(`${this.node.toString()} - Invalid expression result on track \`${t}\``)},h=r.attribute(t),u=this.values[t],c=this._animator;return e&&i?((t,n,r)=>function(n,r){let s,a;return t[0]=s=h.T.validate(e(n,r),t[0],o),t[1]=a=h.T.validate(i(n,r),t[1],o),t[2]=c.lerp(h.T,s,a,f(n),t[2])})(u):e?((t,i,n)=>function(i,n){let r;return t[0]=r=h.T.validate(e(i,n),t[0],o),t[1]=c.lerp(h.T,r,s,f(i),t[1])})(u):i?((t,e,r)=>function(e,r){let s;return t[0]=s=h.T.validate(i(e,r),t[0],o),t[1]=c.lerp(h.T,n,s,f(e),t[1])})(u):((t,e,i)=>(e,i)=>t[0]=c.lerp(h.T,n,s,f(e),t[0]))(u)},g={};for(n in a.bind)null==g[n]&&(g[n]=m(n));for(n in l.bind)null==g[n]&&(g[n]=m(n));for(n in a.props)null==g[n]&&(g[n]=m(n));for(n in l.props)null==g[n]&&(g[n]=m(n));return this.bindExpr(g)}}change(t,e,i){return t["track.target"]||t["track.script"]||t["track.mode"]?this.rebuild():t["seek.seek"]||i?this.update():void 0}}Si.initClass();class Mi extends Si{static initClass(){this.traits=["node","track","trigger","play","bind"]}init(){return super.init(),this.skew=null,this.start=null}reset(t){return null==t&&(t=!0),this.skew=t?0:null,this.start=null}make(){super.make(),this._listen("slide","slide.step",(t=>{const{trigger:e}=this.props;return null!=e&&t.index===e?this.reset():null!=e&&0===t.index?this.reset(!1):void 0})),this.props.trigger&&null!=this._inherit("slide")||this.reset();const t=this._inherit("clock");return this._listen(t,"clock.tick",(()=>{const{from:e,to:i,speed:n,pace:r,delay:s,realtime:o}=this.props,a=t.getTime();if(null!=this.skew){const t=o?a.time:a.clock,l=o?a.delta:a.step,h=n/r;null==this.start&&(this.start=t),this.skew+=l*(h-1);let u=Math.max(0,t-this.start+this.skew-s*h);this.props.loop&&(u%=i-e),this.playhead=Math.min(i,e+u)}else this.playhead=0;return this.update()}))}update(){return super.update()}change(t,e,i){return t["trigger.trigger"]||t["play.realtime"]?this.rebuild():super.change(t,e,i)}}Mi.initClass();class Ai extends Mt{static initClass(){this.traits=["node","present"]}init(){}make(){return this.nodes=[],this.steps=[],this.length=0,this.last=[],this.index=0,this.dirty=[],this._listen("root","root.update",this.update),this._compute("present.length",(()=>this.length))}adopt(t){const{node:e}=t;return this.nodes.indexOf(t)<0&&this.nodes.push(e),this.dirty.push(t)}unadopt(t){return this.nodes=this.nodes.filter((e=>e!==t)),this.dirty.push(t)}update(){if(this.dirty.length){for(const t of Array.from(this.dirty))this.slideReset(t);return[this.steps,this.indices]=Array.from(this.process(this.nodes)),this.length=this.steps.length,this.index=null,this.go(this.props.index),this.dirty=[]}}slideLatch(t,e,i){return t.slideLatch(e,i)}slideStep(t,e,i){return t.slideStep(this.mapIndex(t,e),i)}slideRelease(t,e){return t.slideRelease()}slideReset(t){return t.slideReset()}mapIndex(t,e){return e-this.indices[t.node._id]}process(t){const e=(t=>e=>(()=>{let i,n;const r=[];for(;e&&([e,i]=Array.from(n=[t(e),e]),n);)r.push(i);return r})())((function(t){return t.parent.traits.hash.present?null:t.parent})),i=e=>t.indexOf(e)>=0,n=function(t){return t?(()=>{const e=[];for(let i=0;i<t.length;i++){const n=t[i];t.indexOf(n)===i&&e.push(n)}return e})():[]},r=t=>t.sort(((t,e)=>t.order-e.order)),s=(t=>Array.from(t).map((t=>e(t).filter(i))))(t),o=(t=>t.sort((function(t,e){const i=t.length,n=e.length;let r=Math.min(i,n);for(let s=1,o=r,a=1<=o;a?s<=o:s>=o;a?s++:s--){const o=t[i-s],a=e[n-s],l=o.props.order,h=a.props.order;if(null!=l||null!=h){if(null!=l&&null!=h&&0!=(r=l-h))return r;if(null!=l)return-1;if(null!=h)return 1}if(a.order!==o.order)return a.order-o.order}return r=i-n,0!==r?r:0})))(s);return function(t){let e;const[i,s]=Array.from(t),o={};let a=[];const l=function(t,e){let i;const{props:n}=i=t[0],r=t[1],s=null!=r?o[r._id]:0,l=e;let h=null!=n.from?s+n.from:l-n.early,u=null!=n.to?s+n.to:l+n.steps+n.late;h=Math.max(0,h),u=Math.min(100,u),null==o[i._id]&&(o[i._id]=h);for(let e=h,i=u,n=h<=i;n?e<i:e>i;n?e++:e--)a[e]=(null!=a[e]?a[e]:a[e]=[]).concat(t);return n.steps};let h=0;for(e of Array.from(i))h+=l(e,h);for(e of Array.from(s))l(e,0);return a=(()=>{const t=[];for(e of Array.from(a))t.push(r(n(e)));return t})(),[a,o]}(function(t){const e=[],i=[];for(const n of Array.from(t))(null!=n[0].props.steps?e:i).push(n);return[e,i]}(o))}go(t){let e,i;t=Math.max(0,Math.min(this.length+1,+t||0));const n=null!=(e=this.steps[t-1])?e:[],r=this.props.directed?t-this.index:1;this.index=t;const s=(()=>{const t=[];for(i of Array.from(n))this.last.indexOf(i)<0&&t.push(i);return t})(),o=(()=>{const t=[];for(i of Array.from(this.last))n.indexOf(i)<0&&t.push(i);return t})(),a=(()=>{const t=[];for(i of Array.from(n))s.indexOf(i)<0&&o.indexOf(i)<0&&t.push(i);return t})(),l=t=>t.sort(((t,e)=>t.order-e.order)),h=t=>t.sort(((t,e)=>e.order-t.order));for(i of Array.from(l(s)))this.slideLatch(i.controller,!0,r);for(i of Array.from(l(a)))this.slideLatch(i.controller,null,r);for(i of Array.from(l(o)))this.slideLatch(i.controller,!1,r);for(i of Array.from(s))this.slideStep(i.controller,t,r);for(i of Array.from(a))this.slideStep(i.controller,t,r);for(i of Array.from(o))this.slideStep(i.controller,t,r);for(i of Array.from(h(s)))this.slideRelease(i.controller);for(i of Array.from(h(a)))this.slideRelease(i.controller);for(i of Array.from(h(o)))this.slideRelease(i.controller);this.last=n}change(t,e,i){if(t["present.index"]||i)return this.go(this.props.index)}}Ai.initClass();class Ci extends yi{static initClass(){this.traits=["node","transition","mask","visible","active"]}mask(t){let e,i;return t?(i=this._shaders.shader(),i.pipe(re("vec4")),i.fan(),i.pipe(t,this.uniforms),i.next(),i.pipe("reveal.mask",this.uniforms),i.end(),i.pipe("float combine(float a, float b) { return min(a, b); }")):(i=this._shaders.shader(),i.pipe("reveal.mask",this.uniforms)),null!=(n=this._inherit("mask"),r=t=>t.mask(i),e=null!=n?r(n):void 0)?e:i;var n,r}}Ci.initClass();class Ti extends Mt{static initClass(){this.traits=["node","slide","visible","active"]}make(){if(this._helpers.visible.make(),this._helpers.active.make(),!this._inherit("present"))throw new Error(`${this.node.toString()} must be placed inside <present></present>`);return this._inherit("present").adopt(this)}unmake(){return this._helpers.visible.unmake(),this._helpers.active.unmake(),this._inherit("present").unadopt(this)}change(t,e,i){if(t["slide.early"]||t["slide.late"]||t["slide.steps"]||t["slide.from"]||t["slide.to"])return this.rebuild()}slideLatch(t,e){if(this.trigger({type:"transition.latch",step:e}),null!=t)return this._instant(t)}slideStep(t,e){return this.trigger({type:"slide.step",index:t,step:e})}slideRelease(){return this.trigger({type:"transition.release"})}slideReset(){return this._instant(!1),this.trigger({type:"slide.reset"})}_instant(t){return this.setVisible(t),this.setActive(t)}}Ti.initClass();class Oi extends Si{static initClass(){this.traits=["node","track","step","trigger","bind"]}make(){super.make();const t=this._inherit("clock");return null==this.actualIndex&&(this.actualIndex=null),this.animateIndex=this._animator.make(this._types.number(0),{clock:t,realtime:this.props.realtime,step:t=>this.actualIndex=t}),null==this.lastIndex&&(this.lastIndex=null),this.animateStep=this._animator.make(this._types.number(0),{clock:t,realtime:this.props.realtime,step:t=>(this.playhead=t,this.update())}),this.stops=null!=this.props.stops?this.props.stops:function(t,e,i){const n=[],r=t<e,s=i?r?e+1:e-1:e;for(let e=t;r?e<s:e>s;r?e++:e--)n.push(e);return n}(0,this.script.length,!1),this._listen("slide","slide.reset",(t=>this.lastIndex=null)),this._listen("slide","slide.step",(t=>{let e,{duration:i}=this.props;const{delay:n,pace:r,speed:s,playback:o,rewind:a,skip:l,trigger:h}=this.props,u=Math.max(0,Math.min(this.stops.length-1,t.index-h)),c=this.playhead,p=this.stops[u];if(null==this.lastIndex&&h)return this.lastIndex=u,this.animateStep.set(p),void this.animateIndex.set(u);let d=null!=(e=null!=this.actualIndex?this.actualIndex:this.lastIndex)?e:0;const f=u-d,m=this.stops.slice(Math.min(d,u),Math.max(d,u));let g=0;d=m.shift();for(const t of Array.from(m))d===t&&g++,d=t;this.lastIndex=u;let v=s*(t.step>=0?1:a);return v*=l?Math.max(1,Math.abs(f)-g):1,i+=Math.abs(p-c)*r/v,c!==p?(this.animateIndex.immediate(u,{delay:n,duration:i,ease:o}),this.animateStep.immediate(p,{delay:n,duration:i,ease:o})):void 0}))}made(){return this.update()}unmake(){return this.animateIndex.dispose(),this.animateStep.dispose(),this.animateIndex=this.animateStep=null,super.unmake()}change(t,e,i){return t["step.stops"]||t["step.realtime"]?this.rebuild():super.change(t,e,i)}}Oi.initClass();class Ei extends Mt{static initClass(){this.traits=["node","root","scene","vertex","texture","rtt","source","index","image"],this.defaults={minFilter:"linear",magFilter:"linear",type:"unsignedByte"}}init(){return this.rtt=this.scene=this.camera=this.width=this.height=this.history=this.rootSize=this.size=null}indexShader(t){return t}imageShader(t){return this.rtt.shaderRelative(t)}sourceShader(t){return this.rtt.shaderAbsolute(t,this.history)}getDimensions(){return{items:1,width:this.width,height:this.height,depth:this.history}}getActiveDimensions(){return this.getDimensions()}make(){let t;if(this.parentRoot=this._inherit("root"),this.rootSize=this.parentRoot.getSize(),this._listen(this.parentRoot,"root.pre",this.pre),this._listen(this.parentRoot,"root.update",this.update),this._listen(this.parentRoot,"root.render",this.render),this._listen(this.parentRoot,"root.post",this.post),this._listen(this.parentRoot,"root.camera",this.setCamera),this._listen(this.parentRoot,"root.resize",(function(t){return this.resize(t.size)})),null==this.rootSize)return;const{minFilter:e,magFilter:i,type:n}=this.props,{width:r,height:s,history:o,size:a}=this.props,l=a===this.node.attributes["rtt.size"].enum.relative,h=l?this.rootSize.renderWidth:1,u=l?this.rootSize.renderHeight:1;this.width=Math.round(null!=r?r*h:this.rootSize.renderWidth),this.height=Math.round(null!=s?s*u:this.rootSize.renderHeight),this.history=o,this.aspect=t=this.width/this.height,null==this.scene&&(this.scene=this._renderables.make("scene")),this.rtt=this._renderables.make("renderToTexture",{scene:this.scene,camera:this._context.defaultCamera,width:this.width,height:this.height,frames:this.history,minFilter:e,magFilter:i,type:n}),t=r||s?t:this.rootSize.aspect;const c=null!=r?r:this.rootSize.viewWidth,p=null!=s?s:this.rootSize.viewHeight;return this.size={renderWidth:this.width,renderHeight:this.height,aspect:t,viewWidth:c,viewHeight:p,pixelRatio:this.height/p}}made(){if(this.trigger({type:"source.rebuild"}),this.size)return this.trigger({type:"root.resize",size:this.size})}unmake(t){if(null!=this.rtt)return this.rtt.dispose(),t||this.scene.dispose(),this.rtt=this.width=this.height=this.history=null}change(t,e,i){return e.texture||t["rtt.width"]||t["rtt.height"]?this.rebuild():t["root.camera"]||i?(this._unattach(),this._attach(this.props.camera,"camera",this.setCamera,this,this,!0),this.setCamera()):void 0}adopt(t){return Array.from(t.renders).map((t=>this.scene.add(t)))}unadopt(t){return Array.from(t.renders).map((t=>this.scene.remove(t)))}resize(t){let e,i;this.rootSize=t,({width:i,height:e,size:t}=this.props);const n=t===this.node.attributes["rtt.size"].enum.relative;if(!this.rtt||null==i||null==e||n)return this.rebuild()}select(t){return this._root.node.model.select(t,[this.node])}watch(t,e){return this._root.node.model.watch(t,e)}unwatch(t){return this._root.node.model.unwatch(t)}pre(t){return this.trigger(t)}update(t){let e;return null!=(e=this.getOwnCamera())&&(e.aspect=this.aspect||1,e.updateProjectionMatrix()),this.trigger(t)}render(t){return this.trigger(t),null!=this.rtt?this.rtt.render(this.getCamera()):void 0}post(t){return this.trigger(t)}setCamera(){const t=(e=this.select(this.props.camera)[0],i=t=>t.controller,null!=e?i(e):void 0);var e,i;return this.camera!==t?(this.camera=t,this.rtt.camera=this.getCamera(),this.trigger({type:"root.camera"})):this.camera?void 0:this.trigger({type:"root.camera"})}getOwnCamera(){return null!=this.camera?this.camera.getCamera():void 0}getCamera(){let t;return null!=(t=this.getOwnCamera())?t:this._inherit("root").getCamera()}vertex(t,e){return 2===e?t.pipe("view.position"):3===e?t.pipe("root.position"):t}}Ei.initClass();class Pi extends St{static initClass(){this.traits=["node","bind","object","visible","operator","style","compose"],this.defaults={zWrite:!1,zTest:!1,color:"#ffffff"}}init(){return this.compose=null}resize(){if(!this.compose||!this.bind.source)return;const t=this.bind.source.getActiveDimensions(),{width:e}=t,{height:i}=t;return this.remapUVScale.set(e,i)}make(){if(this._helpers.bind.make([{to:"operator.source",trait:"source"}]),null==this.bind.source)return;const t={remapUVScale:this._attributes.make(this._types.vec2())};this.remapUVScale=t.remapUVScale.value;let e=this._shaders.shader();const{alpha:i}=this.props;this.bind.source.is("image")?(e.pipe("screen.pass.uv",t),e=this.bind.source.imageShader(e)):(e.pipe("screen.map.xy",t),e=this.bind.source.sourceShader(e)),i||e.pipe("color.opaque");const n=this._helpers.style.uniforms();return this.compose=this._renderables.make("screen",{map:e,uniforms:n,linear:!0}),this._helpers.visible.make(),this._helpers.object.make([this.compose])}made(){return this.resize()}unmake(){return this._helpers.bind.unmake(),this._helpers.visible.unmake(),this._helpers.object.unmake()}change(t,e,i){if(t["operator.source"]||t["compose.alpha"])return this.rebuild()}}Pi.initClass();class Di extends Ye{static initClass(){this.traits=["node","object","visible","view","vertex"]}make(){return this._helpers.visible.make()}unmake(){return this._helpers.visible.unmake()}axis(t){return this.props.range[t-1]}}Di.initClass();class ji extends Di{static initClass(){this.traits=["node","object","visible","view","view3","vertex"]}make(){super.make(),this.uniforms={viewMatrix:this._attributes.make(this._types.mat4())},this.viewMatrix=this.uniforms.viewMatrix.value,this.composer=jt()}unmake(){super.unmake(),delete this.viewMatrix,delete this.objectMatrix,delete this.uniforms}change(t,e,i){if(!e.view&&!e.view3&&!i)return;const n=this.props.position,r=this.props.scale,s=this.props.quaternion,o=this.props.rotation,a=this.props.range,l=this.props.eulerOrder,{x:h}=a[0],u=a[1].x,c=a[2].x,p=a[0].y-h||1,d=a[1].y-u||1,f=a[2].y-c||1;this.viewMatrix.set(2/p,0,0,-(2*h+p)/p,0,2/d,0,-(2*u+d)/d,0,0,2/f,-(2*c+f)/f,0,0,0,1);const m=this.composer(n,o,s,r,null,l);this.viewMatrix.multiplyMatrices(m,this.viewMatrix),t["view.range"]&&this.trigger({type:"view.range"})}vertex(t,e){return 1===e&&t.pipe("cartesian.position",this.uniforms),super.vertex(t,e)}}ji.initClass();class qi extends Di{static initClass(){this.traits=["node","object","visible","view","view4","vertex"]}make(){return super.make(),this.uniforms={basisOffset:this._attributes.make(this._types.vec4()),basisScale:this._attributes.make(this._types.vec4())},this.basisScale=this.uniforms.basisScale.value,this.basisOffset=this.uniforms.basisOffset.value}unmake(){return super.unmake(),delete this.basisScale,delete this.basisOffset,delete this.uniforms}change(t,e,i){if(!e.view&&!e.view4&&!i)return;const n=this.props.position,r=this.props.scale,s=this.props.range,{x:o}=s[0],a=s[1].x,l=s[2].x,h=s[3].x,u=s[0].y-o||1,c=s[1].y-a||1,p=s[2].y-l||1,d=s[3].y-h||1,f=function(t,e){return t.x*=e.x,t.y*=e.y,t.z*=e.z,t.w*=e.w};return this.basisScale.set(2/u,2/c,2/p,2/d),this.basisOffset.set(-(2*o+u)/u,-(2*a+c)/c,-(2*l+p)/p,-(2*h+d)/d),f(this.basisScale,r),f(this.basisOffset,r),this.basisOffset.add(n),t["view.range"]?this.trigger({type:"view.range"}):void 0}vertex(t,e){return 1===e&&t.pipe("cartesian4.position",this.uniforms),super.vertex(t,e)}}qi.initClass();class Fi extends Di{static initClass(){this.traits=["node","object","visible","view","view3","polar","vertex"]}make(){super.make();const{types:t}=this._attributes;return this.uniforms={polarBend:this.node.attributes["polar.bend"],polarHelix:this.node.attributes["polar.helix"],polarFocus:this._attributes.make(t.number()),polarAspect:this._attributes.make(t.number()),viewMatrix:this._attributes.make(t.mat4())},this.viewMatrix=this.uniforms.viewMatrix.value,this.composer=jt(),this.aspect=1}unmake(){return super.unmake(),delete this.viewMatrix,delete this.objectMatrix,delete this.aspect,delete this.uniforms}change(t,e,i){let n,r,s;if(!(e.view||e.view3||e.polar||i))return;this.helix=this.props.helix,this.bend=r=this.props.bend,this.focus=s=r>0?1/r-1:0;const o=this.props.position,a=this.props.scale,l=this.props.quaternion,h=this.props.rotation,u=this.props.range,c=this.props.eulerOrder,{x:p}=u[0];let d=u[1].x;const f=u[2].x,m=u[0].y-p||1;let g=u[1].y-d||1;const v=u[2].y-f||1,y=a.x,b=a.y,x=m>0?1:-1;[d,g]=Array.from(ze(d,g,r));const w=m+(Math.abs(g)*x-m)*r,_=w/y,k=g/b;this.aspect=n=Math.abs(_/k),this.uniforms.polarFocus.value=s,this.uniforms.polarAspect.value=n,this.viewMatrix.set(2/w,0,0,-(2*p+m)/m,0,2/g,0,-(2*d+g)/g,0,0,2/v,-(2*f+v)/v,0,0,0,1);const z=this.composer(o,h,l,a,null,c);this.viewMatrix.multiplyMatrices(z,this.viewMatrix),(t["view.range"]||e.polar)&&this.trigger({type:"view.range"})}vertex(t,e){return 1===e&&t.pipe("polar.position",this.uniforms),super.vertex(t,e)}axis(t){const e=this.props.range[t-1];let i=e.x,n=e.y;return 2===t&&this.bend>0&&(n=Math.max(Math.abs(n),Math.abs(i)),i=Math.max(-this.focus/this.aspect,i)),new S.Vector2(i,n)}}Fi.initClass();class Ii extends Di{static initClass(){this.traits=["node","object","visible","view","view3","spherical","vertex"]}make(){return super.make(),this.uniforms={sphericalBend:this.node.attributes["spherical.bend"],sphericalFocus:this._attributes.make(this._types.number()),sphericalAspectX:this._attributes.make(this._types.number()),sphericalAspectY:this._attributes.make(this._types.number()),sphericalScaleY:this._attributes.make(this._types.number()),viewMatrix:this._attributes.make(this._types.mat4())},this.viewMatrix=this.uniforms.viewMatrix.value,this.composer=jt(),this.aspectX=1,this.aspectY=1}unmake(){return super.unmake(),delete this.viewMatrix,delete this.objectMatrix,delete this.aspectX,delete this.aspectY,delete this.uniforms}change(t,e,i){let n,r,s,o,a;if(!(e.view||e.view3||e.spherical||i))return;this.bend=s=this.props.bend,this.focus=o=s>0?1/s-1:0;const l=this.props.position,h=this.props.scale,u=this.props.quaternion,c=this.props.rotation,p=this.props.range,d=this.props.eulerOrder,{x:f}=p[0];let m=p[1].x,g=p[2].x;const v=p[0].y-f||1;let y=p[1].y-m||1,b=p[2].y-g||1;const x=h.x,w=h.y,_=h.z;[m,y]=Array.from(ze(m,y,s)),[g,b]=Array.from(ze(g,b,s));const k=v>0?1:-1,z=y>0?1:-1,S=Math.abs(b),M=v+(S*k-v)*s,A=y+(S*z-y)*s,C=M/x,T=A/w,O=b/_;this.aspectX=n=Math.abs(C/O),this.aspectY=r=Math.abs(T/O/n);const E=y/v*x/w*2;this.scaleY=a=Math.min(r/s,1+(E-1)*s),this.uniforms.sphericalBend.value=s,this.uniforms.sphericalFocus.value=o,this.uniforms.sphericalAspectX.value=n,this.uniforms.sphericalAspectY.value=r,this.uniforms.sphericalScaleY.value=a,this.viewMatrix.set(2/M,0,0,-(2*f+v)/v,0,2/A,0,-(2*m+y)/y,0,0,2/b,-(2*g+b)/b,0,0,0,1);const P=this.composer(l,c,u,h,null,d);return this.viewMatrix.multiplyMatrices(P,this.viewMatrix),t["view.range"]||e.spherical?this.trigger({type:"view.range"}):void 0}vertex(t,e){return 1===e&&t.pipe("spherical.position",this.uniforms),super.vertex(t,e)}axis(t){const e=this.props.range[t-1];let i=e.x,n=e.y;return 3===t&&this.bend>0&&(n=Math.max(Math.abs(n),Math.abs(i)),i=Math.max(-this.focus/this.aspectX+.001,i)),new S.Vector2(i,n)}}Ii.initClass();class Li extends Di{static initClass(){this.traits=["node","object","visible","view","view3","stereographic","vertex"]}make(){return super.make(),this.uniforms={stereoBend:this.node.attributes["stereographic.bend"],viewMatrix:this._attributes.make(this._types.mat4())},this.viewMatrix=this.uniforms.viewMatrix.value,this.composer=jt()}unmake(){return super.unmake(),delete this.viewMatrix,delete this.rotationMatrix,delete this.uniforms}change(t,e,i){let n;if(!(e.view||e.view3||e.stereographic||i))return;this.bend=n=this.props.bend;const r=this.props.position,s=this.props.scale,o=this.props.quaternion,a=this.props.rotation,l=this.props.range,h=this.props.eulerOrder,{x:u}=l[0],c=l[1].x;let p=l[2].x;const d=l[0].y-u||1,f=l[1].y-c||1;let m=l[2].y-p||1;[p,m]=Array.from(ze(p,m,n,1)),this.uniforms.stereoBend.value=n,this.viewMatrix.set(2/d,0,0,-(2*u+d)/d,0,2/f,0,-(2*c+f)/f,0,0,2/m,-(2*p+m)/m,0,0,0,1);const g=this.composer(r,a,o,s,null,h);return this.viewMatrix.multiplyMatrices(g,this.viewMatrix),t["view.range"]||e.stereographic?this.trigger({type:"view.range"}):void 0}vertex(t,e){return 1===e&&t.pipe("stereographic.position",this.uniforms),super.vertex(t,e)}}Li.initClass();class Ni extends Di{static initClass(){this.traits=["node","object","visible","view","view4","stereographic","vertex"]}make(){super.make(),this.uniforms={basisOffset:this._attributes.make(this._types.vec4()),basisScale:this._attributes.make(this._types.vec4()),stereoBend:this.node.attributes["stereographic.bend"]},this.basisScale=this.uniforms.basisScale.value,this.basisOffset=this.uniforms.basisOffset.value}unmake(){super.unmake(),delete this.basisScale,delete this.basisOffset,delete this.uniforms}change(t,e,i){let n;if(!(e.view||e.view4||e.stereographic||i))return;this.bend=n=this.props.bend;const r=this.props.position,s=this.props.scale,o=this.props.range,{x:a}=o[0],l=o[1].x,h=o[2].x;let u=o[3].x;const c=o[0].y-a||1,p=o[1].y-l||1,d=o[2].y-h||1;let f=o[3].y-u||1;const m=function(t,e){t.x*=e.x,t.y*=e.y,t.z*=e.z,t.w*=e.w};[u,f]=Array.from(ze(u,f,n,1)),this.basisScale.set(2/c,2/p,2/d,2/f),this.basisOffset.set(-(2*a+c)/c,-(2*l+p)/p,-(2*h+d)/d,-(2*u+f)/f),m(this.basisScale,s),m(this.basisOffset,s),this.basisOffset.add(r),(t["view.range"]||e.stereographic)&&this.trigger({type:"view.range"})}vertex(t,e){return 1===e&&t.pipe("stereographic4.position",this.uniforms),super.vertex(t,e)}}Ni.initClass();class Ri extends St{static initClass(){this.traits=["node","bind","shader"],this.freeform=!0}init(){return this.shader=null}make(){const{language:t,code:e}=this.props;if("glsl"!==t)throw new Error("GLSL required");this._helpers.bind.make([{to:"shader.sources",trait:"source",multiple:!0}]);const i=this._shaders.fetch(e),n=this._types,r={},s=t=>{let e;switch(t){case"i":return n.int();case"f":return n.number();case"v2":return n.vec2();case"v3":return n.vec3();case"v4":return n.vec4();case"m3":return n.mat3();case"m4":return n.mat4();case"t":return n.object();default:return e=t.split(""),"v"===e.pop()?n.array(s(e.join(""))):null}};for(const t of Array.from(i._signatures.uniform)){let e;(e=s(t.type))&&(r[t.name]=e)}return this.reconfigure({props:{uniform:r}})}made(){return this.trigger({type:"source.rebuild"})}unmake(){return this.shader=null}change(t,e,i){if(t["shader.uniforms"]||t["shader.code"]||t["shader.language"])return this.rebuild()}shaderBind(t){let e,i,n;null==t&&(t={});const{code:r,indices:s,channels:o}=this.props;for(e in this.node.attributes)n=this.node.attributes[e],null!=n.type&&null!=n.short&&"uniform"===n.ns&&null==t[n.short]&&(t[n.short]=n);if(null!=(i=this.props.uniforms))for(e in i)n=i[e],t[e]=n;const a=this._shaders.shader();if(null!=this.bind.sources)for(const t of Array.from(this.bind.sources))a.callback(),4!=s&&a.pipe(Kt(s,4)),a.pipe(t.sourceShader(this._shaders.shader())),4!=o&&a.pipe(te(4,o)),a.join();return a.pipe(r,t)}}Ri.initClass();const Ui={axis:Te,face:Oe,grid:Ee,line:Pe,point:De,strip:je,surface:qe,ticks:Fe,vector:Ie,view:Di,cartesian:ji,cartesian4:qi,polar:Fi,spherical:Ii,stereographic:Li,stereographic4:Ni,transform:Qe,transform4:Je,vertex:Ke,fragment:ti,layer:ei,mask:ii,array:he,interval:ue,matrix:ge,area:ve,voxel:ye,volume:be,scale:Se,latch:me,html:Le,dom:Ne,text:Re,format:Be,label:$e,retext:We,clamp:ni,grow:ri,join:si,lerp:oi,memo:ai,readback:li,resample:He,repeat:hi,reverse:ui,swizzle:ci,spread:pi,split:di,slice:fi,subdivide:mi,transpose:vi,group:At,inherit:Ct,root:Tt,unit:Ot,shader:Ri,camera:qt,rtt:Ei,compose:Pi,clock:Xe,now:Ge,move:bi,play:Mi,present:Ai,reveal:Ci,slide:Ti,step:Oi},Vi={array(t,e,i=null){const n=t.lerp?function(e,i,n,r){for(let s=0,o=Math.min(e.length,i.length),a=0<=o;a?s<o:s>o;a?s++:s--)n[s]=t.lerp(e[s],i[s],n[s],r);return n}:void 0,r=t.op?function(e,i,n,r){for(let s=0,o=Math.min(e.length,i.length),a=0<=o;a?s<o:s>o;a?s++:s--)n[s]=t.op(e[s],i[s],n[s],r);return n}:void 0;return null==i||i instanceof Array||(i=[i]),{uniform:()=>t.uniform?t.uniform()+"v":void 0,make:()=>null!=i?i.slice():e?function(t,e,i){const n=[],r=t<e,s=i?r?e+1:e-1:e;for(let e=t;r?e<s:e>s;r?e++:e--)n.push(e);return n}(0,e,!1).map((e=>t.make())):[],validate(i,n,r){i instanceof Array||(i=[i]);for(let s=0,o=n.length=e||i.length,a=0<=o;a?s<o:s>o;a?s++:s--){const e=null!=i[s]?i[s]:t.make();n[s]=t.validate(e,n[s],r)}return n},equals(e,i){const n=e.length,r=i.length;if(n!==r)return!1;for(let s=0,o=Math.min(n,r),a=0<=o;a?s<o:s>o;a?s++:s--)if(!("function"==typeof t.equals?t.equals(e[s],i[s]):void 0))return!1;return!0},lerp:n,op:r,clone:e=>Array.from(e).map((e=>t.clone(e)))}},letters(t,e,i=null){if(null!=i){i===""+i&&(i=i.split(""));for(let e=0;e<i.length;e++){const n=i[e];i[e]=t.validate(n,n)}}const n=Bi.array(t,e,i);return{uniform:()=>n.uniform(),make:()=>n.make(),validate:(t,e,i)=>(t===""+t&&(t=t.split("")),n.validate(t,e,i)),equals:(t,e)=>n.equals(t,e),clone:n.clone}},nullable(t,e){null==e&&(e=!1);let i=e?t.make():null;const n=t.emitter?function(e,i){return null==i?e:null==e?i:t.emitter(e,i)}:void 0;return{make:()=>i,validate:(e,i,n)=>null===e?e:(null===i&&(i=t.make()),t.validate(e,i,n)),uniform:()=>"function"==typeof t.uniform?t.uniform():void 0,equals(e,i){let n;const r=null===e,s=null===i;return!(!r||!s)||!(r^s)&&(null!=(n="function"==typeof t.equals?t.equals(e,i):void 0)?n:e===i)},lerp:t.lerp?function(e,n,r,s){return null===e||null===n?s<.5?e:n:(null==r&&(r=t.make()),i=t.lerp(e,n,r,s),r)}:void 0,op:t.op?function(e,n,r,s){return null===e||null===n?null:(null==r&&(r=t.make()),i=t.op(e,n,r,s),i)}:void 0,emitter:n}},enum(t,e,i){let n;null==e&&(e=[]),null==i&&(i={});let r=0;const s={};for(n of Array.from(e))n!==+n&&null==i[n]&&(i[n]=r++);for(n of Array.from(e))n===+n&&(s[n]=n);for(n in i)r=i[n],s[r]=!0;return null==s[t]&&(t=i[t]),{enum:()=>i,make:()=>t,validate(t,e,n){const r=s[t]?t:i[t];return null!=r?r:n()}}},enumber(t,e,i){null==i&&(i={});const n=Bi.enum(t,e,i);return{enum:n.enum,uniform:()=>"f",make(){let e;return null!=(e=n.make())?e:+t},validate:(t,e,i)=>t===+t?t:n.validate(t,e,i),op:(t,e,i,n)=>n(t,e)}},select:t=>(null==t&&(t="<"),{make:()=>t,validate:(t,e,i)=>"string"==typeof t||"object"==typeof t?t:i()}),bool:t=>(t=!!t,{uniform:()=>"f",make:()=>t,validate:(t,e,i)=>!!t}),int:t=>(null==t&&(t=0),t=+Math.round(t),{uniform:()=>"i",make:()=>t,validate(t,e,i){let n;return t!==(n=+t)?i():Math.round(n)||0},op:(t,e,i,n)=>n(t,e)}),round:t=>(null==t&&(t=0),t=+Math.round(t),{uniform:()=>"f",make:()=>t,validate(t,e,i){let n;return t!==(n=+t)?i():Math.round(n)||0},op:(t,e,i,n)=>n(t,e)}),number:t=>(null==t&&(t=0),{uniform:()=>"f",make:()=>+t,validate(t,e,i){let n;return t!==(n=+t)?i():n||0},op:(t,e,i,n)=>n(t,e)}),positive:(t,e)=>(null==e&&(e=!1),{uniform:t.uniform,make:t.make,validate:(i,n,r)=>(i=t.validate(i,n,r))<0||e&&i<=0?r():i,op:(t,e,i,n)=>n(t,e)}),string:t=>(null==t&&(t=""),{make:()=>""+t,validate(t,e,i){let n;return t!==(n=""+t)?i():n}}),func:()=>({make:()=>function(){},validate:(t,e,i)=>"function"==typeof t?t:i()}),emitter:()=>({make:()=>t=>t(1,1,1,1),validate:(t,e,i)=>"function"==typeof t?t:i(),emitter:(t,e)=>Vt(t,e)}),object:t=>({make:()=>null!=t?t:{},validate:(t,e,i)=>"object"==typeof t?t:i(),clone:t=>JSON.parse(JSON.stringify(t))}),timestamp:(t=null)=>("string"==typeof t&&(t=Date.parse(t)),{uniform:()=>"f",make:()=>null!=t?t:+new Date,validate:(t,e,i)=>(t=Date.parse(t))!==+t?i():t,op:(t,e,i,n)=>n(t,e)}),vec2(t,e){null==t&&(t=0),null==e&&(e=0);const i=[t,e];return{uniform:()=>"v2",make:()=>new S.Vector2(t,e),validate(n,r,s){if(n===+n&&(n=[n]),n?.isVector2)r.copy(n);else if(n instanceof Array)n=n.concat(i.slice(n.length)),r.set.apply(r,n);else{if(null==n)return s();{const i=null!=n.x?n.x:t,s=null!=n.y?n.y:e;r.set(i,s)}}return r},equals:(t,e)=>t.x===e.x&&t.y===e.y,op:(t,e,i,n)=>(i.x=n(t.x,e.x),i.y=n(t.y,e.y),i)}},ivec2(t,e){null==t&&(t=0),null==e&&(e=0);const i=Bi.vec2(t,e),{validate:n}=i;return i.validate=function(t,e,i){return n(t,e,i),e.x=Math.round(e.x),e.y=Math.round(e.y),e},i},vec3(t,e,i){null==t&&(t=0),null==e&&(e=0),null==i&&(i=0);const n=[t,e,i];return{uniform:()=>"v3",make:()=>new S.Vector3(t,e,i),validate(r,s,o){if(r===+r&&(r=[r]),r?.isVector3)s.copy(r);else if(r instanceof Array)r=r.concat(n.slice(r.length)),s.set.apply(s,r);else{if(null==r)return o();{const n=null!=r.x?r.x:t,o=null!=r.y?r.y:e,a=null!=r.z?r.z:i;s.set(n,o,a)}}return s},equals:(t,e)=>t.x===e.x&&t.y===e.y&&t.z===e.z,op:(t,e,i,n)=>(i.x=n(t.x,e.x),i.y=n(t.y,e.y),i.z=n(t.z,e.z),i)}},ivec3(t,e,i){null==t&&(t=0),null==e&&(e=0),null==i&&(i=0);const n=Bi.vec3(t,e,i),{validate:r}=n;return n.validate=function(t,e,i){return r(t,e,i),e.x=Math.round(e.x),e.y=Math.round(e.y),e.z=Math.round(e.z),e},n},vec4(t,e,i,n){null==t&&(t=0),null==e&&(e=0),null==i&&(i=0),null==n&&(n=0);const r=[t,e,i,n];return{uniform:()=>"v4",make:()=>new S.Vector4(t,e,i,n),validate(s,o,a){if(s===+s&&(s=[s]),s?.isVector4)o.copy(s);else if(s instanceof Array)s=s.concat(r.slice(s.length)),o.set.apply(o,s);else{if(null==s)return a();{const r=null!=s.x?s.x:t,a=null!=s.y?s.y:e,l=null!=s.z?s.z:i,h=null!=s.w?s.w:n;o.set(r,a,l,h)}}return o},equals:(t,e)=>t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w,op:(t,e,i,n)=>(i.x=n(t.x,e.x),i.y=n(t.y,e.y),i.z=n(t.z,e.z),i.w=n(t.w,e.w),i)}},ivec4(t,e,i,n){null==t&&(t=0),null==e&&(e=0),null==i&&(i=0),null==n&&(n=0);const r=Bi.vec4(t,e,i,n),{validate:s}=r;return r.validate=function(t,e,i){return s(t,e,i),e.x=Math.round(e.x),e.y=Math.round(e.y),e.z=Math.round(e.z),e.w=Math.round(e.w),e},r},mat3(t,e,i,n,r,s,o,a,l){null==t&&(t=1),null==e&&(e=0),null==i&&(i=0),null==n&&(n=0),null==r&&(r=1),null==s&&(s=0),null==o&&(o=0),null==a&&(a=0),null==l&&(l=1);const h=[t,e,i,n,r,s,o,a,l];return{uniform:()=>"m4",make(){const h=new S.Matrix3;return h.set(t,e,i,n,r,s,o,a,l),h},validate(t,e,i){if(t?.isMatrix3)e.copy(t);else{if(!(t instanceof Array))return i();t=t.concat(h.slice(t.length)),e.set.apply(e,t)}return e}}},mat4(t,e,i,n,r,s,o,a,l,h,u,c,p,d,f,m){null==t&&(t=1),null==e&&(e=0),null==i&&(i=0),null==n&&(n=0),null==r&&(r=0),null==s&&(s=1),null==o&&(o=0),null==a&&(a=0),null==l&&(l=0),null==h&&(h=0),null==u&&(u=1),null==c&&(c=0),null==p&&(p=0),null==d&&(d=0),null==f&&(f=0),null==m&&(m=1);const g=[t,e,i,n,r,s,o,a,l,h,u,c,p,d,f,m];return{uniform:()=>"m4",make(){const g=new S.Matrix4;return g.set(t,e,i,n,r,s,o,a,l,h,u,c,p,d,f,m),g},validate(t,e,i){if(t?.isMatrix4)e.copy(t);else{if(!(t instanceof Array))return i();t=t.concat(g.slice(t.length)),e.set.apply(e,t)}return e}}},quat(t,e,i,n){null==t&&(t=0),null==e&&(e=0),null==i&&(i=0),null==n&&(n=1);const r=Bi.vec4(t,e,i,n);return{uniform:()=>"v4",make:()=>new S.Quaternion,validate:(t,e,i)=>(t?.isQuaternion?e.copy(t):e=r.validate(t,e,i),e.normalize(),e),equals:(t,e)=>t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w,op:(t,e,i,n)=>(i.x=n(t.x,e.x),i.y=n(t.y,e.y),i.z=n(t.z,e.z),i.w=n(t.w,e.w),i.normalize(),i),lerp:(t,e,i,n)=>(i.slerpQuaternions?i.slerpQuaternions(t,e,n):S.Quaternion.slerp(t,e,i,n),i)}},color(t,e,i){null==t&&(t=.5),null==e&&(e=.5),null==i&&(i=.5);const n=[t,e,i];return{uniform:()=>"c",make:()=>new S.Color(t,e,i),validate(r,s,o){if(r===""+r?r=(new S.Color).setStyle(r):r===+r&&(r=new S.Color(r)),r?.isColor)s.copy(r);else if(r instanceof Array)r=r.concat(n.slice(r.length)),s.setRGB.apply(s,r);else{if(null==r)return o();{const n=null!=r.r?r.r:t,o=null!=r.g?r.g:e,a=null!=r.b?r.b:i;s.set(n,o,a)}}return s},equals:(t,e)=>t.r===e.r&&t.g===e.g&&t.b===e.b,op:(t,e,i,n)=>(i.r=n(t.r,e.r),i.g=n(t.g,e.g),i.b=n(t.b,e.b),i)}},axis(t,e){let i;null==t&&(t=1),null==e&&(e=!1);const n={x:1,y:2,z:3,w:4,W:1,H:2,D:3,I:4,zero:0,null:0,width:1,height:2,depth:3,items:4},r=e?[0,1,2,3,4]:[1,2,3,4];return null!=(i=n[t])&&(t=i),{make:()=>t,validate(t,e,s){let o;return null!=(i=n[t])&&(t=i),t=null!=(o=Math.round(t))?o:0,Array.from(r).includes(t)?t:s()}}},transpose(t){null==t&&(t=[1,2,3,4]);const e=Bi.letters(Bi.axis(null,!1),0,t),i=Bi.letters(Bi.axis(null,!1),4,t);return{make:()=>i.make(),validate(t,n,r){let s=[1,2,3,4];if(e.validate(t,s,r),s.length<4){const t=[1,2,3,4].filter((t=>-1===s.indexOf(t)));s=s.concat(t)}return Array.from(s).map(((t,e)=>s.indexOf(t)===e)).indexOf(!1)<0?i.validate(s,n,r):r()},equals:i.equals,clone:i.clone}},swizzle(t,e=null){null==t&&(t=[1,2,3,4]),null==e&&(e=t.length),t=t.slice(0,e);const i=Bi.letters(Bi.axis(null,!1),0,t),n=Bi.letters(Bi.axis(null,!0),e,t);return{make:()=>n.make(),validate(r,s,o){let a=t.slice();return i.validate(r,a,o),a.length<e&&(a=a.concat([0,0,0,0]).slice(0,e)),n.validate(a,s,o)},equals:n.equals,clone:n.clone}},classes(){const t=Bi.array(Bi.string());return{make:()=>t.make(),validate:(e,i,n)=>(e===""+e&&(e=e.split(" ")),e=e.filter((t=>!!t.length)),t.validate(e,i,n)),equals:t.equals,clone:t.clone}},blending(t){null==t&&(t="normal");return Bi.enum(t,["no","normal","add","subtract","multiply","custom"])},filter(t){null==t&&(t="nearest");const e={nearest:S.NearestFilter,nearestMipMapNearest:S.NearestMipMapNearestFilter,nearestMipMapLinear:S.NearestMipMapLinearFilter,linear:S.LinearFilter,linearMipMapNearest:S.LinearMipMapNearestFilter,linearMipmapLinear:S.LinearMipMapLinearFilter};return Bi.enum(t,[],e)},type(t){null==t&&(t="unsignedByte");const e={unsignedByte:S.UnsignedByteType,byte:S.ByteType,short:S.ShortType,unsignedShort:S.UnsignedShortType,int:S.IntType,unsignedInt:S.UnsignedIntType,float:S.FloatType};return Bi.enum(t,[],e)},scale(t){null==t&&(t="linear");return Bi.enum(t,["linear","log"])},mapping(t){null==t&&(t="relative");return Bi.enum(t,["relative","absolute"])},indexing(t){null==t&&(t="original");return Bi.enum(t,["original","final"])},shape(t){null==t&&(t="circle");return Bi.enum(t,["circle","square","diamond","up","down","left","right"])},join(t){null==t&&(t="miter");return Bi.enum(t,["miter","round","bevel"])},stroke(t){null==t&&(t="solid");return Bi.enum(t,["solid","dotted","dashed"])},vertexPass(t){null==t&&(t="view");return Bi.enum(t,["data","view","world","eye"])},fragmentPass(t){null==t&&(t="light");return Bi.enum(t,["color","light","rgba"])},ease(t){null==t&&(t="linear");return Bi.enum(t,["linear","cosine","binary","hold"])},fit(t){null==t&&(t="contain");return Bi.enum(t,["x","y","contain","cover"])},anchor(t){null==t&&(t="middle");return Bi.enumber(t,[],{first:1,middle:0,last:-1})},transitionState(t){null==t&&(t="enter");return Bi.enumber(t,[],{enter:-1,visible:0,exit:1})},font(t){null==t&&(t="sans-serif");const e=Ce;t instanceof Array||(t=e(t));const i=Bi.array(Bi.string(),0,t);return{make:()=>i.make(),validate(t,n,r){try{t instanceof Array||(t=e(t))}catch(t){return r()}return t=t.filter((t=>!!t.length)),i.validate(t,n,r)},equals:i.equals,clone:i.clone}},data:t=>(null==t&&(t=[]),{make:()=>[],validate:(t,e,i)=>t instanceof Array||null!=(null!=t?t.length:void 0)?t:i(),emitter:(t,e)=>Bt(t,e)})},Bi=function(t){for(const e in t){const i=t[e];t[e]=(t=>function(){const e=t.apply(t,arguments);return null==e.validate&&(e.validate=t=>null!=t),null==e.equals&&(e.equals=(t,e)=>t===e),null==e.clone&&(e.clone=function(t){let e;return null!=(e=$i(t,"clone",(t=>t.clone())))?e:t}),e})(i)}return t}(Vi);function $i(t,e,i){return null!=t&&"function"==typeof t[e]?i(t,e):void 0}const Hi=Bi,Wi={node:{id:Hi.nullable(Hi.string()),classes:Hi.classes()},entity:{active:Hi.bool(!0)},object:{visible:Hi.bool(!0)},latch:{data:Hi.nullable(Hi.object()),deep:Hi.nullable(Hi.bool(!0))},unit:{scale:Hi.nullable(Hi.number()),fov:Hi.nullable(Hi.number()),focus:Hi.nullable(Hi.number(1),!0)},span:{range:Hi.nullable(Hi.vec2(-1,1))},view:{range:Hi.array(Hi.vec2(-1,1),4)},view3:{position:Hi.vec3(),quaternion:Hi.quat(),rotation:Hi.vec3(),scale:Hi.vec3(1,1,1),eulerOrder:Hi.swizzle("xyz")},view4:{position:Hi.vec4(),scale:Hi.vec4(1,1,1,1)},layer:{depth:Hi.number(1),fit:Hi.fit("y")},vertex:{pass:Hi.vertexPass()},fragment:{pass:Hi.fragmentPass(),gamma:Hi.bool(!1)},transform3:{position:Hi.vec3(),quaternion:Hi.quat(),rotation:Hi.vec3(),eulerOrder:Hi.swizzle("xyz"),scale:Hi.vec3(1,1,1),matrix:Hi.mat4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},transform4:{position:Hi.vec4(),scale:Hi.vec4(1,1,1,1),matrix:Hi.mat4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},camera:{proxy:Hi.bool(!1),position:Hi.nullable(Hi.vec3()),quaternion:Hi.nullable(Hi.quat()),rotation:Hi.nullable(Hi.vec3()),lookAt:Hi.nullable(Hi.vec3()),up:Hi.nullable(Hi.vec3()),eulerOrder:Hi.swizzle("xyz"),fov:Hi.nullable(Hi.number(1))},polar:{bend:Hi.number(1),helix:Hi.number(0)},spherical:{bend:Hi.number(1)},stereographic:{bend:Hi.number(1)},interval:{axis:Hi.axis()},area:{axes:Hi.swizzle([1,2],2)},volume:{axes:Hi.swizzle([1,2,3],3)},origin:{origin:Hi.vec4()},scale:{divide:Hi.number(10),unit:Hi.number(1),base:Hi.number(10),mode:Hi.scale(),start:Hi.bool(!0),end:Hi.bool(!0),zero:Hi.bool(!0),factor:Hi.positive(Hi.number(1)),nice:Hi.bool(!0)},grid:{lineX:Hi.bool(!0),lineY:Hi.bool(!0),crossed:Hi.bool(!1),closedX:Hi.bool(!1),closedY:Hi.bool(!1)},axis:{detail:Hi.int(1),crossed:Hi.bool(!1)},data:{data:Hi.nullable(Hi.data()),expr:Hi.nullable(Hi.emitter()),bind:Hi.nullable(Hi.func()),live:Hi.bool(!0)},buffer:{channels:Hi.enum(4,[1,2,3,4]),items:Hi.int(1),fps:Hi.nullable(Hi.int(60)),hurry:Hi.int(5),limit:Hi.int(60),realtime:Hi.bool(!1),observe:Hi.bool(!1),aligned:Hi.bool(!1)},sampler:{centered:Hi.bool(!1),padding:Hi.number(0)},array:{width:Hi.nullable(Hi.positive(Hi.int(1),!0)),bufferWidth:Hi.int(1),history:Hi.int(1)},matrix:{width:Hi.nullable(Hi.positive(Hi.int(1),!0)),height:Hi.nullable(Hi.positive(Hi.int(1),!0)),history:Hi.int(1),bufferWidth:Hi.int(1),bufferHeight:Hi.int(1)},voxel:{width:Hi.nullable(Hi.positive(Hi.int(1),!0)),height:Hi.nullable(Hi.positive(Hi.int(1),!0)),depth:Hi.nullable(Hi.positive(Hi.int(1),!0)),bufferWidth:Hi.int(1),bufferHeight:Hi.int(1),bufferDepth:Hi.int(1)},resolve:{expr:Hi.nullable(Hi.func()),items:Hi.int(1)},style:{opacity:Hi.positive(Hi.number(1)),color:Hi.color(),blending:Hi.blending(),zWrite:Hi.bool(!0),zTest:Hi.bool(!0),zIndex:Hi.positive(Hi.round()),zBias:Hi.number(0),zOrder:Hi.nullable(Hi.int())},geometry:{points:Hi.select(),colors:Hi.nullable(Hi.select())},point:{size:Hi.positive(Hi.number(4)),sizes:Hi.nullable(Hi.select()),shape:Hi.shape(),optical:Hi.bool(!0),fill:Hi.bool(!0),depth:Hi.number(1)},line:{width:Hi.positive(Hi.number(2)),depth:Hi.positive(Hi.number(1)),join:Hi.join(),stroke:Hi.stroke(),proximity:Hi.nullable(Hi.number(1/0)),closed:Hi.bool(!1)},mesh:{fill:Hi.bool(!0),shaded:Hi.bool(!1),normals:Hi.nullable(Hi.select()),map:Hi.nullable(Hi.select()),lineBias:Hi.number(5)},strip:{line:Hi.bool(!1)},face:{line:Hi.bool(!1)},arrow:{size:Hi.number(3),start:Hi.bool(!1),end:Hi.bool(!1)},ticks:{normal:Hi.vec3(0,0,1),size:Hi.positive(Hi.number(10)),epsilon:Hi.positive(Hi.number(.001))},attach:{offset:Hi.vec2(0,-20),snap:Hi.bool(!1),depth:Hi.number(0)},format:{digits:Hi.nullable(Hi.positive(Hi.number(3))),data:Hi.nullable(Hi.data()),expr:Hi.nullable(Hi.func()),live:Hi.bool(!0)},font:{font:Hi.font("sans-serif"),style:Hi.string(),variant:Hi.string(),weight:Hi.string(),detail:Hi.number(24),sdf:Hi.number(5)},label:{text:Hi.select(),size:Hi.number(16),outline:Hi.number(2),expand:Hi.number(0),background:Hi.color(1,1,1)},overlay:{opacity:Hi.number(1),zIndex:Hi.positive(Hi.round(0))},dom:{points:Hi.select(),html:Hi.select(),size:Hi.number(16),outline:Hi.number(2),zoom:Hi.number(1),color:Hi.nullable(Hi.color()),attributes:Hi.nullable(Hi.object()),pointerEvents:Hi.bool(!1)},texture:{minFilter:Hi.filter("nearest"),magFilter:Hi.filter("nearest"),type:Hi.type("float")},shader:{sources:Hi.nullable(Hi.select()),indices:Hi.number(4),channels:Hi.number(4),language:Hi.string("glsl"),code:Hi.string(),uniforms:Hi.nullable(Hi.object())},include:{shader:Hi.select()},operator:{source:Hi.select()},spread:{unit:Hi.mapping(),items:Hi.nullable(Hi.vec4()),width:Hi.nullable(Hi.vec4()),height:Hi.nullable(Hi.vec4()),depth:Hi.nullable(Hi.vec4()),alignItems:Hi.anchor(),alignWidth:Hi.anchor(),alignHeight:Hi.anchor(),alignDepth:Hi.anchor()},grow:{scale:Hi.number(1),items:Hi.nullable(Hi.anchor()),width:Hi.nullable(Hi.anchor()),height:Hi.nullable(Hi.anchor()),depth:Hi.nullable(Hi.anchor())},split:{order:Hi.transpose("wxyz"),axis:Hi.nullable(Hi.axis()),length:Hi.int(1),overlap:Hi.int(0)},join:{order:Hi.transpose("wxyz"),axis:Hi.nullable(Hi.axis()),overlap:Hi.int(0)},swizzle:{order:Hi.swizzle()},transpose:{order:Hi.transpose()},repeat:{items:Hi.number(1),width:Hi.number(1),height:Hi.number(1),depth:Hi.number(1)},slice:{items:Hi.nullable(Hi.vec2()),width:Hi.nullable(Hi.vec2()),height:Hi.nullable(Hi.vec2()),depth:Hi.nullable(Hi.vec2())},reverse:{items:Hi.bool(!1),width:Hi.bool(!1),height:Hi.bool(!1),depth:Hi.bool(!1)},lerp:{size:Hi.mapping("absolute"),items:Hi.nullable(Hi.number()),width:Hi.nullable(Hi.number()),height:Hi.nullable(Hi.number()),depth:Hi.nullable(Hi.number())},subdivide:{items:Hi.nullable(Hi.positive(Hi.int(),!0)),width:Hi.nullable(Hi.positive(Hi.int(),!0)),height:Hi.nullable(Hi.positive(Hi.int(),!0)),depth:Hi.nullable(Hi.positive(Hi.int(),!0)),bevel:Hi.number(1),lerp:Hi.bool(!0)},resample:{indices:Hi.number(4),channels:Hi.number(4),sample:Hi.mapping(),size:Hi.mapping("absolute"),items:Hi.nullable(Hi.number()),width:Hi.nullable(Hi.number()),height:Hi.nullable(Hi.number()),depth:Hi.nullable(Hi.number())},readback:{type:Hi.type("float"),expr:Hi.nullable(Hi.func()),data:Hi.data(),channels:Hi.enum(4,[1,2,3,4]),items:Hi.nullable(Hi.int()),width:Hi.nullable(Hi.int()),height:Hi.nullable(Hi.int()),depth:Hi.nullable(Hi.int())},root:{speed:Hi.number(1),camera:Hi.select("[camera]")},inherit:{source:Hi.select(),traits:Hi.array(Hi.string())},rtt:{size:Hi.mapping("absolute"),width:Hi.nullable(Hi.number()),height:Hi.nullable(Hi.number()),history:Hi.int(1)},compose:{alpha:Hi.bool(!1)},present:{index:Hi.int(1),directed:Hi.bool(!0),length:Hi.number(0)},slide:{order:Hi.nullable(Hi.int(0)),steps:Hi.number(1),early:Hi.int(0),late:Hi.int(0),from:Hi.nullable(Hi.int(0)),to:Hi.nullable(Hi.int(1))},transition:{stagger:Hi.vec4(),enter:Hi.nullable(Hi.number(1)),exit:Hi.nullable(Hi.number(1)),delay:Hi.number(0),delayEnter:Hi.nullable(Hi.number(0)),delayExit:Hi.nullable(Hi.number(0)),duration:Hi.number(.3),durationEnter:Hi.nullable(Hi.number(0)),durationExit:Hi.nullable(Hi.number(0))},move:{from:Hi.vec4(),to:Hi.vec4()},seek:{seek:Hi.nullable(Hi.number(0))},track:{target:Hi.select(),script:Hi.object({}),ease:Hi.ease("cosine")},trigger:{trigger:Hi.nullable(Hi.int(1),!0)},step:{playback:Hi.ease("linear"),stops:Hi.nullable(Hi.array(Hi.number())),delay:Hi.number(0),duration:Hi.number(.3),pace:Hi.number(0),speed:Hi.number(1),rewind:Hi.number(2),skip:Hi.bool(!0),realtime:Hi.bool(!1)},play:{delay:Hi.number(0),pace:Hi.number(1),speed:Hi.number(1),from:Hi.number(0),to:Hi.number(1/0),realtime:Hi.bool(!1),loop:Hi.bool(!1)},now:{now:Hi.nullable(Hi.timestamp()),seek:Hi.nullable(Hi.number(0)),pace:Hi.number(1),speed:Hi.number(1)}},Xi=function(t,e,i,n,r,s,o,a,l,h){let u,c,p;null==h&&(h=!0),i||(i=10),n||(n=1),r||(r=10),s||(s=1);const d=(e-t)/i;if(!h)return u=(()=>{let e,n;const r=[];for(c=0,n=i,e=0<=n;e?c<=n:c>=n;e?c++:c--)r.push(t+c*d);return r})(),o||u.shift(),a||u.pop(),l||(u=u.filter((t=>0!==t))),u;n||(n=1),r||(r=10);const f=n*Math.pow(r,Math.floor(Math.log(d/n)/Math.log(r))),m=r%2==0?[r/2,1,.5]:r%3==0?[r/3,1,1/3]:[1],g=(()=>{const t=[];for(p of Array.from(m))t.push(f*p);return t})();let v=1/0,y=g.reduce((function(t,e){p=e/d;const i=Math.max(p,1/p);return i<v?(v=i,e):t}),f);return y*=s,t=Math.ceil(t/y+ +!o)*y,e=(Math.floor(e/y)-+!a)*y,i=Math.ceil((e-t)/y),u=(()=>{let e,n;const r=[];for(c=0,n=i,e=0<=n;e?c<=n:c>=n;e?c++:c--)r.push(t+c*y);return r})(),l||(u=u.filter((t=>0!==t))),u},Gi=function(t,e,i,n,r,s,o,a,l,h){throw new Error("Log ticks not yet implemented.")},Yi=function(t,e,i,n,r,s,o,a,l,h,u){switch(t){case 0:return Xi(e,i,n,r,s,o,a,l,h,u);case 1:return Gi(e,i,n,r,s,o,a,l,h,u)}},Zi={bind:{make(t){null==this.bind&&(this.bind={}),null==this.bound&&(this.bound=[]);for(const e of Array.from(t)){let{callback:t}=e;const{to:i,trait:n,optional:r,unique:s,multiple:o}=e;null==t&&(t=this.rebuild);const a=i.split(/\./g).pop(),l=this._get(i);let h=null;if(null!=l){let e=this,i=!1;for(;!i;){e=h=this._attach(l,n,t,this,e,r,o);const a=s&&(null==h||this.bound.indexOf(h)<0);i=o||r||!s||a}}if(null!=h)if(null!=this.resize&&this._listen(h,"source.resize",this.resize),t&&this._listen(h,"source.rebuild",t),o)for(const t of Array.from(h))this.bound.push(t);else this.bound.push(h);this.bind[a]=h}return null},unmake(){if(this.bind)return delete this.bind,delete this.bound}},span:{make(){return this.spanView=this._inherit("view"),this._listen("view","view.range",(()=>this.trigger({type:"span.range"})))},unmake(){return delete this.spanView},get:function(){const t=new S.Vector2(-1,1);return function(e,i){let n;const r=this._get(e+"span.range");return null!=r?r:null!=(n=null!=this.spanView?this.spanView.axis(i):void 0)?n:t}}()},scale:{divide(t){const e=this._get(t+"scale.divide"),i=this._get(t+"scale.factor");return Math.round(2.5*e/i)},generate(t,e,i,n){const r=this._get(t+"scale.mode"),s=this._get(t+"scale.divide"),o=this._get(t+"scale.unit"),a=this._get(t+"scale.base"),l=this._get(t+"scale.factor"),h=this._get(t+"scale.start"),u=this._get(t+"scale.end"),c=this._get(t+"scale.zero"),p=this._get(t+"scale.nice"),d=Yi(r,i,n,s,o,a,l,h,u,c,p);return e.copy(d),d}},style:{uniforms(){return{styleColor:this.node.attributes["style.color"],styleOpacity:this.node.attributes["style.opacity"],styleZBias:this.node.attributes["style.zBias"],styleZIndex:this.node.attributes["style.zIndex"]}}},arrow:{uniforms(){const{start:t}=this.props,{end:e}=this.props,i=this._attributes.make(this._types.number(1.25/(t+e))),n=this._attributes.make(this._types.vec2(+t,+e)),r=this.node.attributes["arrow.size"];return{clipStyle:n,clipRange:r,clipSpace:i,arrowSpace:i,arrowSize:r}}},point:{uniforms(){return{pointSize:this.node.attributes["point.size"],pointDepth:this.node.attributes["point.depth"]}}},line:{uniforms(){return{lineWidth:this.node.attributes["line.width"],lineDepth:this.node.attributes["line.depth"],lineProximity:this.node.attributes["line.proximity"]}}},surface:{uniforms:()=>({})},shade:{pipeline(t){if(!this._inherit("fragment"))return t;null==t&&(t=this._shaders.shader());for(let e=0;e<=2;e++)t=Ji(this._inherit("fragment"),(i=>i.fragment(t,e)));return t.pipe("fragment.map.rgba"),t},normal:t=>(t.pipe(ie("xyz")),t),map(t){return t?this._shaders.shader().pipe("mesh.map.uvwo").pipe(t):t}},position:{pipeline(t){if(!this._inherit("vertex"))return t;null==t&&(t=this._shaders.shader());for(let e=0;e<=3;e++)t=Ji(this._inherit("vertex"),(i=>i.vertex(t,e)));return t},swizzle(t,e){if(t)return this._shaders.shader().pipe(ie(e)).pipe(t)},swizzle2(t,e,i){if(t)return this._shaders.shader().split().pipe(ie(e)).next().pipe(ie(i)).join().pipe(t)}},visible:{make(){const t={type:"visible.change"};let e=null;this.setVisible=function(t){return null!=t&&(e=t),i()};const i=()=>{let i;const r=this.isVisible;let s=null==(i=null!=e?e:this._get("object.visible"))||i;if(null!=n&&s&&(s=n.isVisible),this.isVisible=s,r!==this.isVisible)return this.trigger(t)},n=this._inherit("visible");return n&&this._listen(n,"visible.change",i),this.is("object")&&this._listen(this.node,"change:object",i),i()},unmake(){return delete this.isVisible}},active:{make(){const t={type:"active.change"};let e=null;this.setActive=function(t){return null!=t&&(e=t),i()};const i=()=>{let i;const r=this.isActive;let s=null==(i=null!=e?e:this._get("entity.active"))||i;if(null!=n&&s&&(s=n.isActive),this.isActive=s,r!==this.isActive)return this.trigger(t)},n=this._inherit("active");return n&&this._listen(n,"active.change",i),this.is("entity")&&this._listen(this.node,"change:entity",i),i()},unmake(){return delete this.isActive}},object:{make(t){let e,i;null==t&&(t=[]),this.objects=t,this.renders=this.objects.reduce(((t,e)=>t.concat(e.renders)),[]);const n=this._inherit("scene");let r=e=i=null;const s=Array.from(this.traits).includes("style");r=1,e=S.NormalBlending;let o=!0,a=!0;s&&(({opacity:r}=this.props),({blending:e}=this.props),({zOrder:i}=this.props),({zWrite:o}=this.props),({zTest:a}=this.props));const l=()=>{const t=null!=i?-i:this.node.order;return(null==this.isVisible||this.isVisible)&&r>0?s?(()=>{const i=[];for(const n of Array.from(this.objects))n.show(r<1,e,t),i.push(n.depth(o,a));return i})():(()=>{const i=[];for(const n of Array.from(this.objects))i.push(n.show(!0,e,t));return i})():(()=>{const t=[];for(const e of Array.from(this.objects))t.push(e.hide());return t})()};this._listen(this.node,"change:style",(t=>{const{changed:n}=t;let s=null;if(n["style.opacity"]&&(s=r=this.props.opacity),n["style.blending"]&&(s=e=this.props.blending),n["style.zOrder"]&&(s=i=this.props.zOrder),n["style.zWrite"]&&(s=o=this.props.zWrite),n["style.zTest"]&&(s=a=this.props.zTest),null!=s)return l()})),this._listen(this.node,"reindex",l),this._listen(this,"visible.change",l);for(const t of Array.from(this.objects))n.adopt(t);return l()},unmake(t){let e;if(null==t&&(t=!0),!this.objects)return;const i=this._inherit("scene");for(e of Array.from(this.objects))i.unadopt(e);return t?(()=>{const t=[];for(e of Array.from(this.objects))t.push(e.dispose());return t})():void 0},mask(){let t,e;if(t=this._inherit("mask"))return t.mask(e)}},unit:{make(){let t,e,i,n,r,s,o,a,l,h,u,c,p=Math.PI;this.unitUniforms={renderScaleInv:a=this._attributes.make(this._types.number(1)),renderScale:o=this._attributes.make(this._types.number(1)),renderAspect:n=this._attributes.make(this._types.number(1)),renderWidth:l=this._attributes.make(this._types.number(0)),renderHeight:r=this._attributes.make(this._types.number(0)),viewWidth:u=this._attributes.make(this._types.number(0)),viewHeight:h=this._attributes.make(this._types.number(0)),pixelRatio:e=this._attributes.make(this._types.number(1)),pixelUnit:i=this._attributes.make(this._types.number(1)),worldUnit:c=this._attributes.make(this._types.number(1)),focusDepth:t=this._attributes.make(this._types.number(1)),renderOdd:s=this._attributes.make(this._types.vec2())};const d=new S.Vector3,f=new S.Vector3,m=()=>{let m,v;if(null==(v=null!=g?g.getSize():void 0))return;p=Math.PI;const{scale:y}=this.props,{fov:b}=this.props,x=null!=this.props.focus?this.props.focus:this.inherit("unit").props.focus,w=null===y;let _=1;if(m=null!=g?g.getCamera():void 0){const t=m.projectionMatrix;d.set(0,-.5,1).applyMatrix4(t),f.set(0,.5,1).applyMatrix4(t),d.sub(f),_=d.y}const k=v.renderHeight/v.viewHeight,z=null!=b?_*Math.tan(b*p/360):1,S=w?k:v.renderHeight/y*z,M=v.renderHeight*_/2,A=S/M;return u.value=v.viewWidth,h.value=v.viewHeight,l.value=v.renderWidth,r.value=v.renderHeight,n.value=v.aspect,o.value=M,a.value=1/M,e.value=k,i.value=S,c.value=A,t.value=x,s.value.set(v.renderWidth%2,v.renderHeight%2).multiplyScalar(.5)},g=this.is("root")?this:this._inherit("root");return this._listen(g,"root.update",m),m()},unmake(){return delete this.unitUniforms},get(){const t={};for(const e in this.unitUniforms){const i=this.unitUniforms[e];t[e]=i.value}return t},uniforms(){return this.unitUniforms}}},Qi=function(t,e){const i={};for(const n of Array.from(e)){let e;if(e=Zi[n]){i[n]={};for(const r in e){const s=e[r];i[n][r]=s.bind(t)}}}return i};function Ji(t,e){return null!=t?e(t):void 0}class Ki{constructor(t,e){this.context=e,this.classes=t.Classes,this.helpers=t.Helpers}getTypes(){return Object.keys(this.classes)}make(t,e,i=null){null==e&&(e={});const n=this.classes[t];if(null==n)throw new Error(`Unknown primitive class \`${t}\``);const r=new n.model(t,n.defaults,e,i,n,this.context.attributes);return new n(r,this.context,this.helpers),r}}const tn=d;class en{constructor(t,e){this.renderer=t,this.shaders=e,this.gl=this.renderer.getContext(),null==this.uniforms&&(this.uniforms={})}dispose(){this.uniforms=null}_adopt(t){for(const e in t){const i=t[e];this.uniforms[e]=i}}_set(t){for(const e in t){const i=t[e];null!=this.uniforms[e]&&(this.uniforms[e].value=i)}}}class nn extends S.Object3D{constructor(){super(),this.rotationAutoUpdate=!1,this.frustumCulled=!1,this.matrixAutoUpdate=!1}}class rn extends en{constructor(t,e,i){super(t,e,i),this.root=new nn,null!=(null!=i?i.scene:void 0)&&(this.scene=i.scene),null==this.scene&&(this.scene=new S.Scene),this.pending=[],this.async=0,this.scratch=new S.WebGLRenderTarget(1,1),this.camera=new S.PerspectiveCamera}inject(t){return null!=t&&(this.scene=t),this.scene.add(this.root)}unject(){return null!=this.scene?this.scene.remove(this.root):void 0}add(t){return this.async?this.pending.push(t):this._add(t)}remove(t){if(this.pending=this.pending.filter((e=>e!==t)),null!=t.parent)return this._remove(t)}_add(t){return this.root.add(t)}_remove(t){return this.root.remove(t)}dispose(){if(null!=this.root.parent)return this.unject()}warmup(t){return this.async=+t||0}render(){if(!this.pending.length)return;const{children:t}=this.root,e=[];for(let t=0,i=this.async,n=0<=i;n?t<i:t>i;n?t++:t--){const t=this.pending.shift();if(!t)break;this._add(t),e.push(e)}const i=t.map((function(t){return t.visible}));t.map((t=>t.visible=!Array.from(e).includes(t)));const n=this.renderer.getRenderTarget();return this.renderer.setRenderTarget(this.scratch),this.renderer.render(this.scene,this.camera),this.renderer.setRenderTarget(n),t.map(((t,e)=>t.visible=i[e]))}toJSON(){return this.root.toJSON()}}class sn{constructor(t,e,i){this.classes=t,this.renderer=e,this.shaders=i}getTypes(){return Object.keys(this.classes)}make(t,e){return new this.classes[t](this.renderer,this.shaders,e)}}class on extends en{constructor(t,e,i){super(t,e),null==this.items&&(this.items=i.items||1),null==this.samples&&(this.samples=i.samples||1),null==this.channels&&(this.channels=i.channels||4),null==this.callback&&(this.callback=i.callback||function(){})}dispose(){return super.dispose()}update(){const t=this.fill();return this.write(t),t}setActive(t,e,i,n){}setCallback(t){this.callback=t}write(){}fill(){}generate(t){return Ut(t,this.samples,this.channels,this.items)}}class an{constructor(t,e,i,n,r){this.renderer=t,this.width=e,this.height=i,this.channels=n,this.n=this.width*this.height*this.channels;const s=this.renderer.getContext();this.gl=s;const o=null!=(null!=r?r.minFilter:void 0)?null!=r?r.minFilter:void 0:S.NearestFilter,a=null!=(null!=r?r.magFilter:void 0)?null!=r?r.magFilter:void 0:S.NearestFilter,l=null!=(null!=r?r.type:void 0)?null!=r?r.type:void 0:S.FloatType;this.minFilter=Et(s,o),this.magFilter=Et(s,a),this.type=Et(s,l),this.ctor=Pt(l),this.build(r)}build(t){const{gl:e}=this,i=this.renderer.state;this.texture=e.createTexture(),this.format=[null,e.LUMINANCE,e.LUMINANCE_ALPHA,e.RGB,e.RGBA][this.channels],this.format3=[null,S.LuminanceFormat,S.LuminanceAlphaFormat,S.RGBFormat,S.RGBAFormat][this.channels],i.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,this.minFilter),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,this.magFilter),this.data=new this.ctor(this.n),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.texImage2D(e.TEXTURE_2D,0,this.format,this.width,this.height,0,this.format,this.type,this.data),this.textureObject=new S.Texture(new Image,S.UVMapping,S.ClampToEdgeWrapping,S.ClampToEdgeWrapping,null!=t?t.minFilter:void 0,null!=t?t.magFilter:void 0),this.textureProperties=this.renderer.properties.get(this.textureObject),this.textureProperties.__webglInit=!0,this.textureProperties.__webglTexture=this.texture,this.textureObject.format=this.format3,this.textureObject.type=S.FloatType,this.textureObject.unpackAlignment=1,this.textureObject.flipY=!1,this.textureObject.generateMipmaps=!1,this.uniforms={dataResolution:{type:"v2",value:new S.Vector2(1/this.width,1/this.height)},dataTexture:{type:"t",value:this.textureObject}}}write(t,e,i,n,r){const{gl:s}=this;return this.renderer.state.bindTexture(s.TEXTURE_2D,this.texture),s.pixelStorei(s.UNPACK_ALIGNMENT,1),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),s.texSubImage2D(s.TEXTURE_2D,0,e,i,n,r,this.format,this.type,t)}dispose(){return this.gl.deleteTexture(this.texture),this.textureProperties.__webglInit=!1,this.textureProperties.__webglTexture=null,this.textureProperties=null,this.textureObject=this.texture=null}}class ln extends on{constructor(t,e,i,n){null==n&&(n=!0);const r=i.width||1,s=i.height||1,o=i.depth||1,a=r*s*o;i.samples||(i.samples=a),super(t,e,i),this.width=r,this.height=s,this.depth=o,null==this.samples&&(this.samples=a),n&&this.build(i)}shader(t,e){null==e&&(e=4),this.items>1||this.depth>1?(4!==e&&t.pipe(Kt(e,4)),t.pipe("map.xyzw.texture",this.uniforms)):2!==e&&t.pipe(te(e,2));const i=this.wrap?".wrap":"";return t.pipe(`map.2d.data${i}`,this.uniforms),t.pipe("sample.2d",this.uniforms),this.channels<4&&t.pipe(ie(["0000","x000","xw00","xyz0"][this.channels])),t}build(t){this.data=new Float32Array(this.samples*this.channels*this.items),this.texture=new an(this.renderer,this.items*this.width,this.height*this.depth,this.channels,t),this.filled=0,this.used=0,this._adopt(this.texture.uniforms),this._adopt({dataPointer:{type:"v2",value:new S.Vector2},textureItems:{type:"f",value:this.items},textureHeight:{type:"f",value:this.height}}),this.dataPointer=this.uniforms.dataPointer.value,this.streamer=this.generate(this.data)}dispose(){return this.data=null,this.texture.dispose(),super.dispose()}getFilled(){return this.filled}setCallback(t){return this.callback=t,this.filled=0}copy(t){const e=Math.min(t.length,this.samples*this.channels*this.items),i=this.data;for(let n=0,r=e,s=0<=r;s?n<r:n>r;s?n++:n--)i[n]=t[n];this.write(Math.ceil(e/this.channels/this.items))}write(t){null==t&&(t=this.samples);let e=t/this.width;t*=this.items;const i=e<1?t:this.items*this.width;e=Math.ceil(e),this.texture.write(this.data,0,0,i,e),this.dataPointer.set(.5,.5),this.filled=1,this.used=t}through(t,e){let i,n;const{consume:r,done:s}=n=this.streamer,{emit:o}=i=e.streamer;let a=0,l=()=>r(((e,i,n,r)=>t(o,e,i,n,r,a)));return l=Lt(l,this.items),()=>{n.reset(),i.reset();const t=this.used;for(a=0;!s()&&a<t;)l(),a++;return n.count()}}}class hn extends S.BufferGeometry{constructor(){super(),new S.BufferGeometry(this),null==this.uniforms&&(this.uniforms={}),null==this.groups&&(this.groups=[])}_reduce(t,e){let i=!1;for(let n=0;n<t.length;n++){const r=t[n],s=e[n];i&&(t[n]=s),r>1&&(i=!0)}return t.reduce(((t,e)=>t*e))}_emitter(t){const e="index"==t?this.getIndex():this.getAttribute(t),i=e.itemSize,{array:n}=e;let r=0;return[null,function(t){n[r++]=t},function(t,e){n[r++]=t,n[r++]=e},function(t,e,i){n[r++]=t,n[r++]=e,n[r++]=i},function(t,e,i,s){n[r++]=t,n[r++]=e,n[r++]=i,n[r++]=s}][i]}_finalize(){}_offsets(t){this.groups=t}}class un extends hn{_clipUniforms(){return this.geometryClip=new S.Vector4(1e10,1e10,1e10,1e10),this.geometryResolution=new S.Vector4,this.mapSize=new S.Vector4,null==this.uniforms&&(this.uniforms={}),this.uniforms.geometryClip={type:"v4",value:this.geometryClip},this.uniforms.geometryResolution={type:"v4",value:this.geometryResolution},this.uniforms.mapSize={type:"v4",value:this.mapSize}}_clipGeometry(t,e,i,n){const r=t=>Math.max(0,t-1),s=t=>1/Math.max(1,t-1);return this.geometryClip.set(r(t),r(e),r(i),r(n)),this.geometryResolution.set(s(t),s(e),s(i),s(n))}_clipMap(t,e,i,n){return this.mapSize.set(t,e,i,n)}_clipOffsets(t,e,i,n,r,s,o,a,l){const h=[n,i,e,r],u=[a,o,s,l],c=this._reduce(h,u);return this._offsets([{start:0,count:c*t,materialIndex:0}])}}class cn extends un{constructor(t){let e,i,n,r,s,o,a,l,h,u,c;super(t),this._clipUniforms(),this.sides=l=+t.sides||12,this.samples=a=+t.samples||2,this.strips=h=+t.strips||1,this.ribbons=o=+t.ribbons||1,this.layers=s=+t.layers||1,this.flip=i=null!=t.flip&&t.flip,this.closed=n=null!=t.closed&&t.closed,this.anchor=e=null!=t.anchor?t.anchor:i||n?0:a-1;const p=h*o*s,d=(l+2)*p,f=2*l*p;this.setIndex(new S.BufferAttribute(new Uint32Array(3*f),1)),this.setAttribute("position4",new S.BufferAttribute(new Float32Array(4*d),4)),this.setAttribute("arrow",new S.BufferAttribute(new Float32Array(3*d),3)),this.setAttribute("attach",new S.BufferAttribute(new Float32Array(2*d),2));const m=this._emitter("index"),g=this._emitter("position4"),v=this._emitter("arrow"),y=this._emitter("attach"),b=[];for(r=0,c=l,u=0<=c;u?r<c:r>c;u?r++:r--){const t=r/l*2*Math.PI;b.push([Math.cos(t),Math.sin(t),1])}let x=0;for(let t=0,e=p,i=0<=e;i?t<e:t>e;i?t++:t--){let t,e;const i=x++,n=i+l+1;for(r=0,e=l,t=0<=e;t?r<e:r>e;t?r++:r--){const t=x+r%l,e=x+(r+1)%l;m(i),m(t),m(e),m(e),m(t),m(n)}x+=l+1}const w=i?1:n?a-1:-1,_=i&&!n?a-1:0,k=e;for(let t=0,e=s,i=0<=e;i?t<e:t>e;i?t++:t--)for(let e=0,i=o,n=0<=i;n?e<i:e>i;n?e++:e--)for(let i=0,n=h,s=0<=n;s?i<n:i>n;s?i++:i--){let n,s;for(g(k,i,e,t),v(0,0,0),y(w,_),r=0,s=l,n=0<=s;n?r<s:r>s;n?r++:r--){g(k,i,e,t);const n=b[r];v(n[0],n[1],n[2]),y(w,_)}g(k,i,e,t),v(0,0,1),y(w,_)}this._finalize(),this.clip()}clip(t,e,i,n){let r;if(null==t&&({samples:t}=this),null==e&&({strips:e}=this),null==i&&({ribbons:i}=this),null==n&&({layers:n}=this),this._clipGeometry(t,e,i,n),t>0){const t=[n,i,e],s=[this.layers,this.ribbons,this.strips];r=this.sides*this._reduce(t,s)}else r=0;return this._offsets([{start:0,count:6*r,materialIndex:0}])}}class pn extends en{constructor(t,e,i){super(t,e,i),this.zUnits=null!=i.zUnits?i.zUnits:0}raw(){for(const t of Array.from(this.renders))this._raw(t);return null}depth(t,e){for(const i of Array.from(this.renders))this._depth(i,t,e);return null}polygonOffset(t,e){for(const i of Array.from(this.renders))this._polygonOffset(i,t,e);return null}show(t,e,i){return Array.from(this.renders).map((n=>this._show(n,t,e,i)))}hide(){for(const t of Array.from(this.renders))this._hide(t);return null}_injectPreamble(t,e){const i=t+"\n"+e;return e.match(/#extension/)?this._hoist(i):i}_hoist(t){const e=t.split("\n"),i=[];for(const t of Array.from(e))t.match(/^\s*#extension/)?i.unshift(t):i.push(t);return i.join("\n")}_material(t){const e=this.renderer.capabilities.precision,i=`    precision ${e} float;\n    precision ${e} int;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;`,n=`    precision ${e} float;\n    precision ${e} int;\nuniform mat4 viewMatrix;\nuniform vec3 cameraPosition;`,r={};Object.assign(r,t),delete r.attributes,delete r.varyings,delete r.inspect,delete r.vertexGraph,delete r.fragmentGraph;const s=new S.RawShaderMaterial(r);return["vertexGraph","fragmentGraph","inspect"].forEach((e=>s[e]=t[e])),s.vertexShader=this._injectPreamble(i,s.vertexShader),s.fragmentShader=this._injectPreamble(n,s.fragmentShader),s}_raw(t){t.rotationAutoUpdate=!1,t.frustumCulled=!1,t.matrixAutoUpdate=!1,t.material.defaultAttributeValues=void 0}_depth(t,e,i){const n=t.material;return n.depthWrite=e,n.depthTest=i}_polygonOffset(t,e,i){const n=0!==(i-=this.zUnits),r=t.material;if(r.polygonOffset=n,n)return r.polygonOffsetFactor=e,r.polygonOffsetUnits=i}_show(t,e,i,n){const r=t.material;return t.renderOrder=-n,t.visible=!0,r.transparent=true,r.blending=i,null}_hide(t){return t.visible=!1}_vertexColor(t,e){if(!t&&!e)return;const i=this.shaders.shader();return t&&(i.require(t),i.pipe("mesh.vertex.color",this.uniforms)),e&&(i.require(e),i.pipe("mesh.vertex.mask",this.uniforms)),i}_vertexPosition(t,e,i,n,r){let s;const o=this.shaders.shader();return(i||e&&!0!==e)&&(s={},(n>0||r)&&(s.POSITION_MAP=""),n>0&&(s[["POSITION_U","POSITION_UV","POSITION_UVW","POSITION_UVWO"][n-1]]=""),r&&(s.POSITION_STPQ="")),o.require(t),o.pipe("mesh.vertex.position",this.uniforms,s)}_fragmentColor(t,e,i,n,r,s,o,a,l){const h=this.shaders.shader();let u=!1,c=!1;const p={};return s>0&&(p[["POSITION_U","POSITION_UV","POSITION_UVW","POSITION_UVWO"][s-1]]=""),o&&(p.POSITION_STPQ=""),t&&(h.pipe("style.color",this.uniforms),u=!0,(i||r||e)&&(l&&!i||h.pipe("mesh.gamma.in"),c=!0)),i&&(h.isolate(),h.pipe("mesh.fragment.color",this.uniforms),l&&!u||h.pipe("mesh.gamma.in"),h.end(),u&&h.pipe(Jt("vec4","*")),l&&u&&h.pipe("mesh.gamma.out"),u=!0,c=!0),r&&(!u&&a&&h.pipe(se("vec4","vec4(1.0)")),h.isolate(),h.require(r),h.pipe("mesh.fragment.map",this.uniforms,p),l||h.pipe("mesh.gamma.in"),h.end(),a?h.pipe(a):u&&h.pipe(Jt("vec4","*")),u=!0,c=!0),e&&(u||h.pipe(se("vec4","vec4(1.0)")),!0===e?h.pipe("mesh.fragment.shaded",this.uniforms):(h.require(e),h.pipe("mesh.fragment.material",this.uniforms,p)),c=!0),c&&!l&&h.pipe("mesh.gamma.out"),n&&(h.pipe("mesh.fragment.mask",this.uniforms),u&&h.pipe(Jt("vec4","*"))),h}}class dn extends an{constructor(t,e,i,n,r){super(t,e,i,n,r),this.data=new this.ctor(this.n)}resize(t,e){const i=this.data,n=this.width,r=this.height;this.width=t,this.height=e,this.n=t*e*this.channels,this.data=new this.ctor(this.n);const{gl:s}=this;return this.renderer.state.bindTexture(s.TEXTURE_2D,this.texture),s.pixelStorei(s.UNPACK_ALIGNMENT,1),s.texImage2D(s.TEXTURE_2D,0,this.format,t,e,0,this.format,this.type,this.data),this.uniforms.dataResolution.value.set(1/t,1/e),this.write(i,0,0,n,r)}write(t,e,i,n,r){let s;const{width:o}=this,a=this.data,{channels:l}=this;let h=0;if(o===n&&0===e){s=i*n*l;const e=n*r*l;for(;h<e;)a[s++]=t[h++]}else{const u=o*l,c=n*l,p=e*l;let d=i;const f=i+r;for(;d<f;){let e=0;for(s=p+d*u;e++<c;)a[s++]=t[h++];d++}}return super.write(t,e,i,n,r)}dispose(){return this.data=null,super.dispose()}}class fn extends en{constructor(t,e,i,n){null==n&&(n=!0),super(t,e),null==this.width&&(this.width=i.width||512),null==this.height&&(this.height=i.height||512),null==this.channels&&(this.channels=i.channels||4),null==this.backed&&(this.backed=i.backed||!1),this.samples=this.width*this.height,n&&this.build(i)}shader(t){return t.pipe("map.2d.data",this.uniforms),t.pipe("sample.2d",this.uniforms),this.channels<4&&t.pipe(ie(["0000","x000","xw00","xyz0"][this.channels])),t}build(t){let e;return this.klass=e=this.backed?dn:an,this.texture=new e(this.renderer,this.width,this.height,this.channels,t),this.uniforms={dataPointer:{type:"v2",value:new S.Vector2(0,0)}},this._adopt(this.texture.uniforms),this.reset()}reset(){return this.rows=[],this.bottom=0}resize(t,e){if(!this.backed)throw new Error("Cannot resize unbacked texture atlas");return t>2048&&e>2048?console.warn(`Giant text atlas ${t}x${e}.`):console.info(`Resizing text atlas ${t}x${e}.`),this.texture.resize(t,e),this.width=t,this.height=e,this.samples=t*e}collapse(t){let e;const{rows:i}=this;var n,r;if(i.splice(i.indexOf(t),1),this.bottom=null!=(n=i[i.length-1],r=t=>t.bottom,e=null!=n?r(n):void 0)?e:0,this.last===t)return this.last=null}allocate(t,e,i,n){const r=this.width,s=this.height,o=2*i;if(e>r)return this.resize(2*r,2*s),this.last=null,this.allocate(t,e,i,n);let a=this.last;if(null!=a&&a.height>=i&&a.height<o&&a.width+e<=r)return void a.append(t,e,i,n);let l=0,h=-1,u=0;for(let s=0;s<this.rows.length;s++){a=this.rows[s];if(a.top-l>=i&&h<0&&(h=s,u=l),({bottom:l}=a),a.height>=i&&a.height<o&&a.width+e<=r)return a.append(t,e,i,n),void(this.last=a)}if(h>=0)a=new mn(u,i),this.rows.splice(h,0,a);else{if(u=l,l+=i,l>=s)return this.resize(2*r,2*s),this.last=null,this.allocate(t,e,i,n);a=new mn(u,i),this.rows.push(a),this.bottom=l}a.append(t,e,i,n),this.last=a}read(){return this.texture.textureObject}write(t,e,i,n,r){return this.texture.write(t,e,i,n,r)}dispose(){return this.texture.dispose(),this.data=null,super.dispose()}}class mn{constructor(t,e){this.top=t,this.bottom=t+e,this.width=0,this.height=e,this.alive=0,this.keys=[]}append(t,e,i,n){const r=this.width,s=this.top;return this.alive++,this.width+=e,this.keys.push(t),n(this,r,s)}}class gn extends un{constructor(t){let e,i,n,r,s;super(t),this._clipUniforms(),this.items=n=+t.items||2,this.width=s=+t.width||1,this.height=i=+t.height||1,this.depth=e=+t.depth||1,this.sides=r=Math.max(0,n-2);const o=s*i*e,a=n*o,l=r*o;this.setIndex(new S.BufferAttribute(new Uint32Array(3*l),1)),this.setAttribute("position4",new S.BufferAttribute(new Float32Array(4*a),4));const h=this._emitter("index"),u=this._emitter("position4");let c=0;for(let t=0,e=o,i=0<=e;i?t<e:t>e;i?t++:t--){for(let t=0,e=r,i=0<=e;i?t<e:t>e;i?t++:t--)h(c),h(c+t+1),h(c+t+2);c+=n}for(let t=0,r=e,o=0<=r;o?t<r:t>r;o?t++:t--)for(let e=0,r=i,o=0<=r;o?e<r:e>r;o?e++:e--)for(let i=0,r=s,o=0<=r;o?i<r:i>r;o?i++:i--)for(let r=0,s=n,o=0<=s;o?r<s:r>s;o?r++:r--)u(i,e,t,r);this._finalize(),this.clip()}clip(t,e,i,n){null==t&&({width:t}=this),null==e&&({height:e}=this),null==i&&({depth:i}=this),null==n&&({items:n}=this);const r=Math.max(0,n-2);return this._clipGeometry(t,e,i,n),this._clipOffsets(3,t,e,i,r,this.width,this.height,this.depth,this.sides)}}class vn extends un{constructor(t){let e,i,n,r,s,o,a,l,h,u,c,p,d,f,m;super(t),this._clipUniforms(),this.closed=e=t.closed||!1,this.samples=h=(+t.samples||2)+(e?1:0),this.strips=c=+t.strips||1,this.ribbons=l=+t.ribbons||1,this.layers=a=+t.layers||1,this.detail=i=+t.detail||1;const g=h-1;this.joints=s=i-1,this.vertices=p=(g-(e?0:1))*s+h,this.segments=u=(g-(e?0:1))*s+g;const v=p*c*l*a*2,y=2*(u*c*l*a);this.setIndex(new S.BufferAttribute(new Uint32Array(3*y),1)),this.setAttribute("position4",new S.BufferAttribute(new Float32Array(4*v),4)),this.setAttribute("line",new S.BufferAttribute(new Float32Array(1*v),1)),i>1&&this.setAttribute("joint",new S.BufferAttribute(new Float32Array(v),1));const b=this._emitter("index"),x=this._emitter("position4"),w=this._emitter("line");i>1&&(r=this._emitter("joint"));let _=0;for(let t=0,e=l*a,i=0<=e;i?t<e:t>e;i?t++:t--)for(let t=0,e=c,i=0<=e;i?t<e:t>e;i?t++:t--){for(let t=0,e=u,i=0<=e;i?t<e:t>e;i?t++:t--)b(_),b(_+1),b(_+2),b(_+2),b(_+1),b(_+3),_+=2;_+=2}const k=e?()=>0:function(t){return 0===t?-1:t===h-1?1:0};if(i>1){let t,e;for(o=0,e=a,t=0<=e;t?o<e:o>e;t?o++:o--){let t,e;for(m=0,e=l,t=0<=e;t?m<e:m>e;t?m++:m--){let t,e;for(f=0,e=c,t=0<=e;t?f<e:f>e;t?f++:f--){let t,e,a;for(a=0,d=a,e=h,t=0<=e;t?a<e:a>e;t?a++:a--,d=a)if(n=k(d),0!==n)x(d,f,m,o),x(d,f,m,o),w(1),w(-1),r(.5),r(.5);else for(let t=0,e=i,n=0<=e;n?t<e:t>e;n?t++:t--)x(d,f,m,o),x(d,f,m,o),w(1),w(-1),r(t/s),r(t/s)}}}}else{let t,e;for(o=0,e=a,t=0<=e;t?o<e:o>e;t?o++:o--){let t,e;for(m=0,e=l,t=0<=e;t?m<e:m>e;t?m++:m--){let t,e;for(f=0,e=c,t=0<=e;t?f<e:f>e;t?f++:f--){let t,e,i;for(i=0,d=i,e=h,t=0<=e;t?i<e:i>e;t?i++:i--,d=i)x(d,f,m,o),x(d,f,m,o),w(1),w(-1)}}}}this._finalize(),this.clip()}clip(t,e,i,n){null==t&&(t=this.samples-this.closed),null==e&&({strips:e}=this),null==i&&({ribbons:i}=this),null==n&&({layers:n}=this);const r=t+(t-(this.closed?0:2))*this.joints-(this.closed?0:1);return t+=this.closed,this._clipGeometry(t,e,i,n),this._clipOffsets(6,r,e,i,n,this.segments,this.strips,this.ribbons,this.layers)}}class yn{constructor(t,e,i,n,r){this.gl=t,null==r&&(r={}),null==r.minFilter&&(r.minFilter=S.NearestFilter),null==r.magFilter&&(r.magFilter=S.NearestFilter),null==r.format&&(r.format=S.RGBAFormat),null==r.type&&(r.type=S.UnsignedByteType),this.options=r,this.width=e||1,this.height=i||1,this.frames=n||1,this.buffers=this.frames+1,this.build()}build(){let t;const e=()=>new S.WebGLRenderTarget(this.width,this.height,this.options);this.targets=(()=>{let i,n;const r=[];for(t=0,n=this.buffers,i=0<=n;i?t<n:t>n;i?t++:t--)r.push(e());return r})();const i=[];this.targets.forEach((t=>i.push(t.texture))),this.reads=i,this.write=this.targets[this.buffers-1],this.uniforms={dataResolution:{type:"v2",value:new S.Vector2(1/this.width,1/this.height)},dataTexture:{type:"t",value:this.reads[0]},dataTextures:{type:"tv",value:this.reads}}}cycle(){this.targets.unshift(this.targets.pop()),this.write=this.targets[this.buffers-1],this.reads.unshift(this.reads.pop()),this.uniforms.dataTexture.value=this.reads[0]}warmup(t){return(()=>{const e=[];for(let i=0,n=this.buffers,r=0<=n;r?i<n:i>n;r?i++:i--)t(this.write),e.push(this.cycle());return e})()}dispose(){for(const t of Array.from(this.targets))t.dispose();return this.targets=this.reads=this.write=null}}class bn extends en{constructor(t,e,i){super(t,e),this.scene=null!=i.scene?i.scene:new S.Scene,this.camera=i.camera,this.build(i)}shaderRelative(t){return null==t&&(t=this.shaders.shader()),t.pipe("sample.2d",this.uniforms)}shaderAbsolute(t,e,i){if(null==e&&(e=1),null==i&&(i=4),null==t&&(t=this.shaders.shader()),e<=1)return i>2&&t.pipe(te(i,2)),t.pipe("map.2d.data",this.uniforms),t.pipe("sample.2d",this.uniforms);{const n=Qt(Math.min(e,this.target.frames));return i<4&&t.pipe(Kt(i,4)),t.pipe("map.xyzw.2dv"),t.split(),t.pipe("map.2d.data",this.uniforms),t.pass(),t.pipe(n,this.uniforms)}}build(t){return this.camera||(this.camera=new S.PerspectiveCamera,this.camera.position.set(0,0,3),this.camera.lookAt(new S.Vector3)),"function"==typeof this.scene.inject&&this.scene.inject(),this.target=new yn(this.gl,t.width,t.height,t.frames,t),this.target.warmup((t=>this.renderer.setRenderTarget(t))),this.renderer.setRenderTarget(null),this._adopt(this.target.uniforms),this._adopt({dataPointer:{type:"v2",value:new S.Vector2(.5,.5)}}),this.filled=0}adopt(t){return Array.from(t.renders).map((t=>this.scene.add(t)))}unadopt(t){return Array.from(t.renders).map((t=>this.scene.remove(t)))}render(t){null==t&&({camera:t}=this);const e=this.renderer.getRenderTarget();if(this.renderer.setRenderTarget(this.target.write),this.renderer.render(null!=this.scene.scene?this.scene.scene:this.scene,t),this.renderer.setRenderTarget(e),this.target.cycle(),this.filled<this.target.frames)return this.filled++}read(t){return null==t&&(t=0),this.target.reads[Math.abs(t)]}getFrames(){return this.target.frames}getFilled(){return this.filled}dispose(){return"function"==typeof this.scene.unject&&this.scene.unject(),this.scene=this.camera=null,this.target.dispose(),super.dispose()}}class xn extends bn{constructor(t,e,i){let n,r;const s=i.items||1,o=i.channels||4,a=i.width||1,l=i.height||1,h=i.depth||1;i.format=S.RGBAFormat,i.width=r=s*a,i.height=n=l*h,i.frames=1,delete i.items,delete i.depth,delete i.channels,super(t,e,i),null==this.items&&(this.items=s),null==this.channels&&(this.channels=o),null==this.width&&(this.width=a),this._width=r,null==this.height&&(this.height=l),this._height=n,null==this.depth&&(this.depth=h),this._adopt({textureItems:{type:"f",value:this.items},textureHeight:{type:"f",value:this.height}})}shaderAbsolute(t){return null==t&&(t=this.shaders.shader()),t.pipe("map.xyzw.texture",this.uniforms),super.shaderAbsolute(t,1,2)}}class wn extends un{constructor(t,e){null==e&&(e=!0),super(),e&&this.construct(t)}construct(t){let e,i,n,r,s,o,a,l;this._clipUniforms(),this.closedX=e=t.closedX||!1,this.closedY=i=t.closedY||!1,this.width=l=(+t.width||2)+(e?1:0),this.height=n=(+t.height||2)+(i?1:0),this.surfaces=a=+t.surfaces||1,this.layers=r=+t.layers||1,this.segmentsX=s=Math.max(0,l-1),this.segmentsY=o=Math.max(0,n-1);const h=l*n*a*r,u=2*(s*o*a*r);this.setIndex(new S.BufferAttribute(new Uint32Array(3*u),1)),this.setAttribute("position4",new S.BufferAttribute(new Float32Array(4*h),4)),this.setAttribute("surface",new S.BufferAttribute(new Float32Array(2*h),2));const c=this._emitter("index"),p=this._emitter("position4");let d=0;for(let t=0,e=a*r,i=0<=e;i?t<e:t>e;i?t++:t--){for(let t=0,e=o,i=0<=e;i?t<e:t>e;i?t++:t--){for(let t=0,e=s,i=0<=e;i?t<e:t>e;i?t++:t--)c(d),c(d+1),c(d+l),c(d+l),c(d+1),c(d+l+1),d++;d++}d+=l}for(let t=0,e=r,i=0<=e;i?t<e:t>e;i?t++:t--)for(let e=0,i=a,r=0<=i;r?e<i:e>i;r?e++:e--)for(let i=0,r=i,s=n,o=0<=s;o?i<s:i>s;o?i++:i--,r=i)for(let i=0,n=i,s=l,o=0<=s;o?i<s:i>s;o?i++:i--,n=i)p(n,r,e,t);this._finalize(),this.clip()}clip(t,e,i,n){null==t&&(t=this.width-this.closedX),null==e&&(e=this.height-this.closedY),null==i&&({surfaces:i}=this),null==n&&({layers:n}=this),t+=this.closedX,e+=this.closedY;const r=Math.max(0,t-1),s=Math.max(0,e-1);return this._clipGeometry(t,e,i,n),this._clipOffsets(6,r,s,i,n,this.segmentsX,this.segmentsY,this.surfaces,this.layers)}map(t,e,i,n){return null==t&&({width:t}=this),null==e&&({height:e}=this),null==i&&({surfaces:i}=this),null==n&&({layers:n}=this),this._clipMap(t,e,i,n)}}class _n extends wn{constructor(t){t.width=Math.max(2,null!=+t.width?+t.width:2),t.height=Math.max(2,null!=+t.height?+t.height:2),super(t,!1),null==this.uniforms&&(this.uniforms={}),this.uniforms.geometryScale={type:"v4",value:new S.Vector4},this.cover(),this.construct(t)}cover(t,e,i,n){null==t&&(t=1),this.scaleX=t,null==e&&(e=1),this.scaleY=e,null==i&&(i=1),this.scaleZ=i,null==n&&(n=1),this.scaleW=n}clip(t,e,i,n){null==t&&({width:t}=this),null==e&&({height:e}=this),null==i&&({surfaces:i}=this),null==n&&({layers:n}=this),super.clip(t,e,i,n);const r=t=>1/Math.max(1,t-1);return this.uniforms.geometryScale.value.set(r(t)*this.scaleX,r(e)*this.scaleY,r(i)*this.scaleZ,r(n)*this.scaleW)}}class kn extends pn{constructor(t,e,i){let n;super(t,e,i);let{uniforms:r}=i;const{map:s,combine:o,stpq:a,linear:l}=i;null==r&&(r={});const h=null!=r.styleColor;this.geometry=new _n({width:i.width,height:i.height}),this._adopt(r),this._adopt(this.geometry.uniforms);const u=e.material(),c=u.vertex;c.pipe("raw.position.scale",this.uniforms),c.fan(),c.pipe("stpq.xyzw.2d",this.uniforms),c.next(),c.pipe("screen.position",this.uniforms),c.join(),u.fragment=n=this._fragmentColor(h,!1,null,null,s,2,a,o,l),n.pipe("fragment.color",this.uniforms);const p=u.link({side:S.DoubleSide});this.material=this._material(p);const d=new S.Mesh(this.geometry,this.material);d.frustumCulled=!1,d.userData=p,this._raw(d),this.renders=[d]}dispose(){return this.geometry.dispose(),this.material.dispose(),this.renders=this.geometry=this.material=null,super.dispose()}}class zn extends kn{constructor(t,e,i){const{items:n,width:r,height:s,depth:o,stpq:a}=i,l=t=>1/Math.max(1,t),h=t=>1/Math.max(1,t-1),u={remapUVScale:{type:"v2",value:new S.Vector2(n*r,s*o)},remapModulus:{type:"v2",value:new S.Vector2(n,s)},remapModulusInv:{type:"v2",value:new S.Vector2(l(n),l(s))},remapSTPQScale:{type:"v4",value:new S.Vector4(h(r),h(s),h(o),h(n))}},c=e.shader();c.pipe("screen.map.xyzw",u),null!=i.map&&(a&&c.pipe("screen.map.stpq",u),c.pipe(i.map)),super(t,e,{map:c,linear:!0}),this.memo=i,this.uniforms=u;for(const t of Array.from(this.renders))t.transparent=!1}cover(t,e,i,n){null==t&&({width:t}=this.memo),null==e&&({height:e}=this.memo),null==i&&({depth:i}=this.memo),null==n&&({items:n}=this.memo);const r=t=>1/Math.max(1,t-1);this.uniforms.remapSTPQScale.value.set(r(t),r(e),r(i),r(n));const s=t/this.memo.width;let o=i/this.memo.depth;return 1===this.memo.depth&&(o=e/this.memo.height),this.geometry.cover(s,o)}}class Sn extends un{constructor(t){let e,i,n,r;super(t),this._clipUniforms(),this.items=n=+t.items||2,this.width=r=+t.width||1,this.height=i=+t.height||1,this.depth=e=+t.depth||1;const s=n*r*i*e,o=4*s,a=2*s;this.setIndex(new S.BufferAttribute(new Uint32Array(3*a),1)),this.setAttribute("position4",new S.BufferAttribute(new Float32Array(4*o),4)),this.setAttribute("sprite",new S.BufferAttribute(new Float32Array(2*o),2));const l=this._emitter("index"),h=this._emitter("position4"),u=this._emitter("sprite"),c=[[-1,-1],[-1,1],[1,-1],[1,1]];let p=0;for(let t=0,e=s,i=0<=e;i?t<e:t>e;i?t++:t--)l(p),l(p+1),l(p+2),l(p+1),l(p+2),l(p+3),p+=4;for(let t=0,s=e,o=0<=s;o?t<s:t>s;o?t++:t--)for(let e=0,s=i,o=0<=s;o?e<s:e>s;o?e++:e--)for(let i=0,s=r,o=0<=s;o?i<s:i>s;o?i++:i--)for(let r=0,s=n,o=0<=s;o?r<s:r>s;o?r++:r--)for(const n of Array.from(c))h(i,e,t,r),u(n[0],n[1]);this._finalize(),this.clip()}clip(t,e,i,n){return null==t&&({width:t}=this),null==e&&({height:e}=this),null==i&&({depth:i}=this),null==n&&({items:n}=this),this._clipGeometry(t,e,i,n),this._clipOffsets(6,t,e,i,n,this.width,this.height,this.depth,this.items)}}class Mn extends un{constructor(t){let e,i,n,r,s;super(t),this._clipUniforms(),this.items=n=+t.items||2,this.width=s=+t.width||1,this.height=i=+t.height||1,this.depth=e=+t.depth||1,this.sides=r=Math.max(0,n-2);const o=s*i*e,a=n*o,l=r*o;this.setIndex(new S.BufferAttribute(new Uint32Array(3*l),1)),this.setAttribute("position4",new S.BufferAttribute(new Float32Array(4*a),4)),this.setAttribute("strip",new S.BufferAttribute(new Float32Array(3*a),3));const h=this._emitter("index"),u=this._emitter("position4"),c=this._emitter("strip");let p=0;for(let t=0,e=o,i=0<=e;i?t<e:t>e;i?t++:t--){let t=p;for(let e=0,i=r,n=0<=i;n?e<i:e>i;n?e++:e--)1&e?(h(t+1),h(t),h(t+2)):(h(t),h(t+1),h(t+2)),t++;p+=n}const d=n-1;for(let t=0,n=e,r=0<=n;r?t<n:t>n;r?t++:t--)for(let e=0,n=i,r=0<=n;r?e<n:e>n;r?e++:e--)for(let i=0,n=s,r=0<=n;r?i<n:i>n;r?i++:i--){let n=1;u(i,e,t,0),c(1,2,n);for(let r=1,s=d,o=1<=s;o?r<s:r>s;o?r++:r--)u(i,e,t,r),c(r-1,r+1,n=-n);u(i,e,t,d),c(d-2,d-1,-n)}this._finalize(),this.clip()}clip(t,e,i,n){null==t&&({width:t}=this),null==e&&({height:e}=this),null==i&&({depth:i}=this),null==n&&({items:n}=this);const r=Math.max(0,n-2);return this._clipGeometry(t,e,i,n),this._clipOffsets(3,t,e,i,r,this.width,this.height,this.depth,this.sides)}}const An={sprite:class extends pn{constructor(t,e,i){let n;super(t,e,i);let{uniforms:r}=i;const{material:s,position:o,sprite:a,map:l,combine:h,linear:u,color:c,mask:p,stpq:d}=i;null==r&&(r={});const f=null!=r.styleColor;this.geometry=new Sn({items:i.items,width:i.width,height:i.height,depth:i.depth}),this._adopt(r),this._adopt(this.geometry.uniforms);const m=e.material(),g=m.vertex;g.pipe(this._vertexColor(c,p)),g.require(this._vertexPosition(o,s,l,2,d)),g.require(a),g.pipe("sprite.position",this.uniforms),g.pipe("project.position",this.uniforms),m.fragment=n=this._fragmentColor(f,s,c,p,l,2,d,h,u);const v=e.material();v.vertex.pipe(g),v.fragment.pipe(n),v.fragment.pipe("fragment.transparent",this.uniforms);const y=e.material();y.vertex.pipe(g),y.fragment.pipe(n),y.fragment.pipe("fragment.solid",this.uniforms);const b=y.link({side:S.DoubleSide});this.fillMaterial=this._material(b);const x=v.link({side:S.DoubleSide});this.edgeMaterial=this._material(x),this.fillObject=new S.Mesh(this.geometry,this.fillMaterial),this.edgeObject=new S.Mesh(this.geometry,this.edgeMaterial),this._raw(this.fillObject),this.fillObject.userData=b,this._raw(this.edgeObject),this.edgeObject.userData=x,this.renders=[this.fillObject,this.edgeObject]}show(t,e,i,n){return this._show(this.edgeObject,!0,e,i,n),this._show(this.fillObject,t,e,i,n)}dispose(){return this.geometry.dispose(),this.edgeMaterial.dispose(),this.fillMaterial.dispose(),this.renders=this.geometry=this.edgeMaterial=this.fillMaterial=this.edgeObject=this.fillObject=null,super.dispose()}},point:class extends pn{constructor(t,e,i){let n,r;super(t,e,i);let{uniforms:s,shape:o,fill:a}=i;const{material:l,position:h,color:u,size:c,mask:p,map:d,combine:f,linear:m,optical:g,stpq:v}=i;null==s&&(s={}),o=null!=+o?+o:0,null==a&&(a=!0);const y=null!=s.styleColor,b=["circle","square","diamond","up","down","left","right"],x=["circle","generic","generic","generic","generic","generic","generic"],w=null!=x[o]?x[o]:x[0],_=null!=b[o]?b[o]:b[0],k=null!=(r=g&&[1.2,1,1.414,1.16,1.16,1.16,1.16][o])?r:1,z=a?w:`${w}.hollow`;this.geometry=new Sn({items:i.items,width:i.width,height:i.height,depth:i.depth}),this._adopt(s),this._adopt(this.geometry.uniforms);const M={POINT_SHAPE_SCALE:+(k+1e-5)},A=e.material(),C=A.vertex;C.pipe(this._vertexColor(u,p)),c?(C.isolate(),C.require(c),C.require("point.size.varying",this.uniforms),C.end()):C.require("point.size.uniform",this.uniforms),C.require(this._vertexPosition(h,l,d,2,v)),C.pipe("point.position",this.uniforms,M),C.pipe("project.position",this.uniforms),A.fragment=n=this._fragmentColor(y,l,u,p,d,2,v,f,m);const T=e.material();T.vertex.pipe(C),n=T.fragment.pipe(A.fragment),n.require(`point.mask.${_}`,this.uniforms),n.require(`point.alpha.${z}`,this.uniforms),n.pipe("point.edge",this.uniforms);const O=e.material();O.vertex.pipe(C),n=O.fragment.pipe(A.fragment),n.require(`point.mask.${_}`,this.uniforms),n.require(`point.alpha.${z}`,this.uniforms),n.pipe("point.fill",this.uniforms);const E=O.link({side:S.DoubleSide});this.fillMaterial=this._material(E);const P=T.link({side:S.DoubleSide});this.edgeMaterial=this._material(P),this.fillObject=new S.Mesh(this.geometry,this.fillMaterial),this.edgeObject=new S.Mesh(this.geometry,this.edgeMaterial),this._raw(this.fillObject),this.fillObject.userData=E,this._raw(this.edgeObject),this.edgeObject.userData=P,this.renders=[this.fillObject,this.edgeObject]}show(t,e,i,n){return this._show(this.edgeObject,!0,e,i,n),this._show(this.fillObject,t,e,i,n)}dispose(){return this.geometry.dispose(),this.edgeMaterial.dispose(),this.fillMaterial.dispose(),this.renders=this.edgeObject=this.fillObject=this.geometry=this.edgeMaterial=this.fillMaterial=null,super.dispose()}},line:class extends pn{constructor(t,e,i){let n;super(t,e,i);let{uniforms:r,stroke:s,join:o}=i;const{material:a,position:l,color:h,mask:u,map:c,combine:p,stpq:d,linear:f,clip:m,proximity:g,closed:v}=i;null==r&&(r={}),s=[null,"dotted","dashed"][s];const y=null!=r.styleColor;o=null!=(n=["miter","round","bevel"][o])?n:"miter";const b={miter:1,round:4,bevel:2}[o];this.geometry=new vn({samples:i.samples,strips:i.strips,ribbons:i.ribbons,layers:i.layers,anchor:i.anchor,closed:i.closed,detail:b}),this._adopt(r),this._adopt(this.geometry.uniforms);const x=e.material(),w={};s&&(w.LINE_STROKE=""),m&&(w.LINE_CLIP=""),null!=g&&(w.LINE_PROXIMITY=""),w["LINE_JOIN_"+o.toUpperCase()]="",b>1&&(w.LINE_JOIN_DETAIL=b),v&&(w.LINE_CLOSED="");const _=x.vertex;_.pipe(this._vertexColor(h,u)),_.require(this._vertexPosition(l,a,c,2,d)),_.pipe("line.position",this.uniforms,w),_.pipe("project.position",this.uniforms);const k=x.fragment;s&&k.pipe(`fragment.clip.${s}`,this.uniforms),m&&k.pipe("fragment.clip.ends",this.uniforms),null!=g&&k.pipe("fragment.clip.proximity",this.uniforms),k.pipe(this._fragmentColor(y,a,h,u,c,2,d,p,f)),k.pipe("fragment.color",this.uniforms);const z=x.link({side:S.DoubleSide});this.material=this._material(z);const M=new S.Mesh(this.geometry,this.material);M.userData=z,this._raw(M),this.renders=[M]}dispose(){return this.geometry.dispose(),this.material.dispose(),this.renders=this.geometry=this.material=null,super.dispose()}},surface:class extends pn{constructor(t,e,i){let n;super(t,e,i);let{uniforms:r,material:s}=i;const{position:o,color:a,normal:l,mask:h,map:u,combine:c,linear:p,stpq:d,intUV:f}=i;null==r&&(r={}),null==s&&(s=!0);const m=null!=r.styleColor;this.geometry=new wn({width:i.width,height:i.height,surfaces:i.surfaces,layers:i.layers,closedX:i.closedX,closedY:i.closedY}),this._adopt(r),this._adopt(this.geometry.uniforms);const g={};i.closedX&&(g.SURFACE_CLOSED_X=""),i.closedY&&(g.SURFACE_CLOSED_Y=""),f&&(g.POSITION_UV_INT="");const v=e.material(),y=v.vertex;y.pipe(this._vertexColor(a,h)),y.require(this._vertexPosition(o,s,u,2,d)),l?(y.require(l),y.pipe("surface.position.normal",this.uniforms,g)):(s||y.pipe("surface.position",this.uniforms,g),s&&y.pipe("surface.position.shaded",this.uniforms,g)),y.pipe("project.position",this.uniforms),v.fragment=n=this._fragmentColor(m,s,a,h,u,2,d,c,p),n.pipe("fragment.color",this.uniforms);const b=v.link({side:S.DoubleSide});this.material=this._material(b);const x=new S.Mesh(this.geometry,this.material);x.userData=b,this._raw(x),this.renders=[x]}dispose(){return this.geometry.dispose(),this.material.dispose(),this.renders=this.geometry=this.material=null,super.dispose()}},face:class extends pn{constructor(t,e,i){let n;super(t,e,i);let{uniforms:r,material:s}=i;const{position:o,color:a,mask:l,map:h,combine:u,stpq:c,linear:p}=i;null==r&&(r={}),null==s&&(s=!0);const d=null!=r.styleColor;this.geometry=new gn({items:i.items,width:i.width,height:i.height,depth:i.depth}),this._adopt(r),this._adopt(this.geometry.uniforms);const f=e.material(),m=f.vertex;m.pipe(this._vertexColor(a,l)),m.require(this._vertexPosition(o,s,h,2,c)),s||m.pipe("face.position",this.uniforms),s&&m.pipe("face.position.normal",this.uniforms),m.pipe("project.position",this.uniforms),f.fragment=n=this._fragmentColor(d,s,a,l,h,2,c,u,p),n.pipe("fragment.color",this.uniforms);const g=f.link({side:S.DoubleSide});this.material=this._material(g);const v=new S.Mesh(this.geometry,this.material);v.userData=g,this._raw(v),this.renders=[v]}dispose(){return this.geometry.dispose(),this.material.dispose(),this.renders=this.geometry=this.material=null,super.dispose()}},strip:class extends pn{constructor(t,e,i){let n;super(t,e,i);let{uniforms:r,material:s}=i;const{position:o,color:a,mask:l,map:h,combine:u,linear:c,stpq:p}=i;null==r&&(r={}),null==s&&(s=!0);const d=null!=r.styleColor;this.geometry=new Mn({items:i.items,width:i.width,height:i.height,depth:i.depth}),this._adopt(r),this._adopt(this.geometry.uniforms);const f=e.material(),m=f.vertex;m.pipe(this._vertexColor(a,l)),m.require(this._vertexPosition(o,s,h,2,p)),s||m.pipe("mesh.position",this.uniforms),s&&m.pipe("strip.position.normal",this.uniforms),m.pipe("project.position",this.uniforms),f.fragment=n=this._fragmentColor(d,s,a,l,h,2,p,u,c),n.pipe("fragment.color",this.uniforms);const g=f.link({side:S.DoubleSide});this.material=this._material(g);const v=new S.Mesh(this.geometry,this.material);v.userData=g,this._raw(v),this.renders=[v]}dispose(){return this.geometry.dispose(),this.material.dispose(),this.renders=this.geometry=this.material=null,super.dispose()}},arrow:class extends pn{constructor(t,e,i){let n;super(t,e,i);let{uniforms:r}=i;const{material:s,position:o,color:a,mask:l,map:h,combine:u,stpq:c,linear:p}=i;null==r&&(r={});const d=null!=r.styleColor;this.geometry=new cn({sides:i.sides,samples:i.samples,strips:i.strips,ribbons:i.ribbons,layers:i.layers,anchor:i.anchor,flip:i.flip,closed:i.closed}),this._adopt(r),this._adopt(this.geometry.uniforms);const f={};closed&&(f.ARROW_CLOSED="");const m=e.material(),g=m.vertex;g.pipe(this._vertexColor(a,l)),g.require(this._vertexPosition(o,s,h,1,c)),g.pipe("arrow.position",this.uniforms,f),g.pipe("project.position",this.uniforms),m.fragment=n=this._fragmentColor(d,s,a,l,h,1,c,u,p),n.pipe("fragment.color",this.uniforms);const v=m.link({side:S.DoubleSide});this.material=this._material(v);const y=new S.Mesh(this.geometry,this.material);y.frustumCulled=!1,y.matrixAutoUpdate=!1,y.userData=v,this._raw(y),this.renders=[y]}dispose(){return this.geometry.dispose(),this.material.dispose(),this.renders=this.geometry=this.material=null,super.dispose()}},screen:kn,memoScreen:zn,debug:class extends pn{constructor(t,e,i){super(t,e,i),this.geometry=new S.PlaneGeometry(1,1),this.material=new S.MeshBasicMaterial({map:i.map}),this.material.side=S.DoubleSide;const n=new S.Mesh(this.geometry,this.material);n.position.x+=i.x||0,n.position.y+=i.y||0,n.frustumCulled=!1,n.scale.set(2,2,2),n.__debug=!0,this.objects=[n]}dispose(){return this.geometry.dispose(),this.material.dispose(),this.objects=this.geometry=this.material=null,super.dispose()}},dataBuffer:ln,arrayBuffer:class extends ln{constructor(t,e,i){const n=i.width||1,r=i.history||1;i.width=n,i.height=r,i.depth=1,super(t,e,i,!1),this.width=n,this.history=r,this.samples=n,this.wrap=r>1,this.build(i)}build(t){return super.build(),this.index=0,this.pad=0,this.streamer=this.generate(this.data)}setActive(t){return this.pad=Math.max(0,this.width-t)}fill(){const{callback:t}=this;"function"==typeof t.reset&&t.reset();const{emit:e,count:i,done:n,reset:r}=this.streamer;r();const s=this.samples-this.pad;let o=0;for(;!n()&&o<s&&!1!==t(e,o++););return Math.floor(i()/this.items)}write(t){return null==t&&(t=this.samples),t*=this.items,this.texture.write(this.data,0,this.index,t,1),this.dataPointer.set(.5,this.index+.5),this.index=(this.index+this.history-1)%this.history,this.filled=Math.min(this.history,this.filled+1)}through(t,e){let i,n;const{consume:r,done:s}=n=this.streamer,{emit:o}=i=e.streamer;let a=0,l=()=>r(((e,i,n,r)=>t(o,e,i,n,r,a)));return l=Lt(l,this.items),()=>{n.reset(),i.reset();const t=this.samples-this.pad;for(a=0;!s()&&a<t;)l(),a++;return n.count()}}},matrixBuffer:class extends ln{constructor(t,e,i){const n=i.width||1,r=i.height||1,s=i.history||1;i.depth=s,super(t,e,i,!1),this.width=n,this.height=r,this.history=s,this.samples=n*r,this.wrap=s>1,this.build(i)}build(t){return super.build(),this.index=0,this.pad={x:0,y:0},this.streamer=this.generate(this.data)}getFilled(){return this.filled}setActive(t,e){let i;return[this.pad.x,this.pad.y]=Array.from(i=[Math.max(0,this.width-t),Math.max(0,this.height-e)]),i}fill(){let t,e,i;const{callback:n}=this;"function"==typeof n.reset&&n.reset();const{emit:r,skip:s,count:o,done:a,reset:l}=this.streamer;l();const h=this.width,u=this.pad.x,c=this.samples-this.pad.y*h;let p=t=e=0;if(u)for(;!a()&&e<c&&(e++,i=n(r,p,t),++p==h-u&&(s(u),e+=u,p=0,t++),!1!==i););else for(;!a()&&e<c&&(e++,i=n(r,p,t),++p===h&&(p=0,t++),!1!==i););return Math.floor(o()/this.items)}write(t){null==t&&(t=this.samples),t*=this.items;const e=this.width*this.items,i=Math.ceil(t/e);return this.texture.write(this.data,0,this.index*this.height,e,i),this.dataPointer.set(.5,this.index*this.height+.5),this.index=(this.index+this.history-1)%this.history,this.filled=Math.min(this.history,this.filled+1)}through(t,e){let i,n,r;const{consume:s,skip:o,done:a}=r=this.streamer,{emit:l}=i=e.streamer;let h=n=0,u=()=>s(((e,i,r,s)=>t(l,e,i,r,s,h,n)));return u=Lt(u,this.items),()=>{let t;r.reset(),i.reset();const e=this.width,s=this.pad.x,l=this.samples-this.pad.y*e;if(h=n=t=0,s)for(;!a()&&t<l;)t++,u(),++h==e-s&&(o(s),h=0,n++);else for(;!a()&&t<l;)t++,u(),++h===e&&(h=0,n++);return r.count()}}},voxelBuffer:class extends ln{build(t){return super.build(),this.pad={x:0,y:0,z:0},this.streamer=this.generate(this.data)}setActive(t,e,i){let n;return[this.pad.x,this.pad.y,this.pad.z]=Array.from(n=[Math.max(0,this.width-t),Math.max(0,this.height-e),Math.max(0,this.depth-i)]),n}fill(){let t,e,i,n;const{callback:r}=this;"function"==typeof r.reset&&r.reset();const{emit:s,skip:o,count:a,done:l,reset:h}=this.streamer;h();const u=this.width,c=this.height,p=this.pad.x,d=this.pad.y,f=this.samples-this.pad.z*u*c;let m=t=e=i=0;if(p>0||d>0)for(;!l()&&i<f&&(i++,n=r(s,m,t,e),++m==u-p&&(o(p),i+=p,m=0,++t==c-d&&(o(u*d),i+=u*d,t=0,e++)),!1!==n););else for(;!l()&&i<f&&(i++,n=r(s,m,t,e),++m===u&&(m=0,++t===c&&(t=0,e++)),!1!==n););return Math.floor(a()/this.items)}through(t,e){let i,n,r,s;const{consume:o,done:a,skip:l}=s=this.streamer,{emit:h}=i=e.streamer;let u=n=r=0,c=()=>o(((e,i,s,o)=>t(h,e,i,s,o,u,n,r)));return c=Lt(c,this.items),()=>{let t;s.reset(),i.reset();const e=this.width,o=this.height,h=this.pad.x,p=this.pad.y,d=this.samples-this.pad.z*e*o;if(u=n=r=t=0,h>0||p>0)for(;!a()&&t<d;)t++,c(),++u==e-h&&(l(h),u=0,++n==o-p&&(l(e*p),n=0,r++));else for(;!a()&&t<d;)t++,c(),++u===e&&(u=0,++n===o&&(n=0,r++));return s.count()}}},pushBuffer:class extends on{constructor(t,e,i){const n=i.width||1,r=i.height||1,s=i.depth||1,o=n*r*s;i.samples||(i.samples=o),super(t,e,i),this.width=n,this.height=r,this.depth=s,null==this.samples&&(this.samples=o),this.build(i)}build(t){return this.data=[],this.data.length=this.samples,this.filled=0,this.pad={x:0,y:0,z:0},this.streamer=this.generate(this.data)}dispose(){return this.data=null,super.dispose()}getFilled(){return this.filled}setActive(t,e,i){let n;return[this.pad.x,this.pad.y,this.pad.z]=Array.from(n=[this.width-t,this.height-e,this.depth-i]),n}read(){return this.data}copy(t){const e=Math.min(t.length,this.samples),i=this.data;return function(t,e,i){const n=[],r=t<e,s=i?r?e+1:e-1:e;for(let e=t;r?e<s:e>s;r?e++:e--)n.push(e);return n}(0,e,!1).map((e=>i[e]=t[e]))}fill(){let t,e,i,n;const{callback:r}=this;"function"==typeof r.reset&&r.reset();const{emit:s,skip:o,count:a,done:l,reset:h}=this.streamer;h();const u=this.width,c=this.height,p=this.pad.x,d=this.pad.y,f=this.samples-this.pad.z*u*c;let m=t=e=i=0;if(p>0||d>0)for(;!l()&&i<f&&(i++,n=r(s,m,t,e),++m==u-p&&(o(p),m=0,++t==c-d&&(o(u*d),t=0,e++)),!1!==n););else for(;!l()&&i<f&&(i++,n=r(s,m,t,e),++m===u&&(m=0,++t===c&&(t=0,e++)),!1!==n););return this.filled=1,a()}},renderToTexture:bn,memo:xn,readback:class extends en{constructor(t,e,i){super(t,e),null==this.items&&(this.items=i.items||1),null==this.channels&&(this.channels=i.channels||4),null==this.width&&(this.width=i.width||1),null==this.height&&(this.height=i.height||1),null==this.depth&&(this.depth=i.depth||1),null==this.type&&(this.type=i.type||S.FloatType),null==this.stpq&&(this.stpq=i.stpq||!1),this.isFloat=this.type===S.FloatType,this.active=this.sampled=this.rect=this.pad=null,this.build(i)}build(t){let e,i,n;const{map:r}=t,{indexer:s}=t,o=null!=s&&!s.empty();let{stpq:a}=this;const{items:l,width:h,height:u,depth:c}=this;let p=r;o&&(this._adopt({indexModulus:{type:"v4",value:new S.Vector4(l,l*h,l*h*u,1)}}),p=this.shaders.shader(),p.require(r),p.require(s),p.pipe("float.index.pack",this.uniforms)),this.isFloat&&this.channels>1&&(this.floatMemo=new xn(this.renderer,this.shaders,{items:l,channels:4,width:h,height:u,depth:c,history:0,type:S.FloatType}),this.floatCompose=new zn(this.renderer,this.shaders,{map:p,items:l,width:h,height:u,depth:c,stpq:a}),this.floatMemo.adopt(this.floatCompose),a=!1,p=this.shaders.shader(),this.floatMemo.shaderAbsolute(p)),this.isFloat?(n=this.channels,e=4):(n=1,e=this.channels),n>1?(i=this.shaders.shader(),i.pipe(Zt(n)),i.require(p),i.pipe("float.stretch"),i.pipe("float.encode"),p=i):this.isFloat&&(i=this.shaders.shader(),i.pipe(p),i.pipe(te(4,1)),i.pipe("float.encode"),p=i),this.byteMemo=new xn(this.renderer,this.shaders,{items:l*n,channels:e,width:h,height:u,depth:c,history:0,type:S.UnsignedByteType}),this.byteCompose=new zn(this.renderer,this.shaders,{map:p,items:l*n,width:h,height:u,depth:c,stpq:a}),this.byteMemo.adopt(this.byteCompose);const d=l*h*n,f=u*c;return this.samples=this.width*this.height*this.depth,this.bytes=new Uint8Array(d*f*4),this.isFloat&&(this.floats=new Float32Array(this.bytes.buffer)),this.data=this.isFloat?this.floats:this.bytes,this.streamer=this.generate(this.data),this.active={items:0,width:0,height:0,depth:0},this.sampled={items:0,width:0,height:0,depth:0},this.rect={w:0,h:0},this.pad={x:0,y:0,z:0,w:0},this.stretch=n,this.isIndexed=o,this.setActive(l,h,u,c)}generate(t){return Ut(t,this.samples,4,this.items)}setActive(t,e,i,n){let r;if(t===this.active.items&&e===this.active.width&&i===this.active.height&&n===this.active.depth)return;[this.active.items,this.active.width,this.active.height,this.active.depth]=Array.from([t,e,i,n]),null!=this.floatCompose&&this.floatCompose.cover(e,i,n),null!=this.byteCompose&&this.byteCompose.cover(e*this.stretch,i,n),({items:t}=this),({width:e}=this.active),i=1===this.depth?this.active.height:this.height,({depth:n}=this.active);const s=t*e*this.stretch,o=i*n;return[this.sampled.items,this.sampled.width,this.sampled.height,this.sampled.depth]=Array.from([t,e,i,n]),[this.rect.w,this.rect.h]=Array.from([s,o]),[this.pad.x,this.pad.y,this.pad.z,this.pad.w]=Array.from(r=[this.sampled.width-this.active.width,this.sampled.height-this.active.height,this.sampled.depth-this.active.depth,this.sampled.items-this.active.items]),r}update(t){return null!=this.floatMemo&&this.floatMemo.render(t),null!=this.byteMemo?this.byteMemo.render(t):void 0}post(){const t=this.renderer.getRenderTarget();this.renderer.setRenderTarget(this.byteMemo.target.targets[0]),this.gl.readPixels(0,0,this.rect.w,this.rect.h,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.bytes),this.renderer.setRenderTarget(t)}readFloat(t){return null!=this.floatMemo?this.floatMemo.read(t):void 0}readByte(t){return null!=this.byteMemo?this.byteMemo.read(t):void 0}setCallback(t){this.emitter=this.callback(t)}callback(t){if(!this.isIndexed)return t;const e=this.width,i=this.height,n=this.items,r=function(r,s,o,a){let l=a;const h=l%n;l=(l-h)/n;const u=l%e;l=(l-u)/e;const c=l%i;l=(l-c)/i;return t(r,s,o,a,u,c,l,h)};return r.reset=()=>"function"==typeof t.reset?t.reset():void 0,r}iterate(){let t,e,i,n=this.emitter;"function"==typeof n.reset&&n.reset();const{consume:r,skip:s,count:o,done:a,reset:l}=this.streamer;l();const h=0|this.sampled.width;let u=0|this.sampled.height;const c=0|this.sampled.depth,p=0|this.sampled.items,d=0|this.pad.x,f=0|this.pad.y,m=0|this.pad.z,g=0|this.pad.w,v=h*u*p*(c-m);if(!this.isIndexed){const r=n;n=(n,s,o,a)=>r(n,s,o,a,y,t,e,i)}let y=t=e=i=u=0;for(;!a()&&u<v;){u++;const o=r(n);if(++i==p-g&&(s(d),i=0,++y==h-d&&(s(p*d),y=0,++t==u-f&&(s(p*h*f),t=0,e++))),!1===o)break}return Math.floor(o()/p)}dispose(){return null!=this.floatMemo&&this.floatMemo.unadopt(this.floatCompose),null!=this.floatMemo&&this.floatMemo.dispose(),null!=this.floatCompose&&this.floatCompose.dispose(),null!=this.byteMemo&&this.byteMemo.unadopt(this.byteCompose),null!=this.byteMemo&&this.byteMemo.dispose(),null!=this.byteCompose&&this.byteCompose.dispose(),this.floatMemo=this.byteMemo=this.floatCompose=this.byteCompose=null}},atlas:fn,textAtlas:class extends fn{constructor(t,e,i){let n;if(i.width||(i.width=256),i.height||(i.height=256),i.type=S.UnsignedByteType,i.channels=1,i.backed=!0,super(t,e,i,!1),this.font=null!=i.font?i.font:["sans-serif"],this.size=i.size||24,this.style=null!=i.style?i.style:"normal",this.variant=null!=i.variant?i.variant:"normal",this.weight=null!=i.weight?i.weight:"normal",this.outline=null!=(n=+(null!=i.outline?i.outline:5))?n:0,this.gamma=1,"undefined"!=typeof navigator){const t=navigator.userAgent;t.match(/Chrome/)&&t.match(/OS X/)&&(this.gamma=.5)}this.scratchW=this.scratchH=0,this.build(i)}build(t){super.build(t);let e=16;e=this.size,e+=4+2*Math.min(1,this.outline);const i=32*e,n=document.createElement("canvas");n.width=i,n.height=e;const r=this.font.map((t=>`${t.replace(/(['"\\])/g,"\\$1")}`)).join(", "),s=n.getContext("2d",{willReadFrequently:!0});s.font=`${this.style} ${this.variant} ${this.weight} ${this.size}px ${r}`,s.fillStyle="#FF0000",s.textAlign="left",s.textBaseline="bottom",s.lineJoin="round";const o=[];for(let t=0,e=3*this.outline,i=0<=e;i?t<e:t>e;i?t++:t--){const e=("00"+Math.max(0,8*-t+128-8*!t).toString(16)).slice(-2);o.push("#"+e+e+e)}const a=new Uint8Array(i*e*2);return this.canvas=n,this.context=s,this.lineHeight=e,this.maxWidth=i,this.colors=o,this.scratch=a,this._allocate=this.allocate.bind(this),this._write=this.write.bind(this)}reset(){return super.reset(),this.mapped={}}begin(){return Array.from(this.rows).map((t=>t.alive=0))}end(){const{mapped:t}=this;for(const e of Array.from(this.rows.slice()))if(0===e.alive){for(const i of Array.from(e.keys))delete t[i];this.collapse(e)}}map(t,e){const{mapped:i}=this,n=i[t];if(null!=n)return n.row.alive++,e(n.x,n.y,n.w,n.h);this.draw(t);const r=this.scratch,s=this.scratchW,o=this.scratchH,a=this._allocate,l=this._write;return a(t,s,o,(function(n,a,h){return i[t]={x:a,y:h,w:s,h:o,row:n},l(r,a,h,s,o),e(a,h,s,o)}))}draw(t){let e,i,n,r=this.width;const s=this.lineHeight,o=this.outline,a=this.context,l=this.scratch,h=this.maxWidth,{colors:u}=this,c=o+1,p=Math.round(1.05*s-1),d=a.measureText(t);if(r=Math.min(h,Math.ceil(d.width+2*c+1)),a.clearRect(0,0,r,s),0===this.outline){let o,h;for(a.fillText(t,c,p),({data:e}=a.getImageData(0,0,r,s)),n=3,i=0,h=e.length/4,o=0<=h;o?i<h:i>h;o?i++:i--)l[i]=e[n],n+=4;return this.scratchW=r,this.scratchH=s}{let h,d,f,m;for(a.globalCompositeOperation="source-over",d=o+1,i=d,h=d<=1;h?i<=1:i>=1;h?i++:i--)n=i>1?2*i-2:i,a.strokeStyle=u[n-1],a.lineWidth=n,a.strokeText(t,c,p);a.globalCompositeOperation="multiply",a.fillText(t,c,p),({data:e}=a.getImageData(0,0,r,s)),n=0;const{gamma:g}=this;for(i=0,m=e.length/4,f=0<=m;f?i<m:i>m;f?i++:i--){const t=e[n];let r=t?e[n+1]/t:1;.5===g&&(r=Math.sqrt(r)),r=Math.min(1,Math.max(0,r));const s=256-t,o=s+(t-s)*r;l[i]=Math.max(0,Math.min(255,o+2)),n+=4}return this.scratchW=r,this.scratchH=s}}},scene:rn};class Cn{static initClass(){this.index=0,this.IN=0,this.OUT=1}static id(t){return++Cn.index}constructor(t,e=null){this.parent=e,this.id=Cn.id(),this.nodes=[],t&&this.add(t)}inputs(){const t=[];for(const e of Array.from(this.nodes))for(const i of Array.from(e.inputs))null===i.input&&t.push(i);return t}outputs(){const t=[];for(const e of Array.from(this.nodes))for(const i of Array.from(e.outputs))0===i.output.length&&t.push(i);return t}getIn(t){return Array.from(this.inputs()).filter((e=>e.name===t))[0]}getOut(t){return Array.from(this.outputs()).filter((e=>e.name===t))[0]}add(t,e){if(t.length)for(const e of Array.from(t))this.add(e);else{if(t.graph&&!e)throw new Error("Adding node to two graphs at once");t.graph=this,this.nodes.push(t)}}remove(t,e){if(t.length)for(const e of Array.from(t))this.remove(e);else{if(t.graph!==this)throw new Error("Removing node from wrong graph.");e||t.disconnect(),this.nodes.splice(this.nodes.indexOf(t),1),t.graph=null}}adopt(t){if(t.length)for(const e of Array.from(t))this.adopt(e);else t.graph.remove(t,!0),this.add(t,!0)}}Cn.initClass();class Tn{static initClass(){this.index=0}static make(t,e){null==e&&(e={});const i=e;if(null!=t.meta)for(const e in t.meta){const n=t.meta[e];i[e]=n}return new Tn(t.inout,t.name,t.hint,t.type,i)}static id(t){return`_io_${++Tn.index}_${t}`}static hint(t){return(t=(t=t.replace(/^_io_[0-9]+_/,"")).replace(/_i_o$/,"")).replace(/(In|Out|Inout|InOut)$/,"")}constructor(t,e,i,n,r,s){this.inout=t,this.name=e,this.hint=i,this.type=n,null==r&&(r={}),this.meta=r,this.id=s,null==this.hint&&(this.hint=Tn.hint(this.name)),this.node=null,this.input=null,this.output=[],null==this.id&&(this.id=Tn.id(this.hint))}morph(t){return this.inout=t.inout,this.name=t.name,this.hint=t.hint,this.type=t.type,this.meta=t.meta}dupe(t){null==t&&(t=this.id);const e=Tn.make(this);return e.name=t,e}connect(t){if(this.inout===Cn.IN&&t.inout===Cn.OUT)return t.connect(this);if(this.inout!==Cn.OUT||t.inout!==Cn.IN)throw new Error("Can only connect out to in.");return t.input!==this?(t.disconnect(),t.input=this,this.output.push(t)):void 0}disconnect(t){if(this.input&&this.input.disconnect(this),this.output.length){if(!t){for(t of Array.from(this.output))t.input=null;return this.output=[]}{const e=this.output.indexOf(t);if(e>=0)return this.output.splice(e,1),t.input=null}}}}Tn.initClass();class On{static initClass(){this.index=0}static id(t){return++On.index}constructor(t,e){this.owner=t,this.graph=null,this.inputs=[],this.outputs=[],this.all=[],this.outlets=null,this.id=On.id(),this.setOutlets(e)}getIn(t){return Array.from(this.inputs).filter((e=>e.name===t))[0]}getOut(t){return Array.from(this.outputs).filter((e=>e.name===t))[0]}get(t){return this.getIn(t)||this.getOut(t)}setOutlets(t){if(null!=t){let e;if(null==this.outlets){for(e of(this.outlets={},Array.from(t)))e instanceof Tn||(e=Tn.make(e)),this._add(e);return}const i=t=>[t.name,t.inout,t.type].join("-"),n={};for(e of Array.from(t))n[i(e)]=!0;for(let t in this.outlets)e=this.outlets[t],t=i(e),n[t]?n[t]=e:this._remove(e);for(e of Array.from(t)){const t=n[i(e)];t instanceof Tn?this._morph(t,e):(e instanceof Tn||(e=Tn.make(e)),this._add(e))}}return this.outlets}connect(t,e,i){let n,r,s,o,a;const l={},h={},u=t=>a+"/"+t.hint;for(n of Array.from(t.inputs)){let t;!i&&n.input||(({type:a}=n),s=u(n),h[s]||(h[s]=n),l[a]=t=l[a]||[],t.push(n))}let c=this.outputs;for(o of(c=c.filter((t=>!(e&&t.output.length))),Array.from(c.slice())))({type:a}=o),s=u(o),r=l[a],(n=h[s])&&(o.connect(n),delete h[s],r.splice(r.indexOf(n),1),c.splice(c.indexOf(o),1));if(!c.length)return this;for(o of Array.from(c.slice()))({type:a}=o),r=l[a],r&&r.length&&o.connect(r.shift());return this}disconnect(t){let e;for(e of Array.from(this.inputs))e.disconnect();for(e of Array.from(this.outputs))e.disconnect();return this}_key(t){return[t.name,t.inout].join("-")}_add(t){const e=this._key(t);if(t.node)throw new Error("Adding outlet to two nodes at once.");if(this.outlets[e])throw new Error(`Adding two identical outlets to same node. (${e})`);return t.node=this,t.inout===Cn.IN&&this.inputs.push(t),t.inout===Cn.OUT&&this.outputs.push(t),this.all.push(t),this.outlets[e]=t}_morph(t,e){let i=this._key(e);return delete this.outlets[i],t.morph(e),i=this._key(e),this.outlets[i]=e}_remove(t){const e=this._key(t);if(t.node!==this)throw new Error("Removing outlet from wrong node.");return t.disconnect(),t.node=null,delete this.outlets[e],t.inout===Cn.IN&&this.inputs.splice(this.inputs.indexOf(t),1),t.inout===Cn.OUT&&this.outputs.splice(this.outputs.indexOf(t),1),this.all.splice(this.all.indexOf(t),1),this}}On.initClass();const{IN:En,OUT:Pn}=Cn;class Dn{static initClass(){this.index=0}static namespace(){return`_sn_${++Dn.index}_`}static load(t,e,i){const n=t.parse(e,i),[r,s]=Array.from(t.compile(n));return new Dn(t,r,s,e,i)}constructor(t,e,i,n,r){this.language=t,this._signatures=e,this._compiler=i,this._name=n,this._original=r,this.namespace=null,this.code=null,this.main=null,this.entry=null,this.uniforms=null,this.externals=null,this.symbols=null,this.attributes=null,this.varyings=null,this.language||delete this.language,this._signatures||delete this._signatures,this._compiler||delete this._compiler,this._original||delete this._original,this._name||(this._name=null!=this._signatures?this._signatures.main.name:void 0)}clone(){return new Dn(this.language,this._signatures,this._compiler,this._name,this._original)}bind(t,e,i,n){let r,s,o;e===""+e?[i,e,n]=Array.from([e,null!=i?i:{},null!=n?n:{}]):i!==""+i&&([n,i]=Array.from([null!=i?i:{},void 0])),this.main=this._signatures.main,this.namespace=null!=(s=null!=i?i:this.namespace)?s:Dn.namespace(),this.entry=this.namespace+this.main.name,this.uniforms={},this.varyings={},this.attributes={},this.externals={},this.symbols=[];const a={},l={},h=function(t){return l[t]=!0,t},u=t=>this.namespace+t;if(t.globals)for(const e of Array.from(t.globals))h(e);const c=t.globalUniforms?h:u,p=t.globalVaryings?h:u,d=t.globalAttributes?h:u,f=u,m=t=>a[t.name]=!0,g=(t,e)=>this.uniforms[c(null!=e?e:t.name)]=t;o=t=>this.varyings[p(t.name)]=t;const v=t=>this.attributes[d(t.name)]=t,y=t=>{const e=f(t.name);return this.externals[e]=t,this.symbols.push(e)},b=t=>({type:t.type,name:t.name,value:t.value});for(r of Array.from(this._signatures.uniform))m(r);for(r of Array.from(this._signatures.uniform))g(b(r));for(r of Array.from(this._signatures.varying))o(b(r));for(r of Array.from(this._signatures.external))y(r);for(r of Array.from(this._signatures.attribute))v(b(r));for(const t in e)r=e[t],a[t]&&g(r,t);if(this.body=this.code=this._compiler(this.namespace,l,n),n){const t=(()=>{const t=[];for(const e in n)o=n[e],t.push(`#define ${e} ${o}`);return t})().join("\n");t.length&&(this._original=[t,"//----------------------------------------",this._original].join("\n"))}return null}}Dn.initClass();var jn=n(3981);const qn=function(t,e,i,n){const r=t,s={},o=[],a={},l={},h={},u={},c=t=>{let e;(t=(()=>{const i=[];for(const n in t)e=t[n],i.push(e);return i})()).sort(((t,e)=>e.priority-t.priority));const i=(t,e,i)=>{d(t,e,i);const{main:s}=e,{entry:o}=e;return r.call((e=>g(t,e)),(e=>m(t,e)),o,s.signature,n)},n=r.body();for(e of Array.from(t))i(e.node,e.module,e.priority);return[n,t]},p=function(t,e,i){const n=u[t];return null!=n?n.priority=jn.max(n.priority,i):u[t]={code:e,priority:i}},d=function(t,e,i){let n,r;i=jn.make(i);for(const t in e.library){const n=e.library[t];p(t,n.code,jn.nest(i,n.priority))}for(r in p(e.namespace,e.body,i),e.uniforms)n=e.uniforms[r],a[r]=n;for(r in e.varyings)n=e.varyings[r],l[r]=n;for(r in e.attributes)n=e.attributes[r],h[r]=n;return f(t,e)},f=(t,e)=>(()=>{const i=[];for(const n of Array.from(e.symbols)){const r=e.externals[n];if(m(t,r.name)){const e={};for(const t in r){const i=r[t];e[t]=i}e.name=g(t,r.name),s[n]=e,i.push(o.push(n))}else i.push(void 0)}return i})(),m=function(t,e){const i=t.get(e);return i.inout===En?null===i.input:i.inout===Pn?0===i.output.length:void 0},g=function(t,e){let i=t.get(e);return i?(i.input&&(i=i.input),({name:e}=i),i.id):null};return function(){let t,p;for(p in n){const t=n[p];f(t.node,t.module)}[t,i]=Array.from(c(i)),null!=e&&(t.entry=e);const d=r.build(t,i),m=(()=>{const t=[];for(p in u){const e=u[p];t.push(e)}return t})().sort(((t,e)=>jn.compare(t.priority,e.priority))),g=m.map((t=>t.code));g.push(d.code);const v=r.lines(g);return{namespace:d.name,library:u,body:d.code,code:v,main:d,entry:d.name,symbols:o,externals:s,uniforms:a,varyings:l,attributes:h}}()};class Fn{static initClass(){this.index=0}static entry(){return`_pg_${++Fn.index}_`}constructor(t,e,i){this.language=t,this.namespace=e,this.graph=i,this.calls={},this.requires={}}call(t,e,i){let n;const r=e.namespace;return(n=this.calls[r])?n.priority=Math.max(n.priority,i):this.calls[r]={node:t,module:e,priority:i},this}require(t,e){const i=e.namespace;return this.requires[i]={node:t,module:e}}assemble(){const t=qn(this.language,null!=this.namespace?this.namespace:Fn.entry,this.calls,this.requires),e=new Dn;for(const i in t)e[i]=t[i];return e.graph=this.graph,e}}Fn.initClass();const In=function(t,e,i,n){const r=t;let s=[];const o=[],a={},l={},h={},u={},c={},p=function(t,e,i){const n=c[t];return null!=n?n.priority=jn.max(n.priority,i):c[t]={code:e,priority:i}},d=function(t,e,i){let n,r;i=jn.make(i);for(const t in e.library){const n=e.library[t];p(t,n.code,jn.nest(i,n.priority))}for(r in p(e.namespace,e.body,i),e.uniforms)n=e.uniforms[r],l[r]=n;for(r in e.varyings)n=e.varyings[r],u[r]=n;for(r in e.attributes)n=e.attributes[r],h[r]=n;return(()=>{const i=[];for(r of Array.from(e.symbols)){const n=e.externals[r];f(t,n.name)?(a[r]=n,i.push(o.push(r))):i.push(void 0)}return i})()},f=function(t,e){const i=t.get(e);if(!i){const i=null!=(null!=t.owner.snippet?t.owner.snippet._name:void 0)?null!=t.owner.snippet?t.owner.snippet._name:void 0:t.owner.namespace;throw new Error(`Unable to link program. Unlinked callback \`${e}\` on \`${i}\``)}return i.inout===En?null===i.input:i.inout===Pn?0===i.output.length:void 0};return function(){const t=r.links(e),o=[];null!=t.defs&&o.push(t.defs),null!=t.bodies&&o.push(t.bodies);for(const t of Array.from(i))d(t.node,t.module,t.priority);const p=(()=>{const t=[];for(const e in c){const i=c[e];t.push(i)}return t})().sort(((t,e)=>jn.compare(t.priority,e.priority)));s=p.map((t=>t.code));let f=r.lines(s);f=r.defuse(f),o.length&&(f=[r.lines(o),f].join("\n")),f=r.hoist(f),f=r.dedupe(f);const m=n;return{namespace:m.main.name,code:f,main:m.main,entry:m.main.name,externals:a,uniforms:l,attributes:h,varyings:u}}()};class Ln{constructor(t,e){this.language=t,this.graph=e,this.links=[],this.includes=[],this.modules={},this.visits={}}callback(t,e,i,n,r){return this.links.push({node:t,module:e,priority:i,name:n,external:r})}include(t,e,i){let n;return null!=(n=this.modules[e.namespace])?n.priority=Math.max(i,n.priority):(this.modules[e.namespace]=!0,this.includes.push({node:t,module:e,priority:i}))}visit(t){return!this.visits[t]&&(this.visits[t]=!0)}link(t){const e=In(this.language,this.links,this.includes,t),i=new Dn;for(const t in e)i[t]=e[t];return i.graph=this.graph,i}}const{load:Nn}=Dn;class Rn{static previous(t){return null!=t.input?t.input.node.owner:void 0}constructor(t){null==t&&(t=!1),t||this.construct()}construct(){let t;return null==this.namespace&&(this.namespace=Fn.entry()),this.node=new On(this,null!=(t="function"==typeof this.makeOutlets?this.makeOutlets():void 0)?t:{})}refresh(){let t;return this.node.setOutlets(null!=(t="function"==typeof this.makeOutlets?this.makeOutlets():void 0)?t:{})}clone(){return new Rn}compile(t,e){const i=new Fn(t,null!=e?e:Fn.entry(),this.node.graph);return this.call(i,0),i.assemble()}link(t,e){const i=this.compile(t,e),n=new Ln(t,this.node.graph);return this._include(i,n,0),this.export(n,0),n.link(i)}call(t,e){}callback(t,e,i,n,r){}export(t,e){}_info(t){let e=null!=(null!=this.node.owner.snippet?this.node.owner.snippet._name:void 0)?null!=this.node.owner.snippet?this.node.owner.snippet._name:void 0:this.node.owner.namespace;if(null!=t)return e+"."+t}_outlet(t,e){const i=Tn.make(t,e);return i.meta.def=t,i}_call(t,e,i){return e.call(this.node,t,i)}_require(t,e){return e.require(this.node,t)}_inputs(t,e,i){return(()=>{const n=[];for(const r of Array.from(t.main.signature)){const t=this.node.get(r.name);n.push(Vn(Rn.previous(t),(t=>t.call(e,i+1))))}return n})()}_callback(t,e,i,n,r,s){return e.callback(this.node,t,i,n,r,s)}_include(t,e,i){return e.include(this.node,t,i)}_link(t,e,i){return(()=>{const n=[];for(const r of Array.from(t.symbols)){const s=t.externals[r];let o=this.node.get(s.name);if(!o)throw new Un(`External not found on ${this._info(s.name)}`);if(null!=o.meta.child)continue;let a,l=o;for(;!a&&l;)[l,o]=Array.from([o.meta.parent,l]);if(a=Rn.previous(o),!a)throw new Un(`Missing connection on ${this._info(s.name)}`);a.callback(e,i+1,r,s,o.input),n.push(null!=a?a.export(e,i+1):void 0)}return n})()}_trace(t,e,i){return(()=>{const n=[];for(const r of Array.from(t.main.signature)){const t=this.node.get(r.name);n.push(Vn(Rn.previous(t),(t=>t.export(e,i+1))))}return n})()}}const Un=function(t){const e=new Error(t);return e.name="OutletError",e};function Vn(t,e){return null!=t?e(t):void 0}Un.prototype=new Error;class Bn extends Rn{constructor(t){super(!0),this.snippet=t,this.namespace=t.namespace,this.construct()}clone(){return new Bn(this.snippet)}makeOutlets(){const t=this.snippet.main.signature,{externals:e}=this.snippet,{symbols:i}=this.snippet,n=Array.from(t).map((t=>this._outlet(t,{callback:!1}))),r=Array.from(i).map((t=>this._outlet(e[t],{callback:!0})));return n.concat(r)}call(t,e){return this._call(this.snippet,t,e),this._inputs(this.snippet,t,e)}export(t,e){if(t.visit(this.namespace,e))return this._link(this.snippet,t,e),this._trace(this.snippet,t,e)}}class $n extends Rn{constructor(t){super(!0),this.graph=t,this.construct()}refresh(){return super.refresh(),delete this.subroutine}clone(){return new $n(this.graph)}makeOutlets(){let t;this.make();const e=[];let i=[],n=[];const r=(t,i)=>{if(!t.meta.callback)return i.push(t.type);if(t.inout===Cn.IN){const i=t.dupe();return null==i.meta.child&&(i.meta.child=t),t.meta.parent=i,e.push(i)}};for(t of Array.from(this.graph.inputs()))r(t,i);for(t of Array.from(this.graph.outputs()))r(t,n);i=i.join(","),n=n.join(",");const s=`(${i})(${n})`;return e.push({name:"callback",type:s,inout:Cn.OUT,meta:{callback:!0,def:this.subroutine.main}}),e}make(){return this.subroutine=this.graph.compile(this.namespace)}export(t,e){if(t.visit(this.namespace,e))return this._link(this.subroutine,t,e),this.graph.export(t,e)}call(t,e){return this._require(this.subroutine,t,e)}callback(t,e,i,n,r){return this._include(this.subroutine,t,e),this._callback(this.subroutine,t,e,i,n,r)}}class Hn extends Rn{constructor(t){super(!0),this.graph=t,this.construct()}refresh(){return super.refresh(),delete this.subroutine}clone(){return new Hn(this.graph)}makeOutlets(){this.make();const t=[],e={},i={};for(const n of["inputs","outputs"])for(const r of Array.from(this.graph[n]())){let n;["return","callback"].includes(r.hint)&&r.inout===Cn.OUT&&(n=r.hint),null!=e[n]&&(n=void 0);const s=r.dupe(n);null==s.meta.child&&(s.meta.child=r),r.meta.parent=s,null!=n&&(e[n]=!0),i[r.name]=s,t.push(s)}return t}make(){return this.subroutine=this.graph.compile(this.namespace)}call(t,e){return this._call(this.subroutine,t,e),this._inputs(this.subroutine,t,e)}export(t,e){if(t.visit(this.namespace,e))return this._link(this.subroutine,t,e),this._trace(this.subroutine,t,e),this.graph.export(t,e)}callback(t,e,i,n,r){return(r=r.meta.child).node.owner.callback(t,e,i,n,r)}}class Wn extends Rn{constructor(t){super(!0),this.nodes=t,this.construct()}clone(){return new Wn(this.nodes)}makeOutlets(){return[]}call(t,e){return(()=>{const i=[];for(const n of Array.from(this.nodes)){const r=n.owner;i.push(r.call(t,e))}return i})()}export(t,e){return(()=>{const i=[];for(const n of Array.from(this.nodes)){const r=n.owner;i.push(r.export(t,e))}return i})()}}const Xn=function(t){const e=[],i=[];for(const n of Array.from(t.nodes)){let t;const r={id:n.id,name:null,type:null,depth:null,graph:null,inputs:[],outputs:[]};e.push(r);const{inputs:s}=r,{outputs:o}=r,a=n.owner;a instanceof Bn?(r.name=a.snippet._name,r.type="call",r.code=a.snippet._original):a instanceof $n?(r.name="Callback",r.type="callback",r.graph=Xn(a.graph)):a instanceof Hn?(r.name="Isolate",r.type="isolate",r.graph=Xn(a.graph)):a instanceof Wn?(r.name="Join",r.type="join"):null!=a&&(null==r.name&&(r.name=null!=a.name?a.name:a.type),null==r.type&&(r.type=a.type),null==r.code&&(r.code=a.code),null!=a.graph&&(r.graph=Xn(a.graph)));const l=function(t){return(t=t.replace(")(",")→(")).replace("()","")};for(t of Array.from(n.inputs))s.push({id:t.id,name:t.name,type:l(t.type),open:null==t.input});for(t of Array.from(n.outputs)){o.push({id:t.id,name:t.name,type:l(t.type),open:!t.output.length});for(const e of Array.from(t.output))i.push({from:n.id,out:t.id,to:e.node.id,in:e.id,type:l(t.type)})}}return{nodes:e,links:i}};let Gn=function(t,e){const i=65535&t,n=65535&e;return i*n+((t>>>16&65535)*n+i*(e>>>16&65535)<<16>>>0)|0};if(null!=Math.imul){-5===Math.imul(4294967295,5)&&({imul:Gn}=Math)}const Yn=function(t){let e;const i=t.length;let n=Math.floor(i/2),r=e=0;const s=()=>t.charCodeAt(r++),o=function(t,i){let n=t|i<<16;return n^=n<<9,n=Gn(n,3432918353),n=n<<15|n>>>17,n=Gn(n,461845907),e^=n,e=e<<13|e>>>19,e=Gn(e,5),e=e+3864292196|0};for(;n--;)o(s(),s());return 1&i&&o(s(),0),e^=i,e^=e>>>16,e=Gn(e,2246822507),e^=e>>>13,e=Gn(e,3266489909),e^=e>>>16},Zn=t=>(""+t).replace(/^\s+|\s+$/g,""),Qn=function(t,e){null==e&&(e=1);const i=1193046^Yn(t);let n=255&i,r=i>>>8&255,s=i>>>16&255;const o=Math.max(n,r,s),a=140/o,l=Math.round(o/3);return n=Math.min(255,Math.round(a*Math.max(n,l))),r=Math.min(255,Math.round(a*Math.max(r,l))),s=Math.min(255,Math.round(a*Math.max(s,l))),((t,e,i,n)=>"rgba("+[t,e,i,n].join(", ")+")")(n,r,s,e)},Jn=function(t){return(t=null!=t?t:"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")},Kn=function(t){const e=[],i=er(t,e);return i.update=()=>sr(i,e),tr(i),i},tr=function(t){const e=t.querySelectorAll(".shadergraph-code");return Array.from(e).map((t=>function(){const e=t;return e.parentNode.classList.add("shadergraph-has-code"),e.parentNode.addEventListener("click",(t=>e.style.display={block:"none",none:"block"}[e.style.display||"none"]))}()))},er=function(t,e){let i;!function(t){let e,i;const n={},r={};for(i of Array.from(t.nodes))n[i.id]=i;for(e of Array.from(t.links))null==r[e.from]&&(r[e.from]=[]),r[e.from].push(e);const s=function(t,i){let o;if(null==i&&(i=0),t.depth=Math.max(null!=t.depth?t.depth:0,i),o=r[t.id])for(e of Array.from(o))s(n[e.to],i+1);return null};for(i of Array.from(t.nodes))null==i.depth&&s(i)}(t);const n=document.createElement("div");n.classList.add("shadergraph-graph");const r=[],s={};for(const n of Array.from(t.nodes)){let t;const o=document.createElement("div");o.classList.add("shadergraph-node"),o.classList.add(`shadergraph-node-${n.type}`),o.innerHTML=`<div class="shadergraph-header">${Jn(n.name)}</div>`;const a=function(t,e){const i=Qn(t.type),n=document.createElement("div");return n.classList.add("shadergraph-outlet"),n.classList.add(`shadergraph-outlet-${e}`),n.innerHTML=`<div class="shadergraph-point" style="background: ${i}"></div>\n<div class="shadergraph-type" style="color: ${i}">${Jn(t.type)}</div>\n<div class="shadergraph-name">${Jn(t.name)}</div>`,o.appendChild(n),s[t.id]=n.querySelector(".shadergraph-point")};for(t of Array.from(n.inputs))a(t,"in");for(t of Array.from(n.outputs))a(t,"out");if(null!=n.graph)o.appendChild(er(n.graph,e));else{const t=document.createElement("div");t.classList.add("shadergraph-clear"),o.appendChild(t)}if(null!=n.code){const t=document.createElement("div");t.classList.add("shadergraph-code"),t.innerHTML=Jn(Zn(n.code)),o.appendChild(t)}i=r[n.depth],null==i&&(i=document.createElement("div"),i.classList.add("shadergraph-column"),r[n.depth]=i),i.appendChild(o)}for(i of Array.from(r))null!=i&&n.appendChild(i);for(const i of Array.from(t.links)){const t=Qn(i.type);e.push({color:t,out:s[i.out],in:s[i.in]})}return n},ir=t=>t*t,nr=function(t,e,i,n){let r;const s=i-t,o=n-e,a=Math.sqrt(ir(s)+ir(o));if(Math.abs(o)>Math.abs(s)){const l=(t+i)/2,h=(e+n)/2,u=o>0?.3:-.3;return r=Math.min(Math.abs(s)/2,20+a/8),["M",t,e,"C",t+r,e+",",l,h-a*u,l,h,"C",l,h+a*u,i-r,n+",",i,n].join(" ")}return r=Math.min(Math.abs(s)/2.5,20+a/4),["M",t,e,"C",t+r,e+",",i-r,n+",",i,n].join(" ")},rr=function(t){return null==t&&(t="svg"),document.createElementNS("http://www.w3.org/2000/svg",t)},sr=function(t,e){let i;if(null==t.parentNode)return;const n=t.getBoundingClientRect();for(i of Array.from(e)){const t=i.out.getBoundingClientRect(),e=i.in.getBoundingClientRect();i.coords={x1:(t.left+t.right)/2-n.left,y1:(t.top+t.bottom)/2-n.top,x2:(e.left+e.right)/2-n.left,y2:(e.top+e.bottom)/2-n.top}}let r=t.querySelector("svg");null!=r&&t.removeChild(r);let s=t;for(;s.parentNode&&0===s.offsetHeight;)s=s.parentNode;for(i of(r=rr(),r.setAttribute("width",s.offsetWidth),r.setAttribute("height",s.offsetHeight),Array.from(e))){const t=i.coords,e=rr("path");e.setAttribute("d",nr(t.x1,t.y1,t.x2,t.y2)),e.setAttribute("stroke",i.color),e.setAttribute("stroke-width",3),e.setAttribute("fill","transparent"),r.appendChild(e)}return t.appendChild(r)},or=function(t){const e=document.createElement("div");e.setAttribute("class","shadergraph-overlay");const i=document.createElement("div");i.setAttribute("class","shadergraph-close"),i.innerHTML="&times;";const n=document.createElement("div");n.setAttribute("class","shadergraph-view");const r=document.createElement("div");return r.setAttribute("class","shadergraph-inside"),r.appendChild(t),n.appendChild(r),e.appendChild(n),e.appendChild(i),i.addEventListener("click",(()=>e.parentNode.removeChild(e))),e},ar=function(t){if(t instanceof Node)return t;const e=document.createElement("span");return e.innerText=null!=t?t:"",e},lr=function(t){if(1!==t.length){let e;const i=document.createElement("div");for(e of Array.from(t))i.appendChild(ar(e));return i.update=()=>(()=>{const i=[];for(e of Array.from(t))i.push("function"==typeof e.update?e.update():void 0);return i})(),i}return ar(t[0])},hr=Xn,ur=y,cr=function(t){if(!t)return;if(!t.nodes)return t;const e=hr(t);return ur.process(e)},pr=function(t){return null==t?t:t instanceof Array?t.map(pr):null!=t.vertex&&null!=t.fragment?[pr(t.vertex,pr(t.fragment))]:null!=t._graph?t._graph:null!=t.graph?t.graph:t},dr=function(t){let e=[];for(const i of Array.from(t))i instanceof Array?e=e.concat(dr(i)):null!=i&&e.push(i);return e},fr=function(){const t=dr(pr([].slice.call(arguments)));return ur.merge(Array.from(t).filter((t=>t)).map((t=>cr(t))))},mr=function(){const t=fr.apply(null,arguments),e=ur.overlay(t);for(const t of Array.from(document.querySelectorAll(".shadergraph-overlay")))t.remove();return document.body.appendChild(e),t.update(),e};class gr{constructor(t,e,i){this.language=t,this.fetch=e,this.config=i,this.graph()}pipe(t,e,i,n){return t instanceof gr?this._concat(t):null!=t&&this._call(t,e,i,n),this}call(t,e,i,n){return this.pipe(t,e,i,n)}require(t,e,i,n){return t instanceof gr?this._import(t):null!=t&&(this.callback(),this._call(t,e,i,n),this.end()),this}import(t,e,i,n){return this.require(t,e,i,n)}split(){return this._group("_combine",!0),this}fan(){return this._group("_combine",!1),this}isolate(){return this._group("_isolate"),this}callback(){return this._group("_callback"),this}next(){return this._next(),this}pass(){const t=this._stack[2].end;return this.end(),this._state.end=this._state.end.concat(t),this}end(){const[t,e]=Array.from(this._exit()),{op:i}=t;return this[i]&&this[i](t,e),this}join(){return this.end()}graph(){for(;(null!=this._stack?this._stack.length:void 0)>1;)this.end();this._graph&&this._tail(this._state,this._graph);const t=this._graph;return this._graph=new Cn,this._state=new vr,this._stack=[this._state],t}compile(t){return null==t&&(t="main"),this.graph().compile(t)}link(t){return null==t&&(t="main"),this.graph().link(t)}serialize(){return hr(this._graph)}empty(){return 0===this._graph.nodes.length}_concat(t){let e;if(0===t._state.nodes.length)return this;this._tail(t._state,t._graph);try{e=new Hn(t._graph)}catch(e){throw this.config.autoInspect&&mr(e,this._graph,t),e}return this._auto(e),this}_import(t){let e;if(0===t._state.nodes.length)throw"Can't import empty callback";this._tail(t._state,t._graph);try{e=new $n(t._graph)}catch(e){throw this.config.autoInspect&&mr(e,this._graph,t),e}return this._auto(e),this}_combine(t,e){for(const i of Array.from(t.start))for(const n of Array.from(e.end))n.connect(i,t.multi);return e.end=t.end,e.nodes=e.nodes.concat(t.nodes)}_isolate(t,e){if(t.nodes.length){let e;const i=this._subgraph(t);this._tail(t,i);try{e=new Hn(i)}catch(t){throw this.config.autoInspect&&mr(t,this._graph,i),t}return this._auto(e)}}_callback(t,e){if(t.nodes.length){let e;const i=this._subgraph(t);this._tail(t,i);try{e=new $n(i)}catch(t){throw this.config.autoInspect&&mr(t,this._graph,i),t}return this._auto(e)}}_call(t,e,i,n){const r=this.fetch(t);r.bind(this.config,e,i,n);const s=new Bn(r);return this._auto(s)}_subgraph(t){const e=new Cn(null,this._graph);return e.adopt(t.nodes),e}_tail(t,e){let i=t.end.concat(t.tail);if(i=i.filter(((t,e)=>i.indexOf(t)===e)),i.length>1&&(i=new Wn(i),i=[i.node],this._graph.add(i)),e.tail=i[0],t.end=i,t.tail=[],!e.tail)throw new Error("Cannot finalize empty graph");return e.compile=t=>{null==t&&(t="main");try{return e.tail.owner.compile(this.language,t)}catch(t){throw this.config.autoInspect&&e.inspect(t),t}},e.link=t=>{null==t&&(t="main");try{return e.tail.owner.link(this.language,t)}catch(t){throw this.config.autoInspect&&e.inspect(t),t}},e.export=(t,i)=>e.tail.owner.export(t,i),e.inspect=(t=null)=>mr(t,e)}_group(t,e){return this._push(t,e),this._push(),this}_next(){const t=this._pop();return this._state.start=this._state.start.concat(t.start),this._state.end=this._state.end.concat(t.end),this._state.nodes=this._state.nodes.concat(t.nodes),this._state.tail=this._state.tail.concat(t.tail),this._push()}_exit(){return this._next(),this._pop(),[this._pop(),this._state]}_push(t,e){return this._stack.unshift(new vr(t,e)),this._state=this._stack[0]}_pop(){let t;return this._state=this._stack[1],null==this._state&&(this._state=new vr),null!=(t=this._stack.shift())?t:new vr}_auto(t){return t.node.inputs.length?this._append(t):this._insert(t)}_append(t){let e;const{node:i}=t;for(e of(this._graph.add(i),Array.from(this._state.end)))e.connect(i);this._state.start.length||(this._state.start=[i]),this._state.end=[i],this._state.nodes.push(i),i.outputs.length||this._state.tail.push(i)}_prepend(t){let e;const{node:i}=t;for(e of(this._graph.add(i),Array.from(this._state.start)))i.connect(e);this._state.end.length||(this._state.end=[i]),this._state.start=[i],this._state.nodes.push(i),i.outputs.length||this._state.tail.push(i)}_insert(t){const{node:e}=t;if(this._graph.add(e),this._state.start.push(e),this._state.end.push(e),this._state.nodes.push(e),!e.outputs.length)return this._state.tail.push(e)}}class vr{constructor(t=null,e,i,n,r,s){this.op=t,null==e&&(e=!1),this.multi=e,null==i&&(i=[]),this.start=i,null==n&&(n=[]),this.end=n,null==r&&(r=[]),this.nodes=r,null==s&&(s=[]),this.tail=s}}class yr{constructor(t,e){this.vertex=t,this.fragment=e}build(t){return this.link(t)}link(t){null==t&&(t={});const e={},i={},n={},r=this.vertex.link("main"),s=this.fragment.link("main");for(const t of[r,s]){for(const i in t.uniforms){const n=t.uniforms[i];e[i]=n}for(const e in t.varyings){const n=t.varyings[e];i[e]=n}for(const e in t.attributes){const i=t.attributes[e];n[e]=i}}return t.vertexShader=r.code,t.vertexGraph=r.graph,t.fragmentShader=s.code,t.fragmentGraph=s.graph,t.attributes=n,t.uniforms=e,t.varyings=i,t.inspect=()=>mr("Vertex Shader",r,"Fragment Shader",s.graph),t}inspect(){return mr("Vertex Shader",this.vertex,"Fragment Shader",this.fragment.graph)}}const br=function(t,e,i){let n=null,r={};null!=e&&("function"==typeof e?n=n=>i(t,n,e(n)):"object"==typeof e&&(n=function(n){if(null==e[n])throw new Error(`Unknown snippet \`${n}\``);return i(t,n,e[n])}));const s=e=>i(t,"",e);if(null==n)return s;const o=function(t){return t.match(/[{;]/)?s(t):(r[t]=!0,n(t))};return o.used=function(t){return null==t&&(t=r),r=t},o},xr=function(t){null==t&&(t=100);const e={};let i=null,n=null,r=0;const s=function(t){if(t.prev=null,t.next=i,null!=i&&(i.prev=t),i=t,null==n)return n=t},o=function(t){const{prev:e}=t,{next:r}=t;if(null!=e&&(e.next=r),null!=r&&(r.prev=e),i===t&&(i=r),n===t)return n=e};return function(a){let l,h;return(h=e[a])&&h!==i?(o(h),s(h)):(r===t?(l=n.key,o(n),delete e[l]):r++,h={next:i,prev:null,key:a},s(h),e[a]=h),l}},wr=function(t){const e={},i=xr(100);return function(n){const r=n.length>32?"##"+Yn(n).toString(16):n,s=i(r);return null!=s&&delete e[s],null==e[r]&&(e[r]=t(n)),e[r].clone()}},_r=function(t){const{code:e,signatures:i}=t,n=kr(i);return[i,zr(e,n)]},kr=function(t){const e={},i=t=>e[t.name]=!0;i(t.main);for(const e of["external","internal","varying","uniform","attribute"])for(const n of t[e])i(n);return e},zr=function(t,e){let i;const n=new RegExp("\\b("+(()=>{const t=[];for(i in e)t.push(i);return t})().join("|")+")\\b","g");return t=(t=t.replace(/\/\/[^\n]*/g,"")).replace(/\/\*([^*]|\*[^/])*\*\//g,""),function(i,r,s){let o;null==i&&(i=""),null==r&&(r={}),null==s&&(s={});const a={};for(o in e)a[o]=null!=r[o]?o:i+o;const l=t.replace(n,(t=>a[t])),h=(()=>{const t=[];for(o in s){const e=s[o];t.push(`#define ${o} ${e}`)}return t})();return h.length&&h.push(""),h.join("\n")+l}};var Sr=n(9932),Mr=n.n(Sr),Ar=n(3036),Cr=n.n(Ar);class Tr{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),n=Math.sin(e),r=this.x-t.x,s=this.y-t.y;return this.x=r*i-s*n+t.x,this.y=r*n+s*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}Tr.prototype.isVector2=!0;const Or=[];for(let t=0;t<256;t++)Or[t]=(t<16?"0":"")+t.toString(16);Math.PI,Math.PI;function Er(t,e,i){return Math.max(e,Math.min(i,t))}class Pr{constructor(t=0,e=0,i=0,n=1){this._x=t,this._y=e,this._z=i,this._w=n}static slerp(t,e,i,n){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(t,e,n)}static slerpFlat(t,e,i,n,r,s,o){let a=i[n+0],l=i[n+1],h=i[n+2],u=i[n+3];const c=r[s+0],p=r[s+1],d=r[s+2],f=r[s+3];if(0===o)return t[e+0]=a,t[e+1]=l,t[e+2]=h,void(t[e+3]=u);if(1===o)return t[e+0]=c,t[e+1]=p,t[e+2]=d,void(t[e+3]=f);if(u!==f||a!==c||l!==p||h!==d){let t=1-o;const e=a*c+l*p+h*d+u*f,i=e>=0?1:-1,n=1-e*e;if(n>Number.EPSILON){const r=Math.sqrt(n),s=Math.atan2(r,e*i);t=Math.sin(t*s)/r,o=Math.sin(o*s)/r}const r=o*i;if(a=a*t+c*r,l=l*t+p*r,h=h*t+d*r,u=u*t+f*r,t===1-o){const t=1/Math.sqrt(a*a+l*l+h*h+u*u);a*=t,l*=t,h*=t,u*=t}}t[e]=a,t[e+1]=l,t[e+2]=h,t[e+3]=u}static multiplyQuaternionsFlat(t,e,i,n,r,s){const o=i[n],a=i[n+1],l=i[n+2],h=i[n+3],u=r[s],c=r[s+1],p=r[s+2],d=r[s+3];return t[e]=o*d+h*u+a*p-l*c,t[e+1]=a*d+h*c+l*u-o*p,t[e+2]=l*d+h*p+o*c-a*u,t[e+3]=h*d-o*u-a*c-l*p,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=t._x,n=t._y,r=t._z,s=t._order,o=Math.cos,a=Math.sin,l=o(i/2),h=o(n/2),u=o(r/2),c=a(i/2),p=a(n/2),d=a(r/2);switch(s){case"XYZ":this._x=c*h*u+l*p*d,this._y=l*p*u-c*h*d,this._z=l*h*d+c*p*u,this._w=l*h*u-c*p*d;break;case"YXZ":this._x=c*h*u+l*p*d,this._y=l*p*u-c*h*d,this._z=l*h*d-c*p*u,this._w=l*h*u+c*p*d;break;case"ZXY":this._x=c*h*u-l*p*d,this._y=l*p*u+c*h*d,this._z=l*h*d+c*p*u,this._w=l*h*u-c*p*d;break;case"ZYX":this._x=c*h*u-l*p*d,this._y=l*p*u+c*h*d,this._z=l*h*d-c*p*u,this._w=l*h*u+c*p*d;break;case"YZX":this._x=c*h*u+l*p*d,this._y=l*p*u+c*h*d,this._z=l*h*d-c*p*u,this._w=l*h*u-c*p*d;break;case"XZY":this._x=c*h*u-l*p*d,this._y=l*p*u-c*h*d,this._z=l*h*d+c*p*u,this._w=l*h*u+c*p*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],n=e[4],r=e[8],s=e[1],o=e[5],a=e[9],l=e[2],h=e[6],u=e[10],c=i+o+u;if(c>0){const t=.5/Math.sqrt(c+1);this._w=.25/t,this._x=(h-a)*t,this._y=(r-l)*t,this._z=(s-n)*t}else if(i>o&&i>u){const t=2*Math.sqrt(1+i-o-u);this._w=(h-a)/t,this._x=.25*t,this._y=(n+s)/t,this._z=(r+l)/t}else if(o>u){const t=2*Math.sqrt(1+o-i-u);this._w=(r-l)/t,this._x=(n+s)/t,this._y=.25*t,this._z=(a+h)/t}else{const t=2*Math.sqrt(1+u-i-o);this._w=(s-n)/t,this._x=(r+l)/t,this._y=(a+h)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Er(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const n=Math.min(1,e/i);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,n=t._y,r=t._z,s=t._w,o=e._x,a=e._y,l=e._z,h=e._w;return this._x=i*h+s*o+n*l-r*a,this._y=n*h+s*a+r*o-i*l,this._z=r*h+s*l+i*a-n*o,this._w=s*h-i*o-n*a-r*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const i=this._x,n=this._y,r=this._z,s=this._w;let o=s*t._w+i*t._x+n*t._y+r*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=i,this._y=n,this._z=r,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*i+e*this._x,this._y=t*n+e*this._y,this._z=t*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),h=Math.atan2(l,o),u=Math.sin((1-e)*h)/l,c=Math.sin(e*h)/l;return this._w=s*u+this._w*c,this._x=i*u+this._x*c,this._y=n*u+this._y*c,this._z=r*u+this._z*c,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),n=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(n),i*Math.sin(r),i*Math.cos(r),e*Math.sin(n))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}Pr.prototype.isQuaternion=!0;class Dr{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(qr.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(qr.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*n,this.y=r[1]*e+r[4]*i+r[7]*n,this.z=r[2]*e+r[5]*i+r[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,r=t.elements,s=1/(r[3]*e+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*n+r[12])*s,this.y=(r[1]*e+r[5]*i+r[9]*n+r[13])*s,this.z=(r[2]*e+r[6]*i+r[10]*n+r[14])*s,this}applyQuaternion(t){const e=this.x,i=this.y,n=this.z,r=t.x,s=t.y,o=t.z,a=t.w,l=a*e+s*n-o*i,h=a*i+o*e-r*n,u=a*n+r*i-s*e,c=-r*e-s*i-o*n;return this.x=l*a+c*-r+h*-o-u*-s,this.y=h*a+c*-s+u*-r-l*-o,this.z=u*a+c*-o+l*-s-h*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n,this.y=r[1]*e+r[5]*i+r[9]*n,this.z=r[2]*e+r[6]*i+r[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,n=t.y,r=t.z,s=e.x,o=e.y,a=e.z;return this.x=n*a-r*o,this.y=r*s-i*a,this.z=i*o-n*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return jr.copy(this).projectOnVector(t),this.sub(jr)}reflect(t){return this.sub(jr.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(Er(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const n=Math.sin(e)*t;return this.x=n*Math.sin(i),this.y=Math.cos(e)*t,this.z=n*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}Dr.prototype.isVector3=!0;const jr=new Dr,qr=new Pr;class Fr{constructor(t=0,e=0,i=0,n=1){this.x=t,this.y=e,this.z=i,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,r=this.w,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*n+s[12]*r,this.y=s[1]*e+s[5]*i+s[9]*n+s[13]*r,this.z=s[2]*e+s[6]*i+s[10]*n+s[14]*r,this.w=s[3]*e+s[7]*i+s[11]*n+s[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,n,r;const s=.01,o=.1,a=t.elements,l=a[0],h=a[4],u=a[8],c=a[1],p=a[5],d=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(h-c)<s&&Math.abs(u-f)<s&&Math.abs(d-m)<s){if(Math.abs(h+c)<o&&Math.abs(u+f)<o&&Math.abs(d+m)<o&&Math.abs(l+p+g-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,a=(p+1)/2,v=(g+1)/2,y=(h+c)/4,b=(u+f)/4,x=(d+m)/4;return t>a&&t>v?t<s?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(t),n=y/i,r=b/i):a>v?a<s?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(a),i=y/n,r=x/n):v<s?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(v),i=b/r,n=x/r),this.set(i,n,r,e),this}let v=Math.sqrt((m-d)*(m-d)+(u-f)*(u-f)+(c-h)*(c-h));return Math.abs(v)<.001&&(v=1),this.x=(m-d)/v,this.y=(u-f)/v,this.z=(c-h)/v,this.w=Math.acos((l+p+g-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}Fr.prototype.isVector4=!0;class Ir{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,n,r,s,o,a,l){const h=this.elements;return h[0]=t,h[1]=n,h[2]=o,h[3]=e,h[4]=r,h[5]=a,h[6]=i,h[7]=s,h[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,r=this.elements,s=i[0],o=i[3],a=i[6],l=i[1],h=i[4],u=i[7],c=i[2],p=i[5],d=i[8],f=n[0],m=n[3],g=n[6],v=n[1],y=n[4],b=n[7],x=n[2],w=n[5],_=n[8];return r[0]=s*f+o*v+a*x,r[3]=s*m+o*y+a*w,r[6]=s*g+o*b+a*_,r[1]=l*f+h*v+u*x,r[4]=l*m+h*y+u*w,r[7]=l*g+h*b+u*_,r[2]=c*f+p*v+d*x,r[5]=c*m+p*y+d*w,r[8]=c*g+p*b+d*_,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],h=t[8];return e*s*h-e*o*l-i*r*h+i*o*a+n*r*l-n*s*a}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],h=t[8],u=h*s-o*l,c=o*a-h*r,p=l*r-s*a,d=e*u+i*c+n*p;if(0===d)return this.set(0,0,0,0,0,0,0,0,0);const f=1/d;return t[0]=u*f,t[1]=(n*l-h*i)*f,t[2]=(o*i-n*s)*f,t[3]=c*f,t[4]=(h*e-n*a)*f,t[5]=(n*r-o*e)*f,t[6]=p*f,t[7]=(i*a-l*e)*f,t[8]=(s*e-i*r)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,n,r,s,o){const a=Math.cos(r),l=Math.sin(r);return this.set(i*a,i*l,-i*(a*s+l*o)+s+t,-n*l,n*a,-n*(-l*s+a*o)+o+e,0,0,1),this}scale(t,e){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),n=this.elements,r=n[0],s=n[3],o=n[6],a=n[1],l=n[4],h=n[7];return n[0]=e*r+i*a,n[3]=e*s+i*l,n[6]=e*o+i*h,n[1]=-i*r+e*a,n[4]=-i*s+e*l,n[7]=-i*o+e*h,this}translate(t,e){const i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<9;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}Ir.prototype.isMatrix3=!0;class Lr{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,n,r,s,o,a,l,h,u,c,p,d,f,m){const g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=n,g[1]=r,g[5]=s,g[9]=o,g[13]=a,g[2]=l,g[6]=h,g[10]=u,g[14]=c,g[3]=p,g[7]=d,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Lr).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,n=1/Nr.setFromMatrixColumn(t,0).length(),r=1/Nr.setFromMatrixColumn(t,1).length(),s=1/Nr.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=0,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=0,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,i=t.x,n=t.y,r=t.z,s=Math.cos(i),o=Math.sin(i),a=Math.cos(n),l=Math.sin(n),h=Math.cos(r),u=Math.sin(r);if("XYZ"===t.order){const t=s*h,i=s*u,n=o*h,r=o*u;e[0]=a*h,e[4]=-a*u,e[8]=l,e[1]=i+n*l,e[5]=t-r*l,e[9]=-o*a,e[2]=r-t*l,e[6]=n+i*l,e[10]=s*a}else if("YXZ"===t.order){const t=a*h,i=a*u,n=l*h,r=l*u;e[0]=t+r*o,e[4]=n*o-i,e[8]=s*l,e[1]=s*u,e[5]=s*h,e[9]=-o,e[2]=i*o-n,e[6]=r+t*o,e[10]=s*a}else if("ZXY"===t.order){const t=a*h,i=a*u,n=l*h,r=l*u;e[0]=t-r*o,e[4]=-s*u,e[8]=n+i*o,e[1]=i+n*o,e[5]=s*h,e[9]=r-t*o,e[2]=-s*l,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){const t=s*h,i=s*u,n=o*h,r=o*u;e[0]=a*h,e[4]=n*l-i,e[8]=t*l+r,e[1]=a*u,e[5]=r*l+t,e[9]=i*l-n,e[2]=-l,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){const t=s*a,i=s*l,n=o*a,r=o*l;e[0]=a*h,e[4]=r-t*u,e[8]=n*u+i,e[1]=u,e[5]=s*h,e[9]=-o*h,e[2]=-l*h,e[6]=i*u+n,e[10]=t-r*u}else if("XZY"===t.order){const t=s*a,i=s*l,n=o*a,r=o*l;e[0]=a*h,e[4]=-u,e[8]=l*h,e[1]=t*u+r,e[5]=s*h,e[9]=i*u-n,e[2]=n*u-i,e[6]=o*h,e[10]=r*u+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Ur,t,Vr)}lookAt(t,e,i){const n=this.elements;return Hr.subVectors(t,e),0===Hr.lengthSq()&&(Hr.z=1),Hr.normalize(),Br.crossVectors(i,Hr),0===Br.lengthSq()&&(1===Math.abs(i.z)?Hr.x+=1e-4:Hr.z+=1e-4,Hr.normalize(),Br.crossVectors(i,Hr)),Br.normalize(),$r.crossVectors(Hr,Br),n[0]=Br.x,n[4]=$r.x,n[8]=Hr.x,n[1]=Br.y,n[5]=$r.y,n[9]=Hr.y,n[2]=Br.z,n[6]=$r.z,n[10]=Hr.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,r=this.elements,s=i[0],o=i[4],a=i[8],l=i[12],h=i[1],u=i[5],c=i[9],p=i[13],d=i[2],f=i[6],m=i[10],g=i[14],v=i[3],y=i[7],b=i[11],x=i[15],w=n[0],_=n[4],k=n[8],z=n[12],S=n[1],M=n[5],A=n[9],C=n[13],T=n[2],O=n[6],E=n[10],P=n[14],D=n[3],j=n[7],q=n[11],F=n[15];return r[0]=s*w+o*S+a*T+l*D,r[4]=s*_+o*M+a*O+l*j,r[8]=s*k+o*A+a*E+l*q,r[12]=s*z+o*C+a*P+l*F,r[1]=h*w+u*S+c*T+p*D,r[5]=h*_+u*M+c*O+p*j,r[9]=h*k+u*A+c*E+p*q,r[13]=h*z+u*C+c*P+p*F,r[2]=d*w+f*S+m*T+g*D,r[6]=d*_+f*M+m*O+g*j,r[10]=d*k+f*A+m*E+g*q,r[14]=d*z+f*C+m*P+g*F,r[3]=v*w+y*S+b*T+x*D,r[7]=v*_+y*M+b*O+x*j,r[11]=v*k+y*A+b*E+x*q,r[15]=v*z+y*C+b*P+x*F,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],n=t[8],r=t[12],s=t[1],o=t[5],a=t[9],l=t[13],h=t[2],u=t[6],c=t[10],p=t[14];return t[3]*(+r*a*u-n*l*u-r*o*c+i*l*c+n*o*p-i*a*p)+t[7]*(+e*a*p-e*l*c+r*s*c-n*s*p+n*l*h-r*a*h)+t[11]*(+e*l*u-e*o*p-r*s*u+i*s*p+r*o*h-i*l*h)+t[15]*(-n*o*h-e*a*u+e*o*c+n*s*u-i*s*c+i*a*h)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],h=t[8],u=t[9],c=t[10],p=t[11],d=t[12],f=t[13],m=t[14],g=t[15],v=u*m*l-f*c*l+f*a*p-o*m*p-u*a*g+o*c*g,y=d*c*l-h*m*l-d*a*p+s*m*p+h*a*g-s*c*g,b=h*f*l-d*u*l+d*o*p-s*f*p-h*o*g+s*u*g,x=d*u*a-h*f*a-d*o*c+s*f*c+h*o*m-s*u*m,w=e*v+i*y+n*b+r*x;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const _=1/w;return t[0]=v*_,t[1]=(f*c*r-u*m*r-f*n*p+i*m*p+u*n*g-i*c*g)*_,t[2]=(o*m*r-f*a*r+f*n*l-i*m*l-o*n*g+i*a*g)*_,t[3]=(u*a*r-o*c*r-u*n*l+i*c*l+o*n*p-i*a*p)*_,t[4]=y*_,t[5]=(h*m*r-d*c*r+d*n*p-e*m*p-h*n*g+e*c*g)*_,t[6]=(d*a*r-s*m*r-d*n*l+e*m*l+s*n*g-e*a*g)*_,t[7]=(s*c*r-h*a*r+h*n*l-e*c*l-s*n*p+e*a*p)*_,t[8]=b*_,t[9]=(d*u*r-h*f*r-d*i*p+e*f*p+h*i*g-e*u*g)*_,t[10]=(s*f*r-d*o*r+d*i*l-e*f*l-s*i*g+e*o*g)*_,t[11]=(h*o*r-s*u*r-h*i*l+e*u*l+s*i*p-e*o*p)*_,t[12]=x*_,t[13]=(h*f*n-d*u*n+d*i*c-e*f*c-h*i*m+e*u*m)*_,t[14]=(d*o*n-s*f*n-d*i*a+e*f*a+s*i*m-e*o*m)*_,t[15]=(s*u*n-h*o*n+h*i*a-e*u*a-s*i*c+e*o*c)*_,this}scale(t){const e=this.elements,i=t.x,n=t.y,r=t.z;return e[0]*=i,e[4]*=n,e[8]*=r,e[1]*=i,e[5]*=n,e[9]*=r,e[2]*=i,e[6]*=n,e[10]*=r,e[3]*=i,e[7]*=n,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),n=Math.sin(e),r=1-i,s=t.x,o=t.y,a=t.z,l=r*s,h=r*o;return this.set(l*s+i,l*o-n*a,l*a+n*o,0,l*o+n*a,h*o+i,h*a-n*s,0,l*a-n*o,h*a+n*s,r*a*a+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,n,r,s){return this.set(1,i,r,0,t,1,s,0,e,n,1,0,0,0,0,1),this}compose(t,e,i){const n=this.elements,r=e._x,s=e._y,o=e._z,a=e._w,l=r+r,h=s+s,u=o+o,c=r*l,p=r*h,d=r*u,f=s*h,m=s*u,g=o*u,v=a*l,y=a*h,b=a*u,x=i.x,w=i.y,_=i.z;return n[0]=(1-(f+g))*x,n[1]=(p+b)*x,n[2]=(d-y)*x,n[3]=0,n[4]=(p-b)*w,n[5]=(1-(c+g))*w,n[6]=(m+v)*w,n[7]=0,n[8]=(d+y)*_,n[9]=(m-v)*_,n[10]=(1-(c+f))*_,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,e,i){const n=this.elements;let r=Nr.set(n[0],n[1],n[2]).length();const s=Nr.set(n[4],n[5],n[6]).length(),o=Nr.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),t.x=n[12],t.y=n[13],t.z=n[14],Rr.copy(this);const a=1/r,l=1/s,h=1/o;return Rr.elements[0]*=a,Rr.elements[1]*=a,Rr.elements[2]*=a,Rr.elements[4]*=l,Rr.elements[5]*=l,Rr.elements[6]*=l,Rr.elements[8]*=h,Rr.elements[9]*=h,Rr.elements[10]*=h,e.setFromRotationMatrix(Rr),i.x=r,i.y=s,i.z=o,this}makePerspective(t,e,i,n,r,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const o=this.elements,a=2*r/(e-t),l=2*r/(i-n),h=(e+t)/(e-t),u=(i+n)/(i-n),c=-(s+r)/(s-r),p=-2*s*r/(s-r);return o[0]=a,o[4]=0,o[8]=h,o[12]=0,o[1]=0,o[5]=l,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=c,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,i,n,r,s){const o=this.elements,a=1/(e-t),l=1/(i-n),h=1/(s-r),u=(e+t)*a,c=(i+n)*l,p=(s+r)*h;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-c,o[2]=0,o[6]=0,o[10]=-2*h,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<16;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}Lr.prototype.isMatrix4=!0;const Nr=new Dr,Rr=new Lr,Ur=new Dr(0,0,0),Vr=new Dr(1,1,1),Br=new Dr,$r=new Dr,Hr=new Dr,Wr={in:0,out:1,inout:2},Xr=t=>t.token.data;Wr.node=function(t){return"function"===(null!=t.children[5]?t.children[5].type:void 0)?Wr.function(t):"keyword"===(null!=t.token?t.token.type:void 0)?Wr.external(t):void 0},Wr.external=function(t){let e=t.children,i=Xr(e[1]);const n=Xr(e[4]),r=e[5];["attribute","uniform","varying"].includes(i)||(i="global");const s=[];for(let t=0;t<r.children.length;t++)if(e=r.children[t],"ident"===e.type){const o=Xr(e),a=r.children[t+1],l="quantifier"===(null!=a?a.type:void 0);s.push({decl:"external",storage:i,type:n,ident:o,quant:!!l,count:l})}return s},Wr.function=function(t){const e=t.children,i=Xr(e[1]),n=Xr(e[4]),r=e[5],s=Xr(r.children[0]),o=r.children[1];return[{decl:"function",storage:i,type:n,ident:s,body:!!r.children[2],args:Array.from(o.children).map((t=>Wr.argument(t)))}]},Wr.argument=function(t){const e=t.children,i=Xr(e[1]),n=Xr(e[2]),r=Xr(e[4]),s=e[5],o=Xr(s.children[0]),a=s.children[1];return{decl:"argument",storage:i,inout:n,type:r,ident:o,quant:!!a,count:a?a.children[0].token.data:void 0}},Wr.param=function(t,e,i,n,r){let s=[];null!=e&&s.push(e),null!=i&&s.push(i),s.push(""),s=s.join(" ");const o=n?"["+r+"]":"";""!==t&&(t+=" ");const a=(e,i)=>(i?t:"")+`${s}${e}${o}`;return a.split=t=>Wr.param(t,e,i,n,r),a};const Gr="undefined"!=typeof window&&!!window.THREE,Yr={int:0,float:0,vec2:Gr?Tr:null,vec3:Gr?Dr:null,vec4:Gr?Fr:null,mat2:null,mat3:Gr?Ir:null,mat4:Gr?Lr:null,sampler2D:0,samplerCube:0},Zr={int:"i",float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat2:"m2",mat3:"m3",mat4:"m4",sampler2D:"t",samplerCube:"t"};Wr.type=function(t,e,i,n,r,s){const o={in:Wr.in,out:Wr.out,inout:Wr.inout};let a=Zr[e];i&&(a+="v");let l=Yr[e];(null!=l?l.call:void 0)&&(l=new l),i&&(l=[l]);const h=null!=o[r]?o[r]:o.in;s={const:"const"}[s];const u=Wr.param(r,s,e,i,n);return new Qr(t,a,e,u,l,h)};class Qr{constructor(t,e,i,n,r,s,o){this.name=t,this.type=e,this.spec=i,this.param=n,this.value=r,this.inout=s,this.meta=o}split(){const t=null!=this.meta.shadowed,e=t?"in":"out",i=t?Wr.in:Wr.out,n=this.param.split(e);return new Qr(this.name,this.type,this.spec,n,this.value,i)}copy(t,e){return new Qr(null!=t?t:this.name,this.type,this.spec,this.param,this.value,this.inout,e)}}const Jr="_i_o",Kr="return";let ts=!1;const es=function(t,e){const i=is(t,e);return ns(i,e)},is=function(t,e){let i,n,r=[];ts&&(n=hs());try{const t=Mr()(e);i=Cr()(t)}catch(t){r=[{message:t}]}ts&&n("GLSL Tokenize & Parse");const s=function(t){const e=(""+(t=t.split("\n")).length).length;return t.map(((t,i)=>{return`${n=i+1,(n=""+n).length<e?("       "+n).slice(-e):n}: ${t}`;var n})).join("\n")};if(!i||r.length){t||(t="(inline code)"),console.warn(s(e));for(const e of r)console.error(`${t} -`,e.message);throw new Error("GLSL parse error")}return i},ns=function(t,e){let i;ts&&(i=hs());const n=[];ls(rs,ss(n),t,"");const[r,s,o]=Array.from(os(n)),a=as(r,s,o);return ts&&i("GLSL AST"),{ast:t,code:e,signatures:a}},rs=function(t,e){return"decl"!==t.type||(e(Wr.node(t)),!1)},ss=t=>function(e){null!=e&&Array.from(e).map((e=>t.push(e)))},os=function(t){let e=null;const i=[];let n=[];const r={};let s=!1;for(const o of Array.from(t))o.body?(r[o.ident]&&(n=Array.from(n).filter((t=>t.ident!==o.ident)),delete r[o.ident]),i.push(o),"main"===o.ident?(e=o,s=!0):s||(e=o)):"global"===o.storage?i.push(o):(n.push(o),r[o.ident]=!0);return[e,i,n]},as=function(t,e,i){let n;const r={uniform:[],attribute:[],varying:[],external:[],internal:[],global:[],main:null},s=t=>Wr.type(t.ident,t.type,t.quant,t.count,t.inout,t.storage),o=function(t,e){let i;const n=Array.from(t.args).map((t=>s(t)));for(i of Array.from(n))if(i.inout===Wr.inout){const t=i,e=i.copy();t.inout=Wr.in,e.inout=Wr.out,e.meta={shadow:t.name},e.name+=Jr,t.meta={shadowed:e.name},n.push(e)}"void"!==t.type&&n.unshift(Wr.type(Kr,t.type,!1,"","out"));const r=`(${(()=>{const t=[];for(i of Array.from(n))i.inout===Wr.in&&t.push(i.type);return t})().join(",")})(${(()=>{const t=[];for(i of Array.from(n))i.inout===Wr.out&&t.push(i.type);return t})().join(",")})`;return{name:t.ident,type:r,signature:n,inout:e,spec:t.type}};for(n of(r.main=o(t,Wr.out),Array.from(e)))r.internal.push({name:n.ident});for(n of Array.from(i)){let t;switch(n.decl){case"external":t=s(n),r[n.storage].push(t);break;case"function":t=o(n,Wr.in),r.external.push(t)}}return r};ts=!1;const ls=function(t,e,i,n){ts&&console.log(n,i.type,null!=i.token?i.token.data:void 0,null!=i.token?i.token.type:void 0);if(t(i,e))for(let r=0;r<i.children.length;r++){const s=i.children[r];ls(t,e,s,n+"  ",ts)}return null},hs=function(){const t=+new Date;return function(e){const i=+new Date-t;return console.log(e,i+" ms"),i}};function us(t){const e=t.replace(Jr,"");return e!==t?e:null}function cs(t){return t.join("\n")}function ps(t){return t.join(", ")}function ds(t){return t.join(";\n")}function fs(t){return{entry:t,type:"void",params:[],signature:[],return:"",vars:{},calls:[],post:[],chain:{}}}function ms(t,e){return`#define ${t} ${e}`}function gs(t,e,i,n,r){return`${t} ${e}(${i}) {\n${n}${r}}`}function vs(t,e,i){return`  ${t=t?`${t} = `:""}${e}(${i=ps(i)})`}function ys(t,e){for(let i=0;i<t.length;i++){const n=t[i],r=e[i];if(!r)return!1;if(n.type!==r.type)return!1;if(n.name===Kr!=(r.name===Kr))return!1}return!0}function bs(t,e,i,n,r){const s=[];let o="";for(let i of Array.from(n)){let n,a;const{name:l}=i;let h=n=t(l),u=null,c=null,p=!1;const d=l===Kr;if((a=null!=i.meta?i.meta.shadowed:void 0)&&(u=t(a),u&&(r.vars[u]="  "+i.param(u),r.calls.push(`  ${u} = ${n}`),e(a)?c={shadowed:u}:i=i.split())),(a=null!=i.meta?i.meta.shadow:void 0)&&(u=t(a),u)){if(e(a)){c={shadow:u};continue}i=i.split(),p=!0}if(d?o=n:p||s.push(null!=u?u:n),e(l)){let t="push";d?""===r.return?(t="unshift",h=l,r.type=i.spec,r.return=`  return ${n}`,r.vars[n]="  "+i.param(n)):(r.vars[n]="  "+i.param(n),r.params.push(i.param(n,!0))):r.params.push(i.param(n,!0)),i=i.copy(h,c),r.signature[t](i)}else r.vars[n]="  "+i.param(n)}return r.calls.push(vs(o,i,s))}function xs(t,e){const{entry:i}=t;let n=null;if(e&&1===e.length&&"main"!==i){const r=e[0].module;ys(t.signature,r.main.signature)&&(n=ms(i,r.entry))}if(null==n){let r=(()=>{const e=[];for(const i in t.vars){const n=t.vars[i];e.push(n)}return e})();({calls:e}=t);const{post:s}=t;let{params:o}=t;const{type:a}=t,l=t.return;e=e.concat(s),""!==l&&e.push(l),e.push(""),r.length?(r.push(""),r=ds(r)+"\n"):r="",e=ds(e),o=ps(o),n=gs(a,i,o,r,e)}return{signature:t.signature,code:n,name:i}}function ws(t){const e={defs:[],bodies:[]};for(const i of Array.from(t))_s(i,e);return e.defs=cs(e.defs),e.bodies=ds(e.bodies),""===e.defs&&delete e.defs,""===e.bodies&&delete e.bodies,e}const _s=(t,e)=>{let i,n;const{module:r,name:s,external:o}=t,{main:a}=r,{entry:l}=r;if(ys(a.signature,o.signature))return e.defs.push(ms(s,l));const h=[],u=[];let c={};const p=[r.namespace,Kr].join("");for(i of Array.from(o.signature))n=i.inout===En?h:u,n.push(i);for(i of Array.from(a.signature)){n=i.inout===En?h:u;let t=n.shift().name;t===Kr&&(t=p),c[i.name]=t}let d=t=>c[t];const f=()=>!0,m=fs();bs(d,f,l,a.signature,m),m.entry=l,c={return:p},d=t=>null!=c[t]?c[t]:t;const g=fs();return bs(d,f,l,o.signature,g),g.calls=m.calls,g.entry=s,e.bodies.push(xs(m).code.split(" {")[0]),e.bodies.push(xs(g).code)};function ks(t){const e=/([A-Za-z0-9_]+\s+)?[A-Za-z0-9_]+\s+[A-Za-z0-9_]+\s*\([^)]*\)\s*;\s*/gm,i=t=>t.replace(e,(t=>"")),n=t.split(/(?=[{}])/g);let r=0;for(let t=0;t<n.length;t++){const e=n[t];switch(e[0]){case"{":r++;break;case"}":r--}if(0===r){const r=e.split(/^[ \t]*#/m);for(let t=0;t<r.length;t++){let e=r[t];if(t>0){e=e.split(/\n/);const n=e.shift(),s=e.join("\n");r[t]=[n,i(s)].join("\n")}else r[t]=i(e)}n[t]=r.join("#")}}return n.join("")}function zs(t){const e={};return t.replace(/((attribute|uniform|varying)\s+)[A-Za-z0-9_]+\s+([A-Za-z0-9_]+)\s*(\[[^\]]*\]\s*)?;\s*/gm,(function(t,i,n,r,s){return e[r]?"":(e[r]=!0,t)}))}function Ss(t){const e=function(t,e){const i=[],n=[];for(const r of Array.from(t)){(r.match(e)?i:n).push(r)}return i.concat(n)};let i=t.split("\n");return i=e(i,/^#define ([^ ]+ _pg_[0-9]+_|_pg_[0-9]+_ [^ ]+)$/),i=e(i,/^#extension/),i.join("\n")}const{library:Ms,cache:As}=x,{visualize:Cs,inspect:Ts}=b,{Snippet:Os}=v,Es=function(t,e={}){const i={};for(let n in t)i[n]=e[n]||t[n];return i};class Ps{constructor(t,e){this.config=Es({globalUniforms:!1,globalVaryings:!0,globalAttributes:!0,globals:[],autoInspect:!1},e),this.fetch=As(Ms(w,t,Os.load))}shader(t){null==t&&(t={});const e=Es(this.config,t);return new gr(w,this.fetch,e)}material(t){return new yr(this.shader(t),this.shader(t))}inspect(t){return Ps.inspect(t)}visualize(t){return Ps.visualize(t)}static inspect(t){return Ts(t)}static visualize(t){return Cs(t)}}Ps.Block=Rn,Ps.Factory=x,Ps.GLSL=w,Ps.Graph=g,Ps.Linker=v,Ps.Visualize=b;const Ds=function(t){return function(t,e={}){return new Ps(t,e)}((function(e){const i=t[e];if(null!=i)return i;const n=["#",".",":","["].includes(e[0])?e:`#${e}`,r=document.querySelector(n);if(null!=r&&"SCRIPT"===r.tagName)return r.textContent||r.innerText;throw new Error(`Unknown shader \`${e}\``)}),{autoInspect:!0})},js={"arrow.position":"uniform float worldUnit;\nuniform float lineDepth;\nuniform float lineWidth;\nuniform float focusDepth;\n\nuniform vec4 geometryClip;\nuniform float arrowSize;\nuniform float arrowSpace;\n\nattribute vec4 position4;\nattribute vec3 arrow;\nattribute vec2 attach;\n\n// External\nvec3 getPosition(vec4 xyzw, float canonical);\n\nvoid getArrowGeometry(vec4 xyzw, float near, float mid, float far, out vec3 left, out vec3 right, out vec3 middle, out vec3 start) {\n  right  = getPosition(xyzw, 1.0);\n  left   = getPosition(vec4(near, xyzw.yzw), 0.0);\n  middle = getPosition(vec4(mid,  xyzw.yzw), 0.0);\n  start  = getPosition(vec4(far,  xyzw.yzw), 0.0);\n}\n\nmat4 getArrowMatrix(vec3 left, vec3 right, vec3 middle, vec3 start) {\n\n  float depth = focusDepth;\n  if (lineDepth < 1.0) {\n    // Depth blending\n    float z = max(0.00001, -right.z);\n    depth = mix(z, focusDepth, lineDepth);\n  }\n\n  vec3 diff = left - right;\n  float l = length(diff);\n  if (l == 0.0) {\n    return mat4(1.0, 0.0, 0.0, 0.0,\n                0.0, 1.0, 0.0, 0.0,\n                0.0, 0.0, 1.0, 0.0,\n                0.0, 0.0, 0.0, 1.0);\n  }\n\n  // Construct TBN matrix around shaft\n  vec3 t = normalize(diff);\n  vec3 n = normalize(cross(t, t.yzx + vec3(.1, .2, .3)));\n  vec3 b = cross(n, t);\n\n  // Shrink arrows when vector gets too small\n  // Approach linear scaling with cubic ease the smaller we get\n  float size = arrowSize * lineWidth * worldUnit * depth * 1.25;\n  l = max(length(right - middle), length(middle - start)) * 2.0 * arrowSpace;\n  float mini = clamp(1.0 - l / size * .333, 0.0, 1.0);\n  float scale = 1.0 - mini * mini * mini;\n  float range = size * scale;\n\n  // Size to 2.5:1 ratio\n  float rangeNB = range / 2.5;\n\n  // Anchor at end position\n  return mat4(vec4(n * rangeNB,  0),\n              vec4(b * rangeNB,  0),\n              vec4(t * range, 0),\n              vec4(right,  1.0));\n}\n\nvec3 getArrowPosition() {\n  vec3 left, right, middle, start;\n\n  // Clip arrow position and attachment anchors to data\n  vec4 p = min(geometryClip, position4);\n  vec3 a = vec3(min(geometryClip.x, p.x + attach.x), geometryClip.x / 2.0, min(geometryClip.x, attach.y));\n\n  getArrowGeometry(p, a.x, a.y, a.z, left, right, middle, start);\n  mat4 matrix = getArrowMatrix(left, right, middle, start);\n\n  return (matrix * vec4(arrow.xyz, 1.0)).xyz;\n\n}\n","axis.position":"uniform vec4 axisStep;\nuniform vec4 axisPosition;\n\nvec4 getAxisPosition(vec4 xyzw, inout vec4 stpq) {\n  return axisStep * xyzw.x + axisPosition;\n}\n","cartesian.position":"uniform mat4 viewMatrix;\n\nvec4 getCartesianPosition(vec4 position, inout vec4 stpq) {\n  return viewMatrix * vec4(position.xyz, 1.0);\n}\n","cartesian4.position":"uniform vec4 basisScale;\nuniform vec4 basisOffset;\nuniform vec4 viewScale;\nuniform vec4 viewOffset;\n\nvec4 getCartesian4Position(vec4 position, inout vec4 stpq) {\n  return position * basisScale + basisOffset;\n}\n","clamp.position":"uniform vec4 clampLimit;\n\nvec4 getClampXYZW(vec4 xyzw) {\n  return clamp(xyzw, vec4(0.0), clampLimit);\n}\n","color.opaque":"vec4 opaqueColor(vec4 color) {\n  return vec4(color.rgb, 1.0);\n}\n","face.position":"uniform vec4 geometryClip;\nattribute vec4 position4;\n\n// External\nvec3 getPosition(vec4 xyzw, float canonical);\n\nvec3 getFacePosition() {\n  vec4 p = min(geometryClip, position4);\n  return getPosition(p, 1.0);\n}\n","face.position.normal":"attribute vec4 position4;\n\n// External\nvec3 getPosition(vec4 xyzw, float canonical);\n\nvarying vec3 vNormal;\nvarying vec3 vLight;\nvarying vec3 vPosition;\n\nvoid getFaceGeometry(vec4 xyzw, out vec3 pos, out vec3 normal) {\n  vec3 a, b, c;\n\n  a   = getPosition(vec4(xyzw.xyz, 0.0), 0.0);\n  b   = getPosition(vec4(xyzw.xyz, 1.0), 0.0);\n  c   = getPosition(vec4(xyzw.xyz, 2.0), 0.0);\n\n  pos = getPosition(xyzw, 1.0);\n  normal = normalize(cross(c - a, b - a));\n}\n\nvec3 getFacePositionNormal() {\n  vec3 center, normal;\n\n  getFaceGeometry(position4, center, normal);\n  vNormal   = normal;\n  vLight    = normalize((viewMatrix * vec4(1.0, 2.0, 2.0, 0.0)).xyz);\n  vPosition = -center;\n\n  return center;\n}\n","float.encode":"/*\nFloat encoding technique by\nCarlos Scheidegger\nhttps://github.com/cscheid/lux/blob/master/src/shade/bits/encode_float.js\n\nConversion to GLSL by:\nhttp://concord-consortium.github.io/lab/experiments/webgl-gpgpu/script.js\n*/\n\nfloat shift_right(float v, float amt) { \n  v = floor(v) + 0.5; \n  return floor(v / exp2(amt)); \n}\n\nfloat shift_left(float v, float amt) { \n  return floor(v * exp2(amt) + 0.5); \n}\n\nfloat mask_last(float v, float bits) { \n  return mod(v, shift_left(1.0, bits)); \n}\n\nfloat extract_bits(float num, float from, float to) { \n  from = floor(from + 0.5); to = floor(to + 0.5); \n  return mask_last(shift_right(num, from), to - from); \n}\n\nvec4 encode_float(float val) { \n  if (val == 0.0) return vec4(0, 0, 0, 0); \n  float valuesign = val > 0.0 ? 0.0 : 1.0; \n  val = abs(val); \n  float exponent = floor(log2(val)); \n  float biased_exponent = exponent + 127.0; \n  float fraction = ((val / exp2(exponent)) - 1.0) * 8388608.0; \n  float t = biased_exponent / 2.0; \n  float last_bit_of_biased_exponent = fract(t) * 2.0; \n  float remaining_bits_of_biased_exponent = floor(t); \n  float byte4 = extract_bits(fraction, 0.0, 8.0) / 255.0; \n  float byte3 = extract_bits(fraction, 8.0, 16.0) / 255.0; \n  float byte2 = (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0; \n  float byte1 = (valuesign * 128.0 + remaining_bits_of_biased_exponent) / 255.0; \n  return vec4(byte4, byte3, byte2, byte1); \n}\n","float.index.pack":"uniform vec4 indexModulus;\n\nvec4 getSample(vec4 xyzw);\nvec4 getIndex(vec4 xyzw);\n\nvec4 floatPackIndex(vec4 xyzw) {\n  vec4 value = getSample(xyzw);\n  vec4 index = getIndex(xyzw);\n\n  vec4 offset = floor(index + .5) * indexModulus;\n  vec2 sum2 = offset.xy + offset.zw;\n  float sum = sum2.x + sum2.y;\n  return vec4(value.xyz, sum);\n}","float.stretch":"vec4 getSample(vec4 xyzw);\n\nfloat floatStretch(vec4 xyzw, float channelIndex) {\n  vec4 sample = getSample(xyzw);\n  vec2 xy = channelIndex > 1.5 ? sample.zw : sample.xy;\n  return mod(channelIndex, 2.0) > .5 ? xy.y : xy.x;\n}","fragment.clip.dashed":"varying float vClipStrokeWidth;\nvarying float vClipStrokeIndex;\nvarying vec3  vClipStrokeEven;\nvarying vec3  vClipStrokeOdd;\nvarying vec3  vClipStrokePosition;\n\nvoid clipStrokeFragment() {\n  bool odd = mod(vClipStrokeIndex, 2.0) >= 1.0;\n\n  vec3 tangent;\n  if (odd) {\n    tangent = vClipStrokeOdd;\n  }\n  else {\n    tangent = vClipStrokeEven;\n  }\n\n  float travel = dot(vClipStrokePosition, normalize(tangent)) / vClipStrokeWidth;\n  if (mod(travel, 16.0) > 8.0) {\n    discard;\n  }\n}\n","fragment.clip.dotted":"varying float vClipStrokeWidth;\nvarying float vClipStrokeIndex;\nvarying vec3  vClipStrokeEven;\nvarying vec3  vClipStrokeOdd;\nvarying vec3  vClipStrokePosition;\n\nvoid clipStrokeFragment() {\n  bool odd = mod(vClipStrokeIndex, 2.0) >= 1.0;\n\n  vec3 tangent;\n  if (odd) {\n    tangent = vClipStrokeOdd;\n  }\n  else {\n    tangent = vClipStrokeEven;\n  }\n\n  float travel = dot(vClipStrokePosition, normalize(tangent)) / vClipStrokeWidth;\n  if (mod(travel, 4.0) > 2.0) {\n    discard;\n  }\n}\n","fragment.clip.ends":"varying vec2 vClipEnds;\n\nvoid clipEndsFragment() {\n  if (vClipEnds.x < 0.0 || vClipEnds.y < 0.0) discard;\n}\n","fragment.clip.proximity":"varying float vClipProximity;\n\nvoid clipProximityFragment() {\n  if (vClipProximity >= 0.5) discard;\n}","fragment.color":"void setFragmentColor(vec4 color) {\n  gl_FragColor = color;\n}","fragment.map.rgba":"vec4 fragmentRGBA(vec4 rgba, vec4 stpq) {\n  return rgba;\n}","fragment.solid":"void setFragmentColor(vec4 color) {\n  if (color.a < 1.0) discard;\n  gl_FragColor = color;\n}","fragment.transparent":"void setFragmentColor(vec4 color) {\n  if (color.a >= 1.0) discard;\n  gl_FragColor = color;\n}","grid.position":"uniform vec4 gridPosition;\nuniform vec4 gridStep;\nuniform vec4 gridAxis;\n\nvec4 sampleData(vec2 xy);\n\nvec4 getGridPosition(vec4 xyzw) {\n  vec4 onAxis  = gridAxis * sampleData(vec2(xyzw.y, 0.0)).x;\n  vec4 offAxis = gridStep * xyzw.x + gridPosition;\n  return onAxis + offAxis;\n}\n","grow.position":"uniform float growScale;\nuniform vec4  growMask;\nuniform vec4  growAnchor;\n\nvec4 getSample(vec4 xyzw);\n\nvec4 getGrowSample(vec4 xyzw) {\n  vec4 anchor = xyzw * growMask + growAnchor;\n\n  vec4 position = getSample(xyzw);\n  vec4 center = getSample(anchor);\n\n  return mix(center, position, growScale);\n}","join.position":"uniform float joinStride;\nuniform float joinStrideInv;\n\nfloat getIndex(vec4 xyzw);\nvec4 getRest(vec4 xyzw);\nvec4 injectIndices(float a, float b);\n\nvec4 getJoinXYZW(vec4 xyzw) {\n\n  float a = getIndex(xyzw);\n  float b = a * joinStrideInv;\n\n  float integer  = floor(b);\n  float fraction = b - integer;\n  \n  return injectIndices(fraction * joinStride, integer) + getRest(xyzw);\n}\n","label.alpha":"varying float vPixelSize;\n\nvec4 getLabelAlphaColor(vec4 color, vec4 sample) {\n  float mask = clamp(sample.r * 1000.0, 0.0, 1.0);\n  float alpha = (sample.r - .5) * vPixelSize + .5;\n  float a = mask * alpha * color.a;\n  if (a <= 0.0) discard;\n  return vec4(color.xyz, a);\n}\n","label.map":"vec2 mapUV(vec4 uvwo, vec4 stpq) {\n  return uvwo.xy;\n}\n","label.outline":"uniform float outlineExpand;\nuniform float outlineStep;\nuniform vec3  outlineColor;\n\nvarying float vPixelSize;\n\nconst float PIXEL_STEP = 255.0 / 16.0;\n\nvec4 getLabelOutlineColor(vec4 color, vec4 sample) {\n  float ps = vPixelSize * PIXEL_STEP;\n  float os = outlineStep;\n\n  float sdf = sample.r - .5 + outlineExpand;\n  vec2  sdfs = vec2(sdf, sdf + os);\n  vec2  alpha = clamp(sdfs * ps + .5, 0.0, 1.0);\n\n  if (alpha.y <= 0.0) {\n    discard;\n  }\n\n  vec3 blend = color.xyz;\n  if (alpha.y > alpha.x) {\n    blend = sqrt(mix(outlineColor * outlineColor, blend * blend, alpha.x));\n  }\n  \n  return vec4(blend, alpha.y * color.a);\n}\n","layer.position":"uniform vec4 layerScale;\nuniform vec4 layerBias;\n\n#define PROJECT_ORTHOGONAL\n\nvec4 layerPosition(vec4 position, inout vec4 stpq) {\n  return layerScale * position + layerBias;\n}\n","lerp.depth":"// External\nvec4 sampleData(vec4 xyzw);\n\nvec4 lerpDepth(vec4 xyzw) {\n  float x = xyzw.z;\n  float i = floor(x);\n  float f = x - i;\n    \n  vec4 xyzw1 = vec4(xyzw.xy, i, xyzw.w);\n  vec4 xyzw2 = vec4(xyzw.xy, i + 1.0, xyzw.w);\n  \n  vec4 a = sampleData(xyzw1);\n  vec4 b = sampleData(xyzw2);\n\n  return mix(a, b, f);\n}\n","lerp.height":"// External\nvec4 sampleData(vec4 xyzw);\n\nvec4 lerpHeight(vec4 xyzw) {\n  float x = xyzw.y;\n  float i = floor(x);\n  float f = x - i;\n    \n  vec4 xyzw1 = vec4(xyzw.x, i, xyzw.zw);\n  vec4 xyzw2 = vec4(xyzw.x, i + 1.0, xyzw.zw);\n  \n  vec4 a = sampleData(xyzw1);\n  vec4 b = sampleData(xyzw2);\n\n  return mix(a, b, f);\n}\n","lerp.items":"// External\nvec4 sampleData(vec4 xyzw);\n\nvec4 lerpItems(vec4 xyzw) {\n  float x = xyzw.w;\n  float i = floor(x);\n  float f = x - i;\n    \n  vec4 xyzw1 = vec4(xyzw.xyz, i);\n  vec4 xyzw2 = vec4(xyzw.xyz, i + 1.0);\n  \n  vec4 a = sampleData(xyzw1);\n  vec4 b = sampleData(xyzw2);\n\n  return mix(a, b, f);\n}\n","lerp.width":"// External\nvec4 sampleData(vec4 xyzw);\n\nvec4 lerpWidth(vec4 xyzw) {\n  float x = xyzw.x;\n  float i = floor(x);\n  float f = x - i;\n    \n  vec4 xyzw1 = vec4(i, xyzw.yzw);\n  vec4 xyzw2 = vec4(i + 1.0, xyzw.yzw);\n  \n  vec4 a = sampleData(xyzw1);\n  vec4 b = sampleData(xyzw2);\n\n  return mix(a, b, f);\n}\n","line.position":"// Units and calibration\nuniform float worldUnit;\nuniform float lineWidth;\nuniform float lineDepth;\nuniform float focusDepth;\n\n// General data index\nuniform vec4 geometryClip;\nattribute vec4 position4;\n\n// (Top/bottom -1,1)\nattribute float line;\n\n// 0...1 for round or bevel joins\n#ifdef LINE_JOIN_DETAIL\nattribute float joint;\n#else\nconst float joint = 0.0;\n#endif\n\n// Knock out excessively long line segments (e.g. for asymtpotes)\n#ifdef LINE_PROXIMITY\nuniform float lineProximity;\nvarying float vClipProximity;\n#endif\n\n// Ghetto line stroking (local only, not global)\n#ifdef LINE_STROKE\nvarying float vClipStrokeWidth;\nvarying float vClipStrokeIndex;\nvarying vec3  vClipStrokeEven;\nvarying vec3  vClipStrokeOdd;\nvarying vec3  vClipStrokePosition;\n#endif\n\n// External\nvec3 getPosition(vec4 xyzw, float canonical);\n\n// Clip line ends for arrows / decoration\n#ifdef LINE_CLIP\nuniform float clipRange;\nuniform vec2  clipStyle;\nuniform float clipSpace;\n\nattribute vec2 strip;\n\nvarying vec2 vClipEnds;\n\nvoid clipEnds(vec4 xyzw, vec3 center, vec3 pos) {\n\n  // Sample start of line strip\n  vec4 xyzwS = vec4(0.0, xyzw.yzw);\n  vec3 start = getPosition(xyzwS, 0.0);\n\n  // Sample middle of line strip\n  vec4 xyzwM = vec4(geometryClip.x / 2.0, xyzw.yzw);\n  vec3 middle = getPosition(xyzwM, 0.0);\n\n#ifdef LINE_CLOSED\n  vec3 end = start;\n#else\n  // Sample other end of line strip\n  vec4 xyzwE = vec4(geometryClip.x, xyzw.yzw);\n  vec3 end   = getPosition(xyzwE, 0.0);\n#endif\n\n  // Measure length\n  float l = max(length(end - middle), length(middle - start)) * clipSpace * 2.0;\n\n  // Arrow length (=2.5x radius)\n  float arrowSize = 1.25 * clipRange * lineWidth * worldUnit;\n\n#ifdef LINE_CLOSED\n  // Clip around start/end\n  end = start;\n#endif\n\n  vClipEnds = vec2(1.0);\n\n  if (clipStyle.y > 0.0) {\n    // Depth blend end\n    float depth = focusDepth;\n    if (lineDepth < 1.0) {\n      float z = max(0.00001, -end.z);\n      depth = mix(z, focusDepth, lineDepth);\n    }\n\n    // Absolute arrow length\n    float size = arrowSize * depth;\n\n    // Adjust clip range\n    // Approach linear scaling with cubic ease the smaller we get\n    float mini = clamp(1.0 - l / size * .333, 0.0, 1.0);\n    float scale = 1.0 - mini * mini * mini;\n    float invrange = 1.0 / (size * scale);\n\n    // Clip end\n    vec3 diff = end - center;\n    if(diff == vec3(0.0))\n      vClipEnds.x = -1.0;\n    else {\n      diff = normalize(end - center);\n      float d = dot(end - pos, diff);\n      vClipEnds.x = d * invrange - 1.0;\n    }\n  }\n\n  if (clipStyle.x > 0.0) {\n    // Depth blend start\n    float depth = focusDepth;\n    if (lineDepth < 1.0) {\n      float z = max(0.00001, -start.z);\n      depth = mix(z, focusDepth, lineDepth);\n    }\n\n    // Absolute arrow length\n    float size = arrowSize * depth;\n\n    // Adjust clip range\n    // Approach linear scaling with cubic ease the smaller we get\n    float mini = clamp(1.0 - l / size * .333, 0.0, 1.0);\n    float scale = 1.0 - mini * mini * mini;\n    float invrange = 1.0 / (size * scale);\n\n    // Clip start\n    vec3 diff = center - start;\n    if(diff == vec3(0.0))\n      vClipEnds.y = -1.0;\n    else {\n      diff = normalize(center - start);\n      float d = dot(pos - start, diff);\n      vClipEnds.y = d * invrange - 1.0;\n    }\n  }\n}\n#endif\n\n// Adjust left/center/right to be inside near/far z range\nconst float epsilon = 1e-5;\nvoid fixCenter(inout vec3 left, inout vec3 center, inout vec3 right) {\n  if (center.z >= 0.0) {\n    if (left.z < 0.0) {\n      float d = (center.z + epsilon) / (center.z - left.z);\n      center = mix(center, left, d);\n    }\n    else if (right.z < 0.0) {\n      float d = (center.z + epsilon) / (center.z - right.z);\n      center = mix(center, right, d);\n    }\n  }\n\n  if (left.z >= 0.0) {\n    if (center.z < 0.0) {\n      float d = (left.z + epsilon) / (left.z - center.z);\n      left = mix(left, center, d);\n    }\n  }\n\n  if (right.z >= 0.0) {\n    if (center.z < 0.0) {\n      float d = (right.z + epsilon) / (right.z - center.z);\n      right = mix(right, center, d);\n    }\n  }\n}\n\nvec4 wrapAround(vec4 xyzw) {\n#ifdef LINE_CLOSED\n  float gx = geometryClip.x;\n  if (xyzw.x < 0.0) xyzw.x += gx;\n  if (xyzw.x >= gx) xyzw.x -= gx;\n#endif\n  return xyzw;\n}\n\n// Sample the source data in an edge-aware manner\nvoid getLineGeometry(vec4 xyzw, float edge, out vec3 left, out vec3 center, out vec3 right) {\n  vec4 delta = vec4(1.0, 0.0, 0.0, 0.0);\n\n  center = getPosition(xyzw, 1.0);\n  left   = (edge > -0.5) ? getPosition(wrapAround(xyzw - delta), 0.0) : center;\n  right  = (edge < 0.5)  ? getPosition(wrapAround(xyzw + delta), 0.0) : center;\n}\n\n// Calculate the position for a vertex along the line, including joins\nvec3 getLineJoin(float edge, bool odd, vec3 left, vec3 center, vec3 right, float width, float offset, float joint) {\n  vec2 join = vec2(1.0, 0.0);\n\n  fixCenter(left, center, right);\n\n  vec4 a = vec4(left.xy, right.xy);\n  vec4 b = a / vec4(left.zz, right.zz);\n\n  vec2 l = b.xy;\n  vec2 r = b.zw;\n  vec2 c = center.xy / center.z;\n\n  vec4 d = vec4(l, c) - vec4(c, r);\n  float l1 = dot(d.xy, d.xy);\n  float l2 = dot(d.zw, d.zw);\n\n  if (l1 + l2 > 0.0) {\n\n    if (edge > 0.5 || l2 == 0.0) {\n      vec2 nl = normalize(d.xy);\n      vec2 tl = vec2(nl.y, -nl.x);\n\n#ifdef LINE_PROXIMITY\n      vClipProximity = 1.0;\n#endif\n\n#ifdef LINE_STROKE\n      vClipStrokeEven = vClipStrokeOdd = normalize(left - center);\n#endif\n      join = tl;\n    }\n    else if (edge < -0.5 || l1 == 0.0) {\n      vec2 nr = normalize(d.zw);\n      vec2 tr = vec2(nr.y, -nr.x);\n\n#ifdef LINE_PROXIMITY\n      vClipProximity = 1.0;\n#endif\n\n#ifdef LINE_STROKE\n      vClipStrokeEven = vClipStrokeOdd = normalize(center - right);\n#endif\n      join = tr;\n    }\n    else {\n      // Limit join stretch for tiny segments\n      float lmin2 = min(l1, l2) / (width * width);\n\n      // Hide line segment if ratio of leg lengths exceeds promixity threshold\n#ifdef LINE_PROXIMITY\n      float lr     = l1 / l2;\n      float rl     = l2 / l1;\n      float ratio  = max(lr, rl);\n      float thresh = lineProximity + 1.0;\n      vClipProximity = (ratio > thresh * thresh) ? 1.0 : 0.0;\n#endif\n\n      // Calculate normals/tangents\n      vec2 nl = normalize(d.xy);\n      vec2 nr = normalize(d.zw);\n\n      // Calculate tangents\n      vec2 tl = vec2(nl.y, -nl.x);\n      vec2 tr = vec2(nr.y, -nr.x);\n\n#ifdef LINE_PROXIMITY\n      // Mix tangents according to leg lengths\n      vec2 tc = normalize(mix(tl, tr, l1/(l1+l2)));\n#else\n      // Average tangent\n      vec2 tc = normalize(tl + tr);\n#endif\n\n      // Miter join\n      float cosA   = dot(nl, tc);\n      float sinA   = max(0.1, abs(dot(tl, tc)));\n      float factor = cosA / sinA;\n      float scale  = sqrt(1.0 + min(lmin2, factor * factor));\n\n      // Stroke normals\n#ifdef LINE_STROKE\n      vec3 stroke1 = normalize(left - center);\n      vec3 stroke2 = normalize(center - right);\n\n      if (odd) {\n        vClipStrokeEven = stroke1;\n        vClipStrokeOdd  = stroke2;\n      }\n      else {\n        vClipStrokeEven = stroke2;\n        vClipStrokeOdd  = stroke1;\n      }\n#endif\n\n#ifdef LINE_JOIN_MITER\n      // Apply straight up miter\n      join = tc * scale;\n#endif\n\n#ifdef LINE_JOIN_ROUND\n      // Slerp bevel join into circular arc\n      float dotProduct = dot(nl, nr);\n      float angle = acos(dotProduct);\n      float sinT  = sin(angle);\n      join = (sin((1.0 - joint) * angle) * tl + sin(joint * angle) * tr) / sinT;\n#endif\n\n#ifdef LINE_JOIN_BEVEL\n      // Direct bevel join between two flat ends\n      float dotProduct = dot(nl, nr);\n      join = mix(tl, tr, joint);\n#endif\n\n#ifdef LINE_JOIN_DETAIL\n      // Check if on inside or outside of joint\n      float crossProduct = nl.x * nr.y - nl.y * nr.x;\n      if (offset * crossProduct < 0.0) {\n        // For near-180-degree bends, correct back to a miter to avoid discontinuities\n        float ratio = clamp(-dotProduct * 2.0 - 1.0, 0.0, 1.0);\n        // Otherwise collapse the inside vertices into one.\n        join = mix(tc * scale, join, ratio * ratio * ratio);\n      }\n#endif\n\n    }\n    return vec3(join, 0.0);\n  }\n  else {\n    return vec3(0.0);\n  }\n\n}\n\n// Calculate final line position\nvec3 getLinePosition() {\n  vec3 left, center, right, join;\n\n  // Up/down along segment\n  float offset = line;\n\n  // Clip data\n  vec4 p = min(geometryClip, position4);\n\n  // Left/center/right\n  float edge = 0.0;\n#ifdef LINE_CLOSED\n  if (p.x == geometryClip.x) p.x = 0.0;\n#else\n  if (p.x == geometryClip.x) edge = 1.0;\n  if (p.x == 0.0) edge = -1.0;\n#endif\n\n  // Get position + adjacent neighbours\n  getLineGeometry(p, edge, left, center, right);\n\n#ifdef LINE_STROKE\n  // Set parameters for line stroke fragment shader\n  vClipStrokePosition = center;\n  vClipStrokeIndex = p.x;\n  bool odd = mod(p.x, 2.0) >= 1.0;\n#else\n  bool odd = true;\n#endif\n\n  // Divide line width up/down\n  float width = lineWidth * 0.5;\n\n  float depth = focusDepth;\n  if (lineDepth < 1.0) {\n    // Depth blending\n    float z = max(0.00001, -center.z);\n    depth = mix(z, focusDepth, lineDepth);\n  }\n  width *= depth;\n\n  // Convert to world units\n  width *= worldUnit;\n\n  // Calculate line join\n#ifdef LINE_CLOSED\n  join = getLineJoin(0.0, odd, left, center, right, width, offset, joint);\n#else\n  join = getLineJoin(edge, odd, left, center, right, width, offset, joint);\n#endif\n  vec3 pos = center + join * offset * width;\n\n#ifdef LINE_STROKE\n  vClipStrokeWidth = width;\n#endif\n\n#ifdef LINE_CLIP\n  clipEnds(p, center, pos);\n#endif\n\n  return pos;\n}\n","map.2d.data":"uniform vec2 dataResolution;\nuniform vec2 dataPointer;\n\nvec2 map2DData(vec2 xy) {\n  return (xy + dataPointer) * dataResolution;\n}\n","map.2d.data.wrap":"uniform vec2 dataResolution;\nuniform vec2 dataPointer;\n\nvec2 map2DData(vec2 xy) {\n  return fract((xy + dataPointer) * dataResolution);\n}\n","map.xyzw.2dv":"void mapXyzw2DV(vec4 xyzw, out vec2 xy, out float z) {\n  xy = xyzw.xy;\n  z  = xyzw.z;\n}\n\n","map.xyzw.align":"vec4 alignXYZW(vec4 xyzw) {\n  return floor(xyzw + .5);\n}\n\n","map.xyzw.texture":"uniform float textureItems;\nuniform float textureHeight;\n\nvec2 mapXyzwTexture(vec4 xyzw) {\n  \n  float x = xyzw.x;\n  float y = xyzw.y;\n  float z = xyzw.z;\n  float i = xyzw.w;\n  \n  return vec2(i, y) + vec2(x, z) * vec2(textureItems, textureHeight);\n}\n\n","mesh.fragment.color":"varying vec4 vColor;\n\nvec4 getColor() {\n  if (vColor.a <= 0.0) discard;\n  return vColor;\n}\n","mesh.fragment.map":"#ifdef POSITION_STPQ\nvarying vec4 vSTPQ;\n#endif\n#ifdef POSITION_U\nvarying float vU;\n#endif\n#ifdef POSITION_UV\nvarying vec2 vUV;\n#endif\n#ifdef POSITION_UVW\nvarying vec3 vUVW;\n#endif\n#ifdef POSITION_UVWO\nvarying vec4 vUVWO;\n#endif\n\nvec4 getSample(vec4 uvwo, vec4 stpq);\n\nvec4 getMapColor() {\n  #ifdef POSITION_STPQ\n  vec4 stpq = vSTPQ;\n  #else\n  vec4 stpq = vec4(0.0);\n  #endif\n\n  #ifdef POSITION_U\n  vec4 uvwo = vec4(vU, 0.0, 0.0, 0.0);\n  #endif\n  #ifdef POSITION_UV\n  vec4 uvwo = vec4(vUV, 0.0, 0.0);\n  #endif\n  #ifdef POSITION_UVW\n  vec4 uvwo = vec4(vUVW, 0.0);\n  #endif\n  #ifdef POSITION_UVWO\n  vec4 uvwo = vec4(vUVWO);\n  #endif\n\n  return getSample(uvwo, stpq);\n}\n","mesh.fragment.mask":"varying float vMask;\n\nfloat ease(float t) {\n  t = clamp(t, 0.0, 1.0);\n  return t * t * (3.0 - 2.0 * t);\n}\n\nvec4 maskColor() {\n  if (vMask <= 0.0) discard;\n  return vec4(vec3(1.0), ease(vMask));\n}\n","mesh.fragment.material":"#ifdef POSITION_STPQ\nvarying vec4 vSTPQ;\n#endif\n#ifdef POSITION_U\nvarying float vU;\n#endif\n#ifdef POSITION_UV\nvarying vec2 vUV;\n#endif\n#ifdef POSITION_UVW\nvarying vec3 vUVW;\n#endif\n#ifdef POSITION_UVWO\nvarying vec4 vUVWO;\n#endif\n\nvec4 getSample(vec4 rgba, vec4 stpq);\n\nvec4 getMaterialColor(vec4 rgba) {\n  vec4 stpq = vec4(0.0);\n\n  #ifdef POSITION_U\n  stpq.x = vU;\n  #endif\n  #ifdef POSITION_UV\n  stpq.xy = vUV;\n  #endif\n  #ifdef POSITION_UVW\n  stpq.xyz = vUVW;\n  #endif\n  #ifdef POSITION_UVWO\n  stpq = vUVWO;\n  #endif\n\n  #ifdef POSITION_STPQ\n  stpq = vSTPQ;\n  #endif\n\n  return getSample(rgba, stpq);\n}\n","mesh.fragment.shaded":"\n#extension GL_OES_standard_derivatives : enable\nvarying vec3 vNormal;\nvarying vec3 vLight;\nvarying vec3 vPosition;\n\nvec3 offSpecular(vec3 color) {\n  vec3 c = 1.0 - color;\n  return 1.0 - c * c;\n}\n\nvec4 getShadedColor(vec4 rgba) {\n  \n  vec3 color = rgba.xyz;\n  vec3 color2 = offSpecular(rgba.xyz);\n\n  vec3 normal = normalize(vNormal);\n  vec3 light = normalize(vLight);\n  vec3 position = normalize(vPosition);\n  \n  // Workaround to avoid gl_FrontFacing. See https://github.com/unconed/mathbox/pull/26\n  vec3 pdx = dFdx(vPosition);\n  vec3 pdy = dFdy(vPosition);\n  bool frontFacting = dot(vNormal, cross(pdx, pdy)) > 0.0;\n\n  float side = frontFacting ? 1.0 : -1.0;\n  float cosine  = side * dot(normal, light);\n  float diffuse = mix(max(0.0, cosine), .5 + .5 * cosine, .1);\n  \n  vec3  halfLight = normalize(light + position);\n\tfloat cosineHalf = max(0.0, side * dot(normal, halfLight));\n\tfloat specular = pow(cosineHalf, 16.0);\n\t\n\treturn vec4(color * (diffuse * .9 + .05) + .25 * color2 * specular, rgba.a);\n}\n","mesh.fragment.texture":"","mesh.gamma.in":"vec4 getGammaInColor(vec4 rgba) {\n  return vec4(rgba.rgb * rgba.rgb, rgba.a);\n}\n","mesh.gamma.out":"vec4 getGammaOutColor(vec4 rgba) {\n  return vec4(sqrt(rgba.rgb), rgba.a);\n}\n","mesh.map.uvwo":"vec4 mapUVWO(vec4 uvwo, vec4 stpq) {\n  return uvwo;\n}\n","mesh.position":"uniform vec4 geometryClip;\nattribute vec4 position4;\n\n// External\nvec3 getPosition(vec4 xyzw, float canonical);\n\nvec3 getMeshPosition() {\n  vec4 p = min(geometryClip, position4);\n  return getPosition(p, 1.0);\n}\n","mesh.vertex.color":"attribute vec4 position4;\nuniform vec4 geometryClip;\nvarying vec4 vColor;\n\n// External\nvec4 getSample(vec4 xyzw);\n\nvoid vertexColor() {\n  vec4 p = min(geometryClip, position4);\n  vColor = getSample(p);\n}\n","mesh.vertex.mask":"attribute vec4 position4;\nuniform vec4 geometryResolution;\nuniform vec4 geometryClip;\nvarying float vMask;\n\n// External\nfloat getSample(vec4 xyzw);\n\nvoid maskLevel() {\n  vec4 p = min(geometryClip, position4);\n  vMask = getSample(p * geometryResolution);\n}\n","mesh.vertex.position":"uniform vec4 geometryResolution;\n\n#ifdef POSITION_STPQ\nvarying vec4 vSTPQ;\n#endif\n#ifdef POSITION_U\nvarying float vU;\n#endif\n#ifdef POSITION_UV\nvarying vec2 vUV;\n#endif\n#ifdef POSITION_UVW\nvarying vec3 vUVW;\n#endif\n#ifdef POSITION_UVWO\nvarying vec4 vUVWO;\n#endif\n\n// External\nvec3 getPosition(vec4 xyzw, in vec4 stpqIn, out vec4 stpqOut);\n\nvec3 getMeshPosition(vec4 xyzw, float canonical) {\n  vec4 stpqOut, stpqIn = xyzw * geometryResolution;\n  vec3 xyz = getPosition(xyzw, stpqIn, stpqOut);\n\n  #ifdef POSITION_MAP\n  if (canonical > 0.5) {\n    #ifdef POSITION_STPQ\n    vSTPQ = stpqOut;\n    #endif\n    #ifdef POSITION_U\n    vU = stpqOut.x;\n    #endif\n    #ifdef POSITION_UV\n    vUV = stpqOut.xy;\n    #endif\n    #ifdef POSITION_UVW\n    vUVW = stpqOut.xyz;\n    #endif\n    #ifdef POSITION_UVWO\n    vUVWO = stpqOut;\n    #endif\n  }\n  #endif\n  return xyz;\n}\n","move.position":"uniform float transitionEnter;\nuniform float transitionExit;\nuniform vec4  transitionScale;\nuniform vec4  transitionBias;\nuniform float transitionSkew;\nuniform float transitionActive;\n\nuniform vec4  moveFrom;\nuniform vec4  moveTo;\n\nfloat ease(float t) {\n  t = clamp(t, 0.0, 1.0);\n  return 1.0 - (2.0 - t) * t;\n}\n\nvec4 getTransitionPosition(vec4 xyzw, inout vec4 stpq) {\n  if (transitionActive < 0.5) return xyzw;\n\n  float enter   = transitionEnter;\n  float exit    = transitionExit;\n  float skew    = transitionSkew;\n  vec4  scale   = transitionScale;\n  vec4  bias    = transitionBias;\n\n  float factor  = 1.0 + skew;\n  float offset  = dot(vec4(1.0), stpq * scale + bias);\n\n  float a1 = ease(enter * factor - offset);\n  float a2 = ease(exit  * factor + offset - skew);\n\n  return xyzw + a1 * moveFrom + a2 * moveTo;\n}","object.mask.default":"vec4 getMask(vec4 xyzw) {\n  return vec4(1.0);\n}","point.alpha.circle":"varying float vPixelSize;\n\nfloat getDiscAlpha(float mask) {\n  // Approximation: 1 - x*x is approximately linear around x = 1 with slope 2\n  return vPixelSize * (1.0 - mask);\n  //  return vPixelSize * 2.0 * (1.0 - sqrt(mask));\n}\n","point.alpha.circle.hollow":"varying float vPixelSize;\n\nfloat getDiscHollowAlpha(float mask) {\n  return vPixelSize * (0.5 - 2.0 * abs(sqrt(mask) - .75));\n}\n","point.alpha.generic":"varying float vPixelSize;\n\nfloat getGenericAlpha(float mask) {\n  return vPixelSize * 2.0 * (1.0 - mask);\n}\n","point.alpha.generic.hollow":"varying float vPixelSize;\n\nfloat getGenericHollowAlpha(float mask) {\n  return vPixelSize * (0.5 - 2.0 * abs(mask - .75));\n}\n","point.edge":"varying vec2 vSprite;\n\nfloat getSpriteMask(vec2 xy);\nfloat getSpriteAlpha(float mask);\n\nvoid setFragmentColorFill(vec4 color) {\n  float mask = getSpriteMask(vSprite);\n  if (mask > 1.0) {\n    discard;\n  }\n  float alpha = getSpriteAlpha(mask);\n  if (alpha >= 1.0) {\n    discard;\n  }\n  gl_FragColor = vec4(color.rgb, alpha * color.a);\n}\n","point.fill":"varying vec2 vSprite;\n\nfloat getSpriteMask(vec2 xy);\nfloat getSpriteAlpha(float mask);\n\nvoid setFragmentColorFill(vec4 color) {\n  float mask = getSpriteMask(vSprite);\n  if (mask > 1.0) {\n    discard;\n  }\n  float alpha = getSpriteAlpha(mask);\n  if (alpha < 1.0) {\n    discard;\n  }\n  gl_FragColor = color;\n}\n\n","point.mask.circle":"varying float vPixelSize;\n\nfloat getCircleMask(vec2 uv) {\n  return dot(uv, uv);\n}\n","point.mask.diamond":"varying float vPixelSize;\n\nfloat getDiamondMask(vec2 uv) {\n  vec2 a = abs(uv);\n  return a.x + a.y;\n}\n","point.mask.down":"varying float vPixelSize;\n\nfloat getTriangleDownMask(vec2 uv) {\n  uv.y += .25;\n  return max(uv.y, abs(uv.x) * .866 - uv.y * .5 + .6);\n}\n","point.mask.left":"varying float vPixelSize;\n\nfloat getTriangleLeftMask(vec2 uv) {\n  uv.x += .25;\n  return max(uv.x, abs(uv.y) * .866 - uv.x * .5 + .6);\n}\n","point.mask.right":"varying float vPixelSize;\n\nfloat getTriangleRightMask(vec2 uv) {\n  uv.x -= .25;\n  return max(-uv.x, abs(uv.y) * .866 + uv.x * .5 + .6);\n}\n","point.mask.square":"varying float vPixelSize;\n\nfloat getSquareMask(vec2 uv) {\n  vec2 a = abs(uv);\n  return max(a.x, a.y);\n}\n","point.mask.up":"varying float vPixelSize;\n\nfloat getTriangleUpMask(vec2 uv) {\n  uv.y -= .25;\n  return max(-uv.y, abs(uv.x) * .866 + uv.y * .5 + .6);\n}\n","point.position":"uniform float pointDepth;\n\nuniform float pixelUnit;\nuniform float renderScale;\nuniform float renderScaleInv;\nuniform float focusDepth;\n\nuniform vec4 geometryClip;\nattribute vec4 position4;\nattribute vec2 sprite;\n\nvarying vec2 vSprite;\nvarying float vPixelSize;\n\nconst float pointScale = POINT_SHAPE_SCALE;\n\n// External\nfloat getPointSize(vec4 xyzw);\nvec3 getPosition(vec4 xyzw, float canonical);\n\nvec3 getPointPosition() {\n  // Discard out-of-range points by generating degenerate face\n  if (\n    position4.x > geometryClip.x ||\n    position4.y > geometryClip.y ||\n    position4.z > geometryClip.z ||\n    position4.w > geometryClip.w\n  ) return vec3(0.0, 0.0, 0.0);\n  vec4 p = position4;\n\n  vec3 center = getPosition(p, 1.0);\n\n  // Depth blending\n  // TODO: orthographic camera\n  // Workaround: set depth = 0\n  float z = -center.z;\n  float depth = mix(z, focusDepth, pointDepth);\n\n  // Match device/unit mapping\n  // Sprite goes from -1..1, width = 2.\n  float pointSize = getPointSize(p);\n  float size = pointScale * pointSize * pixelUnit * .5;\n  float depthSize = depth * size;\n\n  // Pad sprite by half a pixel to make the anti-aliasing straddle the pixel edge\n  // Note: pixelsize measures radius\n  float pixelSize = .5 * (pointDepth > 0.0 ? depthSize / z : size);\n  float paddedSize = pixelSize + 0.5;\n  float padFactor = paddedSize / pixelSize;\n\n  vPixelSize = paddedSize;\n  vSprite    = sprite;\n\n  return center + vec3(sprite * depthSize * renderScaleInv * padFactor, 0.0);\n}\n","point.size.uniform":"uniform float pointSize;\n\nfloat getPointSize(vec4 xyzw) {\n  return pointSize;\n}","point.size.varying":"uniform float pointSize;\n\nvec4 getSample(vec4 xyzw);\n\nfloat getPointSize(vec4 xyzw) {\n  return pointSize * getSample(xyzw).x;\n}","polar.position":"uniform float polarBend;\nuniform float polarFocus;\nuniform float polarAspect;\nuniform float polarHelix;\n\nuniform mat4 viewMatrix;\n\nvec4 getPolarPosition(vec4 position, inout vec4 stpq) {\n  if (polarBend > 0.0) {\n\n    if (polarBend < 0.001) {\n      // Factor out large addition/subtraction of polarFocus\n      // to avoid numerical error\n      // sin(x) ~ x\n      // cos(x) ~ 1 - x * x / 2\n      vec2 pb = position.xy * polarBend;\n      float ppbbx = pb.x * pb.x;\n      return viewMatrix * vec4(\n        position.x * (1.0 - polarBend + (pb.y * polarAspect)),\n        position.y * (1.0 - .5 * ppbbx) - (.5 * ppbbx) * polarFocus / polarAspect,\n        position.z + position.x * polarHelix * polarBend,\n        1.0\n      );\n    }\n    else {\n      vec2 xy = position.xy * vec2(polarBend, polarAspect);\n      float radius = polarFocus + xy.y;\n      return viewMatrix * vec4(\n        sin(xy.x) * radius,\n        (cos(xy.x) * radius - polarFocus) / polarAspect,\n        position.z + position.x * polarHelix * polarBend,\n        1.0\n      );\n    }\n  }\n  else {\n    return viewMatrix * vec4(position.xyz, 1.0);\n  }\n}","project.position":"uniform float styleZBias;\nuniform float styleZIndex;\n\nvoid setPosition(vec3 position) {\n\n  #ifdef PROJECT_ORTHOGONAL\n  // Orthogonal projection with depth preservation around z = 1\n  vec4 pos = projectionMatrix * vec4(position, 1.0);\n  pos.xy *= -position.z;\n  #else\n  // Normal perspective projection\n  vec4 pos = projectionMatrix * vec4(position, 1.0);\n  #endif\n\n  // Apply relative Z bias\n  float bias  = (1.0 - styleZBias / 32768.0);\n  pos.z *= bias;\n\n  // Apply large scale Z index changes\n  if (styleZIndex > 0.0) {\n    float z = pos.z / pos.w;\n    pos.z = ((z + 1.0) / (styleZIndex + 1.0) - 1.0) * pos.w;\n  }\n\n  gl_Position = pos;\n}","project.readback":"// This is three.js' global uniform, missing from fragment shaders.\nuniform mat4 projectionMatrix;\n\nvec4 readbackPosition(vec3 position, vec4 stpq) {\n  vec4 pos = projectionMatrix * vec4(position, 1.0);\n  vec3 final = pos.xyz / pos.w;\n  if (final.z < -1.0) {\n    return vec4(0.0, 0.0, 0.0, -1.0);\n  }\n  else {\n    return vec4(final, -position.z);\n  }\n}\n","raw.position.scale":"uniform vec4 geometryScale;\nattribute vec4 position4;\n\nvec4 getRawPositionScale() {\n  return geometryScale * position4;\n}\n","repeat.position":"uniform vec4 repeatModulus;\n\nvec4 getRepeatXYZW(vec4 xyzw) {\n  return mod(xyzw + .5, repeatModulus) - .5;\n}\n","resample.padding":"uniform vec4 resampleBias;\n\nvec4 resamplePadding(vec4 xyzw) {\n  return xyzw + resampleBias;\n}","resample.relative":"uniform vec4 resampleFactor;\n\nvec4 resampleRelative(vec4 xyzw) {\n  return xyzw * resampleFactor;\n}","reveal.mask":"uniform float transitionEnter;\nuniform float transitionExit;\nuniform vec4  transitionScale;\nuniform vec4  transitionBias;\nuniform float transitionSkew;\nuniform float transitionActive;\n\nfloat getTransitionSDFMask(vec4 stpq) {\n  if (transitionActive < 0.5) return 1.0;\n\n  float enter   = transitionEnter;\n  float exit    = transitionExit;\n  float skew    = transitionSkew;\n  vec4  scale   = transitionScale;\n  vec4  bias    = transitionBias;\n\n  float factor  = 1.0 + skew;\n  float offset  = dot(vec4(1.0), stpq * scale + bias);\n\n  vec2 d = vec2(enter, exit) * factor + vec2(-offset, offset - skew);\n  if (exit  == 1.0) return d.x;\n  if (enter == 1.0) return d.y;\n  return min(d.x, d.y);\n}","reverse.position":"uniform vec4 reverseScale;\nuniform vec4 reverseOffset;\n\nvec4 getReverseOffset(vec4 xyzw) {\n  return xyzw * reverseScale + reverseOffset;\n}","root.position":"vec3 getRootPosition(vec4 position, in vec4 stpqIn, out vec4 stpqOut) {\n  stpqOut = stpqIn; // avoid inout confusion\n  return position.xyz;\n}","sample.2d":"uniform sampler2D dataTexture;\n\nvec4 sample2D(vec2 uv) {\n  return texture2D(dataTexture, uv);\n}\n","scale.position":"uniform vec4 scaleAxis;\nuniform vec4 scaleOffset;\n\nvec4 sampleData(float x);\n\nvec4 getScalePosition(vec4 xyzw) {\n  return scaleAxis * sampleData(xyzw.x).x + scaleOffset;\n}\n","screen.map.stpq":"uniform vec4 remapSTPQScale;\n\nvec4 screenMapSTPQ(vec4 xyzw, out vec4 stpq) {\n  stpq = xyzw * remapSTPQScale;\n  return xyzw;\n}\n","screen.map.xy":"uniform vec2 remapUVScale;\n\nvec4 screenMapXY(vec4 uvwo, vec4 stpq) {\n  return vec4(floor(remapUVScale * uvwo.xy), 0.0, 0.0);\n}\n","screen.map.xyzw":"uniform vec2 remapUVScale;\nuniform vec2 remapModulus;\nuniform vec2 remapModulusInv;\n\nvec4 screenMapXYZW(vec4 uvwo, vec4 stpq) {\n  vec2 st = floor(remapUVScale * uvwo.xy);\n  vec2 xy = st * remapModulusInv;\n  vec2 ixy = floor(xy);\n  vec2 fxy = xy - ixy;\n  vec2 zw = fxy * remapModulus;\n  return vec4(ixy.x, zw.y, ixy.y, zw.x);\n}\n","screen.pass.uv":"vec2 screenPassUV(vec4 uvwo, vec4 stpq) {\n  return uvwo.xy;\n}\n","screen.position":"void setScreenPosition(vec4 position) {\n  gl_Position = vec4(position.xy * 2.0 - 1.0, 0.5, 1.0);\n}\n","slice.position":"uniform vec4 sliceOffset;\n\nvec4 getSliceOffset(vec4 xyzw) {\n  return xyzw + sliceOffset;\n}\n","spherical.position":"uniform float sphericalBend;\nuniform float sphericalFocus;\nuniform float sphericalAspectX;\nuniform float sphericalAspectY;\nuniform float sphericalScaleY;\n\nuniform mat4 viewMatrix;\n\nvec4 getSphericalPosition(vec4 position, inout vec4 stpq) {\n  if (sphericalBend > 0.0001) {\n\n    vec3 xyz = position.xyz * vec3(sphericalBend, sphericalBend / sphericalAspectY * sphericalScaleY, sphericalAspectX);\n    float radius = sphericalFocus + xyz.z;\n    float cosine = cos(xyz.y) * radius;\n\n    return viewMatrix * vec4(\n      sin(xyz.x) * cosine,\n      sin(xyz.y) * radius * sphericalAspectY,\n      (cos(xyz.x) * cosine - sphericalFocus) / sphericalAspectX,\n      1.0\n    );\n  }\n  else {\n    return viewMatrix * vec4(position.xyz, 1.0);\n  }\n}","split.position":"uniform float splitStride;\n\nvec2 getIndices(vec4 xyzw);\nvec4 getRest(vec4 xyzw);\nvec4 injectIndex(float v);\n\nvec4 getSplitXYZW(vec4 xyzw) {\n  vec2 uv = getIndices(xyzw);\n  float offset = uv.x + uv.y * splitStride;\n  return injectIndex(offset) + getRest(xyzw);\n}\n","spread.position":"uniform vec4 spreadOffset;\nuniform mat4 spreadMatrix;\n\n// External\nvec4 getSample(vec4 xyzw);\n\nvec4 getSpreadSample(vec4 xyzw) {\n  vec4 sample = getSample(xyzw);\n  return sample + spreadMatrix * (spreadOffset + xyzw);\n}\n","sprite.fragment":"varying vec2 vSprite;\n\nvec4 getSample(vec2 xy);\n\nvec4 getSpriteColor() {\n  return getSample(vSprite);\n}","sprite.position":"uniform vec2 spriteOffset;\nuniform float spriteScale;\nuniform float spriteDepth;\nuniform float spriteSnap;\n\nuniform vec2 renderOdd;\nuniform float renderScale;\nuniform float renderScaleInv;\nuniform float pixelUnit;\nuniform float focusDepth;\n\nuniform vec4 geometryClip;\nattribute vec4 position4;\nattribute vec2 sprite;\n\nvarying float vPixelSize;\n\n// External\nvec3 getPosition(vec4 xyzw, float canonical);\nvec4 getSprite(vec4 xyzw);\n\nvec3 getSpritePosition() {\n  // Clip points\n  vec4 p = min(geometryClip, position4);\n  float diff = length(position4 - p);\n  if (diff > 0.0) {\n    return vec3(0.0, 0.0, 1000.0);\n  }\n\n  // Make sprites\n  vec3 center = getPosition(p, 1.0);\n  vec4 atlas = getSprite(p);\n\n  // Sprite goes from -1..1, width = 2.\n  // -1..1 -> -0.5..0.5\n  vec2 halfSprite = sprite * .5;\n  vec2 halfFlipSprite = vec2(halfSprite.x, -halfSprite.y);\n\n#ifdef POSITION_UV\n  // Assign UVs\n  vUV = atlas.xy + atlas.zw * (halfFlipSprite + .5);\n#endif\n\n  // Depth blending\n  // TODO: orthographic camera\n  // Workaround: set depth = 0\n  float depth = focusDepth, z;\n  z = -center.z;\n  if (spriteDepth < 1.0) {\n    depth = mix(z, focusDepth, spriteDepth);\n  }\n  \n  // Match device/unit mapping \n  float size = pixelUnit * spriteScale;\n  float depthSize = depth * size;\n\n  // Calculate pixelSize for anti-aliasing\n  float pixelSize = (spriteDepth > 0.0 ? depthSize / z : size);\n  vPixelSize = pixelSize;\n\n  // Position sprite\n  vec2 atlasOdd = fract(atlas.zw / 2.0);\n  vec2 offset = (spriteOffset + halfSprite * atlas.zw) * depthSize;\n  if (spriteSnap > 0.5) {\n    // Snap to pixel (w/ epsilon shift to avoid jitter)\n    return vec3(((floor(center.xy / center.z * renderScale + 0.001) + renderOdd + atlasOdd) * center.z + offset) * renderScaleInv, center.z);\n  }\n  else {\n    // Place directly\n    return center + vec3(offset * renderScaleInv, 0.0);\n  }\n\n}\n","stereographic.position":"uniform float stereoBend;\n\nuniform mat4 viewMatrix;\n\nvec4 getStereoPosition(vec4 position, inout vec4 stpq) {\n  if (stereoBend > 0.0001) {\n\n    vec3 pos = position.xyz;\n    float r = length(pos);\n    float z = r + pos.z;\n    vec3 project = vec3(pos.xy / z, r);\n    \n    vec3 lerped = mix(pos, project, stereoBend);\n\n    return viewMatrix * vec4(lerped, 1.0);\n  }\n  else {\n    return viewMatrix * vec4(position.xyz, 1.0);\n  }\n}","stereographic4.position":"uniform float stereoBend;\nuniform vec4 basisScale;\nuniform vec4 basisOffset;\nuniform mat4 viewMatrix;\nuniform vec2 view4D;\n\nvec4 getStereographic4Position(vec4 position, inout vec4 stpq) {\n  \n  vec4 transformed;\n  if (stereoBend > 0.0001) {\n\n    float r = length(position);\n    float w = r + position.w;\n    vec4 project = vec4(position.xyz / w, r);\n    \n    transformed = mix(position, project, stereoBend);\n  }\n  else {\n    transformed = position;\n  }\n\n  vec4 pos4 = transformed * basisScale - basisOffset;\n  vec3 xyz = (viewMatrix * vec4(pos4.xyz, 1.0)).xyz;\n  return vec4(xyz, pos4.w * view4D.y + view4D.x);\n}\n","stpq.sample.2d":"varying vec2 vST;\n\nvec4 getSample(vec2 st);\n\nvec4 getSTSample() {\n  return getSample(vST);\n}\n","stpq.xyzw.2d":"varying vec2 vUV;\n\nvoid setRawUV(vec4 xyzw) {\n  vUV = xyzw.xy;\n}\n","strip.position.normal":"uniform vec4 geometryClip;\nattribute vec4 position4;\nattribute vec3 strip;\n\n// External\nvec3 getPosition(vec4 xyzw, float canonical);\n\nvarying vec3 vNormal;\nvarying vec3 vLight;\nvarying vec3 vPosition;\n\nvoid getStripGeometry(vec4 xyzw, vec3 strip, out vec3 pos, out vec3 normal) {\n  vec3 a, b, c;\n\n  a   = getPosition(xyzw, 1.0);\n  b   = getPosition(vec4(xyzw.xyz, strip.x), 0.0);\n  c   = getPosition(vec4(xyzw.xyz, strip.y), 0.0);\n\n  normal = normalize(cross(c - a, b - a)) * strip.z;\n  \n  pos = a;\n}\n\nvec3 getStripPositionNormal() {\n  vec3 center, normal;\n\n  vec4 p = min(geometryClip, position4);\n\n  getStripGeometry(p, strip, center, normal);\n  vNormal   = normal;\n  vLight    = normalize((viewMatrix * vec4(1.0, 2.0, 2.0, 0.0)).xyz);\n  vPosition = -center;\n\n  return center;\n}\n","style.color":"uniform vec3 styleColor;\nuniform float styleOpacity;\n\nvec4 getStyleColor() {\n  return vec4(styleColor, styleOpacity);\n}\n","subdivide.depth":"uniform float subdivideBevel;\n\n// External\nvec4 sampleData(vec4 xyzw);\n\nvec4 subdivideDepth(vec4 xyzw) {\n  float x = xyzw.z;\n  float i = floor(x);\n  float f = x - i;\n\n  float minf = subdivideBevel * min(f, 1.0 - f);\n  float g = (f > 0.5) ? 1.0 - minf : (f < 0.5) ? minf : 0.5;\n\n  return sampleData(vec4(xyzw.xy, i + g, xyzw.w));\n}\n","subdivide.depth.lerp":"uniform float subdivideBevel;\n\n// External\nvec4 sampleData(vec4 xyzw);\n\nvec4 subdivideDepthLerp(vec4 xyzw) {\n  float x = xyzw.z;\n  float i = floor(x);\n  float f = x - i;\n\n  float minf = subdivideBevel * min(f, 1.0 - f);\n  float g = (f > 0.5) ? 1.0 - minf : (f < 0.5) ? minf : 0.5;\n\n  vec4 xyzw1 = vec4(xyzw.xy, i, xyzw.w);\n  vec4 xyzw2 = vec4(xyzw.xy, i + 1.0, xyzw.w);\n  \n  vec4 a = sampleData(xyzw1);\n  vec4 b = sampleData(xyzw2);\n\n  return mix(a, b, g);\n}\n","subdivide.height":"uniform float subdivideBevel;\n\n// External\nvec4 sampleData(vec4 xyzw);\n\nvec4 subdivideHeight(vec4 xyzw) {\n  float x = xyzw.y;\n  float i = floor(x);\n  float f = x - i;\n\n  float minf = subdivideBevel * min(f, 1.0 - f);\n  float g = (f > 0.5) ? 1.0 - minf : (f < 0.5) ? minf : 0.5;\n\n  return sampleData(vec4(xyzw.x, i + g, xyzw.zw));\n}\n","subdivide.height.lerp":"uniform float subdivideBevel;\n\n// External\nvec4 sampleData(vec4 xyzw);\n\nvec4 subdivideHeightLerp(vec4 xyzw) {\n  float x = xyzw.y;\n  float i = floor(x);\n  float f = x - i;\n\n  float minf = subdivideBevel * min(f, 1.0 - f);\n  float g = (f > 0.5) ? 1.0 - minf : (f < 0.5) ? minf : 0.5;\n\n  vec4 xyzw1 = vec4(xyzw.x, i, xyzw.zw);\n  vec4 xyzw2 = vec4(xyzw.x, i + 1.0, xyzw.zw);\n  \n  vec4 a = sampleData(xyzw1);\n  vec4 b = sampleData(xyzw2);\n\n  return mix(a, b, g);\n}\n","subdivide.items":"uniform float subdivideBevel;\n\n// External\nvec4 sampleData(vec4 xyzw);\n\nvec4 subdivideItems(vec4 xyzw) {\n  float x = xyzw.w;\n  float i = floor(x);\n  float f = x - i;\n\n  float minf = subdivideBevel * min(f, 1.0 - f);\n  float g = (f > 0.5) ? 1.0 - minf : (f < 0.5) ? minf : 0.5;\n\n  return sampleData(vec4(xyzw.xyz, i + g));\n}\n","subdivide.items.lerp":"uniform float subdivideBevel;\n\n// External\nvec4 sampleData(vec4 xyzw);\n\nvec4 subdivideItemsLerp(vec4 xyzw) {\n  float x = xyzw.w;\n  float i = floor(x);\n  float f = x - i;\n\n  float minf = subdivideBevel * min(f, 1.0 - f);\n  float g = (f > 0.5) ? 1.0 - minf : (f < 0.5) ? minf : 0.5;\n\n  vec4 xyzw1 = vec4(xyzw.xyz, i);\n  vec4 xyzw2 = vec4(xyzw.xyz, i + 1.0);\n  \n  vec4 a = sampleData(xyzw1);\n  vec4 b = sampleData(xyzw2);\n\n  return mix(a, b, g);\n}\n","subdivide.width":"uniform float subdivideBevel;\n\n// External\nvec4 sampleData(vec4 xyzw);\n\nvec4 subdivideWidth(vec4 xyzw) {\n  float x = xyzw.x;\n  float i = floor(x);\n  float f = x - i;\n\n  float minf = subdivideBevel * min(f, 1.0 - f);\n  float g = (f > 0.5) ? 1.0 - minf : (f < 0.5) ? minf : 0.5;\n\n  return sampleData(vec4(i + g, xyzw.yzw));\n}\n","subdivide.width.lerp":"uniform float subdivideBevel;\n\n// External\nvec4 sampleData(vec4 xyzw);\n\nvec4 subdivideWidthLerp(vec4 xyzw) {\n  float x = xyzw.x;\n  float i = floor(x);\n  float f = x - i;\n\n  float minf = subdivideBevel * min(f, 1.0 - f);\n  float g = (f > 0.5) ? 1.0 - minf : (f < 0.5) ? minf : 0.5;\n\n  vec4 xyzw1 = vec4(i, xyzw.yzw);\n  vec4 xyzw2 = vec4(i + 1.0, xyzw.yzw);\n  \n  vec4 a = sampleData(xyzw1);\n  vec4 b = sampleData(xyzw2);\n\n  return mix(a, b, g);\n}\n","surface.mask.hollow":"attribute vec4 position4;\n\nfloat getSurfaceHollowMask(vec4 xyzw) {\n  vec4 df = abs(fract(position4) - .5);\n  vec2 df2 = min(df.xy, df.zw);\n  float df3 = min(df2.x, df2.y);\n  return df3;\n}","surface.position":"uniform vec4 geometryClip;\nuniform vec4 geometryResolution;\nuniform vec4 mapSize;\n\nattribute vec4 position4;\n\n// External\nvec3 getPosition(vec4 xyzw, float canonical);\n\nvec3 getSurfacePosition() {\n  vec4 p = min(geometryClip, position4);\n\n#ifdef SURFACE_CLOSED_X\n  if (p.x == geometryClip.x) p.x = 0.0;\n#endif\n#ifdef SURFACE_CLOSED_Y\n  if (p.y == geometryClip.y) p.y = 0.0;\n#endif\n\n  vec3 xyz = getPosition(p, 1.0);\n\n  // Overwrite UVs\n#ifdef POSITION_UV\n#ifdef POSITION_UV_INT\n  vUV = -.5 + (position4.xy * geometryResolution.xy) * mapSize.xy;\n#else\n  vUV = position4.xy * geometryResolution.xy;\n#endif\n#endif\n\n  return xyz;\n}\n","surface.position.normal":"uniform vec4 mapSize;\nuniform vec4 geometryResolution;\nuniform vec4 geometryClip;\nattribute vec4 position4;\n\n// External\nvec3 getPosition(vec4 xyzw, float canonical);\nvec3 getNormal(vec4 xyzw);\n\nvarying vec3 vNormal;\nvarying vec3 vLight;\nvarying vec3 vPosition;\n\nvec3 getSurfacePositionNormal() {\n\n  vec4 p = min(geometryClip, position4);\n#ifdef SURFACE_CLOSED_X\n  if (p.x == geometryClip.x) p.x = 0.0;\n#endif\n#ifdef SURFACE_CLOSED_Y\n  if (p.y == geometryClip.y) p.y = 0.0;\n#endif\n\n  vec3 center = getPosition(p, 1.0);\n  vNormal     = normalMatrix * normalize(getNormal(p));\n  vLight      = normalize((viewMatrix * vec4(1.0, 2.0, 2.0, 0.0)).xyz); // hardcoded directional light\n  vPosition   = -center;\n\n#ifdef POSITION_UV\n#ifdef POSITION_UV_INT\n  vUV = -.5 + (position4.xy * geometryResolution.xy) * mapSize.xy;\n#else\n  vUV = position4.xy * geometryResolution.xy;\n#endif\n#endif\n\n  return center;\n}\n","surface.position.shaded":"uniform vec4 mapSize;\nuniform vec4 geometryResolution;\nuniform vec4 geometryClip;\nattribute vec4 position4;\n\n// External\nvec3 getPosition(vec4 xyzw, float canonical);\n\nvec4 wrapAround(vec4 xyzw) {\n#ifdef SURFACE_CLOSED_X\n  float gx = geometryClip.x;\n  if (xyzw.x < 0.0) xyzw.x += gx;\n  if (xyzw.x >= gx) xyzw.x -= gx;\n#endif\n#ifdef SURFACE_CLOSED_Y\n  float gy = geometryClip.y;\n  if (xyzw.y < 0.0) xyzw.y += gy;\n  if (xyzw.y >= gy) xyzw.y -= gy;\n#endif\n  return xyzw;\n}\n\nvoid getSurfaceGeometry(vec4 xyzw, float edgeX, float edgeY, out vec3 left, out vec3 center, out vec3 right, out vec3 up, out vec3 down) {\n  vec4 deltaX = vec4(1.0, 0.0, 0.0, 0.0);\n  vec4 deltaY = vec4(0.0, 1.0, 0.0, 0.0);\n\n  center =                  getPosition(xyzw, 1.0);\n  left   =                  center;\n  down   =                  center;\n  right  = (edgeX < 0.5)  ? getPosition(wrapAround(xyzw + deltaX), 0.0) : (2.0 * center - getPosition(xyzw - deltaX, 0.0));\n  up     = (edgeY < 0.5)  ? getPosition(wrapAround(xyzw + deltaY), 0.0) : (2.0 * center - getPosition(xyzw - deltaY, 0.0));\n}\n\nvec3 getSurfaceNormal(vec3 left, vec3 center, vec3 right, vec3 up, vec3 down) {\n  vec3 dx = right - left;\n  vec3 dy = up    - down;\n  vec3 n = cross(dy, dx);\n  if (length(n) > 0.0) {\n    return normalize(n);\n  }\n  return vec3(0.0, 1.0, 0.0);\n}\n\nvarying vec3 vNormal;\nvarying vec3 vLight;\nvarying vec3 vPosition;\n\nvec3 getSurfacePositionShaded() {\n  vec3 left, center, right, up, down;\n\n  vec4 p = min(geometryClip, position4);\n  vec2 surface = vec2(0.0);\n#ifdef SURFACE_CLOSED_X\n  if (p.x == geometryClip.x) p.x = 0.0;\n#else\n  if (p.x == geometryClip.x) surface.x = 1.0;\n  //if (p.x == 0.0) surface.x = -1.0;\n#endif\n#ifdef SURFACE_CLOSED_Y\n  if (p.y == geometryClip.y) p.y = 0.0;\n#else\n  if (p.y == geometryClip.y) surface.y = 1.0;\n  //if (p.y == 0.0) surface.y = -1.0;\n#endif\n\n  getSurfaceGeometry(p, surface.x, surface.y, left, center, right, up, down);\n  vNormal   = getSurfaceNormal(left, center, right, up, down);\n  vLight    = normalize((viewMatrix * vec4(1.0, 2.0, 2.0, 0.0)).xyz); // hardcoded directional light\n  vPosition = -center;\n\n#ifdef POSITION_UV\n#ifdef POSITION_UV_INT\n  vUV = -.5 + (position4.xy * geometryResolution.xy) * mapSize.xy;\n#else\n  vUV = position4.xy * geometryResolution.xy;\n#endif\n#endif\n\n  return center;\n}\n","ticks.position":"uniform float worldUnit;\nuniform float focusDepth;\nuniform float tickSize;\nuniform float tickEpsilon;\nuniform vec3  tickNormal;\nuniform vec2  tickStrip;\n\nvec4 getSample(vec4 xyzw);\n\nvec3 transformPosition(vec4 position, in vec4 stpqIn, out vec4 stpqOut);\n\nvec3 getTickPosition(vec4 xyzw, in vec4 stpqIn, out vec4 stpqOut) {\n  float epsilon = tickEpsilon;\n\n  // determine tick direction\n  float leftX  = max(tickStrip.x, xyzw.y - 1.0);\n  float rightX = min(tickStrip.y, xyzw.y + 1.0);\n  \n  vec4 left    = getSample(vec4(leftX,  xyzw.zw, 0.0));\n  vec4 right   = getSample(vec4(rightX, xyzw.zw, 0.0));\n  vec4 diff    = right - left;\n\n  vec3 normal  = cross(normalize(diff.xyz + vec3(diff.w)), tickNormal);\n  float bias   = max(0.0, 1.0 - length(normal) * 2.0);\n       normal  = mix(normal, tickNormal.yzx, bias * bias);\n  \n  // transform (point) and (point + delta)\n  vec4 center  = getSample(vec4(xyzw.yzw, 0.0));\n  vec4 delta   = vec4(normal, 0.0) * epsilon;\n\n  vec4 a = center;\n  vec4 b = center + delta;\n\n  vec4 _;\n  vec3 c = transformPosition(a, stpqIn, stpqOut);\n  vec3 d = transformPosition(b, stpqIn, _);\n  \n  // sample on either side to create line\n  float line = xyzw.x - .5;\n  vec3  mid  = c;\n  vec3  side = normalize(d - c);\n\n  return mid + side * line * tickSize * worldUnit * focusDepth;\n}\n","transform3.position":"uniform mat4 transformMatrix;\n\nvec4 transformPosition(vec4 position, inout vec4 stpq) {\n  return transformMatrix * vec4(position.xyz, 1.0);\n}\n","transform4.position":"uniform mat4 transformMatrix;\nuniform vec4 transformOffset;\n\nvec4 transformPosition(vec4 position, inout vec4 stpq) {\n  return transformMatrix * position + transformOffset;\n}\n","view.position":"// Implicit three.js uniform\n// uniform mat4 viewMatrix;\n\nvec4 getViewPosition(vec4 position, inout vec4 stpq) {\n  return (viewMatrix * vec4(position.xyz, 1.0));\n}\n"};class qs{constructor(t){this.context=t,this.anims=[]}make(t,e){const i=new Fs(this,this.context.time,t,e);return this.anims.push(i),i}unmake(t){return this.anims=Array.from(this.anims).filter((e=>e!==t))}update(){const{time:t}=this.context;return this.anims=(()=>{const e=[];for(const i of Array.from(this.anims))!1!==i.update(t)&&e.push(i);return e})()}lerp(t,e,i,n,r){if(null==r&&(r=t.make()),t.lerp)r=t.lerp(e,i,r,n);else{if(t.emitter){const r=e.emitterFrom,s=i.emitterTo;if(null!=r&&null!=s&&r===s)return r.lerp(n),r;{const r=t.emitter(e,i);return e.emitterFrom=r,i.emitterTo=r,r.lerp(n),r}}if(t.op){const s=function(t,e){return t===+t&&e===+e?t+(e-t)*n:n>.5?e:t};r=t.op(e,i,r,s)}else r=n>.5?i:e}return r}}class Fs{constructor(t,e,i,n){this.animator=t,this.time=e,this.type=i,this.options=n,this.value=this.type.make(),this.target=this.type.make(),this.queue=[]}dispose(){return this.animator.unmake(this)}set(){let{target:t}=this,e=arguments.length>1?[].slice.call(arguments):arguments[0],i=!1;return e=this.type.validate(e,t,(()=>i=!0)),i||(t=e),this.cancel(),this.target=this.value,this.value=t,this.notify()}getTime(){const{clock:t}=this.options,e=t?t.getTime():this.time;return this.options.realtime?e.time:e.clock}cancel(t){let e;null==t&&(t=this.getTime());const{queue:i}=this,n=(()=>{const n=[];for(e of Array.from(i))e.end>=t&&n.push(e);return n})();for(e of(this.queue=(()=>{const n=[];for(e of Array.from(i))e.end<t&&n.push(e);return n})(),Array.from(n)))"function"==typeof e.complete&&e.complete(!1);"function"==typeof this.options.complete&&this.options.complete(!1)}notify(){return"function"==typeof this.options.step?this.options.step(this.value):void 0}immediate(t,e){const{duration:i,delay:n,ease:r,step:s,complete:o}=e,a=this.getTime()+n,l=a+i;let h=!1,u=this.type.make();return void 0===(t=this.type.validate(t,u,(function(){return h=!0,null})))||h||(u=t),this.cancel(a),this.queue.push({from:null,to:u,start:a,end:l,ease:r,step:s,complete:o})}update(t){if(this.time=t,0===this.queue.length)return!0;const e=this.getTime();let{value:i}=this;const{queue:n}=this;let r=!1;for(;!r;){const t=n[0];let{from:s}=t;const{to:o,start:a,end:l,step:h,complete:u,ease:c}=t;null==s&&(s=t.from=this.type.clone(this.value));let p=xi((e-a)/Math.max(1e-5,l-a)||0,0,1);if(0===p)return;const d=(()=>{switch(c){case"linear":case 0:return null;case"cosine":case 1:default:return wi;case"binary":case 2:return _i;case"hold":case 3:return ki}})();if(null!=d&&(p=d(p)),r=p<1,i=r?this.animator.lerp(this.type,s,o,p,i):o,"function"==typeof h&&h(i),!r&&("function"==typeof u&&u(!0),"function"==typeof this.options.complete&&this.options.complete(!0),n.shift(),0===n.length))break}return this.value=i,this.notify()}}class Is{v2(){return this}constructor(t,e,i){this._context=t,this._up=e,this._targets=i;const n=this._context.controller.getRoot();null==this._targets&&(this._targets=[n]),this.isRoot=1===this._targets.length&&this._targets[0]===n,this.isLeaf=1===this._targets.length&&null==this._targets[0].children;for(let t=0;t<this._targets.length;t++){const e=this._targets[t];this[t]=e}this.length=this._targets.length;for(const t of Array.from(this._context.controller.getTypes()))["root"].includes(t)||(this[t]=(e,i)=>this.add(t,e,i))}select(t){const e=this._context.model.select(t,this.isRoot?null:this._targets);return this._push(e)}eq(t){return this._targets.length>t?this._push([this._targets[t]]):this._push([])}filter(t){if("string"==typeof t){const e=this._context.model._matcher(t);t=t=>e(t)}return this._push(this._targets.filter(t))}map(t){return function(t,e,i){const n=[],r=t<e,s=i?r?e+1:e-1:e;for(let e=t;r?e<s:e>s;r?e++:e--)n.push(e);return n}(0,this.length,!1).map((e=>t(this[e],e,this)))}each(t){for(let e=0,i=this.length,n=0<=i;n?e<i:e>i;n?e++:e--)t(this[e],e,this);return this}add(t,e,i){const{controller:n}=this._context;if(this.isLeaf)return this._pop().add(t,e,i);const r=[];for(const s of this._targets){const o=n.make(t,e,i);n.add(o,s),r.push(o)}return this._push(r)}remove(t){if(t)return this.select(t).remove();for(const t of Array.from(this._targets.slice().reverse()))this._context.controller.remove(t);return this._pop()}set(t,e){for(const i of Array.from(this._targets))this._context.controller.set(i,t,e);return this}getAll(t){return Array.from(this._targets).map((e=>this._context.controller.get(e,t)))}get(t){return null!=this._targets[0]?this._targets[0].get(t):void 0}evaluate(t,e){return null!=this._targets[0]?this._targets[0].evaluate(t,e):void 0}bind(t,e){for(const i of Array.from(this._targets))this._context.controller.bind(i,t,e);return this}unbind(t){for(const e of Array.from(this._targets))this._context.controller.unbind(e,t);return this}end(){return(this.isLeaf?this._pop():this)._pop()}_push(t){return new Is(this._context,this,t)}_pop(){return null!=this._up?this._up:this}_reset(){let t;return null!=(t=null!=this._up?this._up.reset():void 0)?t:this}map(t){return this._targets.map(t)}on(){const t=arguments;return this._targets.map((e=>e.on.apply(e,t))),this}off(){const t=arguments;return this._targets.map((e=>e.off.apply(e,t))),this}toString(){const t=this._targets.map((t=>t.toString()));return this._targets.length>1?`[${t.join(", ")}]`:t[0]}toMarkup(){return this._targets.map((t=>t.toMarkup())).join("\n\n")}print(){return U(this._targets.map((t=>t.toMarkup())).join("\n\n")),this}debug(){const t=this.inspect();console.log("Renderables: ",t.renderables),console.log("Renders: ",t.renders),console.log("Shaders: ",t.shaders);const e=[];for(const i of Array.from(t.shaders)){const t=i.owner.constructor.name;e.push(`${t} - Vertex`),e.push(i.vertex),e.push(`${t} - Fragment`),e.push(i.fragment)}return Ts(e)}inspect(t,e,i){let n;"boolean"==typeof e&&(i=e,e=null),null==i&&(i=!0);const r=n=function(t,i){if(null==i&&(i=[]),e&&!t.traits.hash[e]||i.push((t=>null!=(null!=t.controller?t.controller.objects:void 0)?null!=t.controller?t.controller.objects:void 0:[])(t)),null!=t.children)for(const e of Array.from(t.children))n(e,i);return i},s=function(t){return t=(t=t.reduce(((t,e)=>t.concat(e)),[])).filter(((e,i)=>null!=e&&t.indexOf(e)===i))},o=function(t,e){const i={};return i.owner=t,i.geometry=e.geometry,i.material=e.material,i.vertex=e.userData.vertexGraph,i.fragment=e.userData.fragmentGraph,i},a={nodes:this._targets.slice(),renderables:[],renders:[],shaders:[]};for(const e of Array.from(this._targets)){let n;i&&e.print(t,"info");const l={renderables:n=s(r(e)),renders:s(n.map((t=>t.renders))),shaders:s(n.map((t=>null!=t.renders?t.renders.map((e=>o(t,e))):void 0)))};for(const t in l)a[t]=a[t].concat(l[t])}return a}}class Ls{constructor(t,e){this.model=t,this.primitives=e}getRoot(){return this.model.getRoot()}getTypes(){return this.primitives.getTypes()}make(t,e,i){return this.primitives.make(t,e,i)}get(t,e){return t.get(e)}set(t,e,i){try{return t.set(e,i)}catch(e){return t.print(null,"warn"),console.error(e)}}bind(t,e,i){try{return t.bind(e,i)}catch(e){return t.print(null,"warn"),console.error(e)}}unbind(t,e){try{return t.unbind(e)}catch(e){return t.print(null,"warn"),console.error(e)}}add(t,e){return null==e&&(e=this.model.getRoot()),e.add(t)}remove(t){const e=t.parent;if(e)return e.remove(t)}}const Ns=h,Rs=a,Us=c,Vs=l,Bs=u,$s=t,Hs=o,Ws=p,Xs=i;class Gs{static initClass(){this.Namespace={Model:e,Overlay:s,Primitives:f,Render:m,Shaders:_,Stage:k,Util:z,DOM:Xs},this.Version="2.3.1"}constructor(t,e=null,i=null){let n;this.canvas=n=t.domElement,this.element=null,this.shaders=Ds(js),this.renderables=new sn(An,t,this.shaders),this.overlays=new ot(zt,n),this.scene=this.renderables.make("scene",{scene:e}),this.camera=this.defaultCamera=null!=i?i:new S.PerspectiveCamera,this.attributes=new P(tn,this),this.primitives=new Ki(tn,this),this.root=this.primitives.make("root"),this.model=new st(this.root),this.guard=new Z,this.controller=new Ls(this.model,this.primitives),this.animator=new qs(this),this.api=new Is(this),this.speed=1,this.time={now:+new Date/1e3,time:0,delta:0,clock:0,step:0}}init(){return this.scene.inject(),this.overlays.inject(),this}destroy(){return this.scene.unject(),this.overlays.unject(),this}resize(t){return null==t&&(t={}),null==t.renderWidth&&(t.renderWidth=null!=t.viewWidth?t.viewWidth:t.viewWidth=1280),null==t.renderHeight&&(t.renderHeight=null!=t.viewHeight?t.viewHeight:t.viewHeight=720),null==t.pixelRatio&&(t.pixelRatio=t.renderWidth/Math.max(1e-6,t.viewWidth)),null==t.aspect&&(t.aspect=t.viewWidth/Math.max(1e-6,t.viewHeight)),this.root.controller.resize(t),this}frame(t){return this.pre(t),this.update(),this.render(),this.post(),this}pre(t){return t||((t={now:+new Date/1e3,time:0,delta:0,clock:0,step:0}).delta=null!=this.time.now?t.now-this.time.now:0,t.delta>1&&(t.delta=1/60),t.step=t.delta*this.speed,t.time=this.time.time+t.delta,t.clock=this.time.clock+t.step),this.time=t,"function"==typeof this.root.controller.pre&&this.root.controller.pre(),this}update(){return this.animator.update(),this.attributes.compute(),this.guard.iterate({step:()=>{let t=this.attributes.digest();return t||this.model.digest()},last(){return{attribute:this.attributes.getLastTrigger(),model:this.model.getLastTrigger()}}}),"function"==typeof this.root.controller.update&&this.root.controller.update(),this.camera=this.root.controller.getCamera(),this.speed=this.root.controller.getSpeed(),this}render(){return"function"==typeof this.root.controller.render&&this.root.controller.render(),this.scene.render(),this}post(){return"function"==typeof this.root.controller.post&&this.root.controller.post(),this}setWarmup(t){return this.scene.warmup(t),this}getPending(){return this.scene.pending.length}}Gs.initClass();const Ys=Math.PI,Zs=2*Ys,Qs=Math.E,Js=Gs,Ks=Gs.Version,to=e,eo=s,io=f,no=m,ro=_,so=k,oo=z,ao=Xs,lo=function(t){const e=new C(t);return e.fallback||(e.Time||e.install("time"),e.MathBox||e.install(["mathbox","splash"])),null!=e.mathbox?e.mathbox:e};C.registerPlugin("mathbox",{defaults:{init:!0,warmup:2,inspect:!0,splash:!0},listen:["ready","pre","update","post","resize"],install(t){let e=!1;return this.first=!0,t.MathBox={init:i=>{if(e)return;e=!0;const n=(null!=i?i.scene:void 0)||this.options.scene||t.scene,r=(null!=i?i.camera:void 0)||this.options.camera||t.camera;this.context=new Js(t.renderer,n,r),this.context.api.three=t.three=t,this.context.api.mathbox=t.mathbox=this.context.api,this.context.api.start=()=>t.Loop.start(),this.context.api.stop=()=>t.Loop.stop(),this.context.init(),this.context.resize(t.Size),this.context.setWarmup(this.options.warmup),this.pending=0,this.warm=!this.options.warmup,console.log("MathBox²",Ks),t.trigger({type:"mathbox/init",version:Ks,context:this.context})},destroy:()=>{e&&(e=!1,t.trigger({type:"mathbox/destroy",context:this.context}),this.context.destroy(),delete t.mathbox,delete this.context.api.three,delete this.context)},object:()=>null!=this.context?this.context.scene.root:void 0}},uninstall(t){t.MathBox.destroy(),delete t.MathBox},ready(t,e){if(this.options.init)return e.MathBox.init(),setTimeout((()=>{if(this.options.inspect&&e.MathBox)return this.inspect(e)}))},inspect(t){if(this.context.api.inspect(),!this.options.warmup)return this.info(t)},info(t){const e=function(t){const e=[];for(;t>=1e3;)e.unshift(("000"+t%1e3).slice(-3)),t=Math.floor(t/1e3);return e.unshift(t),e.join(",")},i=t.renderer.info.render;console.log("Geometry  ",e(i.triangles)+" triangles  ",e(i.points)+" points  ",e(i.lines)+" lines  ",e(i.calls)+" draw calls  ")},resize(t,e){return null!=this.context?this.context.resize(e.Size):void 0},pre(t,e){return null!=this.context?this.context.pre(e.Time):void 0},update(t,e){let i;return null!=this.context&&this.context.update(),(i=null!=this.context?this.context.camera:void 0)&&i!==e.camera&&(e.camera=i),e.Time.set({speed:this.context.speed}),this.progress(this.context.getPending(),e),null!=this.context?this.context.render():void 0},post(t,e){return null!=this.context?this.context.post():void 0},progress(t,e){if(!t&&!this.pending)return;let i=Math.max(t+this.options.warmup,this.pending);const n=i-t,r=i;e.trigger({type:"mathbox/progress",current:i-t,total:i}),0===t&&(i=0),this.pending=i,n!==r||this.warm||(this.warm=!0,this.options.inspect&&this.info(e))}})})(),r})()}));
//# sourceMappingURL=mathbox.min.js.map